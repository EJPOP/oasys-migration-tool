SELECT /* csp.bii.service.impl.CSPBII421QServiceImpl.CSPBII421QMainSelect */ NVL2(EPS_MNG_DVSN_CD,EPS_MNG_DVSN_CD,'전체') AS SE_NM /* 구분명 */,
    NVL2(RSG_YN,RSG_YN, NVL2(EPS_MNG_DVSN_CD,'소계','총계')) AS NVL2,
    SUM(TOT_CNT) AS TOT_CNT,
    SUM(SUB_CNT1) AS SUB_CNT1,
    SUM(SUB_CNT2) AS SUB_CNT2,
    SUM(SUB_CNT3) AS SUB_CNT3,
    SUM(SUB_CNT4) AS SUB_CNT4
FROM ( SELECT NVL(F_CODE_NM('1000084', A.EPS_MNG_DVSN_CD),'값없음') AS F_CODE_NM,
    CASE WHEN A.RSG_YN = 'Y' THEN '퇴직자' WHEN A.RSG_YN = 'N' THEN '현직자' ELSE '값없음' END AS RSG_YN,
    COUNT(*) AS TOT_CNT,
    COUNT(CASE WHEN B.INST_SECD = '10' THEN 1 ELSE NULL END) AS INST_SECD /* 기관구분코드 */,
    COUNT(CASE WHEN B.INST_SECD = '21' THEN 1 ELSE NULL END) AS INST_SECD /* 기관구분코드 */,
    COUNT(CASE WHEN B.INST_SECD = '22' THEN 1 ELSE NULL END) AS INST_SECD /* 기관구분코드 */,
    COUNT(CASE WHEN B.INST_SECD NOT IN ('10', '21', '22') OR B.INST_SECD IS NULL THEN 1 ELSE NULL END) AS INST_SECD /* 기관구분코드 */
FROM TBCSPBII300M A, TBDCMACM015M B WHERE A.OGDP_INST_CD = B.INST_CD(+) GROUP BY A.EPS_MNG_DVSN_CD , A.RSG_YN ) GROUP BY ROLLUP ( EPS_MNG_DVSN_CD, RSG_YN) ORDER BY NVL(EPS_MNG_DVSN_CD, '') DESC, NVL(RSG_YN, '0')