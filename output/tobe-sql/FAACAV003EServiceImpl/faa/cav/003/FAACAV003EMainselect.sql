/* faa/cav/003/FAACAV003EMainselect */ SELECT ROWNUM,
    A.JRSD_CD||'-'||A.ACNTG_CD||'-'||A.BLL_KDCD||'-'||A.PROF_RBPRSN_SQNO||'-'||A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO AS JRSD_CD /* 소관코드 */,
    A.PROF_YM /* 증명연월 */,
    A.BLL_RCPTN_DT /* 계산서수신일시 */,
    F_AV_ACCMN_NM(A.JRSD_CD,A.ACNTG_CD,A.BLL_KDCD ,A.PROF_RBPRSN_SQNO ,A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO) AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    F_AV_BLL_COPT_CD_NM(A.JRSD_CD) AS JRSD_NM /* 소관명 */,
    F_AV_ACNT_CD_NM(A.ACNTG_CD) AS ACNTG_CDNM /* 회계코드명 */,
    F_AV_BLL_CD_NM(A.BLL_KDCD, A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO) AS F_AV_BLL_CD_NM,
    '정정대기중' AS STATUS,
    B.BLL_PRCS_STTS_TPCD /* 계산서처리상태유형코드 */,
    (SELECT C.PRCS_STTS_YN AS PRCS_STTS_YN /* 처리상태여부 */
FROM TWFAACAV016M C WHERE C.JRSD_CD = A.JRSD_CD AND C.ACNTG_CD = A.ACNTG_CD AND C.BLL_KDCD = A.BLL_KDCD AND C.PROF_RBPRSN_SQNO = A.PROF_RBPRSN_SQNO AND C.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO AND C.PROF_YM = A.PROF_YM) AS PRCS_STTS_YN , A.JRSD_CD , A.ACNTG_CD , A.BLL_KDCD , A.PROF_RBPRSN_SQNO , A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO , C.PROF_RBPRSN_ABL_YMD , C.CRU_TELNO , C.PROF_RBPRSN_MDFR_NM FROM TWFAACAV002H A, TWFAACAV001M B, TWFAACAV003M C WHERE 1=1 AND A.PROF_YM = #PROF_YM# AND A.PROF_YM like #strProfYr# || '%' AND A.BLL_RCPTN_STTS_SECD = 'W' AND A.PROF_YM = B.PROF_YM AND A.JRSD_CD = B.JRSD_CD AND A.ACNTG_CD = B.ACNTG_CD AND A.BLL_KDCD = B.BLL_KDCD AND A.PROF_RBPRSN_SQNO = B.PROF_RBPRSN_SQNO AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = B.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO AND B.JRSD_CD = C.JRSD_CD AND B.ACNTG_CD = C.ACNTG_CD AND B.BLL_KDCD = C.BLL_KDCD AND B.PROF_RBPRSN_SQNO = C.PROF_RBPRSN_SQNO AND B.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = C.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO AND A.JRSD_CD = #JRSD_CD# AND A.ACNTG_CD = #ACNTG_CD# AND 1 = CASE WHEN #JRSD_CD# IS NOT NULL OR #ACNTG_CD# IS NOT NULL THEN CASE WHEN #PROF_RBPRSN_SQNO# IS NOT NULL THEN CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD = #BLL_KDCD# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD = #BLL_KDCD# THEN '1' END END ELSE CASE WHEN #BLL_KDCD# IN ('17', '18') THEN CASE WHEN #strFildGovYn# = 'N' THEN CASE WHEN A.BLL_KDCD IN ('17', '18') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN '1' END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD IN ('17', '18') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD IN ('17', '18') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' THEN '1' END END END WHEN #BLL_KDCD# = '19' THEN CASE WHEN #strFildGovYn# = 'N' THEN CASE WHEN A.BLL_KDCD = '19' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN '1' END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD = '19' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD = '19' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' THEN '1' END END END WHEN #BLL_KDCD# IN ('22', '23', '24') THEN CASE WHEN #strFildGovYn# = 'N' THEN CASE WHEN A.BLL_KDCD IN ('22', '23', '24') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN '1' END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD IN ('22', '23', '24') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD IN ('22', '23', '24') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' THEN '1' END END END WHEN #BLL_KDCD# IN ('42', '43') THEN CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD IN ('42', '43') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD IN ('42', '43') THEN '1' END END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD = #BLL_KDCD# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD = #BLL_KDCD# THEN '1' END END END END ELSE CASE WHEN #PROF_RBPRSN_SQNO# IS NOT NULL THEN CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD = #BLL_KDCD# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD = #BLL_KDCD# THEN '1' END END ELSE CASE WHEN #BLL_KDCD# IN ('17', '18') THEN CASE WHEN #strFildGovYn# = 'N' THEN CASE WHEN A.BLL_KDCD IN ('17', '18') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN '1' END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD IN ('17', '18') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD IN ('17', '18') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' THEN '1' END END END WHEN #BLL_KDCD# = '19' THEN CASE WHEN #strFildGovYn# = 'N' THEN CASE WHEN A.BLL_KDCD = '19' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN '1' END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD = '19' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD = '19' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' THEN '1' END END END WHEN #BLL_KDCD# IN ('22', '23', '24') THEN CASE WHEN #strFildGovYn# = 'N' THEN CASE WHEN A.BLL_KDCD IN ('22', '23', '24') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN '1' END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD IN ('22', '23', '24') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD IN ('22', '23', '24') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' THEN '1' END END END WHEN #BLL_KDCD# IN ('42', '43') THEN CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD IN ('42', '43') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD IN ('42', '43') THEN '1' END END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD = #BLL_KDCD# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD = #BLL_KDCD# THEN '1' END END END END END AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' AND A.PROF_RBPRSN_SQNO = #PROF_RBPRSN_SQNO# AND A.RCPTN_DT = (SELECT MAX(C.BLL_RCPTN_DT) AS BLL_RCPTN_DT /* 계산서수신일시 */
FROM TWFAACAV002H C WHERE A.PROF_YM = C.PROF_YM AND A.JRSD_CD = C.JRSD_CD AND A.ACNTG_CD = C.ACNTG_CD AND A.BLL_KDCD = C.BLL_KDCD AND A.PROF_RBPRSN_SQNO = C.PROF_RBPRSN_SQNO AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = C.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO) ORDER BY A.BLL_KDCD, A.JRSD_CD, A.ACNTG_CD, A.PROF_RBPRSN_SQNO, A.PROF_YM