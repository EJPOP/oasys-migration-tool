SELECT AGGR.INST_CD /* 기관코드 */,
    /*대상기관코드*/ F_ORG_INFO(AGGR.INST_CD,'1') AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    /*대상기관명*/ SUM(CASE WHEN SITU.ADT_BZTRP_KDCD IN ('02') THEN 1 ELSE 0 END) AS ADT_BZTRP_KDCD /* 감사출장종류코드 */,
    /*감사종류건수*/ MAX(AGGR.ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    /*최근감사기간 From*/ MAX(AGGR.ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */,
    /*최근감사기간 to*/ /* F_GET_REL_AUDWRK_CNT(strStrFromDt,strStrToDt,AGGR.ORG_CD) AUD_DCN , */ /*일수*/ SUM(AGGR.ADT_DCN) AS ADT_DCN /* 감사일수 */,
    SUM(AGGR.MAN_DAY) AS MAN_DAY /* 연인원 */
FROM TB_BADDED002M SITU, TB_BADDED001M AUD, (SELECT TTO.BZTRP_YR /* 출장년도 */,
    TTO.BZTRP_SQNO /* 출장순번 */,
    TTO.INST_CD /* 기관코드 */,
    MIN(TTO.ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    MAX(TTO.ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */,
    SUM(PTD.ADT_DCN) AS ADT_DCN /* 감사일수 */,
    MAX(PTD.ADT_DCN) AS ADT_DCN /* 감사일수 */
FROM TBBADDED006L PTD, TBBADDED008L TTO WHERE TTO.ADT_BGNG_YMD >= #strStrFromDt# /*화면의 감사기간 FROM*/ AND TTO.ADT_BGNG_YMD <= #strStrToDt# /*화면의 감사기간 TO*/ /* 감사기관을 하나 선택 후 조회시 조회기관과 동일한 기관구분,기관차수에 해당하는 기관이 조회되어지던 쿼리를 조회기관만 보이게 수정 - 2016.03.04 yyh */ AND TTO.INST_CD = #INST_CD# /*검색조건에 기간코드가 1개일때 의 기관코드*/ AND PTD.BZTRP_YR = TTO.BZTRP_YR AND PTD.BZTRP_SQNO = TTO.BZTRP_SQNO AND PTD.FT_SQNO = TTO.FT_SQNO AND PTD.FT_TRGT_INST_SQNO = TTO.FT_TRGT_INST_SQNO GROUP BY TTO.BZTRP_YR, TTO.BZTRP_SQNO, TTO.INST_CD) AGGR WHERE SITU.REL_ADT_YR = AUD.ADT_YR AND SITU.REL_ADT_NO = AUD.ADT_NO AND SITU.BZTRP_SECD ='1' AND SITU.ADT_BZTRP_KDCD IN ('02') AND AGGR.BZTRP_YR = SITU.BZTRP_YR AND AGGR.BZTRP_SQNO = SITU.BZTRP_SQNO GROUP BY AGGR.INST_CD ORDER BY INST_CD