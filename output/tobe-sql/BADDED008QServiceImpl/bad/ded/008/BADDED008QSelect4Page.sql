SELECT A.STRTG_GOAL_NM,
    B.ORG_TOT_CNT,
    B.ORG_TYPE_NM,
    B.CNT,
    C.GUBUN,
    C.FULL_AUD_NO,
    C.BZTRP_YR /* 출장년도 */,
    C.BZTRP_SQNO /* 출장순번 */,
    C.FT_SQNO /* 출장조순번 */,
    C.ADT_BGNG_YMD /* 감사시작일자 */,
    C.ADT_END_YMD /* 감사종료일자 */,
    C.ADT_DCN /* 감사일수 */,
    C.PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    C.CVLCPT_ADT_YR /* 민원감사년도 */,
    C.ADT_NO /* 감사번호 */,
    C.ADT_ASMT_SECD /* 감사과제구분코드 */,
    C.INST_SECD /* 기관구분코드 */,
    C.ADT_KDCD /* 감사종류코드 */,
    C.SPRVSN_DEPT_CD /* 주관부서코드 */,
    C.ADT_MTHD_SECD /* 감사방법구분코드 */,
    C.AUD_EXEC_DVSN_CD_NM,
    C.ADT_MTTR_NM /* 감사사항명 */,
    C.CVLCPT_ADT_STP_SQNO /* 민원감사단계순번 */,
    C.IN_PSON_CNT,
    C.EXT_PSON_CNT,
    C.IN_PSON_MAN_CNT,
    C.EXT_PSON_MAN_CNT,
    C.IN_PSON_TOT_CNT,
    C.EXT_PSON_TOT_CNT,
    C.SDATE,
    C.EDATE,
    C.DAYS,
    C.INST_CONT /* 기관개수 */
from ( select A.ADT_ASMT_SECD /* 감사과제구분코드 */,
    A.ADT_YR /* 감사년도 */,
    F_CODE_NM('1000008',A.ADT_ASMT_SECD) AS F_CODE_NM /* 감사방침 */
from TBBADDED001M A, TBBADDED002M B, TBBADDED008L C where A.CVLCPT_ADT_YR BETWEEN #strBztStYY# AND #strBztEndYY# /*화면 감사년도*/ and SUBSTR(A.ADT_ASMT_SECD, -1) BETWEEN #strAudTaskCdSt# AND #strAudTaskCdEnd# /*화면 감사방침 1~9*/ and B.REL_ADT_YR = A.CVLCPT_ADT_YR and B.REL_ADT_NO = A.ADT_NO and B.BZTRP_SECD = '1' and C.BZTRP_YR = B.BZTRP_YR and C.BZTRP_SQNO = B.BZTRP_SQNO and C.ADT_BGNG_YMD BETWEEN #strBztStYY#||#strBztStMM# AND #strBztEndYY#||#strBztEndMM# /*화면 감사기간*/ group by A.ADT_ASMT_SECD, A.CVLCPT_ADT_YR ) A, ( select max(X.CVLCPT_ADT_YR) AS CVLCPT_ADT_YR /* 민원감사년도 */,
    max(X.ADT_NO) AS ADT_NO /* 감사번호 */,
    MAX(X.ADT_ASMT_SECD) AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    X.INST_SECD /* 기관구분코드 */,
    max(X.BZTRP_YR) AS BZTRP_YR /* 출장년도 */,
    max(X.BZTRP_SQNO) AS BZTRP_SQNO /* 출장순번 */,
    SUM(X.INST_CONT) AS INST_CONT /* 기관개수 */,
    SUM(X.IN_PSON_MAN_CNT) AS IN_PSON_MAN_CNT,
    SUM(X.EXT_PSON_MAN_CNT) AS EXT_PSON_MAN_CNT,
    F_CODE_NM('1000119',X.INST_SECD) AS F_CODE_NM,
    /*기관구분명*/ /*--Z.CD_NM as ORG_TYPE_NM,*/ count(*) AS CNT
from (select AA.CVLCPT_ADT_YR /* 민원감사년도 */,
    AA.ADT_NO /* 감사번호 */,
    AA.ADT_ASMT_SECD /* 감사과제구분코드 */,
    AA.INST_SECD /* 기관구분코드 */,
    AA.BZTRP_YR /* 출장년도 */,
    AA.BZTRP_SQNO /* 출장순번 */,
    BB. AS INST_CONT /* 기관개수 */,
    CC.IN_PSON_MAN_CNT,
    CC.EXT_PSON_MAN_CNT
from (select A.ADT_YR /* 감사년도 */,
    A.ADT_NO /* 감사번호 */,
    max(A.ADT_ASMT_SECD) AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    A.INST_SECD /* 기관구분코드 */,
    max(C.BZTRP_YR) AS BZTRP_YR /* 출장년도 */,
    max(C.BZTRP_SQNO) AS BZTRP_SQNO /* 출장순번 */
from TBBADDED001M A, TBBADDED002M B, TBBADDED008L C where A.CVLCPT_ADT_YR BETWEEN #strBztStYY# AND #strBztEndYY# /*화면 감사년도*/ and B.REL_ADT_YR = A.CVLCPT_ADT_YR and B.REL_ADT_NO = A.ADT_NO and B.BZTRP_SECD = '1' and C.BZTRP_YR = B.BZTRP_YR and C.BZTRP_SQNO = B.BZTRP_SQNO and C.ADT_BGNG_YMD BETWEEN #strBztStYY#||#strBztStMM# AND #strBztEndYY#||#strBztEndMM# /*화면의 감사기간*/ group by A.CVLCPT_ADT_YR, A.ADT_NO, A.INST_SECD) AA, (select BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    count(distinct INST_CD) AS INST_CONT /* 기관개수 */,
    min(ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    max(ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */
from TBBADDED008L group by BZTRP_YR, BZTRP_SQNO) BB, (select A.BZTRP_YR /* 출장년도 */,
    A.BZTRP_SQNO /* 출장순번 */,
    sum( case when A.EMP_SECD = '0' then B.ADT_DCN else 0 end) AS EMP_SECD /* 직원구분코드 */,
    sum( case when A.EMP_SECD = '0' then 0 else B.ADT_DCN end) AS EMP_SECD /* 직원구분코드 */,
    MIN(B.ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    MAX(B.ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */,
    MAX(B.ADT_DCN) AS ADT_DCN /* 감사일수 */
from TBBADDED005L A, TBBADDED006L B where B.BZTRP_YR = A.BZTRP_YR and B.BZTRP_SQNO = A.BZTRP_SQNO and B.FT_SQNO = A.FT_SQNO and B.BZTRVR_ALTMNT_SQNO = A.BZTRVR_ALTMNT_SQNO group by A.BZTRP_YR, A.BZTRP_SQNO ) CC where 1=1 and BB.BZTRP_YR(+) = AA.BZTRP_YR and BB.BZTRP_SQNO(+) = AA.BZTRP_SQNO and CC.BZTRP_YR(+) = AA.BZTRP_YR and CC.BZTRP_SQNO(+) = AA.BZTRP_SQNO ) X group by INST_SECD, X.INST_SECD ) B, ( select /*+NO_MERGE*/ F_MNG_KND_AUDYRNO(max(CVLCPT_ADT_YR), max(ADT_NO), max(ADT_KDCD), '-') AS F_MNG_KND_AUDYRNO,
    F_MNG_KND_AUDYRNO(max(CVLCPT_ADT_YR), max(ADT_NO), max(ADT_KDCD), '-') AS F_MNG_KND_AUDYRNO,
    AA.BZTRP_YR /* 출장년도 */,
    AA.BZTRP_SQNO /* 출장순번 */,
    AA.FT_SQNO /* 출장조순번 */,
    AA.ADT_BGNG_YMD /* 감사시작일자 */,
    AA.ADT_END_YMD /* 감사종료일자 */,
    AA.ADT_DCN /* 감사일수 */,
    AA.PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    max(AA.CVLCPT_ADT_YR) AS CVLCPT_ADT_YR /* 민원감사년도 */,
    max(AA.ADT_NO) AS ADT_NO /* 감사번호 */,
    max(AA.ADT_ASMT_SECD) AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    max(AA.INST_SECD) AS INST_SECD /* 기관구분코드 */,
    max(AA.ADT_KDCD) AS ADT_KDCD /* 감사종류코드 */,
    max(AA.SPRVSN_DEPT_CD) AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    max(AA.ADT_MTHD_SECD) AS ADT_MTHD_SECD /* 감사방법구분코드 */,
    max(AA.AUD_EXEC_DVSN_CD_NM) AS AUD_EXEC_DVSN_CD_NM,
    max(AA.ADT_MTTR_NM) AS ADT_MTTR_NM /* 감사사항명 */,
    AA.CVLCPT_ADT_STP_SQNO /* 민원감사단계순번 */,
    max(BB.IN_PSON_CNT) AS IN_PSON_CNT,
    max(BB.EXT_PSON_CNT) AS EXT_PSON_CNT,
    max(CC.IN_PSON_MAN_CNT) AS IN_PSON_MAN_CNT,
    max(CC.EXT_PSON_MAN_CNT) AS EXT_PSON_MAN_CNT,
    max(DD.IN_PSON_TOT_CNT) AS IN_PSON_TOT_CNT,
    max(DD.EXT_PSON_TOT_CNT) AS EXT_PSON_TOT_CNT,
    min(DD.SDATE) AS SDATE,
    max(DD.EDATE) AS EDATE,
    '' AS DAYS,
    max(EE.INST_CONT) AS INST_CONT /* 기관개수 */
from (select A.BZTRP_YR /* 출장년도 */,
    A.BZTRP_SQNO /* 출장순번 */,
    A.FT_SQNO /* 출장조순번 */,
    C.ADT_STP_SQNO /* 감사단계순번 */,
    min( A.ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    max(A.ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */,
    max(A.ADT_DCN) AS ADT_DCN /* 감사일수 */,
    B.FT_TRGT_INST_SQNO /* 출장조대상기관순번 */,
    max(D.ADT_YR) AS CVLCPT_ADT_YR /* 민원감사년도 */,
    max(D.ADT_NO) AS ADT_NO /* 감사번호 */,
    max(D.ADT_ASMT_SECD) AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    max(D.INST_SECD) AS INST_SECD /* 기관구분코드 */,
    max(D.ADT_KDCD) AS ADT_KDCD /* 감사종류코드 */,
    max(D.SPRVSN_DEPT_CD) AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    max(D.ADT_MTHD_SECD) AS ADT_MTHD_SECD /* 감사방법구분코드 */,
    max(D.ADT_MTTR_NM) AS ADT_MTTR_NM /* 감사사항명 */,
    max(E.PROF_RBPRSN_INST_NM) AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    F_CODE_NM('1000007',MAX(D.ADT_KDCD)) AS F_CODE_NM
from TBBADDED006L A, TBBADDED008L B, TBBADDED002M C, TBBADDED001M D, TBDCMACM015M E where 1=1 and A.BZTRP_YR BETWEEN #strBztStYY# AND #strBztEndYY# and SUBSTR(A.ADT_BGNG_YMD, 1, 6) BETWEEN #strBztStYY#||#strBztStMM# AND #strBztEndYY#||#strBztEndMM# /*화면의 감사기간*/ and B.BZTRP_YR = A.BZTRP_YR and B.BZTRP_SQNO = A.BZTRP_SQNO and B.FT_SQNO = A.FT_SQNO and B.FT_TRGT_INST_SQNO = A.FT_TRGT_INST_SQNO and C.BZTRP_YR = B.BZTRP_YR and C.BZTRP_SQNO = B.BZTRP_SQNO and D.CVLCPT_ADT_YR = C.REL_ADT_YR and D.ADT_NO = C.REL_ADT_NO and E.INST_CD = B.INST_CD group by A.BZTRP_YR, A.BZTRP_SQNO, A.FT_SQNO, B.FT_TRGT_INST_SQNO, C.CVLCPT_ADT_STP_SQNO ) AA, (select BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    sum( case when A.EMP_SECD = '0' then 1 else 0 end) AS EMP_SECD /* 직원구분코드 */,
    sum( case when A.EMP_SECD = '0' then 0 else 1 end) AS EMP_SECD /* 직원구분코드 */
from (select distinct AS BZTRP_YR,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    EMP_SECD /* 직원구분코드 */
from TBBADDED005L) A group by BZTRP_YR, BZTRP_SQNO ) BB, (select A.BZTRP_YR /* 출장년도 */,
    A.BZTRP_SQNO /* 출장순번 */,
    A.FT_SQNO /* 출장조순번 */,
    C.FT_TRGT_INST_SQNO /* 출장조대상기관순번 */,
    sum( case when A.EMP_SECD = '0' then B.ADT_DCN else 0 end) AS EMP_SECD /* 직원구분코드 */,
    sum( case when A.EMP_SECD = '0' then 0 else B.ADT_DCN end) AS EMP_SECD /* 직원구분코드 */
from TBBADDED005L A, TBBADDED006L B, TBBADDED008L C where 1 = 1 and B.BZTRP_YR = A.BZTRP_YR and B.BZTRP_SQNO = A.BZTRP_SQNO and A.BZTRP_YR BETWEEN #strBztStYY# AND #strBztEndYY# and SUBSTR(B.ADT_BGNG_YMD, 1, 6) BETWEEN #strBztStYY#||#strBztStMM# AND #strBztEndYY#||#strBztEndMM# /*화면의 감사기간*/ and B.FT_SQNO = A.FT_SQNO and B.BZTRVR_ALTMNT_SQNO = A.BZTRVR_ALTMNT_SQNO and C.BZTRP_YR = B.BZTRP_YR and C.BZTRP_SQNO = B.BZTRP_SQNO and C.FT_SQNO = B.FT_SQNO and C.FT_TRGT_INST_SQNO = B.FT_TRGT_INST_SQNO group by A.BZTRP_YR, A.BZTRP_SQNO, A.FT_SQNO, C.FT_TRGT_INST_SQNO ) CC, (select /*+ INDEX(A KBBADBADDED005001) INDEX(B KBBADBADDED006001)*/ A.BZTRP_YR AS BZTRP_YR /* 출장년도 */,
    A.BZTRP_SQNO /* 출장순번 */,
    sum( case when A.EMP_SECD = '0' then B.ADT_DCN else 0 end) AS EMP_SECD /* 직원구분코드 */,
    sum( case when A.EMP_SECD = '0' then 0 else B.ADT_DCN end) AS EMP_SECD /* 직원구분코드 */,
    MIN(B.ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    MAX(B.ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */
from TBBADDED005L A, TBBADDED006L B where 1 = 1 and B.BZTRP_YR = A.BZTRP_YR and B.BZTRP_SQNO = A.BZTRP_SQNO and B.FT_SQNO = A.FT_SQNO and B.BZTRVR_ALTMNT_SQNO = A.BZTRVR_ALTMNT_SQNO and A.BZTRP_YR BETWEEN #strBztStYY# AND #strBztEndYY# and SUBSTR(B.ADT_BGNG_YMD, 1, 6) BETWEEN #strBztStYY#||#strBztStMM# AND #strBztEndYY#||#strBztEndMM# /*화면의 감사기간*/ group by A.BZTRP_YR, A.BZTRP_SQNO ) DD, (select BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    COUNT(DISTINCT INST_CD) AS INST_CONT /* 기관개수 */
from TBBADDED008L WHERE BZTRP_YR BETWEEN #strBztStYY# AND #strBztEndYY# /*화면의 감사기간*/ group by BZTRP_YR, BZTRP_SQNO) EE where 1 = 1 and BB.BZTRP_YR = AA.BZTRP_YR and BB.BZTRP_SQNO = AA.BZTRP_SQNO and CC.BZTRP_YR = AA.BZTRP_YR and CC.BZTRP_SQNO = AA.BZTRP_SQNO and CC.FT_SQNO = AA.FT_SQNO and CC.FT_TRGT_INST_SQNO = AA.FT_TRGT_INST_SQNO and DD.BZTRP_YR = CC.BZTRP_YR and DD.BZTRP_SQNO = CC.BZTRP_SQNO and EE.BZTRP_YR = DD.BZTRP_YR and EE.BZTRP_SQNO = DD.BZTRP_SQNO group by AA.BZTRP_YR, AA.BZTRP_SQNO, AA.FT_SQNO, AA.ADT_BGNG_YMD, AA.ADT_END_YMD, AA.ADT_DCN, AA.PROF_RBPRSN_INST_NM, AA.CVLCPT_ADT_STP_SQNO ) C WHERE A.ADT_ASMT_SECD = B.ADT_ASMT_SECD AND A.CVLCPT_ADT_YR = B.CVLCPT_ADT_YR AND B.ADT_ASMT_SECD = C.ADT_ASMT_SECD AND B.INST_SECD = C.INST_SECD AND B.BZTRP_YR = C.BZTRP_YR AND B.BZTRP_SQNO = C.BZTRP_SQNO