/*인자값 1) 화면의 감사기간 년도 FROM ~ TO --필수 2) 화면의 감사기간 년월 FROM ~ TO --필수 3) 화면의 기관코드범위 FROM ~ TO */ SELECT /*+ LEADING(SITU,AUD,ORG,TTO,PSON) */ F_ORG_INFO(ORG.INST_CD,'1') AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    ORG.INST_CD /* 기관코드 */,
    SUM(PSON.ADT_DCN) AS ADT_DCN /* 감사일수 */,
    /*총계_일수*/ SUM(PSON.MAN_DAY ) AS MAN_DAY,
    /*총계_연인원*/ SUM (TTO.INST_CONT ) AS INST_CONT /* 기관개수 */,
    /*총계_기관*/ COUNT( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='1' THEN AUD.ADT_NO ELSE NULL END) + COUNT( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='2' THEN AUD.ADT_NO ELSE NULL END) + COUNT( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='3' THEN AUD.ADT_NO ELSE NULL END) + COUNT( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='4' THEN AUD.ADT_NO ELSE NULL END) + COUNT( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1) > '4' THEN AUD.ADT_NO ELSE NULL END) AS SUBSTR,
    /* 총계_사항*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='1' THEN PSON.ADT_DCN ELSE 0 END) AS SUBSTR,
    /*재무감사_일수*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='1' THEN PSON.MAN_DAY ELSE 0 END) AS SUBSTR,
    /*재무감사_연인원*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='1' THEN TTO.INST_CONT ELSE 0 END) AS SUBSTR,
    /*재무감사_기관*/ COUNT( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='1' THEN AUD.ADT_NO ELSE NULL END) AS SUBSTR,
    /*재무감사_사항*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='2' THEN PSON.ADT_DCN ELSE 0 END) AS SUBSTR,
    /*특정과제감사_일수*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='2' THEN PSON.MAN_DAY ELSE 0 END) AS SUBSTR,
    /*특정과제감사_일수*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='2' THEN TTO.INST_CONT ELSE 0 END) AS SUBSTR,
    /*특정과제감사_기관*/ COUNT( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='2' THEN AUD.ADT_NO ELSE NULL END) AS SUBSTR,
    /*특정과제감사_사항*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='3' THEN PSON.ADT_DCN ELSE 0 END) AS SUBSTR,
    /*사업성과감사_일수*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='3' THEN PSON.MAN_DAY ELSE 0 END) AS SUBSTR,
    /*사업성과감사_연인원*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='3' THEN TTO.INST_CONT ELSE 0 END) AS SUBSTR,
    /*사업성과감사_기관*/ COUNT( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='3' THEN AUD.ADT_NO ELSE NULL END) AS SUBSTR,
    /*사업성과감사_사항*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='4' THEN PSON.ADT_DCN ELSE 0 END) AS SUBSTR,
    /*기관운영성과감사_일수*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='4' THEN PSON.MAN_DAY ELSE 0 END) AS SUBSTR,
    /*기관운영성과감사_연인원*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='4' THEN TTO.INST_CONT ELSE 0 END) AS SUBSTR,
    /*기관운영성과감사_기관*/ COUNT( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1)='4' THEN AUD.ADT_NO ELSE NULL END) AS SUBSTR,
    /*기관운영성과감사_감사*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1) >'4' THEN PSON.ADT_DCN ELSE 0 END) AS SUBSTR,
    /*기타감사_일수*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1) >'4' THEN PSON.MAN_DAY ELSE 0 END) AS SUBSTR,
    /*기타감사_연인원*/ SUM( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1) >'4' THEN TTO.INST_CONT ELSE 0 END) AS SUBSTR,
    /*기타감사_기관*/ COUNT( CASE WHEN SUBSTR(AUD.ADT_KDCD, 3, 1) >'4' THEN AUD.ADT_NO ELSE NULL END) AS SUBSTR /* 기타감사_사항 */
FROM TB_BADDED002M SITU, TB_BADDED001M AUD, TB_BADDED008L ORG, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    MIN(ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    MAX(ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */,
    MAX(ADT_DCN) AS ADT_DCN /* 감사일수 */,
    SUM(ADT_DCN) AS ADT_DCN /* 감사일수 */
FROM (SELECT TMA.BZTRP_YR /* 출장년도 */,
    TMA.BZTRP_SQNO /* 출장순번 */,
    TMA.BZTRVR_ENO /* 출장자직원전산번호 */,
    MIN(PTD.ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    MAX(PTD.ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */,
    SUM(PTD.ADT_DCN) AS ADT_DCN /* 감사일수 */
FROM TBBADDED005L TMA, TBBADDED006L PTD WHERE PTD.BZTRP_YR = TMA.BZTRP_YR AND PTD.BZTRP_SQNO = TMA.BZTRP_SQNO AND PTD.FT_SQNO = TMA.FT_SQNO AND PTD.BZTRVR_ALTMNT_SQNO = TMA.BZTRVR_ALTMNT_SQNO AND PTD.BZTRP_YR BETWEEN #strBztStYY# AND #strBztEndYY# /*인자값1*/ AND SUBSTR(PTD.ADT_BGNG_YMD, 1, 6) BETWEEN #strBztStYY#||#strBztStMM# AND #strBztEndYY#||#strBztEndMM# /*인자값2*/ GROUP BY TMA.BZTRP_YR, TMA.BZTRP_SQNO, TMA.BZTRVR_ENO) PTD1 GROUP BY BZTRP_YR, BZTRP_SQNO ) PSON, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    COUNT(*) AS INST_CONT /* 기관개수 */
FROM (SELECT DISTINCT AS BZTRP_YR,
    BZTRP_SQNO /* 출장순번 */,
    FT_TRGT_INST_SQNO /* 출장조대상기관순번 */
FROM TBBADDED008L WHERE SUBSTR(ADT_BGNG_YMD, 1, 6) BETWEEN #strBztStYY#||#strBztStMM# AND #strBztEndYY#||#strBztEndMM# /*인자값2*/ ) TTO0 GROUP BY BZTRP_YR, BZTRP_SQNO ) TTO WHERE SITU.BZTRP_YR BETWEEN #strBztStYY# AND #strBztEndYY# /*인자값1*/ AND SITU.REL_ADT_YR = AUD.ADT_YR AND SITU.REL_ADT_NO = AUD.ADT_NO AND SITU.BZTRP_SECD ='1' AND ORG.BZTRP_YR = SITU.BZTRP_YR AND ORG.BZTRP_SQNO = SITU.BZTRP_SQNO AND ORG.INST_CD >=#strOrgCdSt# AND ORG.INST_CD AND PSON.BZTRP_YR = SITU.BZTRP_YR AND PSON.BZTRP_SQNO = SITU.BZTRP_SQNO AND TTO.BZTRP_YR = SITU.BZTRP_YR AND TTO.BZTRP_SQNO = SITU.BZTRP_SQNO GROUP BY ORG.INST_CD