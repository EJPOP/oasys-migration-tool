SELECT BASE.BZTRP_YR /* 출장년도 */,
    BASE.BZTRP_SQNO /* 출장순번 */,
    BASE.ADT_KDCD /* 감사종류코드 */,
    F_CODE_NM('1000007',BASE.ADT_KDCD) AS F_CODE_NM,
    BASE.REL_ADT_YR /* 관계감사년도 */,
    BASE.REL_ADT_NO /* 관계감사번호 */,
    BASE.CVLCPT_ADT_STP_SQNO /* 민원감사단계순번 */,
    NVL(APTD.SUM_AUD_DCN,BASE.ADT_DCN) AS ADT_DCN /* 감사일수 */,
    BASE.DSPS_RQT_NM /* 처분요구명 */,
    BASE.BZTRP_DEPT_CD /* 출장부서코드 */,
    F_DPT_INFO( BASE.BZTRP_DEPT_CD,'1') AS F_DPT_INFO,
    BASE.ADT_BZTRP_KDCD /* 감사출장종류코드 */,
    BASE.BZTRP_TL_JBGD_SECD /* 출장반장직급구분코드 */,
    F_USR_INFO(BASE.BZTRP_TL_ENO,'2') AS F_USR_INFO,
    BASE.BZTRP_DEPT_CD /* 출장부서코드 */,
    BASE.TPOF_NOPE||nvl2(BASE.EXT_NOP_CNT,'('||BASE.EXT_NOP_CNT||')','') AS TPOF_NOPE /* 제보인원수 */,
    BASE.EXT_NOP_CNT AS EXT_NOP_CNT,
    BASE.ADT_BGNG_YMD /* 감사시작일자 */,
    BASE.ADT_END_YMD /* 감사종료일자 */,
    BASE.INST_CONT /* 기관개수 */,
    BASE.REP_ORG_NM,
    BASE.REP_ORG_NM||DECODE((BASE.INST_CONT-1),0,'',' 외 '||(BASE.INST_CONT-1)) AS REP_ORG_NM,
    TO_CHAR(TO_DATE(BASE.ADT_BGNG_YMD,'YYYYMMDD'),'MM.DD')||'~'|| TO_CHAR(TO_DATE(BASE.ADT_END_YMD,'YYYYMMDD'),'MM.DD') AS TO_CHAR
FROM (SELECT SITU.BZTRP_YR /* 출장년도 */,
    SITU.BZTRP_SQNO /* 출장순번 */,
    AUD.ADT_KDCD /* 감사종류코드 */,
    SITU.REL_ADT_YR /* 관계감사년도 */,
    SITU.REL_ADT_NO /* 관계감사번호 */,
    SITU.ADT_STP_SQNO /* 감사단계순번 */,
    SITU.ADT_DCN /* 감사일수 */,
    SITU.BZTRP_NM /* 출장명 */,
    AUD.SPVR_ENO /* 감리원직원전산번호 */,
    SITU.ADT_BZTRP_KDCD /* 감사출장종류코드 */,
    SITU.BZTRP_TL_JBGD_SECD /* 출장반장직급구분코드 */,
    SITU.BZTRP_TL_ENO /* 출장반장직원전산번호 */,
    SITU.BZTRP_DEPT_CD /* 출장부서코드 */,
    PSON.CNT AS TPOF_NOPE,
    PSON.EXT_CNT,
    SITU.ADT_BGNG_YMD /* 감사시작일자 */,
    SITU.ADT_END_YMD /* 감사종료일자 */,
    TTO.INST_CONT /* 기관개수 */,
    ORG.PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBBADDED002M SITU, TBBADDED001M AUD, TBDCMACM015M ORG, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    SUM( CASE WHEN AS1.EMP_SECD != '0' THEN 1 END) AS EMP_SECD /* 직원구분코드 */,
    COUNT(*) AS CNT
FROM (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    EMP_SECD /* 직원구분코드 */
FROM TBBADDED005L WHERE 1 = 1 AND BZTRP_BGNG_YMD =#ADT_BGNG_YMD#/*TO_CHAR(SYSDATE,'YYYYMMDD')*/ GROUP BY BZTRP_YR, BZTRP_SQNO, BZTRVR_ENO, EMP_SECD ) AS1 GROUP BY BZTRP_YR, BZTRP_SQNO) PSON, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    MIN(O.INST_CD) AS INST_CD /* 기관코드 */,
    COUNT(O.INST_CD) AS INST_CONT /* 기관개수 */
FROM (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    INST_CD /* 기관코드 */
FROM TBBADDED008L GROUP BY BZTRP_YR, BZTRP_SQNO, INST_CD) AS O GROUP BY BZTRP_YR, BZTRP_SQNO) AS TTO WHERE AUD.CVLCPT_ADT_YR = SITU.REL_ADT_YR AND AUD.ADT_NO = SITU.REL_ADT_NO AND TTO.BZTRP_YR = SITU.BZTRP_YR AND TTO.BZTRP_SQNO = SITU.BZTRP_SQNO AND PSON.BZTRP_YR(+) = SITU.BZTRP_YR AND PSON.BZTRP_SQNO(+) = SITU.BZTRP_SQNO AND ORG.INST_CD(+) = TTO.REP_ORG_CD AND SITU.BZTRP_SECD ='1' /* 감찰담당관실은 조회시 제외하며, 로그인 한 담당자가 감찰담당관일때만 포함하여 모두 보임 - 2016.01.04 yyh */ AND AUD.SPRVSN_DEPT_CD != '100100' ) BASE, (SELECT TMA.BZTRP_YR /* 출장년도 */,
    TMA.BZTRP_SQNO /* 출장순번 */,
    TMA.BZTRVR_ENO /* 출장자직원전산번호 */,
    SUM(NVL(PTD.ADT_DCN,0)) AS ADT_DCN /* 감사일수 */
FROM TBBADDED005L TMA, TBBADDED006L PTD WHERE TMA.BZTRP_YR = PTD.BZTRP_YR AND TMA.BZTRP_SQNO = PTD.BZTRP_SQNO AND TMA.FT_SQNO = PTD.FT_SQNO AND TMA.BZTRVR_ALTMNT_SQNO = PTD.BZTRVR_ALTMNT_SQNO GROUP BY TMA.BZTRP_YR, TMA.BZTRP_SQNO, TMA.BZTRVR_ENO) APTD WHERE 1=1 AND APTD.BZTRP_YR(+) = BASE.BZTRP_YR AND APTD.BZTRP_SQNO(+) = BASE.BZTRP_SQNO AND APTD.BZTRVR_ENO(+) = BASE.SPVR_ENO AND BASE.BZTRP_DEPT_CD = #BZTRP_DEPT_CD# AND BASE.ADT_BGNG_YMD = #ADT_BGNG_YMD#/*TO_CHAR(SYSDATE,'YYYYMMDD')*/ ORDER BY BASE.BZTRP_DEPT_CD