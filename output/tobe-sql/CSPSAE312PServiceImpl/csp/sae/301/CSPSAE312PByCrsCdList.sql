WITH USE_INFO AS ( SELECT C.INFO_RLPR_NM AS INFO_RLPR_NM /* 정보관계자명 */,
    A.USE_YN /* 사용여부 */,
    D.CRS_NM /* 과정명 */,
    A.USE_STR_DT,
    A.USE_END_DT,
    B.RMN_NM
FROM TBCSPSAE401D A , TBCSPSAE115B B , TBCSPSAE301D C , TBCSPSAE103C D WHERE B.DMT_NO = A.DMT_NO AND C.LINK_YR = A.LINK_YR AND C.CRS_CD = A.CRS_CD AND C.CRS_CDN = A.CRS_CDN AND C.TANE_ID = A.TANE_ID AND D.CRS_CD = A.CRS_CD AND A.LINK_YR = #LINK_YR# AND A.CRS_CD = #CRS_CD# AND A.CRS_CDN = #CRS_CDN# ) SELECT A.FLOOR2,
    DECODE((SELECT AS USE_YN /* 사용여부 */
FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR2), 'N', '미사용', (SELECT AGGR_CONCAT(USER_NM, ', ') AS USER_NM /* 사용자명 */
FROM USE_INFO WHERE A.FLOOR2 IN RMN_NM)) AS USE_NAM_2 , DECODE ( (SELECT MAX(USER_NM) AS USER_NM /* 사용자명 */
FROM USE_INFO WHERE A.FLOOR2 = RMN_NM) , NULL, '', (SELECT ESN
FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR2)) AS ESN_2 , A.FLOOR3 , DECODE((SELECT USE_YN /* 사용여부 */
FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR3), 'N', '미사용', (SELECT AGGR_CONCAT(USER_NM, ', ') AS USER_NM /* 사용자명 */
FROM USE_INFO WHERE A.FLOOR3 IN RMN_NM)) AS USE_NAM_3 , DECODE ( (SELECT MAX(USER_NM) AS USER_NM /* 사용자명 */
FROM USE_INFO WHERE A.FLOOR3 = RMN_NM) , NULL, '', (SELECT ESN
FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR3)) AS ESN_3 , A.FLOOR4 , DECODE((SELECT USE_YN /* 사용여부 */
FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR4), 'N', '미사용', (SELECT AGGR_CONCAT(USER_NM, ', ') AS USER_NM /* 사용자명 */
FROM USE_INFO WHERE A.FLOOR4 IN RMN_NM)) AS USE_NAM_4 , DECODE ( (SELECT MAX(USER_NM) AS USER_NM /* 사용자명 */
FROM USE_INFO WHERE A.FLOOR4 = RMN_NM) , NULL, '', (SELECT ESN
FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR4)) AS ESN_4 FROM ( SELECT ROW_NO,
    MIN(DECODE(SEAT_NM, '2층', RMN_NM)) AS SEAT_NM,
    MIN(DECODE(SEAT_NM, '3층', RMN_NM)) AS SEAT_NM,
    MIN(DECODE(SEAT_NM, '4층', RMN_NM)) AS SEAT_NM
FROM ( SELECT ROW_NUMBER() OVER (PARTITION BY SEAT_NM ORDER BY RMN_NM) AS ROW_NUMBER,
    SEAT_NM,
    RMN_NM
FROM TBCSPSAE115B ORDER BY RMN_NM ) GROUP BY ROW_NO ) A ORDER BY A.FLOOR2