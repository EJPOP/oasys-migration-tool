SELECT D1.REL_ADT_YR||'-'||D1.REL_ADT_NO||'-'||D1.ADT_STP_SQNO AS ADT_CLSF_NO /* 감사분류번호 */,
    D1.BZTRP_YR AS BZTRP_YR /* 출장년도 */,
    D1.BZTRP_SQNO AS BZTRP_SQNO /* 출장순번 */,
    D2.ADT_KDCD AS ADT_KDCD /* 감사종류코드 */,
    F_CODE_NM('1000007',D2.ADT_KDCD) AS F_CODE_NM /* 감사종류명 */,
    D1.BZTRP_SECD AS BZTRP_SECD /* 출장구분코드 */,
    D1.ADT_BZTRP_KDCD AS ADT_BZTRP_KDCD /* 감사출장종류코드 */,
    F_CODE_NM('1000030',D1.ADT_BZTRP_KDCD) AS F_CODE_NM /* 감사출장종류코드 */,
    D1.BZTRP_TL_ENO AS BZTRP_TL_ENO /* 출장반장직원전산번호 */,
    D1.BZTRP_TL_DEPT_CD AS BZTRP_TL_DEPT_CD /* 출장반장부서코드 */,
    D1.BZTRP_TL_JBGD_SECD AS BZTRP_TL_JBGD_SECD /* 출장반장직급구분코드 */,
    F_USR_INFO(D1.BZTRP_TL_ENO,'2') AS F_USR_INFO /* 출장반장명 */,
    F_DPT_INFO(D1.BZTRP_TL_DEPT_CD,'1') AS F_DPT_INFO /* 출장반장국과명 */,
    F_CODE_NM('1000173',D1.BZTRP_TL_JBGD_SECD) AS F_CODE_NM /* 출장반장직급명 */,
    D1.BZTRP_NM AS BZTRP_NM /* 출장명 */,
    D1.BZTRP_DEPT_CD AS BZTRP_DEPT_CD /* 출장부서코드 */,
    F_DPT_INFO(D1.BZTRP_DEPT_CD,'1') AS F_DPT_INFO /* 출장국과명 */,
    D1.HLDY_ACTV_SECD AS HLDY_ACTV_SECD /* 휴일활동구분코드 */,
    F_CODE_NM('1000019',D1.HLDY_ACTV_SECD) AS F_CODE_NM /* 휴일활동구분코드 */,
    D1.REL_ADT_YR AS REL_ADT_YR /* 관계감사년도 */,
    D1.REL_ADT_NO AS REL_ADT_NO /* 관계감사번호 */,
    D2.ADT_GRNT_NO AS ADT_GRNT_NO /* 감사부여번호 */,
    D1.ADT_STP_SQNO AS ADT_STP_SQNO /* 감사단계순번 */,
    D1.BZTRP_CN AS BZTRP_CN /* 출장내용 */,
    D1.CNTRL_YN AS CNTRL_YN /* 통제여부 */,
    D1.BZTRP_YR ||'-'||D1.SPRT_NO AS BZTRP_YR /* 출장년도 */,
    D1.SPRT_NO AS SPRT_NO /* 지원번호 */,
    D1.GNRL_BZTRP_KDCD AS GNRL_BZTRP_KDCD /* 일반출장종류코드 */,
    D1.REG_YMD AS REG_YMD /* 등록일자 */,
    D1.ADT_BGNG_YMD AS ADT_BGNG_YMD /* 감사시작일자 */,
    D1.ADT_END_YMD AS ADT_END_YMD /* 감사종료일자 */,
    '('||NVL(D1.ADT_DCN,0)||'일)' AS ADT_DCN /* 감사일수 */,
    D1.CAW_GIVE_YN AS CAW_GIVE_YN /* 지휘비지급여부 */,
    D1.CNTRL_TRGT_YN AS CNTRL_TRGT_YN /* 통제대상여부 */,
    D1.CNTRL_YMD AS CNTRL_YMD /* 통제일자 */,
    D1.TRSM_YN AS TRSM_YN /* 전송여부 */,
    D1.SDIN_YMD AS SDIN_YMD /* 송부일자 */,
    D1.ACADT_STP_NO AS ACADT_STP_NO /* 실지감사단계번호 */,
    D2.ADT_YR AS ADT_YR /* 감사년도 */,
    D2.ADT_NO AS ADT_NO /* 감사번호 */,
    F_DPT_INFO(D2.SPRVSN_DEPT_CD,'1') AS F_DPT_INFO /* 주관부서명 */,
    F_DPT_INFO((SELECT AS F_DPT_INFO
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = D2.SPRVSN_DEPT_CD), '1') AS SPV_BRDV_UP_NM /*주관부서명(국)*/ , TO_CHAR(TO_DATE(D1.ADT_BGNG_YMD),'YYYY-MM-DD')||'~'|| TO_CHAR(TO_DATE(D1.ADT_END_YMD),'YYYY-MM-DD') AS AUD_ST_END_DT /*실시기간*/ , D2.ADT_MTTR_NM AS ADT_MTTR_NM /*감사사항명*/ , CASE WHEN NVL(D1.CNTRL_TRGT_YN,'N') = 'N' THEN '-' WHEN NVL(D1.CNTRL_TRGT_YN,'N') = 'Y' AND NVL(D1.CNTRL_YN,'N') = 'Y' THEN 'O' WHEN NVL(D1.CNTRL_TRGT_YN,'N') = 'Y' AND NVL(D1.CNTRL_YN,'N') = 'N' THEN 'X' END AS CTRL_YN_DISP , CASE WHEN NVL(D1.TRSM_YN,'N') = 'Y' THEN 'O' ELSE 'X' END AS SND_YN_DISP , (SELECT CASE WHEN COUNT(1)>0 THEN 'Y' ELSE 'N' AS 1
FROM TB_BADDED011L WHERE 1=1 AND BZTRP_YR = D1.BZTRP_YR AND BZTRP_SQNO = D1.BZTRP_SQNO ) AS EXP_YN /*수정가능여부를 판단하기 위함.*/ , '' AS SEL_YN /*선택여부를 판단하기위함.(통제화면)*/ , NVL(D3.IN_PSON_CNT,0) AS IN_PSON_CNT , NVL(D3.EXT_PSON_CNT,0) AS EXT_PSON_CNT , NVL(D3.IN_PSON_CNT,0)+ NVL(D3.EXT_PSON_CNT,0) AS PSON_CNT , NVL(D3.IN_PSON_CNT,0)||'/'||NVL(D3.EXT_PSON_CNT,0)||'/'||(NVL(D3.IN_PSON_CNT,0)+ NVL(D3.EXT_PSON_CNT,0)) AS ALL_PSON_CNT , F_ORG_CNT_NM_AUD(D1.BZTRP_YR,D1.BZTRP_SQNO,'BZT') AS ORG_CNT_NM , '내부 : '||TO_CHAR(NVL(D3.IN_PSON_CNT,0)) || '명('|| TO_CHAR(NVL(D4.IN_PSON_CNT1,0))||'명) 외부 : '||TO_CHAR(NVL(D3.EXT_PSON_CNT,0))||'명('||TO_CHAR(NVL(D4.EXT_PSON_CNT1,0))||'명)' AS DIS_PSON_CNT , CASE WHEN D2.ADT_YR >= '2016' THEN (SELECT CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000739' AND CD = D2.ADT_KDCD) ELSE '-' END AS AUD_YR_NO_KND_NM FROM TB_BADDED002M D1 , TB_BADDED001M D2 , ( SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN 1 ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN 0 ELSE 1 END) AS EMP_SECD /* 직원구분코드 */
FROM (SELECT DISTINCT AS BZTRP_YR,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    EMP_SECD /* 직원구분코드 */
FROM TBBADDED005L) A GROUP BY BZTRP_YR, BZTRP_SQNO ) D3 , ( SELECT D1.BZTRP_YR /* 출장년도 */,
    D1.BZTRP_SQNO /* 출장순번 */,
    SUM(ADT_DCN) AS ADT_DCN /* 감사일수 */,
    SUM( CASE WHEN D2.EMP_SECD = '0' THEN D1.ADT_DCN ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    SUM( CASE WHEN D2.EMP_SECD = '0' THEN 0 ELSE D1.ADT_DCN END) AS EMP_SECD /* 직원구분코드 */
FROM TBBADDED006L D1 , TBBADDED005L D2 WHERE 1=1 AND D1.BZTRP_YR = D2.BZTRP_YR AND D1.BZTRP_SQNO = D2.BZTRP_SQNO AND D1.FT_SQNO = D2.FT_SQNO AND D1.BZTRVR_ALTMNT_SQNO = D2.BZTRVR_ALTMNT_SQNO AND D1.BZTRP_YR = #BZTRP_YR# AND D1.BZTRP_SQNO = #BZTRP_SQNO# GROUP BY D1.BZTRP_YR, D1.BZTRP_SQNO ) D4 WHERE 1=1 AND D1.REL_ADT_YR = D2.ADT_YR AND D1.REL_ADT_NO = D2.ADT_NO AND D1.BZTRP_YR = D3.BZTRP_YR(+) AND D1.BZTRP_SQNO = D3.BZTRP_SQNO(+) AND D1.BZTRP_YR = D4.BZTRP_YR(+) AND D1.BZTRP_SQNO = D4.BZTRP_SQNO(+) AND D1.BZTRP_SQNO = #BZTRP_SQNO# AND D1.BZTRP_YR = #BZTRP_YR#