SELECT *
FROM ( SELECT D1.BZTRP_YR AS BZTRP_YR /* 출장년도 */,
    D1.BZTRP_SQNO AS BZTRP_SQNO /* 출장순번 */,
    D1.BZTRVR_ENO AS BZTRVR_ENO /* 출장자직원전산번호 */,
    D1.BZTRVR_NM AS BZTRVR_NM /* 출장자명 */,
    D1.JBGD_NM AS JBGD_NM /* 직급명 */,
    NVL(D1.BTEXP_CRTR_AMT,0) - NVL(D2.BTEXP_CRTR_AMT,0) AS BTEXP_CRTR_AMT /* 출장비기준금액 */,
    NVL(D1.LDG_CST,0) - NVL(D2.LDG_CST,0) AS LDG_CST /* 숙박비용 */,
    NVL(D1.BZTRP_TRVEXP_FDEXP,0) - NVL(D2.BZTRP_TRVEXP_FDEXP,0) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */,
    NVL(D1.CPRG_FARE_CST,0) - NVL(D2.CPRG_FARE_CST,0) AS CPRG_FARE_CST /* 수도권운임비용 */,
    NVL(D1.SPM_CST,0) - NVL(D2.SPM_CST,0) AS SPM_CST /* 보충비용 */,
    NVL(D1.BZTRP_DCN,0) - NVL(D2.BZTRP_DCN,0) AS BZTRP_DCN /* 출장일수 */,
    NVL(D1.RL_FARE_AMT,0) - NVL(D2.RL_FARE_AMT,0) AS RL_FARE_AMT /* 철도운임금액 */,
    NVL(D1.LEAD_CST,0) - NVL(D2.LEAD_CST,0) AS LEAD_CST /* 지휘비용 */,
    NVL(D1.ADT_ACTV_ACTC_AMT,0) - NVL(D2.ADT_ACTV_ACTC_AMT,0) AS ADT_ACTV_ACTC_AMT /* 감사활동수용금액 */,
    NVL(D1.SUM_COST,0) - NVL(D2.SUM_COST,0) AS SUM_COST /* 국내여비 */,
    NVL(D1.ALL_COST,0) - NVL(D2.ALL_COST,0) AS ALL_COST /* 합계 */,
    D4.BNK_NM AS BNK_NM /* 은행 */,
    D4.ACTNO_SCRTY AS ACTNO_SCRTY /* 계좌번호보안 */,
    (SELECT F_MNG_KND_AUDYRNO(REL_ADT_YR, REL_ADT_NO, '', '-') || '(' || CVLCPT_ADT_STP_SQNO || ')' AS REL_ADT_YR /* 관계감사년도 */
FROM TBBADDED002M WHERE BZTRP_YR = D1.BZTRP_YR AND BZTRP_SQNO = D1.BZTRP_SQNO) AS AUD_YR_NM /* 분류번호 */ , NVL(D1.ALL_COST_GVM_PUR_CRD_EXMP,0) - NVL(D2.ALL_COST_GVM_PUR_CRD_EXMP,0) AS ALL_COST_GVM_PUR_CRD_EXMP /* 정부구매카드 외 - 2021.02.03 yyh */ , NVL(D1.ALL_COST_GVM_PUR_CRD,0) - NVL(D2.ALL_COST_GVM_PUR_CRD,0) AS ALL_COST_GVM_PUR_CRD /* 정부구매카드 - 2021.02.03 yyh */ FROM ( SELECT D2.*,
    MAX_SNO,
    CLCLN_CHG_RSN_CN /* 정산변경사유내용 */
FROM ( SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    MAX(BZTRP_CLCLN_SQNO) AS BZTRP_CLCLN_SQNO /* 출장정산순번 */,
    MAX(CLCLN_CHG_RSN_CN) AS CLCLN_CHG_RSN_CN /* 정산변경사유내용 */
FROM TBBADDED019H WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# AND NVL(CLCLN_YN,'N') = 'N' GROUP BY BZTRP_YR , BZTRP_SQNO , BZTRVR_ENO ) D1 , VADED001 D2 WHERE 1=1 AND D1.BZTRP_YR = D2.BZTRP_YR AND D1.BZTRP_SQNO = D2.BZTRP_SQNO AND D1.BZTRVR_ENO = D2.BZTRVR_ENO AND D1.MAX_SNO = D2.BZTRP_CLCLN_SQNO AND D1.BZTRP_YR = #BZTRP_YR# AND D1.BZTRP_SQNO = #BZTRP_SQNO# ) D1 , ( SELECT D2.*
FROM ( SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    MAX(BZTRP_CLCLN_SQNO) AS BZTRP_CLCLN_SQNO /* 출장정산순번 */
FROM TBBADDED019H WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# AND NVL(CLCLN_YN,'N') = 'Y' GROUP BY BZTRP_YR , BZTRP_SQNO , BZTRVR_ENO ) D1 , VADED001 D2 WHERE 1=1 AND D1.BZTRP_YR = D2.BZTRP_YR AND D1.BZTRP_SQNO = D2.BZTRP_SQNO AND D1.BZTRVR_ENO = D2.BZTRVR_ENO AND D1.MAX_SNO = D2.BZTRP_CLCLN_SQNO AND D1.BZTRP_YR = #BZTRP_YR# AND D1.BZTRP_SQNO = #BZTRP_SQNO# ) D2 , TBBADDED002M D3 , (SELECT D1.BZTRP_YR AS BZTRP_YR /* 출장년도 */,
    D1.BZTRP_SQNO AS BZTRP_SQNO /* 출장순번 */,
    D1.BZTRVR_ENO AS BZTRVR_ENO /* 출장자직원전산번호 */,
    D1.BZTRVR_NM AS BZTRVR_NM /* 출장자명 */,
    F_CODE_NM('1000166', NVL(D1.BANK_SECD, NVL(D3.BZT_TREXP_RCIT_BNK_CD, D2.PROF_RBPRSN_BANK_KDCD)) ) AS F_CODE_NM,
    NVL(D1.ACTNO_SCRTY , NVL(D3.BZT_TREXP_RCIT_EAN, D2.ACTNO_SCRTY)) AS ACTNO_SCRTY /* 계좌번호보안 */
FROM TBBADDED010L D1 ,TBCSPLFI103M D2 ,TBDCMACM001M D3 WHERE 1=1 AND D1.BZTRVR_ENO = D2.TRGT_NOP_ENO(+) AND D1.BZTRVR_ENO = D3.TRGT_NOP_ENO(+) ) D4 /*출장비계좌정보*/ WHERE 1=1 AND D1.BZTRP_YR = D2.BZTRP_YR(+) AND D1.BZTRP_SQNO = D2.BZTRP_SQNO(+) AND D1.BZTRVR_ENO = D2.BZTRVR_ENO(+) AND D1.BZTRP_YR = D3.BZTRP_YR AND D1.BZTRP_SQNO = D3.BZTRP_SQNO AND D1.BZTRP_YR = D4.BZTRP_YR(+) AND D1.BZTRP_SQNO = D4.BZTRP_SQNO(+) AND D1.BZTRVR_ENO = D4.BZTRVR_ENO(+) ) WHERE 1=1 AND BTEXP_CRTR_AMT <> 0 OR LDG_CST <> 0 OR BZTRP_TRVEXP_FDEXP <> 0 OR SPM_CST <> 0 OR BZTRP_DCN <> 0 OR RL_FARE_AMT <> 0 OR LEAD_CST <> 0 OR ADT_ACTV_ACTC_AMT <> 0 OR SUM_COST <> 0 OR ALL_COST <> 0 OR CPRG_FARE_CST <> 0 ORDER BY BZTRVR_ENO