SELECT CASE WHEN D1.GUBUN = 1 THEN '기한내' WHEN D1.GUBUN = 2 THEN '기한경과' WHEN D1.GUBUN = 3 THEN 'HRA' WHEN D1.GUBUN = 4 THEN '집행회보접수' ELSE NULL END AS GUBUN,
    CASE WHEN D1.GUBUN = 1 THEN MAX(D2.IN_TERM) WHEN D1.GUBUN = 2 THEN MAX(D2.OUT_TERM) WHEN D1.GUBUN = 3 THEN MAX(D2.HRA_CNT) WHEN D1.GUBUN = 4 THEN MAX(0) ELSE NULL END AS GUBUN,
    CASE WHEN D1.GUBUN = 1 THEN MAX(D2.WIN_TERM) WHEN D1.GUBUN = 2 THEN MAX(D2.WOUT_TERM) WHEN D1.GUBUN = 3 THEN MAX(D2.WHRA_CNT) WHEN D1.GUBUN = 4 THEN MAX(0) ELSE NULL END AS GUBUN
FROM ( SELECT LEVEL
FROM DUAL CONNECT BY LEVEL NVL(E.PRCS_TERM_YMD, '99991231') THEN 1 ELSE 0 END ) AS OUT_TERM /* 처분요구 기한외 */ , SUM( CASE WHEN D.DSPS_RQT_KDCD IN ('110', '210', '310', '320', '391', '800', '810', '820', '830', '840', '850') AND NVL(E.HRK_MNG_DSGN_YN, 'N') = 'Y' THEN 1 ELSE 0 END ) AS HRA_CNT /* 처분요구 HRA */ , SUM( CASE WHEN D.DSPS_RQT_KDCD IN ('110', '210', '310', '320', '391', '800', '810', '820', '830', '840', '850') THEN NVL(F.TMP_CNT, 1) ELSE 0 END )AS OVER_TIME /* 처분요구 집행회보접수 */ , SUM( CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') NVL(E.PRCS_TERM_YMD, '99991231') AND D.DSPS_RQT_KDCD IN ('510','520','530','610','611', '620', '621', '623', '630') THEN 1 ELSE 0 END ) AS WOUT_TERM /* 권고통보 기한외 */ , SUM( CASE WHEN D.DSPS_RQT_KDCD IN ('510','520','530','610','611', '620', '621', '623', '630') AND NVL(E.HRK_MNG_DSGN_YN, 'N') = 'Y' THEN 1 ELSE 0 END ) AS WHRA_CNT /* 권고통보 HRA */ , SUM( CASE WHEN D.DSPS_RQT_KDCD IN ('510','520','530','610','611', '620', '621', '623', '630') THEN NVL(F.TMP_CNT, 1) ELSE 0 END )AS OVER_TIME /* 처분요구 집행회보접수 */ FROM TB_BADEAR001M D , TB_BADEAR002D E , ( SELECT COUNT(1) AS 1,
    S1.ADT_YR /* 감사년도 */,
    S1.ADT_NO /* 감사번호 */,
    S1.DSPS_RQT_SQNO /* 처분요구순번 */
FROM TBBADFRE001H S1 WHERE 1 = 1 AND S1.IMPL_WHLS_ATRZ_STTS_SECD <> '3' GROUP BY S1.CVLCPT_ADT_YR , S1.ADT_NO , S1.DSPS_RQT_SQNO ) F WHERE 1=1 AND D.CVLCPT_ADT_YR = E.ADT_YR(+) AND D.ADT_NO = E.ADT_NO(+) AND D.DSPS_RQT_SQNO = E.DSPS_RQT_SQNO(+) AND D.CVLCPT_ADT_YR = F.CVLCPT_ADT_YR(+) AND D.ADT_NO = F.ADT_NO(+) AND D.DSPS_RQT_SQNO = F.DSPS_RQT_SQNO(+) AND E.CFMTN_STTS_SECD = '1' AND E.DSPS_RQT_ATRZ_STTS_SECD <> '3' ) D2 GROUP BY D1.GUBUN ORDER BY D1.GUBUN