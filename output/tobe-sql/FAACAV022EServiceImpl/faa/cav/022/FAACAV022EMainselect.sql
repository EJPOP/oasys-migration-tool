/* faa/cav/022/FAACAV022EMainselect */ SELECT ROWNUM,
    A.JRSD_CD||'-'||A.ACNTG_CD||'-'||A.BLL_KDCD||'-'||A.PROF_RBPRSN_SQNO||'-'|| A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO AS JRSD_CD /* 소관코드 */,
    A.JRSD_CD /* 소관코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.BLL_KDCD /* 계산서종류코드 */,
    A.PROF_RBPRSN_SQNO /* 증명책임자순번 */,
    A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO /* 관서운영경비출납공무원순번 */,
    A.PROF_YM /* 증명연월 */,
    A.BLL_RCPT_DT /* 계산서접수일시 */,
    A.PRCS_STTS_YN /* 처리상태여부 */,
    A.PRCS_DT /* 처리일시 */,
    B.PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    F_AV_ACNT_CD_NM(A.ACNTG_CD) AS F_AV_ACNT_CD_NM,
    DECODE(B.PROF_RBPRSN_ABL_YMD,'999999','') AS PROF_RBPRSN_ABL_YMD /* 증명책임자폐지일자 */,
    B.PROF_RBPRSN_MDFR_NM /* 증명책임자수정자명 */,
    B.PROF_RBPRSN_TELNO /* 증명책임자전화번호 */,
    F_AV_BLL_COPT_CD_NM(A.JRSD_CD) AS F_AV_BLL_COPT_CD_NM
FROM TWFAACAV016M A,TWFAACAV003M B WHERE 1 = 1 /*증명월이 있으면 */ AND A.PROF_YM = #PROF_YM# /*증명월이 없으면 */ AND A.PROF_YM BETWEEN #strYr#||'00' AND #strYr#||'13' AND A.JRSD_CD = #JRSD_CD# AND A.ACNTG_CD = #ACNTG_CD# AND 1 = CASE WHEN #JRSD_CD# IS NOT NULL OR #ACNTG_CD# IS NOT NULL THEN CASE WHEN #PROF_RBPRSN_SQNO# IS NOT NULL THEN CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD = #BLL_KDCD# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD = #BLL_KDCD# THEN '1' END END ELSE CASE WHEN #BLL_KDCD# IN ('17', '18') THEN CASE WHEN #strFildSsecYn# = 'N' THEN CASE WHEN A.BLL_KDCD IN ('17', '18') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN '1' END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD IN ('17', '18') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD IN ('17', '18') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' THEN '1' END END END WHEN #BLL_KDCD# = '19' THEN CASE WHEN #strFildSsecYn# = 'N' THEN CASE WHEN A.BLL_KDCD = '19' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN '1' END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD = '19' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD = '19' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' THEN '1' END END END WHEN #BLL_KDCD# IN ('22', '23', '24') THEN CASE WHEN #strFildSsecYn# = 'N' THEN CASE WHEN A.BLL_KDCD IN ('22', '23', '24') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN '1' END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD IN ('22', '23', '24') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD IN ('22', '23', '24') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' THEN '1' END END END WHEN #BLL_KDCD# IN ('42', '43') THEN CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD IN ('42', '43') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD IN ('42', '43') THEN '1' END END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD = #BLL_KDCD# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD = #BLL_KDCD# THEN '1' END END END END ELSE CASE WHEN #PROF_RBPRSN_SQNO# IS NOT NULL THEN CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD = #BLL_KDCD# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD = #BLL_KDCD# THEN '1' END END ELSE CASE WHEN #BLL_KDCD# IN ('17', '18') THEN CASE WHEN #strFildSsecYn# = 'N' THEN CASE WHEN A.BLL_KDCD IN ('17', '18') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN '1' END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD IN ('17', '18') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD IN ('17', '18') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' THEN '1' END END END WHEN #BLL_KDCD# = '19' THEN CASE WHEN #strFildSsecYn# = 'N' THEN CASE WHEN A.BLL_KDCD = '19' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN '1' END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD = '19' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD = '19' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' THEN '1' END END END WHEN #BLL_KDCD# IN ('22', '23', '24') THEN CASE WHEN #strFildSsecYn# = 'N' THEN CASE WHEN A.BLL_KDCD IN ('22', '23', '24') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN '1' END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD IN ('22', '23', '24') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD IN ('22', '23', '24') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' THEN '1' END END END WHEN #BLL_KDCD# IN ('42', '43') THEN CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD IN ('42', '43') AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD IN ('42', '43') THEN '1' END END ELSE CASE WHEN #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# IS NOT NULL THEN CASE WHEN A.BLL_KDCD = #BLL_KDCD# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# THEN '1' END ELSE CASE WHEN A.BLL_KDCD = #BLL_KDCD# THEN '1' END END END END END AND A.PROF_RBPRSN_SQNO = #PROF_RBPRSN_SQNO# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO &lt;&gt; '000' AND A.JRSD_CD = B.JRSD_CD AND A.ACNTG_CD = B.ACNTG_CD AND A.BLL_KDCD = B.BLL_KDCD AND A.PROF_RBPRSN_SQNO = B.PROF_RBPRSN_SQNO AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = B.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO AND EXISTS ( SELECT 'x'
from TWFAACAV068L D WHERE A.JRSD_CD = D.JRSD_CD AND A.ACNTG_CD = D.ACNTG_CD AND A.BLL_KDCD = D.BLL_KDCD AND A.PROF_RBPRSN_SQNO = D.PROF_RBPRSN_SQNO AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = D.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO ) ORDER BY JRSD_CD, ACNTG_CD, BLL_KDCD, PROF_RBPRSN_SQNO, GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO, PROF_YM,CRU_RCPT_DT