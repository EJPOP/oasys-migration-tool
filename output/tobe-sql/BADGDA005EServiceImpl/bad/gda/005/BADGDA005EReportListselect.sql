SELECT DECODE(#strHndlStaDvsnCd#, 0, '전체', F_CODE_NM ('1000587', #strHndlStaDvsnCd#)) AS #STRHNDLSTADVSNCD# /* 처리구분 */,
    F_DPT_INFO(#strDptCd#,'1') AS F_DPT_INFO /* 처리국과 */,
    F_CODE_NM('1000200', #PRCS_OPNN_SECD#) AS F_CODE_NM /* 처리결과 */,
    F_CODE_NM('1000200', #PRCS_OPNN_SECD#) || ', ' || F_CODE_NM('1000200', #strHndlOpinCd2#) AS F_CODE_NM /* 처리결과 */,
    F_CODE_NM('1000200', #PRCS_OPNN_SECD#) || ', ' || F_CODE_NM('1000200', #strHndlOpinCd2#) || ', ' || F_CODE_NM('1000200', #strHndlOpinCd3#) AS F_CODE_NM /* 처리결과 */,
    F_CODE_NM('1000200', #PRCS_OPNN_SECD#) || ', ' || F_CODE_NM('1000200', #strHndlOpinCd2#) || ', ' || F_CODE_NM('1000200', #strHndlOpinCd3#) || ', ' || F_CODE_NM('1000200', #strHndlOpinCd4#) AS F_CODE_NM /* 처리결과 */,
    '' AS CND_HNDL_OPIN_NM /* 처리결과 */,
    '' AS CND_REGI_DT /* 송부일자 */,
    #strDfntNm# AS #STRDFNTNM# /* 관계자명 */,
    #strSchTxt# AS #STRSCHTXT# /* 검색어 */,
    TO_CHAR(TO_DATE(#strAcpDtStr#), 'YYYY.MM.DD') || '~' || TO_CHAR(TO_DATE(#strAcpDtEnd#), 'YYYY.MM.DD') AS TO_CHAR /* 접수일자 */,
    F_ORG_INFO(#INST_CD#,'1') AS F_ORG_INFO /* 관계기관 */,
    F_CODE_NM('1000202',D1.OCRN_SECD) AS F_CODE_NM /* 구분 */,
    (SELECT AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBDCMACM015M WHERE INST_CD = D1.INST_CD) || '-' || (SELECT CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000202' AND CD = D1.OCRN_SECD AND NVL(USE_YN,'N') ='Y') || '-' || D1.NTFCTN_SQNO AS NTF_SBJ_NO /* 통보사항번호 */ ,CASE WHEN D1.NTFCTN_RCPT_SQNO IS NOT NULL THEN LINK_YR || '-' || DECODE(D1.OCRN_SECD,'6','판청','손망') || '-' || D1.NTFCTN_RCPT_SQNO ELSE '' END AS ACP_NO_TXT /* 접수번호 */ ,D1.RSCH_ASMT_TTL AS RSCH_ASMT_TTL /* 제목명 */ ,NVL(TO_CHAR(D1.HRM_AMT, '9,999,999,999'),'') AS HRM_AMT /* 손해금액 */ ,D2.DFNT_NMS AS DFNT_NMS /* 관계자명 */ ,TO_CHAR(TO_DATE(D1.REG_YMD), 'YYYY.MM.DD') AS REG_YMD /* 송부일자(등록일) */ ,TO_CHAR(TO_DATE(D1.NTFCTN_RCPT_YMD), 'YYYY.MM.DD') AS NTFCTN_RCPT_YMD /* 접수일 */ ,CASE WHEN D1.STT_RCPT_STTS_SECD IN ('58','59') THEN '미접수' WHEN D1.STT_RCPT_STTS_SECD IN ('71','72','76') THEN '처리중' WHEN D1.STT_RCPT_STTS_SECD = '75' THEN '결재중' WHEN D1.STT_RCPT_STTS_SECD = '77' THEN '완결' ELSE D1.STT_RCPT_STTS_SECD END AS ACP_STA_NM /* 접수상태코드 */ ,F_CODE_NM('1000766', D1.LAD_RLVT_RULE_SECD) AS LAD_REL_RULE_NM /* 손망실관련규정코드명 - 2016.11.17 yyh */ FROM TB_BADGDA001M D1 /* 통보기본사항 */ ,( SELECT T1.NTFCTN_INST_CD AS NTFCTN_INST_CD /* 통보기관코드 */,
    T1.NTFCTN_SECD AS NTFCTN_SECD /* 통보구분코드 */,
    T1.NTFCTN_SQNO AS NTFCTN_SQNO /* 통보순번 */,
    CASE WHEN COUNT(T2.NTFCTN_SQNO) = 1 THEN MAX(T2.RLPR_NM) WHEN COUNT(T2.NTFCTN_SQNO) > 1 THEN MAX(T2.RLPR_NM) || '외 ' || ( COUNT(T2.NTFCTN_SQNO) - 1 ) || '명' ELSE '' END AS NTFCTN_SQNO /* 통보순번 */
FROM TBBADGDA001M T1 /* 통보사항 기본 */ ,TBBADGDA001L T2 /* 통보사항 관계자 내역 */ WHERE 1=1 AND T1.INST_CD = T2.INST_CD(+) AND T1.NTFCTN_SECD = T2.NTFCTN_SECD(+) AND T1.NTFCTN_SQNO = T2.NTFCTN_SQNO(+) AND T1.RSCH_ASMT_TTL LIKE '%' || #strSchTxt# || '%' GROUP BY T1.INST_CD, T1.NTFCTN_SECD, T1.NTFCTN_SQNO UNION SELECT T1.NTFCTN_INST_CD AS NTFCTN_INST_CD /* 통보기관코드 */,
    T1.NTFCTN_SECD AS NTFCTN_SECD /* 통보구분코드 */,
    T1.NTFCTN_SQNO AS NTFCTN_SQNO /* 통보순번 */,
    CASE WHEN COUNT(T1.NTFCTN_SQNO) = 1 THEN MAX(T1.RLPR_NM) WHEN COUNT(T1.NTFCTN_SQNO) > 1 THEN MAX(T1.RLPR_NM) || '외 ' || ( COUNT(T1.NTFCTN_SQNO) - 1 ) || '명' ELSE '' END AS NTFCTN_SQNO /* 통보순번 */
FROM TBBADGDA001L T1 /* 통보사항 관계자 내역 */ WHERE 1=1 AND T1.CRIM_VIOL_CN LIKE '%' || #strSchTxt# || '%' AND T1.RLPR_NM LIKE '%' || #strDfntNm# || '%' GROUP BY T1.INST_CD, T1.NTFCTN_SECD, T1.NTFCTN_SQNO ) D2 ,(SELECT T1.NTFCTN_INST_CD AS NTFCTN_INST_CD /* 통보기관코드 */,
    T1.NTFCTN_SECD AS NTFCTN_SECD /* 통보구분코드 */,
    T1.NTFCTN_SQNO AS NTFCTN_SQNO /* 통보순번 */,
    CASE WHEN COUNT(T2.NTFCTN_SQNO) = 1 THEN MAX(T2.RLPR_NM) WHEN COUNT(T2.NTFCTN_SQNO) > 1 THEN MAX(T2.RLPR_NM) || '외 ' || ( COUNT(T2.NTFCTN_SQNO) - 1 ) || '명' ELSE '' END AS NTFCTN_SQNO /* 통보순번 */
FROM TBBADGDA001M T1 /* 통보사항 기본 */ ,TBBADGDA001L T2 /* 통보사항 관계자 내역 */ WHERE 1=1 AND T1.INST_CD = T2.INST_CD(+) AND T1.NTFCTN_SECD = T2.NTFCTN_SECD(+) AND T1.NTFCTN_SQNO = T2.NTFCTN_SQNO(+) AND T1.RSCH_ASMT_TTL LIKE '%' || #strSchTxt# || '%' GROUP BY T1.INST_CD, T1.NTFCTN_SECD, T1.NTFCTN_SQNO ) D2 ,(SELECT T1.NTFCTN_INST_CD AS NTFCTN_INST_CD /* 통보기관코드 */,
    T1.NTFCTN_SECD AS NTFCTN_SECD /* 통보구분코드 */,
    T1.NTFCTN_SQNO AS NTFCTN_SQNO /* 통보순번 */,
    CASE WHEN COUNT(T1.NTFCTN_SQNO) = 1 THEN MAX(T1.RLPR_NM) WHEN COUNT(T1.NTFCTN_SQNO) > 1 THEN MAX(T1.RLPR_NM) || '외 ' || ( COUNT(T1.NTFCTN_SQNO) - 1 ) || '명' ELSE '' END AS NTFCTN_SQNO /* 통보순번 */
FROM TBBADGDA001L T1 /* 통보사항 관계자 내역 */ WHERE 1=1 AND T1.CRIM_VIOL_CN LIKE '%' || #strSchTxt# || '%' AND T1.RLPR_NM LIKE '%' || #strDfntNm# || '%' GROUP BY T1.INST_CD, T1.NTFCTN_SECD, T1.NTFCTN_SQNO ) D2 ,(SELECT T1.NTFCTN_INST_CD AS NTFCTN_INST_CD /* 통보기관코드 */,
    T1.NTFCTN_SECD AS NTFCTN_SECD /* 통보구분코드 */,
    T1.NTFCTN_SQNO AS NTFCTN_SQNO /* 통보순번 */,
    CASE WHEN COUNT(T2.NTFCTN_SQNO) = 1 THEN MAX(T2.RLPR_NM) WHEN COUNT(T2.NTFCTN_SQNO) > 1 THEN MAX(T2.RLPR_NM) || '외 ' || ( COUNT(T2.NTFCTN_SQNO) - 1 ) || '명' ELSE '' END AS NTFCTN_SQNO /* 통보순번 */
FROM TBBADGDA001M T1 /* 통보사항 기본 */ ,TBBADGDA001L T2 /* 통보사항 관계자 내역 */ WHERE 1=1 AND T1.INST_CD = T2.INST_CD(+) AND T1.NTFCTN_SECD = T2.NTFCTN_SECD(+) AND T1.NTFCTN_SQNO = T2.NTFCTN_SQNO(+) AND T2.RLPR_NM LIKE '%' || #strDfntNm# || '%' GROUP BY T1.INST_CD, T1.NTFCTN_SECD, T1.NTFCTN_SQNO ) D2 WHERE 1=1 AND D1.INST_CD = D2.INST_CD AND D1.NTFCTN_SECD = D2.NTFCTN_SECD AND D1.NTFCTN_SQNO = D2.NTFCTN_SQNO AND D1.NTFCTN_SECD = '2' /* 통보구분코드 (1:범죄및징계, 2:망실및훼손) */ AND D1.STT_RCPT_STTS_SECD != '51' AND D1.SRECS_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#))) AND D1.SRECS_DEPT_CD = #SRECS_DEPT_CD# AND D1.NTFCTN_RCPT_YMD BETWEEN #strAcpDtStr# AND #strAcpDtEnd# /* 접수일자 */ AND D1.STT_RCPT_STTS_SECD IN ('58', '59', '71', '72', '75', '76') AND D1.STT_RCPT_STTS_SECD IN ('71', '72', '76') AND D1.STT_RCPT_STTS_SECD = '75' AND D1.STT_RCPT_STTS_SECD = '77' AND D1.OCRN_SECD IN ('3','4','5','6') /* 통보구분 ('6' 추가 - 2017.10.10 yyh )*/ AND D1.OCRN_SECD = #OCRN_SECD# /* 통보구분 */ AND D1.INST_CD = #INST_CD# AND D1.PRCS_OPNN_SECD = #PRCS_OPNN_SECD# AND D1.PRCS_OPNN_SECD IN (#PRCS_OPNN_SECD#, #strHndlOpinCd2#) AND D1.PRCS_OPNN_SECD IN (#PRCS_OPNN_SECD#, #strHndlOpinCd2#, #strHndlOpinCd3#) AND NVL(D1.HRM_AMT,0) BETWEEN TO_NUMBER(#strLosAmFrom#) AND TO_NUMBER(#strLosAmTo#) AND D1.OCRN_SECD IN ('3','4','5') AND D1.OCRN_SECD = '6' AND D1.LAD_RLVT_RULE_SECD = #LAD_RLVT_RULE_SECD# ORDER BY D1.LINK_YR DESC ,D1.NTFCTN_RCPT_SQNO DESC /* ORDER BY D1.ACP_DT DESC ,D1.ORG_CD ,D1.NTF_DVSN_CD ,D1.NNB DESC */