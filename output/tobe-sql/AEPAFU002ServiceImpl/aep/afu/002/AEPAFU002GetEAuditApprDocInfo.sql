SELECT A.SORT_SQNO /* 정렬순번 */,
    C.ADT_STP_NM /* 감사단계명 */,
    B.SLCT_RPTP_NM /* 청탁보고서명 */,
    B.SLCT_RPTP_KDCD /* 청탁보고서종류코드 */,
    D.ATRZ_DMND_ID /* 결재요청아이디 */,
    A.ADT_YR /* 감사년도 */,
    A.ADT_NO /* 감사번호 */,
    A.ADT_STP_SECD /* 감사단계구분코드 */,
    D.DOC_ID /* 문서아이디 */,
    A.ATRZ_SECD /* 결재구분코드 */,
    A.ATRZ_DOC_SECD /* 결재문서구분코드 */,
    F_OPEN_EDIT(D.LNKG_URL_ADDR) AS F_OPEN_EDIT
FROM TB_BADDED109M A INNER JOIN TB_AEPMAR001M D ON A.ADT_YR = D.ADT_YR AND A.ADT_NO = D.ADT_NO AND A.ADT_STP_SECD = D.ADT_STP_SECD AND A.DOC_ID = D.DOC_ID INNER JOIN (SELECT AA.ADT_YR /* 감사년도 */,
    AA.ADT_NO /* 감사번호 */,
    AA.ADT_STP_SECD /* 감사단계구분코드 */,
    AA.CVLCPT_DOC_ID /* 문서아이디 */,
    AA.RPTP_KDCD /* 보고서종류코드 */,
    AA.RPTP_NM /* 보고서명 */,
    AA.LNKG_URL_ADDR /* 연결URL주소 */,
    AA.SORT_SQNO /* 정렬순번 */
FROM TBBADDED103M AA UNION ALL SELECT BB.ADT_YR /* 감사년도 */,
    BB.ADT_NO /* 감사번호 */,
    'NO',
    BB.CVLCPT_DOC_ID /* 문서아이디 */,
    DECODE(BB.DOC_TPCD,'AD-AR-002','A10300100','AD-AR-003','A10600200','AD-AR-001','A10500200') AS SLCT_RPTP_KDCD /* 청탁보고서종류코드 */,
    CC.ENAIS_ATCH_FILE_NM AS ENAIS_ATCH_FILE_NM /* ENAIS첨부파일명 */,
    'hancom' AS DOC_TYPE,
    null
FROM TBBADDED021M BB INNER JOIN ECM_FILE_LIST_VIEW2 CC ON CC.CVLCPT_DOC_ID = BB.CVLCPT_DOC_ID ) B ON A.ADT_YR = B.CVLCPT_ADT_YR AND A.ADT_NO = B.ADT_NO AND A.ADT_STP_SECD = B.ADT_STP_SECD AND B.CVLCPT_DOC_ID = D.RFRNC_DOC_ID LEFT OUTER JOIN TB_BADDED101M C ON A.ADT_YR = C.ADT_YR AND A.ADT_NO = C.ADT_NO AND A.ADT_STP_SECD = C.ADT_STP_SECD WHERE A.ATRZ_DMND_ID = #ATRZ_DMND_ID# AND A.ATRZ_DOC_SECD = #CRU_ATRZ_DOC_SECD# ORDER BY A.SORT_SQNO