SELECT A.BOO_KND_CD /* 도서종류코드 */,
    F_CODE_NM('1000149',A.BOO_KND_CD) AS F_CODE_NM /* 도서종류명 */,
    F_USR_INFO(B.LAG_INV_CNB, '2') AS F_USR_INFO /* 대출자명 */,
    B.LAG_INV_CNB /* 대출자전산번호 */,
    F_DPT_INFO(F_USR_INFO(B.LAG_INV_CNB, '5'), '1') AS F_DPT_INFO /* 대출부서 */,
    F_USR_INFO(B.LAG_INV_CNB, '5') AS F_USR_INFO /* 대출부서코드 */,
    A.BOO_NO /* 도서번호 */,
    A.BOO_NO||'-'||A.BOO_VLE_NO AS BOO_NO /* 도서번호 */,
    A.BOO_VLE_NO /* 도서권번호 */,
    A.CAT_SYM_NM /* 분류기호 */,
    A.BOO_TIT_NM /* 도서제목 */,
    A.RSCH_RPTP_AUT_NM /* 연구보고서저자명 */,
    B.BOO_REN_APT_DT /* 반납예정일자 */,
    DECODE((SELECT COUNT(*)
FROM TBCSPQBO003H H WHERE A.COPT_CAT_CD = H.COPT_CAT_CD AND A.BOO_KND_CD = H.BOO_KND_CD AND A.BOO_NO = H.BOO_NO AND A.CAT_SYM_NM = H.CAT_SYM_NM AND A.BOO_VLE_NO = H.BOO_VLE_NO AND H.LEND_BOKG_STA_CD = 'Y'),0,'N','Y' ) AS BOO_BOKG_YN /*대출예약여부*/ ,A.COPT_CAT_CD /*소관부호*/ ,B.BOO_LEND_SLN FROM TBCSPQBO001M A, TBCSPQBO002H B WHERE 1=1 AND A.COPT_CAT_CD = B.COPT_CAT_CD AND A.BOO_KND_CD = B.BOO_KND_CD AND A.BOO_NO = B.BOO_NO AND A.CAT_SYM_NM = B.CAT_SYM_NM AND A.BOO_VLE_NO = B.BOO_VLE_NO AND A.COPT_CAT_CD = #strCOPT_CAT_CD# AND A.BOO_LEND_DVSN_CD = B.BOO_REN_YN_CD AND A.BOO_LEND_DVSN_CD = '0' AND B.LAG_INV_CNB = #strLAG_INV_CNB# AND B.LAG_INV_CNB IN (SELECT TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBDCMACM001M WHERE SRECS_DEPT_CD = #SRECS_DEPT_CD#) ORDER BY B.BOO_REN_APT_DT DESC