SELECT T1.CVLCPT_ADT_YR AS CVLCPT_ADT_YR /* 민원감사년도 */,
    T1.ADT_NO AS ADT_NO /* 감사번호 */,
    T1.ADT_CLSF_NO AS ADT_CLSF_NO /* 감사분류번호 */,
    T1.ADT_GRNT_NO AS ADT_GRNT_NO /* 감사부여번호 */,
    T1.AUD_YR_NO_KND_CD AS AUD_YR_NO_KND_CD /* 감사연번호종류코드 */,
    T1.AUD_YR_NO_KND_NM AS AUD_YR_NO_KND_NM /* 감사연번호종류코드명 */,
    T1.AUD_DTL_NO AS AUD_DTL_NO /* 세부연번호 */,
    T1.ADT_ASMT_SECD AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    T1.AUD_TASK_NM AS AUD_TASK_NM,
    T1.INST_SECD AS INST_SECD /* 기관구분코드 */,
    T1.ADT_KDCD AS ADT_KDCD /* 감사종류코드 */,
    T1.AUD_KND_NM AS AUD_KND_NM,
    T1.SPRVSN_DEPT_CD AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    T1.SPV_BRDV_NM AS SPV_BRDV_NM /* 주관국과명 */,
    T1.ADT_MTHD_SECD AS ADT_MTHD_SECD /* 감사방법구분코드 */,
    T1.AUD_WAY_NM AS AUD_WAY_NM,
    T1.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    T1.ADT_SCL_SECD AS ADT_SCL_SECD /* 감사규모구분코드 */,
    T1.TASK_SECD AS TASK_SECD /* 업무구분코드 */,
    T1.TSK_CAT_NM AS TSK_CAT_NM,
    T1.ADT_RPRS_INST_CD AS ADT_RPRS_INST_CD /* 감사대표기관코드 */,
    T1.AUD_RPST_ORG_NM AS AUD_RPST_ORG_NM,
    T1.MNG_DEPT_CD AS MNG_DEPT_CD /* 관리부서코드 */,
    T1.MNG_DPT_NM AS MNG_DPT_NM,
    T1.PRGRS_STP_SECD AS PRGRS_STP_SECD /* 진행단계구분코드 */,
    F_CODE_NM('1000785',T1.PRGRS_STP_SECD) || (CASE WHEN T1.BZTRP_BGT_SECD = '1' AND T1.PRGRS_STP_SECD = '02' THEN (SELECT '/'|| F_CODE_NM('1000030',ADT_BZTRP_KDCD) AS PRGRS_STP_SECD /* 진행단계구분코드 */
FROM TB_BADDED002M WHERE BZTRP_YR || BZTRP_SQNO = (SELECT MAX(BZTRP_YR || BZTRP_SQNO) AS BZTRP_YR /* 출장년도 */
FROM TB_BADDED002M WHERE REL_ADT_YR = T1.CVLCPT_ADT_YR AND REL_ADT_NO = T1.ADT_NO ) ) END) AS PRSS_STEP_NM /*진행단계코드명*/ , T1.ADT_BGNG_YMD, T1.ADT_END_YMD , T1.ACADT_END_YMD AS ACADT_END_YMD /* 종료보고일- 2017.10.31 EUNOK */ , T1.DOC_LIST, T1.SLCT_RPTP_NM, TO_CHAR(T1.CRU_LAST_ATRZ_DT,'YYYYMMDD') AS CRU_LAST_ATRZ_DT , T1.RMRK_CN /* 담당자비고 - 2018.02.01 EUNOK */ , T1.ATRZ_STTS_SECD FROM ( SELECT D1.ADT_YR AS ADT_YR /* 감사년도 */,
    D1.ADT_NO AS ADT_NO /* 감사번호 */,
    D1.ADT_GRNT_NO AS ADT_GRNT_NO /* 감사부여번호 */,
    F_MNG_KND_AUDYRNO(D1.ADT_YR, D1.ADT_NO, D1.ADT_KDCD, '-') AS ADT_CLSF_NO /* 감사분류번호 */,
    CASE WHEN D1.ADT_YR >= '2016' THEN SUBSTR(D1.ADT_KDCD,3,1) ELSE '' END AS ADT_YR /* 감사년도 */,
    CASE WHEN D1.ADT_YR >= '2016' THEN F_CODE_NM('1000739',SUBSTR(D1.ADT_KDCD,3,1)) ELSE '-' END AS ADT_YR /* 감사년도 */,
    D1.ADT_YR||'-'||SUBSTR(D1.ADT_ASMT_SECD,-1)||'-'||D1.INST_SECD||'-'||SUBSTR(D1.ADT_KDCD,-1) ||'-'||SUBSTR(D1.SPRVSN_DEPT_CD,1,2)||SUBSTR(D1.SPRVSN_DEPT_CD,4,2)||'-'||SUBSTR(D1.ADT_MTHD_SECD,-1)||'-'||D1.ADT_NO AS ADT_YR /* 감사년도 */,
    D1.ADT_ASMT_SECD AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    F_CODE_NM_YEAR('1000008', D1.ADT_ASMT_SECD, D1.ADT_YR) AS F_CODE_NM_YEAR,
    D1.INST_SECD AS INST_SECD /* 기관구분코드 */,
    D1.ADT_KDCD AS ADT_KDCD /* 감사종류코드 */,
    F_CODE_NM_YEAR('1000007', D1.ADT_KDCD, D1.ADT_YR) AS F_CODE_NM_YEAR,
    D1.SPRVSN_DEPT_CD AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    F_DPT_INFO(D1.SPRVSN_DEPT_CD,'1') AS F_DPT_INFO /* 주관국과명 */,
    D1.ADT_MTHD_SECD AS ADT_MTHD_SECD /* 감사방법구분코드 */,
    F_CODE_NM_YEAR('1000009', D1.ADT_MTHD_SECD, D1.ADT_YR) AS F_CODE_NM_YEAR,
    D1.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    D1.ADT_SCL_SECD AS ADT_SCL_SECD /* 감사규모구분코드 */,
    D1.TASK_SECD AS TASK_SECD /* 업무구분코드 */,
    F_CODE_NM('1000120',D1.TASK_SECD) AS F_CODE_NM,
    D1.ADT_RPRS_INST_CD AS ADT_RPRS_INST_CD /* 감사대표기관코드 */,
    F_ORG_INFO(D1.ADT_RPRS_INST_CD,'1') AS F_ORG_INFO,
    D1.MNG_DEPT_CD AS MNG_DEPT_CD /* 관리부서코드 */,
    F_DPT_INFO(D1.MNG_DEPT_CD,'1') AS F_DPT_INFO,
    D1.PRGRS_STP_SECD AS PRGRS_STP_SECD /* 진행단계구분코드 */,
    D1.RMRK_CN /* 비고내용 */,
    D1.BZTRP_BGT_SECD /* 출장예산구분코드 */,
    (SELECT MIN(ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */
FROM TBBADDED002M A WHERE REL_ADT_YR = D1.CVLCPT_ADT_YR AND REL_ADT_NO = D1.ADT_NO AND ADT_BZTRP_KDCD IN ('02','03')) AS ADT_BGNG_YMD /* 실지감사 02:실지감사, 03:실지감사연장- 2017.11.14 EUNOK */ , (SELECT MAX(ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */
FROM TBBADDED002M A WHERE REL_ADT_YR = D1.CVLCPT_ADT_YR AND REL_ADT_NO = D1.ADT_NO AND ADT_BZTRP_KDCD IN ('02','03')) AS ADT_END_YMD /* 감사종료일 02:실지감사, 03:실지감사연장- 2017.11.07 EUNOK */ , D3.ACADT_END_YMD /* 종료보고일 - 2017.10.31 EUNOK */ , D4.DOC_LIST, D4.SLCT_RPTP_NM , D4.ATRZ_STTS_SECD , D5.CRU_LAST_ATRZ_DT FROM TBBADDED001M D1 , TBCSPDCP101M D2 , TBBADDED003M D3 ,(SELECT A1.ADT_YR /* 감사년도 */,
    A1.ADT_NO /* 감사번호 */,
    MAX (A1.ATRZ_STTS_SECD) AS ATRZ_STTS_SECD /* 결재상태구분코드 */,
    SUBSTR(XMLAGG(XMLELEMENT(X,',',CVLCPT_DOC_ID) ORDER BY CVLCPT_ADT_YR,ADT_NO,ADT_STP_SECD,CVLCPT_DOC_ID).EXTRACT('//text()'),2) AS SUBSTR,
    SUBSTR(XMLAGG(XMLELEMENT(X,',',SLCT_RPTP_NM) ORDER BY CVLCPT_ADT_YR,ADT_NO,ADT_STP_SECD,CVLCPT_DOC_ID).EXTRACT('//text()'),2) AS SLCT_RPTP_NM /* 청탁보고서명 */
FROM TBBADDED103M A1 WHERE A1.ADT_STP_SECD = 'A1050' AND A1.SLCT_RPTP_KDCD = 'A10500400' AND (A1.ATRZ_STTS_SECD IS NULL OR A1.ATRZ_STTS_SECD = '20170908' AND T1.ADT_BGNG_YMD