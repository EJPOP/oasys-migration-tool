SELECT D1.MM,
    D1.MEAL_PEN_CNB,
    D1.USER_NM /* 사용자명 */,
    D1.SRECS_DEPT_CD /* 심사재심의부서코드 */,
    D1.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    SUM(YY) AS YY,
    SUM(MEAL_M) AS MEAL_M
FROM ( SELECT SUBSTR(MEAL_DT, 0, 6) AS SUBSTR,
    MEAL_PEN_CNB,
    D.USER_NM /* 사용자명 */,
    E.SRECS_DEPT_CD /* 심사재심의부서코드 */,
    E.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    (CASE WHEN A.BOKG_YN = 'Y' THEN 1 ELSE 0 END) AS BOKG_YN,
    /* 예약하고 식사 */ (CASE WHEN A.BOKG_YN = 'Y' THEN (SELECT AS BOKG_YN
FROM TBCSPMWF004M WHERE SLCT_CRTR_DT = (SELECT MAX(SLCT_CRTR_DT) AS SLCT_CRTR_DT /* 청탁기준일시 */
FROM TBCSPMWF004M WHERE EXTV_DVSN_CD ='2' AND SLCT_CRTR_DT AND D.SRECS_DEPT_CD LIKE #dptCd# || '%' AND A.MEAL_PEN_CNB = #CNB# ) D1 GROUP BY D1.MM, D1.MEAL_PEN_CNB, D1.USER_NM, D1.SRECS_DEPT_CD, D1.CNSTN_MBCMT_DEPT_NM ORDER BY D1.SRECS_DEPT_CD, D1.USER_NM