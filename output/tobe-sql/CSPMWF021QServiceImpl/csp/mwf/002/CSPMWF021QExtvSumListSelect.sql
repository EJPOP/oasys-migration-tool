SELECT D1.MM,
    D1.MEAL_PEN_CNB,
    D1.USER_NM /* 사용자명 */,
    D1.SRECS_DEPT_CD /* 심사재심의부서코드 */,
    D1.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    D1.SRCH_SNO,
    SUM(YY) AS YY,
    SUM(YN) AS YN,
    SUM(NY) AS NY,
    MAX(BSC_M) AS BSC_M,
    NVL(SUM(MEAL_M),0) AS MEAL_M,
    MAX(BSC_M) + SUM(MEAL_M) AS BSC_M
FROM ( SELECT NVL(SUBSTR(MEAL_DT, 0, 6),#yyyymm#) AS SUBSTR,
    C.TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    D.USER_NM /* 사용자명 */,
    E.SRECS_DEPT_CD /* 심사재심의부서코드 */,
    E.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    (CASE WHEN A.BOKG_YN = 'Y' AND A.MEAL_YN = 'Y' THEN 1 ELSE 0 END) AS BOKG_YN,
    /* 예약하고 식사 */ (CASE WHEN A.BOKG_YN = 'Y' AND A.MEAL_YN = 'N' THEN 1 ELSE 0 END) AS BOKG_YN,
    /* 예약하고 안먹음 */ (CASE WHEN A.BOKG_YN = 'N' AND A.MEAL_YN = 'Y' THEN 1 ELSE 0 END) AS BOKG_YN,
    /* 예약안하고 먹음 */ (SELECT AS BSC_M
FROM TBCSPMWF004M WHERE SLCT_CRTR_DT = (SELECT MAX(SLCT_CRTR_DT) AS SLCT_CRTR_DT /* 청탁기준일시 */
FROM TBCSPMWF004M WHERE EXTV_DVSN_CD ='1' AND SLCT_CRTR_DT AND D.SRECS_DEPT_CD LIKE #dptCd# || '%' AND C.TRGT_NOP_ENO = #TRGT_NOP_ENO# ) D1 GROUP BY D1.MM, D1.MEAL_PEN_CNB, D1.USER_NM, D1.SRECS_DEPT_CD, D1.CNSTN_MBCMT_DEPT_NM, D1.SRCH_SNO ORDER BY SRCH_SNO