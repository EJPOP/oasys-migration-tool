SELECT AUD_KND_NM /* 감사종류 */,
    ADT_MTTR_NM /* 감사사항명 */,
    PTCPT_CNB_CNT /* 참여인원 */,
    STND_ASC /* 표준평점 */,
    SYT_EVL_RK_CD /* 평가등급 */,
    SYT_EVL_ADVL_VAL /* 종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다. */,
    ADVL_ASC /* 가중평점=표준평점*가중치 */,
    DECODE(CVLCPT_TASK_SECD, '10000', TSK_ST_STEP_NM, '') AS CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    DECODE(CVLCPT_TASK_SECD, '10000', TSK_END_STEP_NM, '') AS CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    DECODE(CVLCPT_TASK_SECD, '10000', DRIVE_RTE, '') AS CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    DECODE(CVLCPT_TASK_SECD, '10000', DRIVE_RTE_ASC, '') AS CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    DECODE(CVLCPT_TASK_SECD, '10000', DLAY_DT_NM_SUM, '') AS CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    DECODE(CVLCPT_TASK_SECD, '10000', ASP_RTE, '') AS CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    DECODE(CVLCPT_TASK_SECD, '10000', ASP_ASC, '') AS CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    DECODE(CVLCPT_TASK_SECD, '10000', SPE_ADD_SC, '') AS CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    TSK_ASC /* 업무평점-= 표준평점*평가등급별가중치*감사단계별추진율 + (가감평점) + 특별가산점 + 조정평점 */,
    CTB_RTE_SUM /* 기여율 SUM */,
    DPT_ASC_ALL /* 부서평점 = 업무평점 * 기여율 (기여율이 0 이면 업무평점도 0이다.) */,
    F_DPT_INFO(EVAL_DPT_CD, '1') AS F_DPT_INFO /* 2015.02.04 최원형감사관 요청 */
FROM( SELECT F_CODE_NM('1000270', D12.ADT_KDCD) AS F_CODE_NM /* 감사종류 */,
    D12.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    D12.NMPTCPT_CNT /* 참여인원 */,
    D12.STND_ASC AS STND_ASC /* 표준평점 */,
    F_CODE_NM('1000274', D12.SYT_EVL_RK_CD) AS F_CODE_NM /* 평가등급 */,
    D12.SYT_EVL_ADVL_VAL AS SYT_EVL_ADVL_VAL /* 종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다. */,
    D12.ADVL_ASC AS ADVL_ASC /* 가중평점=표준평점*가중치 */,
    F_CODE_NM('1000273', D12.AUD_STEP_CD_MIN) AS F_CODE_NM /* 단계기초 */,
    F_CODE_NM('1000273', D12.AUD_STEP_CD_MAX) AS F_CODE_NM /* 단계기말 */,
    D12.DRIVE_RTE_SUM /* 추진율 */,
    D12.DRIVE_RTE_ASC AS DRIVE_RTE_ASC /* 추진율 조정평점 */,
    D12.DLY_DT_SUM /* 지연일 */,
    ( CASE WHEN INSTR(D12.DLY_DT_SUM, '-') = 0 AND D12.ASP_RTE = 0 THEN '0.00' WHEN INSTR(D12.DLY_DT_SUM, '-') = 0 THEN TO_CHAR(D12.ASP_RTE,'FM99990.00') ELSE '-' || TO_CHAR(D12.ASP_RTE,'FM99990.00') END) AS INSTR /* 가감점율 */,
    D12.ASP_STND_ASC /* 가감평점 */,
    D12.SPE_ADD_SC AS SPE_ADD_SC /* 특별가산점 */,
    ROUND(D12.DRIVE_RTE_ASC + D12.ASP_STND_ASC + D12.SPE_ADD_SC + D12.MDT_ASC, 2) AS ROUND /* 업무평점-= 표준평점*평가등급별가중치*감사단계별추진율 + (가감평점) + 특별가산점 + 조정평점 */,
    D12.CTB_RTE_SUM AS CTB_RTE_SUM /* 기여율 SUM */,
    CASE WHEN D12.CTB_RTE_SUM = 0 THEN 0 ELSE ROUND((D12.DRIVE_RTE_ASC + D12.ASP_STND_ASC + D12.SPE_ADD_SC + D12.MDT_ASC) * (D12.CTB_RTE_SUM/ 100), 2) END AS CTB_RTE_SUM /* 부서평점 = 업무평점 * 기여율 (기여율이 0 이면 업무평점도 0이다.) */,
    '10000' AS CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    D12.EVAL_DPT_CD
FROM ( SELECT D13.ADT_KDCD /* 감사종류코드 */,
    D13.CVLCPT_ADT_YR /* 민원감사년도 */,
    D13.TSK_NO,
    D13.ADT_MTTR_NM /* 감사사항명 */,
    D13.NMPTCPT_CNT /* 참여인원 */,
    D13.STND_ASC /* 표준평점 */,
    D13.SYT_EVL_RK_CD /* 평가등급 */,
    D13.SYT_EVL_ADVL_VAL /* 종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다. */,
    D13.ADVL_ASC /* 가중평점=표준평점*가중치 */,
    D13.AUD_STEP_CD_MIN /* 단계기초 */,
    D13.AUD_STEP_CD_MAX /* 단계기말 */,
    D13.DRIVE_RTE_SUM /* 추진율 */,
    D13.DRIVE_RTE_ASC /* 추진율 조정평점 */,
    D13.DLY_DT_SUM /* 지연일 */,
    D13.ASP_RTE /* 가감점율 */,
    F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D13.ADT_KDCD, D13.AUD_STEP_CD_MAX, D13.DLY_DT_SUM, D13.SYT_EVL_ADVL_VAL, D13.ASP_STND_ASC, D13.CVLCPT_ADT_YR, D13.TSK_NO) AS F_AOE_ASP_STND_ASC_2 /* 가감평점 */,
    D13.SPE_ADD_SC /* 특별가산점 */,
    D13.MDT_ASC /* 조정평점 */,
    D13.MNDY_CNT /* 연인원 */,
    D13.SYT_TRTM_YN /* 종합처리안 여부 */,
    D13.CTB_RTE_SUM /* 기여율 SUM */,
    D13.EVAL_DPT_CD
FROM ( SELECT D11.ADT_KDCD /* 감사종류코드 */,
    D11.CVLCPT_ADT_YR /* 민원감사년도 */,
    D11.TSK_NO,
    D11.ADT_MTTR_NM /* 감사사항명 */,
    D11.NMPTCPT_CNT /* 참여인원 */,
    D11.STND_ASC /* 표준평점 */,
    D11.SYT_EVL_RK_CD /* 평가등급 */,
    D11.SYT_EVL_ADVL_VAL /* 종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다. */,
    D11.ADVL_ASC /* 가중평점=표준평점*가중치 */,
    D11.AUD_STEP_CD_MIN /* 단계기초 */,
    D11.AUD_STEP_CD_MAX /* 단계기말 */,
    D11.DRIVE_RTE_SUM /* 추진율 */,
    D11.DRIVE_RTE_ASC /* 추진율 조정평점 */,
    D11.DLY_DT_SUM /* 지연일 */,
    D11.ASP_RTE /* 가감점율 */,
    DECODE(D11.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D11.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D11.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D11.DRIVE_RTE_ASC * NVL(D11.ASP_RTE, 0) / 100, 2) ELSE ROUND(D11.STND_ASC * D11.SYT_EVL_ADVL_VAL * ( D11.DRIVE_RTE_SUM / 100) * (NVL(D11.ASP_RTE, 0)/ 100) , 2) END)) AS DLY_DT_SUM /* 가감평점 */,
    NVL(D11.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D11.CVLCPT_ADT_YR, D11.TSK_NO, D11.ADT_KDCD)) AS SPE_ADD_SC /* 특별가산점 */,
    NVL(D11.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D11.CVLCPT_ADT_YR, D11.TSK_NO, D11.ADT_KDCD)) AS MDT_ASC /* 조정평점 */,
    D11.MNDY_CNT /* 연인원 */,
    D11.SYT_TRTM_YN /* 종합처리안 여부 */,
    D11.CTB_RTE_SUM /* 기여율 SUM */,
    D11.EVAL_DPT_CD
FROM ( SELECT D10.ADT_KDCD /* 감사종류코드 */,
    D10.CVLCPT_ADT_YR /* 민원감사년도 */,
    D10.TSK_NO,
    D10.ADT_MTTR_NM /* 감사사항명 */,
    D10.NMPTCPT_CNT /* 참여인원 */,
    D10.STND_ASC /* 표준평점 */,
    D10.SYT_EVL_RK_CD /* 평가등급 */,
    D10.SYT_EVL_ADVL_VAL /* 종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다. */,
    D10.STND_ASC * D10.SYT_EVL_ADVL_VAL AS STND_ASC /* 가중평점=표준평점*가중치 */,
    D10.AUD_STEP_CD_MIN /* 단계기초 */,
    D10.AUD_STEP_CD_MAX /* 단계기말 */,
    D10.DRIVE_RTE_SUM /* 추진율 */,
    F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.ADT_KDCD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) AS F_AOE_DRIVE_RTE_ASC /* 추진율 조정평점 */,
    D10.DLY_DT_SUM /* 지연일 */,
    (SELECT AS ASP_RTE
FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D10.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/ , D10.MNDY_CNT /*연인원*/ , D10.SYT_TRTM_YN /*종합처리안 여부*/ , D10.CTB_RTE_SUM /*기여율 SUM*/ , D10.SPE_ADD_SC /*특별가산점*/ , D10.MDT_ASC /*조정평점*/ , D10.EVAL_DPT_CD FROM ( SELECT BASE.ADT_KDCD /* 감사종류코드 */,
    BASE.CVLCPT_ADT_YR /* 민원감사년도 */,
    BASE.TSK_NO,
    BASE.ADT_MTTR_NM /* 감사사항명 */,
    ( SELECT COUNT(*)
FROM TBCSPAOE023M WHERE CVLCPT_ADT_YR = BASE.CVLCPT_ADT_YR AND TSK_NO = BASE.TSK_NO AND ADT_STP_SECD = BASE.AUD_STEP_CD_MAX AND SUBSTR(BLT_DPT_CD, 1, 3) || '000' = #strDeptUpCd# AND BLT_DPT_CD = #strDeptCd# ) AS NMPTCPT_CNT /*참여인원*/ , F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, BASE.ADT_KDCD, BASE.AUD_STEP_CD_MIN, BASE.AUD_STEP_CD_MAX, BASE.MNDY_CNT, BASE.SYT_TRTM_YN) AS STND_ASC /*표준평점*/ , DECODE(NVL(EVL.EVL_STEP_CD, 'X') , '100', EVL.EVL_RK_CD, '200', EVL.SYT_EVL_RK_CD, 'X', (SELECT ELY_ADPT_STAD_RK_CD
FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND CVLCPT_TASK_SECD = '10000' AND ADT_KDCD = BASE.ADT_KDCD AND ADT_STP_SECD = BASE.AUD_STEP_CD_MAX ), 0) AS SYT_EVL_RK_CD /*평가등급*/ , DECODE(NVL(EVL.EVL_STEP_CD, 'X') , '100', D9.IDVT_INDEX_VAL, '200', EVL.SYT_EVL_ADVL_VAL , 'X', (SELECT IDVT_INDEX_VAL
FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND CVLCPT_TASK_SECD = '10000' AND AUD_TSK_KND_CD = BASE.ADT_KDCD AND RK_CD = ( SELECT ELY_ADPT_STAD_RK_CD
FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND CVLCPT_TASK_SECD = '10000' AND ADT_KDCD = BASE.ADT_KDCD AND ADT_STP_SECD = BASE.AUD_STEP_CD_MAX )) , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/ , BASE.AUD_STEP_CD_MIN /*단계기초*/ , BASE.AUD_STEP_CD_MAX /*단계기말*/ , BASE.MNDY_CNT /*연인원*/ , BASE.SYT_TRTM_YN /*종합처리안 여부*/ , (SELECT NVL(SUM(DRIVE_RTE), 0)
FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND CVLCPT_TASK_SECD = '10000' AND ADT_KDCD = BASE.ADT_KDCD AND ADT_STP_SECD BETWEEN BASE.AUD_STEP_CD_MIN AND BASE.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM /*추진율*/ , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
FROM TBCSPAOE022M WHERE CVLCPT_ADT_YR = BASE.CVLCPT_ADT_YR AND TSK_NO = BASE.TSK_NO AND ADT_STP_SECD BETWEEN BASE.AUD_STEP_CD_MIN AND BASE.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/ , BASE.CTB_RTE_SUM /*기여율 SUM*/ , EVL.SPE_ADD_SC /*특별가산점*/ , EVL.MDT_ASC /*조정평점*/ , BASE.EVAL_DPT_CD FROM ( SELECT D3.ADT_KDCD /* 감사종류코드 */,
    D3.CVLCPT_ADT_YR /* 민원감사년도 */,
    D3.TSK_NO,
    D3.ADT_MTTR_NM /* 감사사항명 */,
    D3.AUD_STEP_CD_MIN /* 단계기초 */,
    D3.AUD_STEP_CD_MAX /* 단계기말 */,
    D3.MNDY_CNT /* 연인원 */,
    D3.SYT_TRTM_YN /* 종합처리안 여부 */,
    D3.EVAL_DPT_CD,
    SUM(D4.CTB_RT) AS CTB_RT /* 기여비율 */
FROM ( SELECT D2.ADT_KDCD /* 감사종류코드 */,
    D2.CVLCPT_ADT_YR /* 민원감사년도 */,
    D2.TSK_NO,
    D2.ADT_MTTR_NM /* 감사사항명 */,
    D1.AUD_STEP_CD_MIN,
    D1.AUD_STEP_CD_MAX,
    D2.MNDY_CNT,
    D2.HNDL_DIV_DPT_CD,
    ( SELECT NVL(SYT_TRTM_YN, 'N')
FROM TBCSPAOE022M WHERE CVLCPT_ADT_YR = D1.CVLCPT_ADT_YR AND TSK_NO = D1.TSK_NO AND ADT_STP_SECD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/ FROM ( SELECT MIN(ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */,
    MAX(ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */,
    CVLCPT_ADT_YR /* 민원감사년도 */,
    TSK_NO
FROM TBCSPAOE022M WHERE CMPTN_YMD IS NOT NULL AND CMPTN_YMD BETWEEN #strEvlStrDt# AND #strEvlEndDt# GROUP BY CVLCPT_ADT_YR, TSK_NO ) D1 , TBCSPAOE021M D2 WHERE D1.CVLCPT_ADT_YR = D2.CVLCPT_ADT_YR AND D1.TSK_NO = D2.TSK_NO ) D3 /*감사사항 조회기준 데이터*/ , TBCSPAOE023M D4 /*참여인원*/ WHERE D3.CVLCPT_ADT_YR = D4.CVLCPT_ADT_YR AND D3.TSK_NO = D4.TSK_NO AND D3.AUD_STEP_CD_MAX = D4.ADT_STP_SECD AND SUBSTR(D4.BLT_DPT_CD, 1, 3) || '000' = #strDeptUpCd# AND D4.BLT_DPT_CD = #strDeptCd# GROUP BY D3.ADT_KDCD, D3.CVLCPT_ADT_YR, D3.TSK_NO, D3.ADT_MTTR_NM, D3.AUD_STEP_CD_MIN, D3.AUD_STEP_CD_MAX, D3.MNDY_CNT, D3.SYT_TRTM_YN, D3.EVAL_DPT_CD ) BASE /*조회조건으로 걸러낸 기본 정보들*/ , ( SELECT D8.AUD_TSK_KND_CD,
    D8.CVLCPT_ADT_YR /* 민원감사년도 */,
    D8.TSK_NO,
    D8.SYT_EVL_ADVL_VAL,
    D8.EVL_YR,
    D8.HLYR_DVSN_CD,
    D8.CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    D8.EVL_RK_CD,
    D8.SYT_EVL_RK_CD,
    D8.EVL_STEP_CD,
    D8.SPE_ADD_SC,
    D8.MDT_ASC
FROM ( SELECT EVL_YR,
    HLYR_DVSN_CD,
    CVLCPT_ADT_YR /* 민원감사년도 */,
    TSK_NO,
    MAX(EVL_STEP_CD) AS EVL_STEP_CD,
    AUD_TSK_KND_CD,
    CVLCPT_TASK_SECD /* 민원업무구분코드 */
FROM TBCSPAOE029M WHERE 1=1 AND (CVLCPT_ADT_YR, TSK_NO, EVL_STEP_CD) IN (SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    TSK_NO,
    MAX(EVL_STEP_CD)
FROM TBCSPAOE029M WHERE (CVLCPT_ADT_YR, TSK_NO) IN (SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    TSK_NO
FROM TBCSPAOE022M WHERE CMPTN_YMD IS NOT NULL AND CMPTN_YMD BETWEEN #strEvlStrDt# AND #strEvlEndDt# GROUP BY CVLCPT_ADT_YR, TSK_NO ) GROUP BY CVLCPT_ADT_YR, TSK_NO ) AND CVLCPT_TASK_SECD = '10000' AND EVL_STA_CD = '300' /*평가완료*/ GROUP BY EVL_YR, HLYR_DVSN_CD, CVLCPT_ADT_YR, TSK_NO, AUD_TSK_KND_CD, CVLCPT_TASK_SECD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/ ) D7 , TBCSPAOE029M D8 WHERE D7.EVL_YR = D8.EVL_YR AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD AND D7.CVLCPT_TASK_SECD = D8.CVLCPT_TASK_SECD AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD AND D7.EVL_STEP_CD = D8.EVL_STEP_CD AND D7.CVLCPT_ADT_YR = D8.CVLCPT_ADT_YR AND D7.TSK_NO = D8.TSK_NO ) EVL /*평가받은 아이들의 점수들*/ , TBCSPAOE010D D9 WHERE BASE.ADT_KDCD = EVL.AUD_TSK_KND_CD (+) /*평가받지 않은 감사사항들도 조회되야 한다.*/ AND BASE.CVLCPT_ADT_YR = EVL.CVLCPT_ADT_YR (+) AND BASE.TSK_NO = EVL.TSK_NO (+) AND EVL.EVL_YR = D9.EVL_YR (+) AND EVL.HLYR_DVSN_CD = D9.HLYR_DVSN_CD (+) AND EVL.CVLCPT_TASK_SECD = D9.CVLCPT_TASK_SECD (+) AND EVL.AUD_TSK_KND_CD = D9.AUD_TSK_KND_CD (+) AND EVL.EVL_RK_CD = D9.RK_CD (+) ) D10 ) D11 ) D13 ) D12 UNION ALL SELECT F_CODE_NM('1000272', BASE.TASK_KDCD) AS F_CODE_NM /* 감사종류 */,
    BASE.TSK_NM AS ADT_MTTR_NM /* 업무명 */,
    ( SELECT COUNT(PTCPT_CNB)
FROM TBCSPAOE025M WHERE EVL_YR = BASE.EVL_YR AND HLYR_DVSN_CD = BASE.HLYR_DVSN_CD AND TASK_KDCD = BASE.TASK_KDCD AND TSK_NO = BASE.TSK_NO AND SUBSTR(CHR_DPT_CD, 1, 3) || '000' = #strDeptUpCd# AND CHR_DPT_CD = #strDeptCd# ) AS PTCPT_CNB_CNT /*참여인원*/ , D3.STND_ASC /*표준평점*/ , F_CODE_NM('1000274', EVL.EVL_RK_CD) AS SYT_EVL_RK_CD /*평가등급*/ , EVL.IDVT_INDEX_VAL AS SYT_EVL_ADVL_VAL /*가중치*/ , D3.STND_ASC * EVL.IDVT_INDEX_VAL AS ADVL_ASC /*가중평점*/ , '' AS TSK_ST_STEP_NM , '' AS TSK_END_STEP_NM , 0 AS DRIVE_RTE , 0 AS DRIVE_RTE_ASC , 0 AS DLAY_DT_NM_SUM , '' AS ASP_RTE , 0 AS ASP_ASC , 0 AS SPE_ADD_SC , D3.STND_ASC * EVL.IDVT_INDEX_VAL AS TSK_ASC /*업무평점*/ , BASE.CTB_RTE_SUM /*기여율 합*/ , ROUND(D3.STND_ASC * EVL.IDVT_INDEX_VAL * (BASE.CTB_RTE_SUM/100), 2) AS DPT_ASC_ALL /*부서평점*/ , '10001' AS CVLCPT_TASK_SECD , BASE.EVAL_DPT_CD FROM ( SELECT D2.EVL_YR,
    D2.HLYR_DVSN_CD,
    D2.TASK_KDCD /* 업무종류코드 */,
    D2.TSK_NO,
    D2.TSK_NM,
    D1.CTB_RTE_SUM,
    D2.CHR_DPT_CD
FROM ( SELECT EVL_YR,
    HLYR_DVSN_CD,
    TASK_KDCD /* 업무종류코드 */,
    TSK_NO,
    SUM(CTB_RT) AS CTB_RT /* 기여비율 */
FROM TBCSPAOE025M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND SUBSTR(CHR_DPT_CD, 1, 3) || '000' = #strDeptUpCd# AND CHR_DPT_CD = #strDeptCd# GROUP BY EVL_YR, HLYR_DVSN_CD, TASK_KDCD, TSK_NO ) D1 , TBCSPAOE024M D2 WHERE D1.EVL_YR = D2.EVL_YR AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD AND D1.TASK_KDCD = D2.TASK_KDCD AND D1.TSK_NO = D2.TSK_NO ) BASE /*조회될 기준일 될 데이터*/ , TBCSPAOE006M D3 /*표준평점*/ , ( SELECT D4.EVL_YR,
    D4.HLYR_DVSN_CD,
    D4.AUD_TSK_KND_CD,
    D4.TSK_NO,
    D4.EVL_RK_CD /* 평가등급 */,
    D4.NAUD_TSK_EVL_SC /* 업무평점 */,
    D5.IDVT_INDEX_VAL /* 가중치 */
FROM TBCSPAOE029M D4 , TBCSPAOE010D D5 WHERE D4.EVL_YR = D5.EVL_YR AND D4.HLYR_DVSN_CD = D5.HLYR_DVSN_CD AND D4.CVLCPT_TASK_SECD = D5.CVLCPT_TASK_SECD AND D4.AUD_TSK_KND_CD = D5.AUD_TSK_KND_CD AND D4.EVL_RK_CD = D5.RK_CD AND D4.EVL_YR = #strEvlYr# AND D4.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D4.CVLCPT_TASK_SECD = '10001' AND D4.EVL_STEP_CD = '600' ) EVL WHERE BASE.EVL_YR = D3.EVL_YR AND BASE.HLYR_DVSN_CD = D3.HLYR_DVSN_CD AND D3.CVLCPT_TASK_SECD = '10001' AND BASE.TASK_KDCD = D3.TASK_KDCD AND BASE.EVL_YR = EVL.EVL_YR AND BASE.HLYR_DVSN_CD = EVL.HLYR_DVSN_CD AND BASE.TASK_KDCD = EVL.AUD_TSK_KND_CD AND BASE.TSK_NO = EVL.TSK_NO ) ORDER BY CVLCPT_TASK_SECD, DPT_ASC_ALL DESC