SELECT D1.CVLCPT_ADT_YR AS CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.ADT_NO AS ADT_NO /* 감사번호 */,
    D3.ADT_GRNT_NO AS ADT_GRNT_NO /* 감사부여번호 */,
    D1.CVLCPT_ADT_YR||D1.ADT_NO AS ADT_CLSF_NO /* 감사분류번호 */,
    D3.SPV_BRDV_NM AS SPV_BRDV_NM /* 주관국과명 */,
    (SELECT AS CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = D3.SPRVSN_DEPT_CD) AS SPRVSN_DEPT_CD ,(SELECT CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = D3.MNG_DEPT_CD) AS MNG_DEPT_CD /*관리부서 - 2016.03.08 yyh*/ , D3.ADT_MTTR_NM AS ADT_MTTR_NM /*감사사항*/ ,(SELECT CASE WHEN COUNT(DISTINCT INST_CD)>1 THEN F_ORG_INFO(MIN(INST_CD),'1')||'외 '||TO_CHAR(COUNT(DISTINCT INST_CD)-1)||'' ELSE F_ORG_INFO(MIN(INST_CD),'1') AS INST_CD /* 기관코드 */
FROM TB_BADDED008L WHERE 1 = 1 AND (BZTRP_YR, BZTRP_SQNO) IN (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */
FROM TB_BADDED002M WHERE 1=1 AND REL_ADT_YR = D3.CVLCPT_ADT_YR AND REL_ADT_NO = D3.ADT_NO AND ADT_BZTRP_KDCD IN ('02','03') )) AS AUD_ORG_CNT /*기관명*/ , D1.DSPS_RQT_SQNO AS DSPS_RQT_SQNO /*처분요구순번*/ , F_MNG_KND_AUDYRNO(D1.CVLCPT_ADT_YR, D1.ADT_NO, D3.ADT_KDCD, '-') ||'-'|| D1.DSPS_RQT_SQNO AS DSP_RQ_SNO_NM /*처분요구순번DISP*/ , CASE WHEN D1.CVLCPT_ADT_YR >= '2016' THEN D3.ADT_KDCD ELSE '' END AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.18 yyh*/ , D1.TMPLT_NO AS TMPLT_NO /*서식번호*/ , D1.RPTP_NO AS RPTP_NO /*보고서식번호*/ , D1.DSPS_RQT_NM AS DSPS_RQT_NM /*제목내용*/ , D1.DSPS_RQT_KDCD AS DSPS_RQT_KDCD /*처분요구종류코드*/ , D1.INST_SECD AS INST_SECD /*기관구분코드*/ , D1.ADT_EMPHS_SECD AS ADT_EMPHS_SECD /*감사중점코드*/ , D2.DSPS_RQT_IDNO AS DSPS_RQT_IDNO /*처분요구일련번호*/ , D2.ENFC_YMD AS ENFC_YMD /*시행일*/ , D2.PRCS_TERM_YMD AS PRCS_TERM_YMD /*처리기한일*/ , D2.ENFC_DEPT_CD AS ENFC_DEPT_CD /*시행국과코드*/ ,(SELECT CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = D2.ENFC_DEPT_CD) AS ENF_BRDV_NM /*시행국과명*/ , D2.DOC_SNDNG_NO AS DOC_SNDNG_NO /*문서발송코드*/ , D2.VIOL_CS_SECD AS VIOL_CS_SECD /*비위원인코드*/ , D2.IMPL_MNG_JRSD_DEPT_CD AS IMPL_MNG_JRSD_DEPT_CD /*집행관리국과코드*/ , D2.CFMTN_YN AS CFMTN_YN /*확정여부*/ , D2.CFMTN_STTS_SECD AS CFMTN_STTS_SECD /*확정상태코드*/ , D2.HMPG_RLS_YN AS HMPG_RLS_YN /*홈페이지공개여부*/ , D2.DUTY_OBV_UTLZ_YN AS DUTY_OBV_UTLZ_YN /*직무관철활용여부*/ , CASE WHEN SUBSTR(D2.VIOL_TPCD,1,1) = '1' THEN '100000000' WHEN SUBSTR(D2.VIOL_TPCD,1,1) = '2' THEN '200000000' ELSE '' END AS VIOL_TPCD /*비위유형코드 - 수정 2016.05.11 yyh*/ , D2.DSPS_RQT_ATRZ_STTS_SECD AS DSPS_RQT_ATRZ_STTS_SECD /*처분요구결재상태코드*/ , D2.TASK_SECD AS TASK_SECD /*업무분류코드*/ ,(SELECT CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000121' AND CD = D2.VIOL_TPCD ) AS VIOL_TYPE_NM /*비위유형코드명*/ ,(SELECT CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000120' AND CD = D2.TASK_SECD ) AS TSK_CAT_NM /*업무분류명*/ ,(SELECT CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000002' AND CD = D1.DSPS_RQT_KDCD ) AS DSPS_RQT_KND_CVN /*처분요구종류명*/ ,(SELECT CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000017' AND CD = D2.CFMTN_STTS_SECD ) AS DTM_STA_NM /*결재상태명*/ , CASE WHEN NVL(D4.CNT,0)>0 THEN 'Y' ELSE 'N' END AS FRE_CNT /*집행전말입력여부*/ , D2.ACSTN_RQST_NOP_CONT /*고발인원*/ , D2.NOP_CONT /*인원*/ , CASE WHEN SRECS_REL_INST_CD IS NOT NULL THEN (SELECT PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBDCMACM015M WHERE INST_CD = D2.REL_INST_CD)||'외 '||D5.CNT ELSE '' END REL_INST_NM /*관계기관*/ , CASE WHEN CMO_INST_CD IS NOT NULL THEN (SELECT PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBDCMACM015M WHERE INST_CD = D2.CMO_INST_CD)|| DECODE(D7.CNT,0,'','외 '||D7.CNT) ELSE '' END COPT_OFI_NM /*소관청*/ , CMO_INST_CD AS CMO_INST_CD /* 추가 - 2016.04.28 yyh*/ /* 처분요구사항실시내역 추가 - 2016.02.24 yyh */ , Z1.DSPS_RQT_DSCTN_SECD AS USER_HSTRY_SECD /* 구분코드 */ , Z1.DSPS_RQT_NM_1 AS DSPS_RQT_NM_1 /* 업무키1 */ , Z1.DSPS_RQT_NM_2 AS DSPS_RQT_NM_2 /* 업무키2 */ , Z1.DSPS_RQT_NM_3 AS DSPS_RQT_NM_3 /* 업무키3 */ , Z1.DSPS_RQT_NM_4 AS DSPS_RQT_NM_4 /* 업무키4 */ , CASE WHEN Z1.DSPS_RQT_DSCTN_SECD IN ('1','2','3') THEN (SELECT S1.TPOF_RCPT_YR||'-'|| (SELECT AS TPOF_RCPT_YR /* 제보접수년도 */
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000740' AND CD = S1.CLM_SECD ) ||'-'|| S1.TPOF_ACTL_RCPT_NO FROM TB_CSPDCP101M S1 WHERE Z1.DSPS_RQT_NM_1 = S1.CVLCPT_RCPT_YR AND Z1.DSPS_RQT_NM_2 = S1.CLM_SECD AND Z1.DSPS_RQT_NM_3 = S1.CVLCPT_RCPT_RCPT) WHEN Z1.DSPS_RQT_DSCTN_SECD = '4' THEN '' WHEN Z1.DSPS_RQT_DSCTN_SECD IN ('5','6','7') THEN (SELECT CASE WHEN S1.SRECS_RCPT_YR >= '2016' THEN S1.SRECS_RCPT_YR || '-' || DECODE(S1.SRECS_RCPT_SECD,'1','심사','2','재심','3','재심판정') || '-' || S1.SRECS_RCPT_SQNO ELSE S1.SRECS_RCPT_YR || '-' || S1.SRECS_RCPT_SECD || '-' || S1.SRECS_RCPT_SQNO AS SRECS_RCPT_YR /* 심사재심의접수년도 */
FROM TB_BADFRE012M S1 WHERE Z1.DSPS_RQT_NM_1 = S1.CVLCPT_RCPT_YR AND Z1.DSPS_RQT_NM_2 = S1.SRECS_RCPT_SECD AND Z1.DSPS_RQT_NM_3 = S1.SRECS_RCPT_SQNO AND Z1.DSPS_RQT_NM_4 = S1.SRECS_DEPT_CD) WHEN Z1.DSPS_RQT_DSCTN_SECD IN ('8','9') THEN (SELECT CASE WHEN S1.OCRN_SECD = '6' THEN S1.NTFCTN_YR||'-판청-'||S1.NTFCTN_RCPT_SQNO ELSE S1.NTFCTN_YR||'-손망-'||S1.NTFCTN_RCPT_SQNO AS OCRN_SECD /* 발생구분코드 */
FROM TB_BADGDA001M S1 WHERE Z1.DSPS_RQT_NM_1 = S1.INST_CD AND Z1.DSPS_RQT_NM_2 = S1.NTFCTN_SECD AND Z1.DSPS_RQT_NM_3 = S1.NTFCTN_SQNO) WHEN Z1.DSPS_RQT_DSCTN_SECD = '0' THEN Z1.DSPS_RQT_NM_1 ||'-정보-'|| Z1.DSPS_RQT_NM_2 WHEN Z1.DSPS_RQT_DSCTN_SECD = 'A' THEN F_MNG_KND_AUDYRNO(Z1.DSPS_RQT_NM_1, Z1.DSPS_RQT_NM_2, (SELECT ADT_KDCD /* 감사종류코드 */
FROM TB_BADDED001M WHERE CVLCPT_ADT_YR = Z1.DSPS_RQT_NM_1 AND ADT_NO = Z1.DSPS_RQT_NM_2), '-') ||'-'|| Z1.DSPS_RQT_NM_3 ||'-'|| F_ORG_INFO(Z1.DSPS_RQT_NM_4,'1') /* 청금 추가 - 2016.10.31 yyh */ WHEN Z1.DSPS_RQT_DSCTN_SECD = 'C' THEN Z1.DSPS_RQT_NM_2 || '-청금-' || (SELECT S1.SLCT_ACTL_RCPT_NO /* 청탁실제접수번호 */
FROM TB_CSPDCP811M S1 WHERE S1.CVLCPT_DCLR_SECD = Z1.DSPS_RQT_NM_1 AND S1.CVLCPT_RCPT_YR = Z1.DSPS_RQT_NM_2 AND S1.CVLCPT_DCLR_RCPT_NO = Z1.DSPS_RQT_NM_3) ELSE '' END AS TSK_KEY_NO /* 실시번호 */ ,D2.ADT_YR || '-' || D2.ADT_NO || '-' || D2.DSPS_RQT_SQNO AS AUD_YR_NO_FOCUS /* 저장 후 ROW위치 지정 */ ,D2.BFR_IMPL_MNG_DEPT_CD AS BFR_IMPL_MNG_DEPT_CD /* 구집행관리국과코드 - 2017.01.25 yyh */ ,'구 이행관리부서:' || (SELECT CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = D2.BFR_IMPL_MNG_DEPT_CD) AS OD_ENFM_MNG_BRDV_NM ,NVL(D2.MAIN_IMPLT_MNG_TRGT_YN, 'N') AS MAIN_IMPLT_MNG_TRGT_YN /* 주요이행관리대상여부 - 2017.01.25 yyh */ ,(SELECT T2.CVLCPT_DOC_ID /* 문서아이디 */
FROM TB_BADEAR001M T1 INNER JOIN TB_BADDED103M T2 ON T1.CVLCPT_ADT_YR = T2.CVLCPT_ADT_YR AND T1.ADT_NO = T2.ADT_NO AND TO_CHAR(T1.ADT_DSPS_RQT_SQNO) = T2.TPOF_RFRNC_ID WHERE T1.CVLCPT_ADT_YR = D1.CVLCPT_ADT_YR AND T1.ADT_NO = D1.ADT_NO AND T1.DSPS_RQT_SQNO = D1.DSPS_RQT_SQNO AND T2.ADT_STP_SECD = 'A1080' AND T2.SLCT_RPTP_KDCD = 'A10800500') AS ELCT_AUD_OPEN_DOC_ID /* 전자감사 공개문 DOC_ID 추가 - 2017.07.04 EUNOK */ ,CASE WHEN (SELECT T2.CVLCPT_DOC_ID /* 문서아이디 */
FROM TB_BADEAR001M T1 INNER JOIN TB_BADDED103M T2 ON T1.CVLCPT_ADT_YR = T2.CVLCPT_ADT_YR AND T1.ADT_NO = T2.ADT_NO AND TO_CHAR(T1.ADT_DSPS_RQT_SQNO) = T2.TPOF_RFRNC_ID WHERE T1.CVLCPT_ADT_YR = D1.CVLCPT_ADT_YR AND T1.ADT_NO = D1.ADT_NO AND T1.DSPS_RQT_SQNO = D1.DSPS_RQT_SQNO AND T2.ADT_STP_SECD = 'A1080' AND T2.SLCT_RPTP_KDCD = 'A10800500') IS NOT NULL THEN 'Y' ELSE '' END AS ELCT_AUD_OPEN_DOC_YN /* 전자감사 공개문 존재 여부 추가 - 2017.07.06 yyh */ ,D3.ADT_KDCD AS ADT_KDCD /* 감사종류코드 추가 - 2017.06.08 yyh */ ,D2.JGMT_DFR_MTTR_SECD AS JGMT_DFR_MTTR_SECD /* 판정유보사항코드 - 2018.08.06 yyh */ ,D2.JGMT_DFR_RSN_CN AS JGMT_DFR_RSN_CN /* 판정유보사유내용 - 2018.08.06 yyh */ ,D2.JGMT_DFR_MTTR_PRCS_RSLT_CN AS JGMT_DFR_MTTR_PRCS_RSLT_CN /* 판정유보사항처리결과내용 - 2018.08.06 yyh */ ,D8.DSPS_RQT_KYWD_CN_1 AS DSPS_RQT_KYWD_CN_1 /* 키워드 추가 - 2018.08.06 yyh */ ,D8.DSPS_RQT_KYWD_CN_2 AS DSPS_RQT_KYWD_CN_2 ,D8.DSPS_RQT_KYWD_CN_3 AS DSPS_RQT_KYWD_CN_3 ,D8.DSPS_RQT_KYWD_CN_4 AS DSPS_RQT_KYWD_CN_4 ,D8.DSPS_RQT_KYWD_CN_5 AS DSPS_RQT_KYWD_CN_5 ,(SELECT F_CODE_NM('1000774',T1.SBCN_SECD) AS SBCN_SECD /* 부의구분코드 */
FROM TB_BADDED145M T1 INNER JOIN TB_BADDED146M T2 ON T1.CVLCPT_ADT_YR = T2.CVLCPT_ADT_YR AND T1.ADT_NO = T2.ADT_NO AND T1.ADT_STP_SECD = T2.ADT_STP_SECD AND T1.APRVR_JBPS_SECD = T2.APRVR_JBPS_SECD AND T1.CVLCPT_DOC_ID = T2.CVLCPT_DOC_ID AND T1.INCDNT_SQNO = T2.INCDNT_SQNO AND T1.ADT_STP_SECD = 'A1070' AND T1.CVLCPT_ADT_YR > '2017' AND T1.APRVR_JBPS_SECD = 'A1070' WHERE T1.CVLCPT_ADT_YR = D1.CVLCPT_ADT_YR AND T1.ADT_NO = D1.ADT_NO AND T2.DSPS_RQT_SQNO = D1.ADT_DSPS_RQT_SQNO) AS REFER_DVSN_NM /* 부의 위임여부 - 2018.10.16 yyh */ , D2.EXRS_RVW_SECD AS EXRS_RVW_SECD /*통계자료 입력 적극행정면책 검토 코드*/ , D2.EXRS_YN_SECD AS EXRS_YN_SECD /*통계자료 입력 면책여부 코드*/ , D2.PASV_PBADMS_RVW_CN_YN AS PASV_PBADMS_RVW_CN_YN /*소극행정검토내용*/ , D2.SELF_YN AS SELF_YN /*자율여부*/ FROM TB_BADEAR001M D1 , TB_BADEAR002D D2 , TB_BADEAR035L Z1 , ( SELECT D1.ADT_YR /* 감사년도 */,
    D1.ADT_NO /* 감사번호 */,
    D1.ADT_GRNT_NO /* 감사부여번호 */,
    D1.ADT_KDCD /* 감사종류코드 */,
    F_DPT_INFO(D1.SPRVSN_DEPT_CD,'1')||'(단장 : '||F_USR_INFO(D1.ADT_WHOL_RBPRSN_ENO,'2')||', 주관 : '||F_USR_INFO(D1.SPVR_ENO,'2')||')' AS F_DPT_INFO,
    ' '||D1.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    D1.SPRVSN_DEPT_CD /* 주관부서코드 */,
    D1.MNG_DEPT_CD /* 관리부서코드 */
FROM TBBADDED001M D1 WHERE 1=1 AND D1.MNG_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#strCnb#, #dptAuth#, '', #strUpSpvBrdvCd#))) /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/ /* 감사연번종류코드 - 2015.12.18 yyh */ AND SUBSTR(D1.ADT_KDCD,3,1) = SUBSTR(#strAudYrNoKndCd#,3,1) AND D1.MNG_DEPT_CD = #MNG_DEPT_CD# AND D1.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND D1.ADT_GRNT_NO = #ADT_GRNT_NO# ) D3 , ( SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    COUNT(1) AS 1
FROM TBBADFRE001M GROUP BY CVLCPT_ADT_YR , ADT_NO , DSPS_RQT_SQNO ) D4 , (/*관계기관*/ SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    COUNT(1)-1 AS 1
FROM TBBADEAR006M GROUP BY CVLCPT_ADT_YR, ADT_NO, DSPS_RQT_SQNO ) D5 , (/*소관청*/ SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    COUNT(1)-1 AS 1
FROM TBBADEAR008M GROUP BY CVLCPT_ADT_YR, ADT_NO, DSPS_RQT_SQNO ) D7 , (SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    MAX(CASE WHEN GRNDS_EXMN_AEX_SQNO=1 THEN DSPS_RQT_KYWD_CN END) AS DSPS_RQT_KYWD_CN_1 /* 처분요구키워드내용1 */,
    MAX(CASE WHEN GRNDS_EXMN_AEX_SQNO=2 THEN DSPS_RQT_KYWD_CN END) AS DSPS_RQT_KYWD_CN_2 /* 처분요구키워드내용2 */,
    MAX(CASE WHEN GRNDS_EXMN_AEX_SQNO=3 THEN DSPS_RQT_KYWD_CN END) AS DSPS_RQT_KYWD_CN_3 /* 처분요구키워드내용3 */,
    MAX(CASE WHEN GRNDS_EXMN_AEX_SQNO=4 THEN DSPS_RQT_KYWD_CN END) AS DSPS_RQT_KYWD_CN_4 /* 처분요구키워드내용4 */,
    MAX(CASE WHEN GRNDS_EXMN_AEX_SQNO=5 THEN DSPS_RQT_KYWD_CN END) AS DSPS_RQT_KYWD_CN_5 /* 처분요구키워드내용5 */
FROM TBBADEAR037M GROUP BY CVLCPT_ADT_YR, ADT_NO, DSPS_RQT_SQNO) D8 /* 키워드 추가 */ WHERE 1=1 AND D1.CVLCPT_ADT_YR = D2.ADT_YR AND D1.ADT_NO = D2.ADT_NO AND D1.DSPS_RQT_SQNO = D2.DSPS_RQT_SQNO AND D1.CVLCPT_ADT_YR = D3.CVLCPT_ADT_YR AND D1.ADT_NO = D3.ADT_NO AND D1.CVLCPT_ADT_YR = D4.CVLCPT_ADT_YR(+) AND D1.ADT_NO = D4.ADT_NO(+) AND D1.DSPS_RQT_SQNO = D4.DSPS_RQT_SQNO(+) AND D1.CVLCPT_ADT_YR = D5.CVLCPT_ADT_YR(+) AND D1.ADT_NO = D5.ADT_NO(+) AND D1.DSPS_RQT_SQNO = D5.DSPS_RQT_SQNO(+) AND D1.CVLCPT_ADT_YR = D7.CVLCPT_ADT_YR(+) AND D1.ADT_NO = D7.ADT_NO(+) AND D1.DSPS_RQT_SQNO = D7.DSPS_RQT_SQNO(+) /* 처분요구사항실시내역 추가 - 2016.02.24 yyh */ AND D1.CVLCPT_ADT_YR = Z1.ADT_YR(+) AND D1.ADT_NO = Z1.ADT_NO(+) AND D1.DSPS_RQT_SQNO = Z1.DSPS_RQT_SQNO(+) AND D1.CVLCPT_ADT_YR = D8.CVLCPT_ADT_YR(+) AND D1.ADT_NO = D8.ADT_NO(+) AND D1.DSPS_RQT_SQNO = D8.DSPS_RQT_SQNO(+) AND D2.SDIN_STTS_SECD = '3' /* 송부상태코드가 결재완료 - 2017.06.01 yyh */ AND D2.ENFC_YMD LIKE #strEnfYr#||'%' AND D2.CFMTN_STTS_SECD = #CFMTN_STTS_SECD# AND D1.DSPS_RQT_KDCD = #DSPS_RQT_KDCD# AND D1.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND D1.ADT_NO = #ADT_NO# AND D1.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND D1.ADT_NO = #ADT_NO# AND D1.DSPS_RQT_SQNO = #DSPS_RQT_SQNO# AND D1.DSPS_RQT_NM LIKE '%'||#strTitTxt#||'%' AND TO_CHAR(D2.LAST_MDFCN_DT, 'YYYYMMDD') = #strInputDt# ORDER BY D1.CVLCPT_ADT_YR DESC , D1.ADT_NO DESC, D1.DSPS_RQT_SQNO DESC ORDER BY D1.CVLCPT_ADT_YR DESC , D1.ADT_NO DESC, D1.DSPS_RQT_SQNO