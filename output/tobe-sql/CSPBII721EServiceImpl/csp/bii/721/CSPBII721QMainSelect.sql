SELECT USER_NM /* 사용자명 */,
    JBGD_NM /* 직급명 */,
    CFMTN_YN /* 확정여부 */,
    CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    SBMSN_NOCS /* 제출건수 */,
    SMT_NOC_CPT,
    SMT_DEL_CPT,
    WRK_MN_CNT,
    SBMSN_DEPT_WORK_YN_1 /* 제출부서근무여부1 */,
    SBMSN_DEPT_WORK_YN_2 /* 제출부서근무여부2 */,
    SBMSN_DEPT_WORK_YN_3 /* 제출부서근무여부3 */,
    SBMSN_DEPT_WORK_YN_4 /* 제출부서근무여부4 */,
    SBMSN_DEPT_WORK_YN_5 /* 제출부서근무여부5 */,
    SBMSN_DEPT_WORK_YN_6 /* 제출부서근무여부6 */,
    INFO_YR /* 정보년도 */,
    INFO_MLG_QTR_SECD /* 정보마일리지분기구분코드 */,
    TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    CNSTN_MBCMT_HOME_TELNO /* 자문위원자택전화번호 */,
    CRNT_DPT_APM_DT,
    JBPS_NM /* 직위명 */,
    EVL_RSLT_SECD /* 평가결과구분코드 */,
    SBMSN_WHOL_SCR /* 제출전체점수 */,
    SBMSN_WHOL_NOCS /* 제출전체건수 */,
    NOW_JBGD_APNTMN_YMD /* 현재직급임용일자 */,
    GEN_ADMN_DVSN_NM,
    SMT_DT1,
    (SELECT MIN(M.SBMSN_YMD) AS SBMSN_YMD /* 제출일자 */
FROM TB_CSPBII170M M WHERE M.PRSNR_ENO = AA.TRGT_NOP_ENO AND M.SBMSN_YMD BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND M.FRS_MDM_SQNO != AA.FRS_MDM_SQNO ) AS SMT_DT2 ,SBMSN_SCR_RNK ,MLG_RMRK_CN ,INFO_RANK_CD ,INFO_RANK_NM ,SBMSN_TPCD FROM ( SELECT B.USER_NM /* 사용자명 */,
    F_CODE_NM('1000173', B.JBGD_SECD) AS JBGD_NM /* 직급명 */,
    A.SBMSN_PRFMNC_CFMTN_YN /* 제출실적확정여부 */,
    C.ABR_DPT_NM_1 AS CNSTN_MBCMT_DEPT_NM,
    (SELECT count(*)
FROM TBCSPBII170M M WHERE M.PRSNR_ENO = A.TRGT_NOP_ENO AND M.ADT_INFO_PRGRS_STTS_SECD NOT IN ('15','20','99') AND M.SBMSN_YMD BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND M.ADT_INFO_PRGRS_STTS_SECD >= '05') AS SBMSN_NOCS /* 제출건수(평가중) */ , (SELECT count(*)
FROM TBCSPBII170M M WHERE M.PRSNR_ENO = A.TRGT_NOP_ENO AND M.ADT_INFO_PRGRS_STTS_SECD IN ('15','20','99') AND M.SBMSN_YMD BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND M.ADT_INFO_PRGRS_STTS_SECD >= '05' AND M.PRCS_DRCTN_SECD != '7') AS SMT_NOC_CPT /* 제출건수(평가완료) */ , (SELECT count(*)
FROM TBCSPBII170M M WHERE M.PRSNR_ENO = A.TRGT_NOP_ENO AND M.ADT_INFO_PRGRS_STTS_SECD IN ('15','20','99') AND M.SBMSN_YMD BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND M.ADT_INFO_PRGRS_STTS_SECD >= '05' AND M.PRCS_DRCTN_SECD = '7' ) AS SMT_DEL_CPT /* 폐기건수 */ , A.MLG_RMRK_CN /* 마일리지비고 */ , DECODE(A.SBMSN_DEPT_WORK_YN_1, '1', 1, 0) + DECODE(A.SBMSN_DEPT_WORK_YN_2, '1', 1, 0) + DECODE(A.SBMSN_DEPT_WORK_YN_3, '1', 1, 0) + DECODE(A.SBMSN_DEPT_WORK_YN_4, '1', 1, 0) + DECODE(A.SBMSN_DEPT_WORK_YN_5, '1', 1, 0) + DECODE(A.SBMSN_DEPT_WORK_YN_6, '1', 1, 0) AS WRK_MN_CNT /* 근무월수 */ , CASE A.SBMSN_DEPT_WORK_YN_1 WHEN '1' THEN 'Y' WHEN '0' THEN 'N' ELSE '-' END AS SBMSN_DEPT_WORK_YN_1 /* 제출부서근무여부1 */ , CASE A.SBMSN_DEPT_WORK_YN_2 WHEN '1' THEN 'Y' WHEN '0' THEN 'N' ELSE '-' END AS SBMSN_DEPT_WORK_YN_2 /* 제출부서근무여부2 */ , CASE A.SBMSN_DEPT_WORK_YN_3 WHEN '1' THEN 'Y' WHEN '0' THEN 'N' ELSE '-' END AS SBMSN_DEPT_WORK_YN_3 /* 제출부서근무여부3 */ , CASE A.SBMSN_DEPT_WORK_YN_4 WHEN '1' THEN 'Y' WHEN '0' THEN 'N' ELSE '-' END AS SBMSN_DEPT_WORK_YN_4 /* 제출부서근무여부4 */ , CASE A.SBMSN_DEPT_WORK_YN_5 WHEN '1' THEN 'Y' WHEN '0' THEN 'N' ELSE '-' END AS SBMSN_DEPT_WORK_YN_5 /* 제출부서근무여부5 */ , CASE A.SBMSN_DEPT_WORK_YN_6 WHEN '1' THEN 'Y' WHEN '0' THEN 'N' ELSE '-' END AS SBMSN_DEPT_WORK_YN_6 /* 제출부서근무여부6 */ , A.INFO_YR , A.INFO_MLG_QTR_SECD , A.TRGT_NOP_ENO , B.CNSTN_MBCMT_HOME_TELNO , (SELECT CRNT_GD_APM_DT
FROM TBDCMACM903O S1 WHERE S1.CRU_RRNO_SCRTY = B.CRU_RRNO_SCRTY) AS CRNT_DPT_APM_DT , F_CODE_NM('1000176',B.JBPS_CD) AS JBPS_NM , NVL(EVL_RSLT_SECD,'0') AS EVL_RSLT_SECD , A.SBMSN_WHOL_SCR , A.SBMSN_WHOL_NOCS , B.NOW_JBGD_APNTMN_YMD , CASE WHEN C.SRECS_DEPT_CD IN ('062500','062600','062700','062800','170300','170320','071100','071300','180100','180110','100100','081100','081200','081300','081400','081500','081600','081700','081800','081900','0L0100','0L0200','0L0300') THEN '감사' ELSE DECODE(C.DEPT_TPCD,'A','감사','지원') END AS GEN_ADMN_DVSN_NM , D.SBMSN_YMD AS SMT_DT1 , (SELECT MAX(S.INFO_SQNO) AS INFO_SQNO /* 정보순번 */
FROM TBCSPBII170M S WHERE S.PRSNR_ENO = A.TRGT_NOP_ENO AND S.SBMSN_YMD BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND S.SBMSN_YMD = D.SBMSN_YMD ) AS FRS_MDM_SQNO , SBMSN_SCR_RNK , DECODE(B.INSD_JBGD_SECD,'30','2','1') AS INFO_RANK_CD , DECODE(F_CODE_NM('1000161',B.INSD_JBGD_SECD),'실국장','국장',F_CODE_NM('1000161', B.INSD_JBGD_SECD)) AS INFO_RANK_NM , A.SBMSN_TPCD FROM TBCSPBII170L A , TBDCMACM001M B , TBDCMACM002M C , (SELECT MIN(SBMSN_YMD) AS SBMSN_YMD /* 제출일자 */,
    PRSNR_ENO /* 제출자직원전산번호 */
FROM TBCSPBII170M WHERE SBMSN_YMD BETWEEN #strStrSmtDt# AND #strEndSmtDt# GROUP BY PRSNR_ENO) D WHERE A.TRGT_NOP_ENO = B.TRGT_NOP_ENO AND A.TRGT_NOP_ENO = D.PRSNR_ENO(+) AND A.INFO_YR = #INFO_YR# AND A.INFO_MLG_QTR_SECD = #INFO_MLG_QTR_SECD# AND nvl(A.SRECS_DEPT_CD,B.SRECS_DEPT_CD) = C.SRECS_DEPT_CD AND A.TRGT_NOP_ENO = #TRGT_NOP_ENO# AND B.SRECS_DEPT_CD = #SRECS_DEPT_CD# AND B.SRECS_DEPT_CD != #SRECS_DEPT_CD# AND A.MLG_RMRK_CN LIKE '%'||#strMlgRmk#||'%' AND A.SBMSN_WHOL_NOCS > 0 AND A.SBMSN_WHOL_NOCS AND A.SBMSN_TPCD = #SBMSN_TPCD# AND CASE WHEN C.SRECS_DEPT_CD IN ('062500','062600','062700','062800','170300','170320','071100','071300','180100','180110','100100','081100','081200','081300','081400','081500','081600','081700','081800','081900','0L0100','0L0200','0L0300') THEN 'A' ELSE C.DEPT_TPCD END = #strDPT_TP_CD# AND DECODE(B.INSD_JBGD_SECD,'30','2','1') = #strGEN_ADMN_DVSN_CD# ) AA ORDER BY SBMSN_WHOL_SCR DESC, SMT_DT1 ASC , nvl((SELECT MIN(M.SBMSN_YMD) AS SBMSN_YMD /* 제출일자 */
FROM TB_CSPBII170M M WHERE M.PRSNR_ENO = AA.TRGT_NOP_ENO AND M.SBMSN_YMD BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND M.FRS_MDM_SQNO != AA.FRS_MDM_SQNO ),'0') ASC, JBGD_NM ASC, TRGT_NOP_ENO ASC