SELECT SUM(SBMSN_WHOL_SCR) AS SBMSN_WHOL_SCR /* 제출전체점수 */,
    SUM(UTLZ_WHOL_SCR) AS UTLZ_WHOL_SCR /* 활용전체점수 */,
    SUM(RLBT_WHOL_SCR) AS RLBT_WHOL_SCR /* 신뢰성전체점수 */,
    SUM(CSIT_TSC) AS CSIT_TSC /* 충실성총점 */,
    MAX(SMT_DEL_CPT) AS SMT_DEL_CPT,
    MAX(SBMSN_NOCS) AS SBMSN_NOCS /* 제출건수 */,
    MAX(SMT_NOC_CPT) AS SMT_NOC_CPT,
    MAX(SBMSN_WHOL_NOCS) AS SBMSN_WHOL_NOCS /* 제출전체건수 */,
    TRGT_NOP_ENO AS TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    INFO_YR AS INFO_YR /* 정보년도 */,
    INFO_MLG_QTR_SECD AS INFO_MLG_QTR_SECD /* 정보마일리지분기구분코드 */
FROM ( SELECT /* csp.bii.service.impl.CSPBII721QServiceImpl.CSPBII721EMlgReCalcSelect */ SUM(AA.UTLZ_SCR) + SUM(AA.RLBT_SCR) + SUM(AA.CSIT_SCR) AS SBMSN_WHOL_SCR /* 제출전체점수 */,
    SUM(AA.UTLZ_SCR) AS UTLZ_WHOL_SCR /* 활용전체점수 */,
    SUM(AA.RLBT_SCR) AS RLBT_WHOL_SCR /* 신뢰성전체점수 */,
    SUM(AA.CSIT_SCR) AS CSIT_TSC /* 충실성총점 */,
    MAX(AA.SMT_DEL_CPT) AS SMT_DEL_CPT /* 폐기건수 */,
    MAX(AA.SBMSN_NOCS) AS SBMSN_NOCS /* 제출건수 */,
    MAX(AA.SMT_NOC_CPT) AS SMT_NOC_CPT /* 제출건수(평가완료) */,
    MAX(AA.SMT_DEL_CPT) + MAX(AA.SBMSN_NOCS) + MAX(AA.SMT_NOC_CPT) AS SBMSN_WHOL_NOCS /* 제출전체건수 */,
    AA.TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    AA.INFO_YR /* 정보년도 */,
    AA.INFO_MLG_QTR_SECD /* 정보마일리지분기구분코드 */
FROM ( SELECT UTLZ_SCR /* 활용점수 */,
    RLBT_SCR /* 신뢰성점수 */,
    CSIT_SCR /* 충실성점수 */,
    ROW_NUMBER() OVER (PARTITION BY A.PRSNR_ENO ORDER BY (UTLZ_SCR + RLBT_SCR + CSIT_SCR) DESC) AS SBMSN_SCR_RNK /* 제출점수순위 */,
    (SELECT count(*)
FROM TBCSPBII170M M WHERE M.PRSNR_ENO = B.TRGT_NOP_ENO AND M.ADT_INFO_PRGRS_STTS_SECD NOT IN ('15','20','99') AND M.SBMSN_YMD BETWEEN #strStrDt# AND #strEndDt# AND M.ADT_INFO_PRGRS_STTS_SECD >= '05') AS SBMSN_NOCS /* 제출건수(평가중) */ , (SELECT count(*)
FROM TBCSPBII170M M WHERE M.PRSNR_ENO = B.TRGT_NOP_ENO AND M.ADT_INFO_PRGRS_STTS_SECD IN ('15','20','99') AND M.SBMSN_YMD BETWEEN #strStrDt# AND #strEndDt# AND M.ADT_INFO_PRGRS_STTS_SECD >= '05' AND M.PRCS_DRCTN_SECD != '7') AS SMT_NOC_CPT /* 제출건수(평가완료) */ , (SELECT count(*)
FROM TBCSPBII170M M WHERE M.PRSNR_ENO = B.TRGT_NOP_ENO AND M.ADT_INFO_PRGRS_STTS_SECD IN ('15','20','99') AND M.SBMSN_YMD BETWEEN #strStrDt# AND #strEndDt# AND M.ADT_INFO_PRGRS_STTS_SECD >= '05' AND M.PRCS_DRCTN_SECD = '7' ) AS SMT_DEL_CPT /* 폐기건수 */ , B.TRGT_NOP_ENO , B.INFO_YR , B.INFO_MLG_QTR_SECD , A.PRSNR_ENO FROM TBCSPBII170M A, TBCSPBII170L B WHERE B.INFO_YR = #INFO_YR# AND B.INFO_MLG_QTR_SECD = #INFO_MLG_QTR_SECD# AND A.SBMSN_YMD BETWEEN #strStrDt# AND #strEndDt# AND A.CLCT_SECD IN ('1','2') AND A.PRSNR_ENO = B.TRGT_NOP_ENO ) AA WHERE SBMSN_SCR_RNK < 3 GROUP BY TRGT_NOP_ENO, INFO_YR, INFO_MLG_QTR_SECD UNION ALL SELECT /* csp.bii.service.impl.CSPBII721QServiceImpl.CSPBII721EMlgReCalcSelect */ SUM(AA.UTLZ_SCR) + SUM(AA.RLBT_SCR) + SUM(AA.CSIT_SCR) AS SBMSN_WHOL_SCR /* 제출전체점수 */,
    SUM(AA.UTLZ_SCR) AS UTLZ_WHOL_SCR /* 활용전체점수 */,
    SUM(AA.RLBT_SCR) AS RLBT_WHOL_SCR /* 신뢰성전체점수 */,
    SUM(AA.CSIT_SCR) AS CSIT_TSC /* 충실성총점 */,
    MAX(AA.SMT_DEL_CPT) AS SMT_DEL_CPT /* 폐기건수 */,
    MAX(AA.SBMSN_NOCS) AS SBMSN_NOCS /* 제출건수 */,
    MAX(AA.SMT_NOC_CPT) AS SMT_NOC_CPT /* 제출건수(평가완료) */,
    MAX(AA.SMT_DEL_CPT) + MAX(AA.SBMSN_NOCS) + MAX(AA.SMT_NOC_CPT) AS SBMSN_WHOL_NOCS /* 제출전체건수 */,
    AA.TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    AA.INFO_YR /* 정보년도 */,
    AA.INFO_MLG_QTR_SECD /* 정보마일리지분기구분코드 */
FROM ( SELECT UTLZ_SCR /* 활용점수 */,
    RLBT_SCR /* 신뢰성점수 */,
    CSIT_SCR /* 충실성점수 */,
    0 AS SBMSN_NOCS /* 제출건수(평가중) */,
    0 /* 제출건수(평가완료) */,
    0 /* 폐기건수 */,
    B.INFO_PRSNR_ENO /* 정보제출자직원전산번호 */,
    B.INFO_YR /* 정보년도 */,
    B.INFO_MLG_QTR_SECD /* 정보마일리지분기구분코드 */,
    A.PRSNR_ENO /* 제출자직원전산번호 */
FROM TBCSPBII170M A, TBCSPBII170L B WHERE B.INFO_YR = #INFO_YR# AND B.INFO_MLG_QTR_SECD = #INFO_MLG_QTR_SECD# AND A.SBMSN_YMD BETWEEN #strStrDt# AND #strEndDt# AND A.CLCT_SECD NOT IN ('1','2') AND A.PRSNR_ENO = B.TRGT_NOP_ENO ) AA GROUP BY TRGT_NOP_ENO, INFO_YR, INFO_MLG_QTR_SECD ) GROUP BY TRGT_NOP_ENO, INFO_YR, INFO_MLG_QTR_SECD