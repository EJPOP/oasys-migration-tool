SELECT D1.CVLCPT_ADT_YR AS CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.ADT_NO AS ADT_NO /* 감사번호 */,
    D3.ADT_GRNT_NO AS ADT_GRNT_NO /* 감사부여번호 */,
    F_MNG_KND_AUDYRNO(D1.CVLCPT_ADT_YR, D1.ADT_NO, D3.ADT_KDCD, '-') AS ADT_CLSF_NO /* 감사분류번호 */,
    CASE WHEN D1.CVLCPT_ADT_YR >= '2016' THEN F_CODE_NM('1000739',D3.ADT_KDCD) ELSE '-' END AS CVLCPT_ADT_YR /* 민원감사년도 */,
    D3.SPV_BRDV_NM AS SPV_BRDV_NM /* 주관국과명 */,
    D3.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    D3.AUD_ORG_CNT AS AUD_ORG_CNT /* 기관명 */,
    D1.DSPS_RQT_SQNO AS DSPS_RQT_SQNO /* 처분요구순번 */,
    F_MNG_KND_AUDYRNO(D1.CVLCPT_ADT_YR, D1.ADT_NO, D3.ADT_KDCD, '-') ||'-'|| D1.DSPS_RQT_SQNO AS F_MNG_KND_AUDYRNO /* 처분요구순번DISP - 2015.12.22 yyh */,
    D1.TMPLT_NO AS TMPLT_NO /* 서식번호 */,
    D1.RPTP_NO AS RPTP_NO /* 보고서번호 */,
    D1.DSPS_RQT_NM AS DSPS_RQT_NM /* 처분요구명 */,
    D1.DSPS_RQT_KDCD AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    D1.INST_SECD AS INST_SECD /* 기관구분코드 */,
    D1.ADT_EMPHS_SECD AS ADT_EMPHS_SECD /* 감사중점구분코드 */,
    D2.DSPS_RQT_IDNO AS DSPS_RQT_IDNO /* 처분요구식별번호 */,
    D2.ENFC_YMD AS ENFC_YMD /* 시행일자 */,
    D2.PRCS_TERM_YMD AS PRCS_TERM_YMD /* 처리기한일자 */,
    D2.ENFC_DEPT_CD AS ENFC_DEPT_CD /* 시행부서코드 */,
    F_DPT_INFO(D2.ENFC_DEPT_CD,'1') AS F_DPT_INFO /* 시행국과명 */,
    D2.DOC_SNDNG_NO AS DOC_SNDNG_NO /* 문서발송번호 */,
    D2.VIOL_CS_SECD AS VIOL_CS_SECD /* 비위원인구분코드 */,
    D2.IMPL_MNG_JRSD_DEPT_CD AS IMPL_MNG_JRSD_DEPT_CD /* 집행관리소관부서코드 */,
    D2.CFMTN_YN AS CFMTN_YN /* 확정여부 */,
    D2.CFMTN_STTS_SECD AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    D2.HMPG_RLS_YN AS HMPG_RLS_YN /* 누리집공개여부 */,
    D2.DUTY_OBV_UTLZ_YN AS DUTY_OBV_UTLZ_YN /* 직무관찰활용여부 */,
    D2.VIOL_TPCD AS VIOL_TPCD /* 비위유형코드 */,
    D2.DSPS_RQT_ATRZ_STTS_SECD AS DSPS_RQT_ATRZ_STTS_SECD /* 처분요구결재상태구분코드 */,
    D2.TASK_SECD AS TASK_SECD /* 업무구분코드 */,
    F_CODE_NM('1000121',D2.VIOL_TPCD) AS VIOL_TYPE_NM /* 비위유형명 */,
    DECODE(SUBSTR(D2.VIOL_TPCD,1,1),'1','100000000','200000000') AS SUBSTR /* 비위유형코드 */,
    F_CODE_NM('1000121',DECODE(SUBSTR(D2.VIOL_TPCD,1,1),'1','100000000','200000000')) AS F_CODE_NM /* 비위유형코드명 */,
    F_CODE_NM('1000120',D2.TASK_SECD) AS F_CODE_NM /* 업무분류명 */,
    F_CODE_NM('1000002',D1.DSPS_RQT_KDCD ) AS DSPS_RQT_KND_CVN /* 처분요구종류코드값명 */,
    F_CODE_NM('1000017',D2.CFMTN_STTS_SECD ) AS F_CODE_NM /* 결재상태명 */,
    '예비 : '||D4.RSRV_CNT||'회('||D4.RSRV_NOP_CNT||'명, '|| D4.RSRV_AUD_DCN||'일) ' ||'실지 : '||D4.FIELD_CNT||'회('||D4.FIELD_NOP_CNT||'명, '|| D4.ACADT_ENFRC_DCN||'일) ' ||'추가 : '||D4.ADD_CNT||'회('||D4.ADD_NOP_CNT||'명, '|| D4.ADD_AUD_DCN||'일)' ||' = 총 연인원' ||D4.MAN_DAY AS RSRV_CNT /* 출장상황 */,
    NVL(D2.PNRT_PRSRV_AMT,0) + NVL(D2.RMBR_AMT,0) + NVL(D2.SPLP_AMT,0) AS PNRT_PRSRV_AMT /* 추징회수보전금액 */,
    NVL(D2.BGT_RTRC_AMT, 0)+NVL(D2.INCM_INCRS_AMT, 0)+NVL(D2.PPL_BRDN_RDT_AMT, 0) + NVL(D2.PRPT_INCRS_AMT, 0) + NVL(D2.EXPND_RATI_AMT, 0) AS BGT_RTRC_AMT /* 예산절감금액 */,
    '처분요구금액 : '||TO_CHAR(NVL(D2.PNRT_PRSRV_AMT,0) + NVL(D2.RMBR_AMT,0) + NVL(D2.SPLP_AMT,0),'999,999,999,999,999')||'원 '||'기대효과금액 : '|| TO_CHAR(NVL(D2.BGT_RTRC_AMT, 0)+NVL(D2.INCM_INCRS_AMT, 0)+NVL(D2.PPL_BRDN_RDT_AMT, 0) + NVL(D2.PRPT_INCRS_AMT, 0) + NVL(D2.EXPND_RATI_AMT, 0),'999,999,999,999,999')||'원' AS TO_CHAR,
    D2.REL_INST_CD /* 관계기관코드 */,
    F_ORG_INFO(D2.REL_INST_CD,'1') ||'외 '|| (SELECT COUNT(1)-1 AS REL_INST_CD /* 관계기관코드 */
FROM TB_BADEAR006M WHERE CVLCPT_ADT_YR = D2.ADT_YR AND ADT_NO = D2.ADT_NO AND DSPS_RQT_SQNO = D2.DSPS_RQT_SQNO) AS DTL_RLTN_ORG_NM , F_ORG_INFO(D2.CMO_INST_CD,'1') AS DTL_COPT_OFI_NM , D2.ACSTN_RQST_NOP_CONT AS ACSTN_RQST_NOP_CONT /*고발의뢰인원수*/ , D2.NOP_CONT AS TPOF_NOPE /*인원수*/ , ( SELECT NVL(MAX(ST1.MNG_SQNO), 0) AS MNG_SQNO /* 관리순번 */
FROM TB_BADFRE011M ST1 WHERE ST1.CVLCPT_ADT_YR = D1.CVLCPT_ADT_YR AND ST1.ADT_NO = D1.ADT_NO AND ST1.DSPS_RQT_SQNO = D1.DSPS_RQT_SQNO AND ST1.SRECS_REL_INST_CD = D2.REL_INST_CD ) AS MNG_SNO_MAX , ( SELECT DECODE(NVL(COUNT(1), 0), 0, '', '특수관리사항') AS 1
FROM TB_BADFRE011M ST1 WHERE ST1.CVLCPT_ADT_YR = D1.CVLCPT_ADT_YR AND ST1.ADT_NO = D1.ADT_NO AND ST1.DSPS_RQT_SQNO = D1.DSPS_RQT_SQNO ) AS SPCN_MNG , ( SELECT DECODE(NVL(COUNT(1), 0), 0, '', '재심의사항') AS 1
FROM TB_BADFRE012M ST1 WHERE ST1.CVLCPT_ADT_YR = D1.CVLCPT_ADT_YR AND ST1.ADT_NO = D1.ADT_NO AND ST1.DSPS_RQT_SQNO = D1.DSPS_RQT_SQNO ) AS JESIM_CNT /* 감사결정례 추가 - 2016.07.12 yyh */ , ( SELECT DECODE(NVL(COUNT(1), 0), 0, '', '감사결정례') AS 1
FROM TBBADEAR034M ST1 WHERE ST1.CVLCPT_ADT_YR = D1.CVLCPT_ADT_YR AND ST1.ADT_NO = D1.ADT_NO AND ST1.DSPS_RQT_SQNO = D1.DSPS_RQT_SQNO ) AS DCSEXP_CNT /* 소송여부 추가 - 2021.10.06 EUNOK */ , ( SELECT DECODE(NVL(COUNT(1), 0), 0, '', '소송') AS 1
FROM TB_BADEAR038M ST1 WHERE ST1.CVLCPT_ADT_YR = D1.CVLCPT_ADT_YR AND ST1.ADT_NO = D1.ADT_NO AND ST1.DSPS_RQT_SQNO = D1.DSPS_RQT_SQNO ) AS SOSONG_CNT /* 실시구분 추가 - 2016.07.12 yyh */ ,Z1.DSPS_RQT_DSCTN_SECD ,(SELECT USR_DFN_TXT_1
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000742' AND CD = Z1.DSPS_RQT_DSCTN_SECD) AS SE_NM ,Z1.DSPS_RQT_NM_1 ,Z1.DSPS_RQT_NM_2 ,Z1.DSPS_RQT_NM_3 ,Z1.DSPS_RQT_NM_4 ,(SELECT T2.CVLCPT_DOC_ID /* 문서아이디 */
FROM TB_BADEAR001M T1 INNER JOIN TB_BADDED103M T2 ON T1.CVLCPT_ADT_YR = T2.CVLCPT_ADT_YR AND T1.ADT_NO = T2.ADT_NO AND TO_CHAR(T1.ADT_DSPS_RQT_SQNO) = T2.TPOF_RFRNC_ID WHERE T1.CVLCPT_ADT_YR = D1.CVLCPT_ADT_YR AND T1.ADT_NO = D1.ADT_NO AND T1.DSPS_RQT_SQNO = D1.DSPS_RQT_SQNO AND T2.ADT_STP_SECD = 'A1080' AND T2.SLCT_RPTP_KDCD = 'A10800500') AS ELCT_AUD_OPEN_DOC_ID /* 전자감사 공개문 DOC_ID 추가 - 2017.07.04 EUNOK */ ,D2.JGMT_DFR_MTTR_SECD AS JGMT_DFR_MTTR_SECD /* 판정유보사항코드 - 2018.08.06 yyh */ ,F_CODE_NM('1000872',D2.JGMT_DFR_MTTR_SECD) AS JUD_RST_SBJ_NM /* 판정유보사항명 - 2018.08.06 yyh */ ,D2.JGMT_DFR_RSN_CN AS JGMT_DFR_RSN_CN /* 판정유보사유내용 - 2018.08.06 yyh */ ,D2.JGMT_DFR_MTTR_PRCS_RSLT_CN AS JGMT_DFR_MTTR_PRCS_RSLT_CN /* 판정유보사항처리결과내용 - 2018.08.06 yyh */ ,D5.DSPS_RQT_KYWD_CN_1 AS DSPS_RQT_KYWD_CN_1 /* 키워드 추가 - 2018.08.06 yyh */ ,D5.DSPS_RQT_KYWD_CN_2 AS DSPS_RQT_KYWD_CN_2 ,D5.DSPS_RQT_KYWD_CN_3 AS DSPS_RQT_KYWD_CN_3 ,D5.DSPS_RQT_KYWD_CN_4 AS DSPS_RQT_KYWD_CN_4 ,D5.DSPS_RQT_KYWD_CN_5 AS DSPS_RQT_KYWD_CN_5 , D2.EXRS_RVW_SECD AS EXRS_RVW_SECD /*통계자료 입력 적극행정면책 검토 코드*/ , D2.EXRS_YN_SECD AS EXRS_YN_SECD /*통계자료 입력 면책여부 코드*/ , D2.PASV_PBADMS_RVW_CN_YN AS PASV_PBADMS_RVW_CN_YN /*소극행정검토내용*/ , D2.SELF_YN AS SELF_YN /*자율여부*/ FROM TB_BADEAR001M D1 , TB_BADEAR002D D2 , TB_BADEAR035L Z1 , ( SELECT D1.CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.ADT_NO /* 감사번호 */,
    D1.ADT_GRNT_NO /* 감사부여번호 */,
    D1.ADT_KDCD /* 감사종류코드 */,
    F_DPT_INFO(D1.SPRVSN_DEPT_CD,'1')||'(반장 : '||F_USR_INFO(D1.ADT_RBPRSN_ENO,'2')||', 주관 : '||F_USR_INFO(D1.SPVR_ENO,'2')||')' AS F_DPT_INFO,
    ' '||D1.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    F_ORG_CNT_NM_AUD(D1.CVLCPT_ADT_YR,D1.ADT_NO,'AUD') AS F_ORG_CNT_NM_AUD,
    D1.SPRVSN_DEPT_CD /* 주관부서코드 */
FROM TBBADDED001M D1 WHERE 1=1 AND D1.SPRVSN_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#strCnb#, #dptAuth#, '', #strUpSpvBrdvCd#))) /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/ AND D1.SPRVSN_DEPT_CD = #SPRVSN_DEPT_CD# ) D3 , ( SELECT SITU.REL_ADT_YR /* 관계감사년도 */,
    SITU.REL_ADT_NO /* 관계감사번호 */,
    MIN(SITU.ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    MAX(SITU.ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */,
    (SELECT COUNT(1)
FROM TBBADDED002M WHERE REL_ADT_YR = SITU.REL_ADT_YR AND REL_ADT_NO = SITU.REL_ADT_NO AND ADT_BZTRP_KDCD = '01') AS RSRV_CNT , (SELECT COUNT(*)
FROM (SELECT DISTINCT AUD2.ADT_YR AS ADT_YR /* 감사년도 */,
    AUD2.ADT_NO /* 감사번호 */,
    TMA2.BZTRVR_ENO /* 출장자직원전산번호 */
FROM TBBADDED001M AUD2 , TBBADDED005L TMA2 , TBBADDED002M SITU2 WHERE 1=1 AND SITU2.REL_ADT_YR = AUD2.CVLCPT_ADT_YR AND SITU2.REL_ADT_NO = AUD2.ADT_NO AND TMA2.BZTRP_YR = SITU2.BZTRP_YR AND TMA2.BZTRP_SQNO = SITU2.BZTRP_SQNO AND SITU2.REL_ADT_YR = #CVLCPT_ADT_YR# AND SITU2.REL_ADT_NO = #ADT_NO# AND SITU2.ADT_BZTRP_KDCD = '01' ) PSON3 ) AS RSRV_NOP_CNT , SUM( CASE WHEN SITU.ADT_BZTRP_KDCD = '01' THEN PSON.ADT_DCN ELSE 0 END) AS RSRV_AUD_DCN , (SELECT COUNT(1)
FROM TBBADDED002M WHERE REL_ADT_YR = SITU.REL_ADT_YR AND REL_ADT_NO = SITU.REL_ADT_NO AND ADT_BZTRP_KDCD = '02') AS FIELD_CNT , (SELECT COUNT(*)
FROM (SELECT DISTINCT AUD2.ADT_YR AS ADT_YR /* 감사년도 */,
    AUD2.ADT_NO /* 감사번호 */,
    TMA2.BZTRVR_ENO /* 출장자직원전산번호 */
FROM TBBADDED001M AUD2 , TBBADDED005L TMA2 , TBBADDED002M SITU2 WHERE 1=1 AND SITU2.REL_ADT_YR = AUD2.CVLCPT_ADT_YR AND SITU2.REL_ADT_NO = AUD2.ADT_NO AND TMA2.BZTRP_YR = SITU2.BZTRP_YR AND TMA2.BZTRP_SQNO = SITU2.BZTRP_SQNO AND SITU2.REL_ADT_YR = #CVLCPT_ADT_YR# AND SITU2.REL_ADT_NO = #ADT_NO# AND SITU2.ADT_BZTRP_KDCD = '02' ) PSON3 ) AS FIELD_NOP_CNT , SUM( CASE WHEN SITU.ADT_BZTRP_KDCD = '02' THEN PSON.ADT_DCN ELSE 0 END) AS ACADT_ENFRC_DCN , (SELECT COUNT(1)
FROM TBBADDED002M WHERE REL_ADT_YR = SITU.REL_ADT_YR AND REL_ADT_NO = SITU.REL_ADT_NO AND ADT_BZTRP_KDCD = '03') AS ADD_CNT , (SELECT COUNT(*)
FROM (SELECT DISTINCT AUD2.ADT_YR AS ADT_YR /* 감사년도 */,
    AUD2.ADT_NO /* 감사번호 */,
    TMA2.BZTRVR_ENO /* 출장자직원전산번호 */
FROM TBBADDED001M AUD2 , TBBADDED005L TMA2 , TBBADDED002M SITU2 WHERE 1=1 AND SITU2.REL_ADT_YR = AUD2.CVLCPT_ADT_YR AND SITU2.REL_ADT_NO = AUD2.ADT_NO AND TMA2.BZTRP_YR = SITU2.BZTRP_YR AND TMA2.BZTRP_SQNO = SITU2.BZTRP_SQNO AND SITU2.ADT_BZTRP_KDCD = '03' AND SITU2.REL_ADT_YR = #CVLCPT_ADT_YR# AND SITU2.REL_ADT_NO = #ADT_NO# ) PSON3 ) AS ADD_NOP_CNT , SUM( CASE WHEN SITU.ADT_BZTRP_KDCD = '03' THEN PSON.ADT_DCN ELSE 0 END) AS ADD_AUD_DCN , SUM(SITU.ADT_DCN) AS ADT_DCN , SUM(PSON.ADT_DCN) AS MAN_DAY FROM TBBADDED002M SITU , TBBADDED006L PSON WHERE 1=1 AND SITU.BZTRP_SECD = '1' AND PSON.BZTRP_YR = SITU.BZTRP_YR AND PSON.BZTRP_SQNO = SITU.BZTRP_SQNO AND SITU.REL_ADT_YR = #CVLCPT_ADT_YR# AND SITU.REL_ADT_NO = #ADT_NO# AND SITU.ADT_BZTRP_KDCD IN ('01','02','03') GROUP BY SITU.REL_ADT_YR ,SITU.REL_ADT_NO ) D4 , (SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    MAX(CASE WHEN GRNDS_EXMN_AEX_SQNO=1 THEN DSPS_RQT_KYWD_CN END) AS DSPS_RQT_KYWD_CN_1 /* 처분요구키워드내용1 */,
    MAX(CASE WHEN GRNDS_EXMN_AEX_SQNO=2 THEN DSPS_RQT_KYWD_CN END) AS DSPS_RQT_KYWD_CN_2 /* 처분요구키워드내용2 */,
    MAX(CASE WHEN GRNDS_EXMN_AEX_SQNO=3 THEN DSPS_RQT_KYWD_CN END) AS DSPS_RQT_KYWD_CN_3 /* 처분요구키워드내용3 */,
    MAX(CASE WHEN GRNDS_EXMN_AEX_SQNO=4 THEN DSPS_RQT_KYWD_CN END) AS DSPS_RQT_KYWD_CN_4 /* 처분요구키워드내용4 */,
    MAX(CASE WHEN GRNDS_EXMN_AEX_SQNO=5 THEN DSPS_RQT_KYWD_CN END) AS DSPS_RQT_KYWD_CN_5 /* 처분요구키워드내용5 */
FROM TBBADEAR037M GROUP BY CVLCPT_ADT_YR, ADT_NO, DSPS_RQT_SQNO) D5 WHERE 1=1 AND D1.CVLCPT_ADT_YR = D2.ADT_YR AND D1.ADT_NO = D2.ADT_NO AND D1.DSPS_RQT_SQNO = D2.DSPS_RQT_SQNO AND D1.CVLCPT_ADT_YR = D3.CVLCPT_ADT_YR AND D1.ADT_NO = D3.ADT_NO AND D1.CVLCPT_ADT_YR = D4.REL_ADT_YR(+) AND D1.ADT_NO = D4.REL_ADT_NO(+) AND D1.CVLCPT_ADT_YR = D5.CVLCPT_ADT_YR(+) AND D1.ADT_NO = D5.ADT_NO(+) AND D1.DSPS_RQT_SQNO = D5.DSPS_RQT_SQNO(+) AND D1.CVLCPT_ADT_YR = Z1.ADT_YR(+) AND D1.ADT_NO = Z1.ADT_NO(+) AND D1.DSPS_RQT_SQNO = Z1.DSPS_RQT_SQNO(+) AND D1.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND D1.ADT_NO = #ADT_NO# AND D1.DSPS_RQT_SQNO = #DSPS_RQT_SQNO# ORDER BY D1.CVLCPT_ADT_YR , D1.ADT_NO DESC, D1.DSPS_RQT_SQNO DESC