WITH /* 특정일 기준으로 계산에 필요한 날짜 계산 */ BASE_DATE_CTE AS (SELECT CASE WHEN #strStdDt# = '20250814' THEN TO_DATE('20250814' , 'YYYYMMDD') + 1 ELSE TO_DATE(#strStdDt# , 'YYYYMMDD') END AS #STRSTDDT#
FROM DUAL) , DAY_TABLE AS ( SELECT TO_CHAR(TO_DATE(BASE_DATE_CTE.BASE_DATE) - 4 + DT, 'YYYYMMDD') AS TO_CHAR /* 월 */,
    TO_CHAR(TO_DATE(BASE_DATE_CTE.BASE_DATE) - 3 + DT, 'YYYYMMDD') AS TO_CHAR /* 화 */,
    TO_CHAR(TO_DATE(BASE_DATE_CTE.BASE_DATE) - 2 + DT, 'YYYYMMDD') AS TO_CHAR /* 수 */,
    TO_CHAR(TO_DATE(BASE_DATE_CTE.BASE_DATE) - 1 + DT, 'YYYYMMDD') AS TO_CHAR /* 목 */,
    TO_CHAR(TO_DATE(BASE_DATE_CTE.BASE_DATE) - 0 + DT, 'YYYYMMDD') AS TO_CHAR /* 금 */
FROM ( SELECT (SELECT NEXT_DAY(TO_DATE(BASE_DATE_CTE.BASE_DATE), 6) - TO_DATE(BASE_DATE_CTE.BASE_DATE)
FROM DUAL) AS DT FROM DUAL , BASE_DATE_CTE ) , BASE_DATE_CTE ) SELECT T1.BOKG_DVSN_CD AS BOKG_DVSN_CD,
    T1.SCO_HST_SNO AS SCO_HST_SNO,
    T1.SCO_SNO AS SCO_SNO,
    SUBSTR(T1.SCO_TM_STR_CD,0,2) || ':' || SUBSTR(T1.SCO_TM_STR_CD,3) || ' ~ ' || SUBSTR(T1.SCO_TM_END_CD,0,2) || ':' || SUBSTR(T1.SCO_TM_END_CD,3) AS SUBSTR,
    T1.SCO_TM_STR_CD AS SCO_TM_STR_CD,
    T1.SCO_TM_END_CD AS SCO_TM_END_CD,
    T1.APC_STR_DT AS APC_STR_DT,
    T1.APC_END_DT AS APC_END_DT /* 월 */,
    STD_DAY1 AS STD_DAY1,
    (SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM ( SELECT INFO_YR || HLDY_CRTR_MND AS INFO_YR /* 정보년도 */
FROM TBBADDED013B UNION ALL SELECT HLDY
FROM TBCSPMWF011M WHERE BOKG_DVSN_CD = '1' ) WHERE DT = T2.STD_DAY1) AS HOLIDAY1 /* 임시휴일 적용 - 2019.07.29 yyh */ ,(SELECT BOKG_PEN_CNB
FROM TBCSPMWF008M WHERE BOKG_DT = T2.STD_DAY1 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_CNB1 /* 관리자 */ ,(SELECT C.ABR_DPT_NM_1 || ' ' || F_CODE_NM('1000173', B.JBGD_SECD) || ' ' || B.USER_NM || ' ' || B.CRU_TELNO AS JBGD_SECD /* 직급구분코드 */
FROM TBCSPMWF008M A ,TBDCMACM001M B ,TBDCMACM002M C WHERE A.BOKG_DT = T2.STD_DAY1 AND A.SCO_HST_SNO = T1.SCO_HST_SNO AND A.SCO_SNO = T1.SCO_SNO AND A.BOKG_PEN_CNB = B.TRGT_NOP_ENO AND B.SRECS_DEPT_CD = C.SRECS_DEPT_CD) AS BOKG_NM1 /* 사용자 */ /* ,CASE WHEN SCO_SNO BETWEEN 1 AND 4 THEN '신규 환자 진료시간' ELSE '' END */ , '' AS BOKG_NM1 /* 화 */ ,STD_DAY2 AS STD_DAY2 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM ( SELECT INFO_YR || HLDY_CRTR_MND AS INFO_YR /* 정보년도 */
FROM TBBADDED013B UNION ALL SELECT HLDY
FROM TBCSPMWF011M WHERE BOKG_DVSN_CD = '1' ) WHERE DT = T2.STD_DAY2) AS HOLIDAY2 /* 임시휴일 적용 - 2019.07.29 yyh */ ,(SELECT BOKG_PEN_CNB
FROM TBCSPMWF008M WHERE BOKG_DT = T2.STD_DAY2 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_CNB2 /* 관리자 */ ,(SELECT C.ABR_DPT_NM_1 || ' ' || F_CODE_NM('1000173', B.JBGD_SECD) || ' ' || B.USER_NM || ' ' || B.CRU_TELNO AS JBGD_SECD /* 직급구분코드 */
FROM TBCSPMWF008M A ,TBDCMACM001M B ,TBDCMACM002M C WHERE A.BOKG_DT = T2.STD_DAY2 AND A.SCO_HST_SNO = T1.SCO_HST_SNO AND A.SCO_SNO = T1.SCO_SNO AND A.BOKG_PEN_CNB = B.TRGT_NOP_ENO AND B.SRECS_DEPT_CD = C.SRECS_DEPT_CD) AS BOKG_NM2 /* 사용자 */ /* ,CASE WHEN SCO_SNO BETWEEN 1 AND 4 THEN '신규 환자 진료시간' ELSE '' END */ , '' AS BOKG_NM2 /* 수 */ ,STD_DAY3 AS STD_DAY3 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM ( SELECT INFO_YR || HLDY_CRTR_MND AS INFO_YR /* 정보년도 */
FROM TBBADDED013B UNION ALL SELECT HLDY
FROM TBCSPMWF011M WHERE BOKG_DVSN_CD = '1' ) WHERE DT = T2.STD_DAY3) AS HOLIDAY3 /* 임시휴일 적용 - 2019.07.29 yyh */ ,(SELECT BOKG_PEN_CNB
FROM TBCSPMWF008M WHERE BOKG_DT = T2.STD_DAY3 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_CNB3 /* 관리자 */ ,(SELECT C.ABR_DPT_NM_1 || ' ' || F_CODE_NM('1000173', B.JBGD_SECD) || ' ' || B.USER_NM || ' ' || B.CRU_TELNO AS JBGD_SECD /* 직급구분코드 */
FROM TBCSPMWF008M A ,TBDCMACM001M B ,TBDCMACM002M C WHERE A.BOKG_DT = T2.STD_DAY3 AND A.SCO_HST_SNO = T1.SCO_HST_SNO AND A.SCO_SNO = T1.SCO_SNO AND A.BOKG_PEN_CNB = B.TRGT_NOP_ENO AND B.SRECS_DEPT_CD = C.SRECS_DEPT_CD) AS BOKG_NM3 /* 사용자 */ /* ,CASE WHEN SCO_SNO BETWEEN 1 AND 4 THEN '신규 환자 진료시간' ELSE '' END */ , '' AS BOKG_NM3 /* 목 */ ,STD_DAY4 AS STD_DAY4 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM ( SELECT INFO_YR || HLDY_CRTR_MND AS INFO_YR /* 정보년도 */
FROM TBBADDED013B UNION ALL SELECT HLDY
FROM TBCSPMWF011M WHERE BOKG_DVSN_CD = '1' ) WHERE DT = T2.STD_DAY4) AS HOLIDAY4 /* 임시휴일 적용 - 2019.07.29 yyh */ ,(SELECT BOKG_PEN_CNB
FROM TBCSPMWF008M WHERE BOKG_DT = T2.STD_DAY4 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_CNB4 /* 관리자 */ ,(SELECT C.ABR_DPT_NM_1 || ' ' || F_CODE_NM('1000173', B.JBGD_SECD) || ' ' || B.USER_NM || ' ' || B.CRU_TELNO AS JBGD_SECD /* 직급구분코드 */
FROM TBCSPMWF008M A ,TBDCMACM001M B ,TBDCMACM002M C WHERE A.BOKG_DT = T2.STD_DAY4 AND A.SCO_HST_SNO = T1.SCO_HST_SNO AND A.SCO_SNO = T1.SCO_SNO AND A.BOKG_PEN_CNB = B.TRGT_NOP_ENO AND B.SRECS_DEPT_CD = C.SRECS_DEPT_CD) AS BOKG_NM4 /* 사용자 */ /* ,CASE WHEN SCO_SNO BETWEEN 1 AND 4 THEN '신규 환자 진료시간' ELSE '' END */ , '' AS BOKG_NM4 /* 금 */ ,STD_DAY5 AS STD_DAY5 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM ( SELECT INFO_YR || HLDY_CRTR_MND AS INFO_YR /* 정보년도 */
FROM TBBADDED013B UNION ALL SELECT HLDY
FROM TBCSPMWF011M WHERE BOKG_DVSN_CD = '1' ) WHERE DT = T2.STD_DAY5) AS HOLIDAY5 ,(SELECT BOKG_PEN_CNB
FROM TBCSPMWF008M WHERE BOKG_DT = T2.STD_DAY5 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_CNB5 /* 관리자 */ ,(SELECT C.ABR_DPT_NM_1 || ' ' || F_CODE_NM('1000173', B.JBGD_SECD) || ' ' || B.USER_NM || ' ' || B.CRU_TELNO AS JBGD_SECD /* 직급구분코드 */
FROM TBCSPMWF008M A ,TBDCMACM001M B ,TBDCMACM002M C WHERE A.BOKG_DT = T2.STD_DAY5 AND A.SCO_HST_SNO = T1.SCO_HST_SNO AND A.SCO_SNO = T1.SCO_SNO AND A.BOKG_PEN_CNB = B.TRGT_NOP_ENO AND B.SRECS_DEPT_CD = C.SRECS_DEPT_CD) AS BOKG_NM5 /* 사용자 */ /* ,CASE WHEN SCO_SNO BETWEEN 1 AND 4 THEN '신규 환자 진료시간' ELSE '' END */ , '' AS BOKG_NM5 FROM TBCSPMWF009M T1 ,DAY_TABLE T2 WHERE T1.BOKG_DVSN_CD = '1' AND #strStdDt# BETWEEN T1.APC_STR_DT AND T1.APC_END_DT ORDER BY SCO_SNO