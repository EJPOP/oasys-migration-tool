WITH /* 특정일 기준으로 계산에 필요한 날짜 계산 */ BASE_DATE_CTE AS (SELECT CASE WHEN #strStdDt# = '20250814' THEN TO_DATE('20250814' , 'YYYYMMDD') + 1 ELSE TO_DATE(#strStdDt# , 'YYYYMMDD') END AS #STRSTDDT#
FROM DUAL) , BASE AS ( /* 금주 시작일 ~ 차주 종료일 (2주간) */ SELECT MIN(DT) AS BGNG_YMD /* 시작일자 */,
    MAX(DT) AS END_YMD /* 종료일자 */
FROM ( SELECT TO_CHAR(TO_DATE(BASE_DATE_CTE.BASE_DATE) - 7 + LEVEL + (SELECT NEXT_DAY(TO_DATE(BASE_DATE_CTE.BASE_DATE),1) - TO_DATE(BASE_DATE_CTE.BASE_DATE)
FROM DUAL), 'YYYYMMDD') AS DT FROM DUAL , BASE_DATE_CTE CONNECT BY LEVEL <= 12 ) ) SELECT T1.BOKG_DT AS BOKG_DT,
    T1.SCO_HST_SNO AS SCO_HST_SNO,
    T1.SCO_SNO AS SCO_SNO,
    TO_CHAR(TO_DATE(T1.BOKG_DT), 'YYYY-MM-DD') || '(' || TO_CHAR(TO_DATE(T1.BOKG_DT), 'DY', 'NLS_DATE_LANGUAGE=korean') || ')' AS TO_CHAR,
    SUBSTR(T2.SCO_TM_STR_CD,0,2) || ':' || SUBSTR(T2.SCO_TM_STR_CD,3) || ' ~ ' || SUBSTR(T2.SCO_TM_END_CD,0,2) || ':' || SUBSTR(T2.SCO_TM_END_CD,3) AS SUBSTR,
    BOKG_PEN_CNB AS BOKG_PEN_CNB,
    F_USR_INFO(BOKG_PEN_CNB, '2') AS F_USR_INFO,
    BOKG_PEN_DPT_CD AS BOKG_PEN_DPT_CD,
    F_DPT_INFO(BOKG_PEN_DPT_CD, '1') AS F_DPT_INFO,
    CASE WHEN T4.TRTMT_NBC_CD = '1' THEN '(초진)' WHEN T4.TRTMT_NBC_CD = '2' THEN '(재진)' END || T4.TRTMT_FNDT_TXT AS TRTMT_NBC_CD
FROM TBCSPMWF008M T1 ,TBCSPMWF009M T2 ,BASE T3 ,TBCSPMWF007M T4 WHERE 1=1 AND T1.SCO_HST_SNO = T2.SCO_HST_SNO AND T1.SCO_SNO = T2.SCO_SNO AND T2.BOKG_DVSN_CD = '1' AND T1.BOKG_APL_DH = T4.BOKG_APL_DH(+) AND T1.BOKG_DT BETWEEN T3.BGNG_YMD AND T3.END_YMD AND T1.BOKG_PEN_CNB = #strBokgPenCnb# ORDER BY T1.BOKG_DT ,T1.SCO_SNO