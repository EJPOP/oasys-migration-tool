SELECT NVL(F_ORG_INFO(D1.CMO_INST_CD, '1'), D1.CMO_INST_CD) AS F_ORG_INFO,
    NVL(F_ORG_INFO(D1.BAI_ORG_CD, '1'), D1.BAI_ORG_CD) AS F_ORG_INFO,
    D1.SYS_NM,
    CASE WHEN MAX(D3.TBL_NM) IS NOT NULL THEN MAX(D3.TBL_NM)||' 등 '||( SELECT COUNT(TBL_ID) AS TBL_ID /* 테이블아이디 */
FROM TBFAAAEA003M WHERE JRSD_INST_CD = D1.JRSD_INST_CD AND SYS_NM = D1.SYS_NM GROUP BY SYS_NM )||'개 자료' ELSE '' END AS TBL_CNT ,D1.OP_DPT_NM AS OP_INFO_DPT_NM ,CASE WHEN D1.OP_DPT_NM IS NOT NULL AND D1.OP_CHGR_NM IS NOT NULL AND D1.OP_CHGR_CNIF_NM IS NOT NULL THEN D1.OP_DPT_NM||' '||D1.OP_CHGR_NM||' ('||D1.OP_CHGR_CNIF_NM||')' ELSE '' END AS OP_INFO ,D1.SYS_DES ,D1.URL_AD ,CASE WHEN D4.FILE_NM IS NOT NULL THEN D4.FILE_NM||'.'||D4.FL_EXT_NM||' ('||REPLACE(TO_CHAR(D4.FL_SZ_TXT,'999,999'),' ','')||' BYTES )' ELSE '' END AS FILE_NM ,D4.CVLCPT_DOC_ID ,NVL(F_ORG_INFO(D1.BAI_ORG_CD, '1'), D1.BAI_ORG_CD) AS PROF_RBPRSN_INST_NM ,D1.JRSD_INST_CD FROM TBFAAAEA001M D1 ,TBFAAAEA002M D2 ,TBFAAAEA003M D3 ,TBFAAAEA009M D4 WHERE D1.USE_YN = 'Y' AND D1.JRSD_INST_CD = D2.JRSD_INST_CD(+) AND D1.SYS_NM = D2.SYS_NM(+) AND D2.JRSD_INST_CD = D3.JRSD_INST_CD(+) AND D2.SYS_NM = D3.SYS_NM(+) AND D2.UNT_SYS_NM = D3.UNT_SYS_NM(+) AND D1.JRSD_INST_CD = D4.JRSD_INST_CD(+) AND D1.SYS_NM = D4.SYS_NM(+) AND D1.CMO_INST_CD = #CMO_INST_CD# AND D1.BAI_ORG_CD = #strCoptOrgCd# AND ( 1=2 OR D1.SYS_NM LIKE '%'||#strSearchNm#||'%' OR D2.UNT_SYS_NM LIKE '%'||#strSearchNm#||'%' OR D3.TBL_NM LIKE '%'||#strSearchNm#||'%' OR (SELECT COUNT(1)
FROM TBFAAAEA004M WHERE 1=1 AND JRSD_INST_CD = D3.JRSD_INST_CD AND SYS_NM = D3.SYS_NM AND UNT_SYS_NM = D3.UNT_SYS_NM AND TBL_ID = D3.TBL_ID AND COL_NM LIKE '%'||#strSearchNm#||'%') > 0 ) GROUP BY D1.JRSD_INST_CD ,D1.BAI_ORG_CD ,D1.CMO_INST_CD ,D1.SYS_NM ,D1.OP_DPT_NM ,D1.OP_CHGR_NM ,D1.OP_CHGR_CNIF_NM ,D1.SYS_DES ,D1.URL_AD ,D4.FILE_NM ,D4.FL_EXT_NM ,D4.FL_SZ_TXT ,D4.CVLCPT_DOC_ID ORDER BY D1.CMO_INST_CD ,D1.BAI_ORG_CD ,D1.SYS_NM