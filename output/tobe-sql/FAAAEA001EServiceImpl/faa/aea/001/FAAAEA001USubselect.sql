SELECT '['|| NVL(F_ORG_INFO(D6.CMO_INST_CD, '1'), D6.CMO_INST_CD) ||'] '|| NVL(F_ORG_INFO(D6.BAI_ORG_CD, '1'), D6.BAI_ORG_CD) AS F_ORG_INFO,
    D2.SYS_NM,
    '('||D2.UNT_SYS_NM||') '||D3.TBL_NM AS UNT_SYS_NM,
    CASE WHEN D7.COLS IS NOT NULL THEN D7.COLS||'...' ELSE D7.COLS END AS COLS,
    CASE WHEN D2.TKCG_DEPT_NM IS NOT NULL AND D2.PIC_NM IS NOT NULL AND D2.CHGR_CNIF_NM IS NOT NULL THEN D2.TKCG_DEPT_NM||' '||D2.PIC_NM||' ('||D2.CHGR_CNIF_NM||')' ELSE '' END AS TKCG_DEPT_NM /* 담당부서명 */,
    D2.UNT_SYS_NM,
    D3.TBL_ID /* 테이블아이디 */,
    NVL(F_ORG_INFO(D6.BAI_ORG_CD, '1'), D6.BAI_ORG_CD) AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    D6.URL_AD,
    D2.UNT_SYS_DES,
    D6.JRSD_INST_CD /* 소관기관코드 */
FROM TBFAAAEA002M D2 LEFT OUTER JOIN TBFAAAEA003M D3 ON D2.JRSD_INST_CD = D3.JRSD_INST_CD AND D2.SYS_NM = D3.SYS_NM AND D2.UNT_SYS_NM = D3.UNT_SYS_NM LEFT OUTER JOIN TBFAAAEA004M D4 ON D2.JRSD_INST_CD = D4.JRSD_INST_CD AND D2.SYS_NM = D4.SYS_NM AND D2.UNT_SYS_NM = D4.UNT_SYS_NM AND D4.TBL_ID = D3.TBL_ID LEFT OUTER JOIN TBFAAAEA005M D5 ON D2.JRSD_INST_CD = D5.JRSD_INST_CD AND D2.SYS_NM = D5.SYS_NM AND D2.UNT_SYS_NM = D5.UNT_SYS_NM LEFT OUTER JOIN TBFAAAEA001M D6 ON D2.JRSD_INST_CD = D6.JRSD_INST_CD AND D2.SYS_NM = D6.SYS_NM LEFT OUTER JOIN ( SELECT AGGR_CONCAT(COL_NM,', ') AS AGGR_CONCAT,
    TBL_ID /* 테이블아이디 */,
    UNT_SYS_NM,
    SYS_NM,
    JRSD_INST_CD /* 소관기관코드 */
FROM ( SELECT ROW_NUMBER() OVER (PARTITION BY A.TBL_ID ORDER BY A.COL_NM DESC) AS ROW_NUMBER,
    TRIM(A.COL_NM) AS TRIM,
    A.TBL_ID /* 테이블아이디 */,
    A.UNT_SYS_NM,
    A.SYS_NM,
    A.JRSD_INST_CD /* 소관기관코드 */
FROM TBFAAAEA004M A ,TBFAAAEA001M B WHERE A.JRSD_INST_CD = B.JRSD_INST_CD AND B.BAI_ORG_CD = #strCoptOrgCd# AND B.CMO_INST_CD = #CMO_INST_CD# ORDER BY A.COL_NM DESC ) M WHERE M.RN AND D6.BAI_ORG_CD = #strCoptOrgCd# AND D6.CMO_INST_CD = #CMO_INST_CD# AND ( 1=2 OR D6.SYS_NM LIKE '%'||#strSearchNm#||'%' OR D2.UNT_SYS_NM LIKE '%'||#strSearchNm#||'%' OR D3.TBL_NM LIKE '%'||#strSearchNm#||'%' OR (SELECT COUNT(1)
FROM TBFAAAEA004M WHERE 1=1 AND JRSD_INST_CD = D3.JRSD_INST_CD AND SYS_NM = D3.SYS_NM AND UNT_SYS_NM = D3.UNT_SYS_NM AND TBL_ID = D3.TBL_ID AND COL_NM LIKE '%'||#strSearchNm#||'%') > 0 ) GROUP BY D6.JRSD_INST_CD ,D6.BAI_ORG_CD ,D2.SYS_NM ,D2.UNT_SYS_NM ,D2.TKCG_DEPT_NM ,D2.PIC_NM ,D2.CHGR_CNIF_NM ,D6.CMO_INST_CD ,D3.TBL_NM ,D3.TBL_ID ,D7.COLS ,D6.URL_AD ,D2.UNT_SYS_DES ORDER BY D6.JRSD_INST_CD ,D2.SYS_NM ,D2.UNT_SYS_NM