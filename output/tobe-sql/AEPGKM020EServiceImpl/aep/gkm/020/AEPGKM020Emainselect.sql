SELECT C.KNB,
    KLD_NM,
    REG_DMND_YMD /* 등록요청일자 */,
    PRSV_WAY_CD,
    PRSV_DDLN_DH,
    KLD_CAT_CD,
    KLD_CAT_NM,
    CVLCPT_DOC_ID /* 민원문서아이디 */,
    KLD_STA_CD,
    ENAIS_PST_INQ_NMTM /* ENAIS게시물조회횟수 */,
    NVL(D.COUNT, '0') AS COUNT,
    NVL(E.APRV_YN, 'N') AS APRV_YN /* 승인여부 */,
    CASE WHEN C.CVLCPT_DOC_ID IS NOT NULL THEN (SELECT DECODE(COUNT(*), 0, 'N', 'Y') AS CVLCPT_DOC_ID /* 민원문서아이디 */
FROM UBKERAPP.XR_PAGE WHERE CVLCPT_DOC_ID = C.CVLCPT_DOC_ID ) ELSE 'N' END AS FILE_YN , CASE WHEN C.CVLCPT_DOC_ID IS NOT NULL THEN (SELECT DECODE(COUNT(*), 0, 'N', 'Y')
FROM UBKERAPP.XR_PAGE WHERE CVLCPT_DOC_ID = C.CVLCPT_DOC_ID AND PAGE_TITLE IS NOT NULL AND SUBSTR(PAGE_TITLE, CASE WHEN INSTR(PAGE_TITLE, '.',-1) > 0 THEN INSTR(PAGE_TITLE, '.',-1)+1 ELSE 1 END) != 'hwp') ELSE 'N' END AS NOT_HWP_DOC_YN , C.OTSD_EXPRT_RGTR_ENO AS USR_CNB , F_USR_INFO(C.OTSD_EXPRT_RGTR_ENO ,'2') AS USER_NM , NVL(F.CMMT_CNT, 0) AS CMMT_CNT /*댓글갯수 2015.01.26 박재운감사관 요청*/ FROM ( SELECT A.KNB,
    A.KLD_NM,
    A.REG_DMND_YMD /* 등록요청일자 */,
    A.PRSV_WAY_CD,
    ( CASE A.PRSV_WAY_CD WHEN '0' THEN '영구보존' ELSE TO_CHAR(A.PRSV_DDLN_DH, 'YYYY-MM-DD') END) AS PRSV_WAY_CD,
    A.KLD_CAT_CD,
    B.TG_CAT_NM,
    A.CVLCPT_DOC_ID /* 민원문서아이디 */,
    A.KLD_STA_CD,
    A.ENAIS_PST_INQ_NMTM /* ENAIS게시물조회횟수 */,
    TO_CHAR(ABRG_DH, 'YYYYMMDD') AS TO_CHAR,
    A.OTSD_EXPRT_RGTR_ENO /* 외부전문가등록자직원전산번호 */
FROM TBAEPGKM001M AS A , TBAEPGKM017M AS B WHERE A.KLD_CAT_CD = B.TG_CAT_ID (+) A.ADT_NO = #ADT_NO# A.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# A.OTSD_EXPRT_RGTR_ENO = #OTSD_EXPRT_RGTR_ENO# A.OTSD_EXPRT_RGTR_ENO IN ( SELECT TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBDCMACM001M WHERE USER_NM LIKE '%'||#REGN_CNB#||'%') AND REGN_OPEN_YN = 'Y' A.REG_DMND_YMD >= #STT_REGI_RQS_DT# A.REG_DMND_YMD A.PRSV_WAY_CD = #PRSV_WAY_CD# A.PRSV_DDLN_DH >= #STT_PRSV_DDLN_DH# A.PRSV_DDLN_DH A.KLD_CAT_CD IN ( SELECT TG_CAT_ID
FROM TBAEPGKM017M A , ( SELECT SRT_VAL_NM
FROM TBAEPGKM017M WHERE TG_CAT_ID = #KLD_CAT_CD# ) B WHERE A.SRT_VAL_NM LIKE B.SRT_VAL_NM || '%' ) ( A.KLD_NM LIKE '%' || #KLD_NM_KYWD# || '%' OR ( A.CRU_KYWD_NM LIKE '%' || #KLD_NM_KYWD# || '%' OR A.CRU_KYWD_NM LIKE '%' || #KLD_NM_KYWD# || '%' OR A.CRU_KYWD_NM LIKE '%' || #KLD_NM_KYWD# || '%' ) ) A.KLD_STA_CD = #KLD_STA_CD# A.FUNC_SPH_CD = #FUNC_SPH_CD# A.CAT_SPH_CD = #CAT_SPH_CD# ORDER BY TO_NUMBER(A.KNB) DESC ) C , ( SELECT KNB,
    COUNT(KNB) AS KNB
FROM ( SELECT KNB
FROM TBAEPGKM002L UNION ALL SELECT KNB
FROM TBAEPGKM004L ) GROUP BY KNB ) D , ( SELECT KNB,
    MAX(APRV_YN) AS APRV_YN /* 승인여부 */
FROM TBAEPGKM016L WHERE APRV_YN = 'Y' AND KNB IS NOT NULL GROUP BY KNB ) E , ( SELECT POST_SEQ,
    COUNT(*) AS CMMT_CNT
FROM CTT_POST_CMMT WHERE BOARD_ID = '1550' GROUP BY POST_SEQ ) F WHERE C.KNB = D.KNB (+) AND C.KNB = E.KNB (+) AND C.KNB = F.POST_SEQ (+) ORDER BY C.REG_DMND_YMD DESC