SELECT T1.LINK_YR /* 연계년도 */,
    T1.CRS_CD,
    T1.LCT_NM,
    T1.CRS_CDN /* 과정기수 */,
    T1.LCT_PLACE,
    SUBSTR(T1.EDU_BGNG_YMD, 0, 4) || '.' || SUBSTR(T1.EDU_BGNG_YMD, 5, 2) || '.' || SUBSTR(T1.EDU_BGNG_YMD, 7, 2) || ' ~ ' || SUBSTR(T1.EDU_END_YMD, 0, 4) || '.' || SUBSTR(T1.EDU_END_YMD, 5, 2) || '.' || SUBSTR(T1.EDU_END_YMD, 7, 2) AS SUBSTR,
    SUBSTR(T1.REG_STR_DT, 0, 4) || '.' || SUBSTR(T1.REG_STR_DT, 5, 2) || '.' || SUBSTR(T1.REG_STR_DT, 7, 2) || ' ~ ' || SUBSTR(T1.REG_END_DT, 0, 4) || '.' || SUBSTR(T1.REG_END_DT, 5, 2) || '.' || SUBSTR(T1.REG_END_DT, 7, 2) AS REG_DT /* 등록일시 */,
    T1.TPOF_NOPE /* 제보인원수 */,
    (SELECT COUNT(*)
FROM TBCSPSAE306D s1 WHERE S1.LINK_YR = T1.LINK_YR AND S1.CRS_CD = T1.CRS_CD AND S1.CRS_CDN = T1.CRS_CDN AND (S1.SIGN_STATUS = '3' OR S1.SIGN_STATUS = '2' OR S1.SIGN_STATUS = '1') ) AS REG_CNT ,CASE WHEN T2.SIGN_STATUS IS NULL OR T2.SIGN_STATUS = '1' THEN '미신청' WHEN T2.SIGN_STATUS = '2' THEN '결재중' WHEN T2.SIGN_STATUS = '3' THEN '신청완료' WHEN T2.SIGN_STATUS = '4' THEN '반려' WHEN T2.SIGN_STATUS = '5' THEN '상신취소' ELSE '' END AS SIGN_STATUS_NM ,T2.SIGN_STATUS ,T2.APV_KEY ,NVL(T2.TRGT_NOP_ENO,#TRGT_NOP_ENO#) AS TRGT_NOP_ENO FROM TBCSPSAE201D T1 ,TBCSPSAE306D T2 WHERE T1.LINK_YR = T2.LINK_YR(+) AND T1.CRS_CD = T2.CRS_CD(+) AND T1.CRS_CDN = T2.CRS_CDN(+) AND TO_CHAR(SYSDATE,'yyyymmdd') BETWEEN SUBSTR(T1.REG_STR_DT, 0, 8) AND SUBSTR(T1.REG_END_DT, 0, 8) AND T1.REG_OPEN_YN = 'Y' AND T2.TRGT_NOP_ENO(+) = #TRGT_NOP_ENO# AND CASE WHEN NVL(T1.INCLUDE_SC,'N') = 'N' AND (SELECT INSD_JBGD_SECD /* 내부직급구분코드 */
FROM TBDCMACM001M WHERE TRGT_NOP_ENO = #TRGT_NOP_ENO#) >'30' THEN 1 WHEN NVL(T1.INCLUDE_SC,'N') = 'Y' THEN 1 ELSE 0 END = 1 ORDER BY T1.REG_STR_DT, T1.CRS_CD, T1.CRS_CDN