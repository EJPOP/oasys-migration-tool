WITH CHAIR_TABLE AS ( SELECT CD,
    CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000896' AND CD <> '000000000' AND USE_YN = 'Y' ) SELECT #strStdDt# AS #STRSTDDT#,
    #strScoHstSno# AS #STRSCOHSTSNO#,
    #strScoSno# AS #STRSCOSNO#,
    A.CD,
    B.BOKG_PEN_CNB AS BOKG_PEN_CNB,
    B.BOKG_PEN_NM AS BOKG_PEN_NM,
    B.BOKG_PEN_DPT_CD AS BOKG_PEN_DPT_CD,
    B.BOKG_PEN_DPT_NM AS BOKG_PEN_DPT_NM,
    B.BOKG_PEN_RANK_NM AS BOKG_PEN_RANK_NM,
    B.BOKG_PEN_TNB AS BOKG_PEN_TNB,
    CASE WHEN B.BOKG_PEN_CNB IS NOT NULL THEN '예약완료' ELSE '' END AS BOKG_PEN_CNB,
    TO_CHAR(TO_DATE(#strStdDt#), 'YYYY-MM-DD') || '(' || TO_CHAR(TO_DATE(#strStdDt#), 'DY', 'NLS_DATE_LANGUAGE=korean') || ')' AS TO_CHAR,
    #strScoTmNm# AS #STRSCOTMNM#,
    A.CD_NM,
    CASE WHEN B.BOKG_PEN_CNB IS NULL THEN '' WHEN B.BOKG_PEN_CNB = #strCnb# THEN B.BOKG_PEN_NM ELSE '***' END AS BOKG_PEN_CNB,
    CASE WHEN B.BOKG_PEN_CNB IS NULL THEN '' WHEN B.BOKG_PEN_CNB = #strCnb# THEN B.BOKG_PEN_DPT_NM ELSE '***' END AS BOKG_PEN_CNB
FROM CHAIR_TABLE A ,( SELECT T1.BOKG_DT,
    T1.SCO_HST_SNO,
    T1.SCO_SNO,
    T1.MSGCHR_CD,
    T1.BOKG_PEN_CNB AS BOKG_PEN_CNB,
    T3.USER_NM /* 사용자명 */,
    T1.BOKG_PEN_DPT_CD AS BOKG_PEN_DPT_CD,
    F_DPT_INFO(T1.BOKG_PEN_DPT_CD, '1') AS F_DPT_INFO,
    F_CODE_NM('1000173', T3.JBGD_SECD) AS F_CODE_NM,
    T3.CRU_TELNO /* 부패전화번호 */
FROM TBCSPMWF010M T1 ,TBCSPMWF009M T2 ,TBDCMACM001M T3 WHERE 1=1 AND T1.SCO_HST_SNO = T2.SCO_HST_SNO AND T1.SCO_SNO = T2.SCO_SNO AND T2.BOKG_DVSN_CD = '2' AND T1.BOKG_PEN_CNB = T3.TRGT_NOP_ENO AND T1.BOKG_DT = #strStdDt# AND T1.SCO_HST_SNO = #strScoHstSno# AND T1.SCO_SNO = #strScoSno# ) B WHERE A.CD = B.MSGCHR_CD(+) ORDER BY A.CD