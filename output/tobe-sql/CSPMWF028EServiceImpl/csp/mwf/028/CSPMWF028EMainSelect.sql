WITH DAY_TABLE AS ( SELECT MAX(CASE WHEN ROWNUM = 1 THEN DT ELSE '' END) AS ROWNUM,
    MAX(CASE WHEN ROWNUM = 2 THEN DT ELSE '' END) AS ROWNUM,
    MAX(CASE WHEN ROWNUM = 3 THEN DT ELSE '' END) AS ROWNUM,
    MAX(CASE WHEN ROWNUM = 4 THEN DT ELSE '' END) AS ROWNUM,
    MAX(CASE WHEN ROWNUM = 5 THEN DT ELSE '' END) AS ROWNUM,
    MAX(CASE WHEN ROWNUM = 6 THEN DT ELSE '' END) AS ROWNUM,
    MAX(CASE WHEN ROWNUM = 7 THEN DT ELSE '' END) AS ROWNUM,
    MAX(CASE WHEN ROWNUM = 8 THEN DT ELSE '' END) AS ROWNUM,
    MAX(CASE WHEN ROWNUM = 9 THEN DT ELSE '' END) AS ROWNUM,
    MAX(CASE WHEN ROWNUM = 10 THEN DT ELSE '' END) AS ROWNUM
FROM ( SELECT TO_CHAR(SYSDATE + (LEVEL-1), 'YYYYMMDD') AS TO_CHAR
FROM DUAL CONNECT BY LEVEL 0 THEN 'Y' ELSE 'N' END FROM TBBADDED013B WHERE INFO_YR || HLDY_CRTR_MND = T2.STD_DAY1) AS HOLIDAY1 ,(SELECT COUNT(1) || SUBSTR(EXTRACT(XMLAGG(XMLELEMENT(A, ','|| BOKG_PEN_CNB) ), '//text()'), 1)
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY1 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO GROUP BY BOKG_DT, SCO_HST_SNO, SCO_SNO) AS BOKG_CNB1 ,(SELECT CASE WHEN COUNT(1) > 0 THEN '남[' || (2 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '1%' THEN 1 ELSE 0 END),0) ) || '] ' || '여[' || (1 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '2%' THEN 1 ELSE 0 END),0) ) || '] ' ELSE '' AS 1
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY1 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_NM1 ,STD_DAY2 AS STD_DAY2 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM TBBADDED013B WHERE INFO_YR || HLDY_CRTR_MND = T2.STD_DAY2) AS HOLIDAY2 ,(SELECT COUNT(1) || SUBSTR(EXTRACT(XMLAGG(XMLELEMENT(A, ','|| BOKG_PEN_CNB) ), '//text()'), 1)
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY2 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO GROUP BY BOKG_DT, SCO_HST_SNO, SCO_SNO) AS BOKG_CNB2 ,(SELECT CASE WHEN COUNT(1) > 0 THEN '남[' || (2 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '1%' THEN 1 ELSE 0 END),0) ) || '] ' || '여[' || (1 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '2%' THEN 1 ELSE 0 END),0) ) || '] ' ELSE '' AS 1
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY2 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_NM2 ,STD_DAY3 AS STD_DAY3 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM TBBADDED013B WHERE INFO_YR || HLDY_CRTR_MND = T2.STD_DAY3) AS HOLIDAY3 ,(SELECT COUNT(1) || SUBSTR(EXTRACT(XMLAGG(XMLELEMENT(A, ','|| BOKG_PEN_CNB) ), '//text()'), 1)
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY3 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO GROUP BY BOKG_DT, SCO_HST_SNO, SCO_SNO) AS BOKG_CNB3 ,(SELECT CASE WHEN COUNT(1) > 0 THEN '남[' || (2 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '1%' THEN 1 ELSE 0 END),0) ) || '] ' || '여[' || (1 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '2%' THEN 1 ELSE 0 END),0) ) || '] ' ELSE '' AS 1
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY3 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_NM3 ,STD_DAY4 AS STD_DAY4 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM TBBADDED013B WHERE INFO_YR || HLDY_CRTR_MND = T2.STD_DAY4) AS HOLIDAY4 ,(SELECT COUNT(1) || SUBSTR(EXTRACT(XMLAGG(XMLELEMENT(A, ','|| BOKG_PEN_CNB) ), '//text()'), 1)
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY4 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO GROUP BY BOKG_DT, SCO_HST_SNO, SCO_SNO) AS BOKG_CNB4 ,(SELECT CASE WHEN COUNT(1) > 0 THEN '남[' || (2 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '1%' THEN 1 ELSE 0 END),0) ) || '] ' || '여[' || (1 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '2%' THEN 1 ELSE 0 END),0) ) || '] ' ELSE '' AS 1
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY4 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_NM4 ,STD_DAY5 AS STD_DAY5 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM TBBADDED013B WHERE INFO_YR || HLDY_CRTR_MND = T2.STD_DAY5) AS HOLIDAY5 ,(SELECT COUNT(1) || SUBSTR(EXTRACT(XMLAGG(XMLELEMENT(A, ','|| BOKG_PEN_CNB) ), '//text()'), 1)
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY5 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO GROUP BY BOKG_DT, SCO_HST_SNO, SCO_SNO) AS BOKG_CNB5 ,(SELECT CASE WHEN COUNT(1) > 0 THEN '남[' || (2 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '1%' THEN 1 ELSE 0 END),0) ) || '] ' || '여[' || (1 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '2%' THEN 1 ELSE 0 END),0) ) || '] ' ELSE '' AS 1
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY5 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_NM5 ,STD_DAY6 AS STD_DAY6 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM TBBADDED013B WHERE INFO_YR || HLDY_CRTR_MND = T2.STD_DAY6) AS HOLIDAY6 ,(SELECT COUNT(1) || SUBSTR(EXTRACT(XMLAGG(XMLELEMENT(A, ','|| BOKG_PEN_CNB) ), '//text()'), 1)
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY6 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO GROUP BY BOKG_DT, SCO_HST_SNO, SCO_SNO) AS BOKG_CNB6 ,(SELECT CASE WHEN COUNT(1) > 0 THEN '남[' || (2 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '1%' THEN 1 ELSE 0 END),0) ) || '] ' || '여[' || (1 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '2%' THEN 1 ELSE 0 END),0) ) || '] ' ELSE '' AS 1
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY6 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_NM6 ,STD_DAY7 AS STD_DAY7 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM TBBADDED013B WHERE INFO_YR || HLDY_CRTR_MND = T2.STD_DAY7) AS HOLIDAY7 ,(SELECT COUNT(1) || SUBSTR(EXTRACT(XMLAGG(XMLELEMENT(A, ','|| BOKG_PEN_CNB) ), '//text()'), 1)
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY7 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO GROUP BY BOKG_DT, SCO_HST_SNO, SCO_SNO) AS BOKG_CNB7 ,(SELECT CASE WHEN COUNT(1) > 0 THEN '남[' || (2 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '1%' THEN 1 ELSE 0 END),0) ) || '] ' || '여[' || (1 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '2%' THEN 1 ELSE 0 END),0) ) || '] ' ELSE '' AS 1
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY7 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_NM7 ,STD_DAY8 AS STD_DAY8 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM TBBADDED013B WHERE INFO_YR || HLDY_CRTR_MND = T2.STD_DAY8) AS HOLIDAY8 ,(SELECT COUNT(1) || SUBSTR(EXTRACT(XMLAGG(XMLELEMENT(A, ','|| BOKG_PEN_CNB) ), '//text()'), 1)
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY8 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO GROUP BY BOKG_DT, SCO_HST_SNO, SCO_SNO) AS BOKG_CNB8 ,(SELECT CASE WHEN COUNT(1) > 0 THEN '남[' || (2 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '1%' THEN 1 ELSE 0 END),0) ) || '] ' || '여[' || (1 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '2%' THEN 1 ELSE 0 END),0) ) || '] ' ELSE '' AS 1
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY8 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_NM8 ,STD_DAY9 AS STD_DAY9 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM TBBADDED013B WHERE INFO_YR || HLDY_CRTR_MND = T2.STD_DAY9) AS HOLIDAY9 ,(SELECT COUNT(1) || SUBSTR(EXTRACT(XMLAGG(XMLELEMENT(A, ','|| BOKG_PEN_CNB) ), '//text()'), 1)
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY9 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO GROUP BY BOKG_DT, SCO_HST_SNO, SCO_SNO) AS BOKG_CNB9 ,(SELECT CASE WHEN COUNT(1) > 0 THEN '남[' || (2 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '1%' THEN 1 ELSE 0 END),0) ) || '] ' || '여[' || (1 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '2%' THEN 1 ELSE 0 END),0) ) || '] ' ELSE '' AS 1
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY9 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_NM9 ,STD_DAY10 AS STD_DAY10 ,(SELECT CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' AS 1
FROM TBBADDED013B WHERE INFO_YR || HLDY_CRTR_MND = T2.STD_DAY10) AS HOLIDAY10 ,(SELECT COUNT(1) || SUBSTR(EXTRACT(XMLAGG(XMLELEMENT(A, ','|| BOKG_PEN_CNB) ), '//text()'), 1)
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY10 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO GROUP BY BOKG_DT, SCO_HST_SNO, SCO_SNO) AS BOKG_CNB10 ,(SELECT CASE WHEN COUNT(1) > 0 THEN '남[' || (2 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '1%' THEN 1 ELSE 0 END),0) ) || '] ' || '여[' || (1 - NVL(SUM(CASE WHEN MSGCHR_CD LIKE '2%' THEN 1 ELSE 0 END),0) ) || '] ' ELSE '' AS 1
FROM TBCSPMWF010M WHERE BOKG_DT = T2.STD_DAY10 AND SCO_HST_SNO = T1.SCO_HST_SNO AND SCO_SNO = T1.SCO_SNO) AS BOKG_NM10 FROM TBCSPMWF009M T1 ,DAY_TABLE T2 WHERE T1.BOKG_DVSN_CD = '2' AND TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN T1.APC_STR_DT AND T1.APC_END_DT ORDER BY SCO_SNO