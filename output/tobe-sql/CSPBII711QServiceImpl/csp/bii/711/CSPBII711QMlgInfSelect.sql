SELECT SUM(SMT_SUM_TSC_CNT) AS SMT_SUM_TSC_CNT,
    SUM(UTLZ_WHOL_SCR) AS UTLZ_WHOL_SCR /* 활용전체점수 */,
    SUM(RLBT_WHOL_SCR) AS RLBT_WHOL_SCR /* 신뢰성전체점수 */,
    SUM(CSIT_TSC) AS CSIT_TSC /* 충실성총점 */,
    MAX(SMT_DEL_CPT) AS SMT_DEL_CPT,
    MAX(SBMSN_NOCS) AS SBMSN_NOCS /* 제출건수 */,
    MAX(SMT_NOC_CPT) AS SMT_NOC_CPT,
    MAX(SMT_TOT_CPT) AS SMT_TOT_CPT
FROM ( SELECT /* csp.bii.service.impl.CSPBII711QServiceImpl.CSPBII711QMlgInfSelect */ SUM(AA.UTLZ_SCR) + SUM(AA.RLBT_SCR) + SUM(AA.CSIT_SCR) AS UTLZ_SCR /* 활용점수 */,
    SUM(AA.UTLZ_SCR) AS UTLZ_WHOL_SCR /* 활용전체점수 */,
    SUM(AA.RLBT_SCR) AS RLBT_WHOL_SCR /* 신뢰성전체점수 */,
    SUM(AA.CSIT_SCR) AS CSIT_TSC /* 충실성총점 */,
    MAX(AA.SMT_DEL_CPT) AS SMT_DEL_CPT /* 폐기건수 */,
    MAX(AA.SBMSN_NOCS) AS SBMSN_NOCS /* 제출건수 */,
    MAX(AA.SMT_NOC_CPT) AS SMT_NOC_CPT /* 제출건수(평가완료) */,
    MAX(AA.SMT_DEL_CPT) + MAX(AA.SBMSN_NOCS) + MAX(AA.SMT_NOC_CPT) AS SMT_DEL_CPT
FROM ( SELECT UTLZ_SCR /* 활용점수 */,
    RLBT_SCR /* 신뢰성점수 */,
    CSIT_SCR /* 충실성점수 */,
    ROW_NUMBER() OVER (PARTITION BY A.PRSNR_ENO ORDER BY (UTLZ_SCR + RLBT_SCR + CSIT_SCR) DESC) AS SBMSN_SCR_RNK /* 제출점수순위 */,
    (SELECT count(*)
FROM TBCSPBII170M M WHERE M.PRSNR_ENO = A.PRSNR_ENO AND M.ADT_INFO_PRGRS_STTS_SECD NOT IN ('15','20','99') AND M.SBMSN_YMD BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND M.ADT_INFO_PRGRS_STTS_SECD >= '05') AS SBMSN_NOCS /* 제출건수(평가중) */ , (SELECT count(*)
FROM TBCSPBII170M M WHERE M.PRSNR_ENO = A.PRSNR_ENO AND M.ADT_INFO_PRGRS_STTS_SECD IN ('15','20','99') AND M.SBMSN_YMD BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND M.ADT_INFO_PRGRS_STTS_SECD >= '05' AND M.PRCS_DRCTN_SECD != '7') AS SMT_NOC_CPT /* 제출건수(평가완료) */ , (SELECT count(*)
FROM TBCSPBII170M M WHERE M.PRSNR_ENO = A.PRSNR_ENO AND M.ADT_INFO_PRGRS_STTS_SECD IN ('15','20','99') AND M.SBMSN_YMD BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND M.ADT_INFO_PRGRS_STTS_SECD >= '05' AND M.PRCS_DRCTN_SECD = '7' ) AS SMT_DEL_CPT /* 폐기건수 */ , A.PRSNR_ENO FROM TBCSPBII170M A WHERE A.SBMSN_YMD BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND A.PRSNR_ENO = #PRSNR_ENO# AND A.CLCT_SECD IN ('1','2') ) AA WHERE SBMSN_SCR_RNK < 3 UNION ALL SELECT /* csp.bii.service.impl.CSPBII711QServiceImpl.CSPBII711QMlgInfSelect */ SUM(AA.UTLZ_SCR) + SUM(AA.RLBT_SCR) + SUM(AA.CSIT_SCR) AS UTLZ_SCR /* 활용점수 */,
    SUM(AA.UTLZ_SCR) AS UTLZ_WHOL_SCR /* 활용전체점수 */,
    SUM(AA.RLBT_SCR) AS RLBT_WHOL_SCR /* 신뢰성전체점수 */,
    SUM(AA.CSIT_SCR) AS CSIT_TSC /* 충실성총점 */,
    MAX(AA.SMT_DEL_CPT) AS SMT_DEL_CPT /* 폐기건수 */,
    MAX(AA.SBMSN_NOCS) AS SBMSN_NOCS /* 제출건수 */,
    MAX(AA.SMT_NOC_CPT) AS SMT_NOC_CPT /* 제출건수(평가완료) */,
    MAX(AA.SMT_DEL_CPT) + MAX(AA.SBMSN_NOCS) + MAX(AA.SMT_NOC_CPT) AS SMT_DEL_CPT
FROM ( SELECT UTLZ_SCR /* 활용점수 */,
    RLBT_SCR /* 신뢰성점수 */,
    CSIT_SCR /* 충실성점수 */,
    0 AS SBMSN_NOCS /* 제출건수(평가중) */,
    0 /* 제출건수(평가완료) */,
    0 /* 폐기건수 */,
    A.PRSNR_ENO /* 제출자직원전산번호 */
FROM TBCSPBII170M A WHERE A.SBMSN_YMD BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND A.PRSNR_ENO = #PRSNR_ENO# AND A.CLCT_SECD NOT IN ('1','2') ) AA )