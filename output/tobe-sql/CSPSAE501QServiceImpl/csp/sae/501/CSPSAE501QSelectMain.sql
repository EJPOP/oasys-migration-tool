WITH APL_DATE AS /* CSPSAE501QSelectMain */ (SELECT T2.DT , CASE WHEN T2.DT = (CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') = A.NOW_JUCHA GROUP BY A.JUCHA, A.YY_JUCHA ) T5 WHERE T2.DT = T3.APL_DT AND T2.DT = TO_CHAR(TO_DATE(T4.END_DDL_DT)-1,'YYYYMMDD') ), ROOM_BASE_CNT AS (SELECT F2_WSRM_BOKG_POSS_CNT,
    '4' AS DMT_DVSN_CD,
    STR_DDL_DT,
    END_DDL_DT
FROM TBCSPSAE134B WHERE TO_DATE(END_DDL_DT)-1 BETWEEN TO_DATE(#strFromY# || #strFromM# || '01', 'YYYYMMDD') AND LAST_DAY(#strToY# || #strToM# || '01') UNION ALL SELECT F3_WSRM_BOKG_POSS_CNT,
    '5' AS DMT_DVSN_CD,
    STR_DDL_DT,
    END_DDL_DT
FROM TBCSPSAE134B WHERE TO_DATE(END_DDL_DT)-1 BETWEEN TO_DATE(#strFromY# || #strFromM# || '01', 'YYYYMMDD') AND LAST_DAY(#strToY# || #strToM# || '01') UNION ALL SELECT F3_KSRM_BOKG_POSS_CNT,
    '6' AS DMT_DVSN_CD,
    STR_DDL_DT,
    END_DDL_DT
FROM TBCSPSAE134B WHERE TO_DATE(END_DDL_DT)-1 BETWEEN TO_DATE(#strFromY# || #strFromM# || '01', 'YYYYMMDD') AND LAST_DAY(#strToY# || #strToM# || '01') UNION ALL SELECT F4_WSRM_BOKG_POSS_CNT,
    '7' AS DMT_DVSN_CD,
    STR_DDL_DT,
    END_DDL_DT
FROM TBCSPSAE134B WHERE TO_DATE(END_DDL_DT)-1 BETWEEN TO_DATE(#strFromY# || #strFromM# || '01', 'YYYYMMDD') AND LAST_DAY(#strToY# || #strToM# || '01') UNION ALL SELECT CAMP_BOKG_POSS_CNT,
    '8' AS DMT_DVSN_CD,
    STR_DDL_DT,
    END_DDL_DT
FROM TBCSPSAE134B WHERE TO_DATE(END_DDL_DT)-1 BETWEEN TO_DATE(#strFromY# || #strFromM# || '01', 'YYYYMMDD') AND LAST_DAY(#strToY# || #strToM# || '01')) SELECT TB1.DMT_DVSN_CD,
    TB1.FLOOR,
    TB1.ROOM_TYPE,
    TB1.PERSON,
    CASE WHEN TB1.DATE_RESULT1 = '예약가능' THEN (CASE WHEN (SELECT AS DATE_RESULT1
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE1,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE1,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE1)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT1 END) ELSE TB1.DATE_RESULT1 END AS DATE_RESULT1, CASE WHEN TB1.DATE_RESULT1 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE1,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE1 END) ELSE TB1.DATE1 END AS DATE1, CASE WHEN TB1.DATE_RESULT1 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE1,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN1 END) ELSE TB1.BOKG_YN1 END AS BOKG_YN1, CASE WHEN TB1.DATE_RESULT2 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE2,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE2,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE2)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT2 END) ELSE TB1.DATE_RESULT2 END AS DATE_RESULT2, CASE WHEN TB1.DATE_RESULT2 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE2,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE2 END) ELSE TB1.DATE2 END AS DATE2, CASE WHEN TB1.DATE_RESULT2 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE2,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN2 END) ELSE TB1.BOKG_YN2 END AS BOKG_YN2, CASE WHEN TB1.DATE_RESULT3 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE3,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE3,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE3)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT3 END) ELSE TB1.DATE_RESULT3 END AS DATE_RESULT3, CASE WHEN TB1.DATE_RESULT3 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE3,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE3 END) ELSE TB1.DATE3 END AS DATE3, CASE WHEN TB1.DATE_RESULT3 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE3,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN3 END) ELSE TB1.BOKG_YN3 END AS BOKG_YN3, CASE WHEN TB1.DATE_RESULT4 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE4,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE4,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE4)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT4 END) ELSE TB1.DATE_RESULT4 END AS DATE_RESULT4, CASE WHEN TB1.DATE_RESULT4 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE4,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE4 END) ELSE TB1.DATE4 END AS DATE4, CASE WHEN TB1.DATE_RESULT4 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE4,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN4 END) ELSE TB1.BOKG_YN4 END AS BOKG_YN4, CASE WHEN TB1.DATE_RESULT5 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE5,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE5,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE5)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT5 END) ELSE TB1.DATE_RESULT5 END AS DATE_RESULT5, CASE WHEN TB1.DATE_RESULT5 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE5,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE5 END) ELSE TB1.DATE5 END AS DATE5, CASE WHEN TB1.DATE_RESULT5 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE5,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN5 END) ELSE TB1.BOKG_YN5 END AS BOKG_YN5, CASE WHEN TB1.DATE_RESULT6 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE6,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE6,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE6)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT6 END) ELSE TB1.DATE_RESULT6 END AS DATE_RESULT6, CASE WHEN TB1.DATE_RESULT6 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE6,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE6 END) ELSE TB1.DATE6 END AS DATE6, CASE WHEN TB1.DATE_RESULT6 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE6,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN6 END) ELSE TB1.BOKG_YN6 END AS BOKG_YN6, CASE WHEN TB1.DATE_RESULT7 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE7,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE7,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE7)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT7 END) ELSE TB1.DATE_RESULT7 END AS DATE_RESULT7, CASE WHEN TB1.DATE_RESULT7 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE7,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE7 END) ELSE TB1.DATE7 END AS DATE7, CASE WHEN TB1.DATE_RESULT7 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE7,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN7 END) ELSE TB1.BOKG_YN7 END AS BOKG_YN7, CASE WHEN TB1.DATE_RESULT8 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE8,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE8,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE8)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT8 END) ELSE TB1.DATE_RESULT8 END AS DATE_RESULT8, CASE WHEN TB1.DATE_RESULT8 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE8,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE8 END) ELSE TB1.DATE8 END AS DATE8, CASE WHEN TB1.DATE_RESULT8 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE8,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN8 END) ELSE TB1.BOKG_YN8 END AS BOKG_YN8, CASE WHEN TB1.DATE_RESULT9 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE9,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE9,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE9)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT9 END) ELSE TB1.DATE_RESULT9 END AS DATE_RESULT9, CASE WHEN TB1.DATE_RESULT9 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE9,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE9 END) ELSE TB1.DATE9 END AS DATE9, CASE WHEN TB1.DATE_RESULT9 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE9,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN9 END) ELSE TB1.BOKG_YN9 END AS BOKG_YN9, CASE WHEN TB1.DATE_RESULT10 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE10,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE10,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE10)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT10 END) ELSE TB1.DATE_RESULT10 END AS DATE_RESULT10, CASE WHEN TB1.DATE_RESULT10 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE10,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE10 END) ELSE TB1.DATE10 END AS DATE10, CASE WHEN TB1.DATE_RESULT10 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE10,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN10 END) ELSE TB1.BOKG_YN10 END AS BOKG_YN10, CASE WHEN TB1.DATE_RESULT11 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE11,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE11,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE11)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT11 END) ELSE TB1.DATE_RESULT11 END AS DATE_RESULT11, CASE WHEN TB1.DATE_RESULT11 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE11,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE11 END) ELSE TB1.DATE11 END AS DATE11, CASE WHEN TB1.DATE_RESULT11 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE11,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN11 END) ELSE TB1.BOKG_YN11 END AS BOKG_YN11, CASE WHEN TB1.DATE_RESULT12 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE12,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE12,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE12)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT12 END) ELSE TB1.DATE_RESULT12 END AS DATE_RESULT12, CASE WHEN TB1.DATE_RESULT12 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE12,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE12 END) ELSE TB1.DATE12 END AS DATE12, CASE WHEN TB1.DATE_RESULT12 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE12,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN12 END) ELSE TB1.BOKG_YN12 END AS BOKG_YN12, CASE WHEN TB1.DATE_RESULT13 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE13,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE13,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE13)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT13 END) ELSE TB1.DATE_RESULT13 END AS DATE_RESULT13, CASE WHEN TB1.DATE_RESULT13 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE13,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE13 END) ELSE TB1.DATE13 END AS DATE13, CASE WHEN TB1.DATE_RESULT13 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE13,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN13 END) ELSE TB1.BOKG_YN13 END AS BOKG_YN13, CASE WHEN TB1.DATE_RESULT14 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE14,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE14,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE14)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT14 END) ELSE TB1.DATE_RESULT14 END AS DATE_RESULT14, CASE WHEN TB1.DATE_RESULT14 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE14,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE14 END) ELSE TB1.DATE14 END AS DATE14, CASE WHEN TB1.DATE_RESULT14 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE14,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN14 END) ELSE TB1.BOKG_YN14 END AS BOKG_YN14, CASE WHEN TB1.DATE_RESULT15 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE15,'YYYYMMDD')+1) = 0 THEN '예약불가' WHEN SIGN((SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE15,'YYYYMMDD')+1) - (SELECT COUNT(R2.TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBCSPSAE501D R2 WHERE R2.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R2.USE_STR_DT = TB1.DATE15)) <> 1 THEN '대기가능' ELSE TB1.DATE_RESULT15 END) ELSE TB1.DATE_RESULT15 END AS DATE_RESULT15, CASE WHEN TB1.DATE_RESULT15 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE15,'YYYYMMDD')+1) = 0 THEN '예약불가' ELSE TB1.DATE15 END) ELSE TB1.DATE15 END AS DATE15, CASE WHEN TB1.DATE_RESULT15 = '예약가능' THEN (CASE WHEN (SELECT POSS_CNT
FROM ROOM_BASE_CNT R1 WHERE R1.DMT_DVSN_CD = TB1.DMT_DVSN_CD AND R1.END_DDL_DT = TO_DATE(TB1.DATE15,'YYYYMMDD')+1) = 0 THEN 'F' ELSE TB1.BOKG_YN15 END) ELSE TB1.BOKG_YN15 END AS BOKG_YN15 FROM (SELECT DD1.DMT_DVSN_CD,
    DD3.USR_DFN_TXT_1,
    DD3.USR_DFN_TXT_2,
    DD3.USR_DFN_TXT_3,
    MAX(DECODE(DD1.DATE1, '예약종료', '예약종료', DECODE(DD1.DATE1, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE1,
    MAX(DECODE(DD1.DATE1, '예약종료', '예약종료', DECODE(DD1.DATE1, '예약불가', '예약불가', DD1.DATE1 ) ) ) AS DATE1,
    MAX(DECODE(DD1.DATE1, '예약종료', 'F', DECODE(DD1.DATE1, '예약불가', 'F', '' ) ) ) AS DATE1,
    MAX(DECODE(DD1.DATE2, '예약종료', '예약종료', DECODE(DD1.DATE2, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE2,
    MAX(DECODE(DD1.DATE2, '예약종료', '예약종료', DECODE(DD1.DATE2, '예약불가', '예약불가', DD1.DATE2 ) ) ) AS DATE2,
    MAX(DECODE(DD1.DATE2, '예약종료', 'F', DECODE(DD1.DATE2, '예약불가', 'F', '' ) ) ) AS DATE2,
    MAX(DECODE(DD1.DATE3, '예약종료', '예약종료', DECODE(DD1.DATE3, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE3,
    MAX(DECODE(DD1.DATE3, '예약종료', '예약종료', DECODE(DD1.DATE3, '예약불가', '예약불가', DD1.DATE3 ) ) ) AS DATE3,
    MAX(DECODE(DD1.DATE3, '예약종료', 'F', DECODE(DD1.DATE3, '예약불가', 'F', '' ) ) ) AS DATE3,
    MAX(DECODE(DD1.DATE4, '예약종료', '예약종료', DECODE(DD1.DATE4, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE4,
    MAX(DECODE(DD1.DATE4, '예약종료', '예약종료', DECODE(DD1.DATE4, '예약불가', '예약불가', DD1.DATE4 ) ) ) AS DATE4,
    MAX(DECODE(DD1.DATE4, '예약종료', 'F', DECODE(DD1.DATE4, '예약불가', 'F', '' ) ) ) AS DATE4,
    MAX(DECODE(DD1.DATE5, '예약종료', '예약종료', DECODE(DD1.DATE5, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE5,
    MAX(DECODE(DD1.DATE5, '예약종료', '예약종료', DECODE(DD1.DATE5, '예약불가', '예약불가', DD1.DATE5 ) ) ) AS DATE5,
    MAX(DECODE(DD1.DATE5, '예약종료', 'F', DECODE(DD1.DATE5, '예약불가', 'F', '' ) ) ) AS DATE5,
    MAX(DECODE(DD1.DATE6, '예약종료', '예약종료', DECODE(DD1.DATE6, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE6,
    MAX(DECODE(DD1.DATE6, '예약종료', '예약종료', DECODE(DD1.DATE6, '예약불가', '예약불가', DD1.DATE6 ) ) ) AS DATE6,
    MAX(DECODE(DD1.DATE6, '예약종료', 'F', DECODE(DD1.DATE6, '예약불가', 'F', '' ) ) ) AS DATE6,
    MAX(DECODE(DD1.DATE7, '예약종료', '예약종료', DECODE(DD1.DATE7, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE7,
    MAX(DECODE(DD1.DATE7, '예약종료', '예약종료', DECODE(DD1.DATE7, '예약불가', '예약불가', DD1.DATE7 ) ) ) AS DATE7,
    MAX(DECODE(DD1.DATE7, '예약종료', 'F', DECODE(DD1.DATE7, '예약불가', 'F', '' ) ) ) AS DATE7,
    MAX(DECODE(DD1.DATE8, '예약종료', '예약종료', DECODE(DD1.DATE8, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE8,
    MAX(DECODE(DD1.DATE8, '예약종료', '예약종료', DECODE(DD1.DATE8, '예약불가', '예약불가', DD1.DATE8 ) ) ) AS DATE8,
    MAX(DECODE(DD1.DATE8, '예약종료', 'F', DECODE(DD1.DATE8, '예약불가', 'F', '' ) ) ) AS DATE8,
    MAX(DECODE(DD1.DATE9, '예약종료', '예약종료', DECODE(DD1.DATE9, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE9,
    MAX(DECODE(DD1.DATE9, '예약종료', '예약종료', DECODE(DD1.DATE9, '예약불가', '예약불가', DD1.DATE9 ) ) ) AS DATE9,
    MAX(DECODE(DD1.DATE9, '예약종료', 'F', DECODE(DD1.DATE9, '예약불가', 'F', '' ) ) ) AS DATE9,
    MAX(DECODE(DD1.DATE10, '예약종료', '예약종료', DECODE(DD1.DATE10, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE10,
    MAX(DECODE(DD1.DATE10, '예약종료', '예약종료', DECODE(DD1.DATE10, '예약불가', '예약불가', DD1.DATE10 ) ) ) AS DATE10,
    MAX(DECODE(DD1.DATE10, '예약종료', 'F', DECODE(DD1.DATE10, '예약불가', 'F', '' ) ) ) AS DATE10,
    MAX(DECODE(DD1.DATE11, '예약종료', '예약종료', DECODE(DD1.DATE11, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE11,
    MAX(DECODE(DD1.DATE11, '예약종료', '예약종료', DECODE(DD1.DATE11, '예약불가', '예약불가', DD1.DATE11 ) ) ) AS DATE11,
    MAX(DECODE(DD1.DATE11, '예약종료', 'F', DECODE(DD1.DATE11, '예약불가', 'F', '' ) ) ) AS DATE11,
    MAX(DECODE(DD1.DATE12, '예약종료', '예약종료', DECODE(DD1.DATE12, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE12,
    MAX(DECODE(DD1.DATE12, '예약종료', '예약종료', DECODE(DD1.DATE12, '예약불가', '예약불가', DD1.DATE12 ) ) ) AS DATE12,
    MAX(DECODE(DD1.DATE12, '예약종료', 'F', DECODE(DD1.DATE12, '예약불가', 'F', '' ) ) ) AS DATE12,
    MAX(DECODE(DD1.DATE13, '예약종료', '예약종료', DECODE(DD1.DATE13, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE13,
    MAX(DECODE(DD1.DATE13, '예약종료', '예약종료', DECODE(DD1.DATE13, '예약불가', '예약불가', DD1.DATE13 ) ) ) AS DATE13,
    MAX(DECODE(DD1.DATE13, '예약종료', 'F', DECODE(DD1.DATE13, '예약불가', 'F', '' ) ) ) AS DATE13,
    MAX(DECODE(DD1.DATE14, '예약종료', '예약종료', DECODE(DD1.DATE14, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE14,
    MAX(DECODE(DD1.DATE14, '예약종료', '예약종료', DECODE(DD1.DATE14, '예약불가', '예약불가', DD1.DATE14 ) ) ) AS DATE14,
    MAX(DECODE(DD1.DATE14, '예약종료', 'F', DECODE(DD1.DATE14, '예약불가', 'F', '' ) ) ) AS DATE14,
    MAX(DECODE(DD1.DATE15, '예약종료', '예약종료', DECODE(DD1.DATE15, '예약불가', '예약불가', '예약가능' ) ) ) AS DATE15,
    MAX(DECODE(DD1.DATE15, '예약종료', '예약종료', DECODE(DD1.DATE15, '예약불가', '예약불가', DD1.DATE15 ) ) ) AS DATE15,
    MAX(DECODE(DD1.DATE15, '예약종료', 'F', DECODE(DD1.DATE15, '예약불가', 'F', '' ) ) ) AS DATE15
FROM ( SELECT D2.DMT_DVSN_CD,
    D2.TOT_DMT_DVSN_CD,
    MAX(DECODE(D1.ROW_SNO, 1, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 2, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 3, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 4, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 5, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 6, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 7, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 8, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 9, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 10, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 11, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 12, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 13, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 14, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO,
    MAX(DECODE(D1.ROW_SNO, 15, DECODE(NVL(D1.DDLN_YN, 'N'), 'Y', '예약종료', DECODE(NVL(D1.DDLN_YN, 'N'), 'X', '예약불가' ,D1.DT)), NULL)) AS ROW_SNO
FROM APL_DATE D1 , (SELECT DMT_DVSN_CD,
    COUNT(DMT_DVSN_CD) AS DMT_DVSN_CD
FROM TBCSPSAE115B WHERE USE_YN = 'Y' GROUP BY DMT_DVSN_CD ORDER BY DMT_DVSN_CD) D2 GROUP BY D2.DMT_DVSN_CD, D2.TOT_DMT_DVSN_CD ORDER BY D2.DMT_DVSN_CD ) DD1 , ( SELECT B.DMT_DVSN_CD,
    B.DT,
    CASE WHEN B.POSS_CNT = 0 THEN 'N' WHEN NVL(B.POSS_CNT, 0) - NVL(A.CNT_DMT_DVSN_CD, 0) = TO_CHAR(SYSDATE + 35, 'YYYYMMDD') THEN 'N' ELSE 'Y' END AS POSS_CNT
FROM ( SELECT A.DMT_DVSN_CD,
    COUNT(A.WEK) AS WEK,
    A.STR_DDL_DT,
    A.END_DDL_DT
FROM ( SELECT A.APL_DT,
    B.DMT_DVSN_CD,
    B.SEAT_NM,
    B.RMN_NM,
    B.USE_STR_DT,
    B.USE_END_DT,
    B.USE_STR_DT,
    C.WEK,
    C.STR_DDL_DT,
    C.END_DDL_DT
FROM TBCSPSAE501M A , TBCSPSAE501D B , TBCSPSAE134B C WHERE A.TRGT_NOP_ENO = B.TRGT_NOP_ENO AND A.APL_DT = B.APL_DT AND A.BSC_SRNO = B.BSC_SRNO AND B.USE_STR_DT = TO_CHAR(TO_DATE(C.END_DDL_DT)-1,'YYYYMMDD') AND B.COFM_STA_CD IN ('10', '30', '50', '60') AND B.USE_STR_DT BETWEEN TO_DATE(#strFromY# || #strFromM# || '01', 'YYYYMMDD') AND LAST_DAY(#strToY# || #strToM# || '01') ) A WHERE A.DDT IN ( SELECT DT
FROM APL_DATE ) GROUP BY A.DMT_DVSN_CD, A.STR_DDL_DT, A.END_DDL_DT) A , (SELECT A.DMT_DVSN_CD,
    A.POSS_CNT,
    B.DT
FROM ROOM_BASE_CNT A , APL_DATE B WHERE B.DT BETWEEN TO_CHAR(TRUNC(TO_DATE(A.END_DDL_DT)-1, 'IW'), 'YYYYMMDD') AND TO_CHAR(TRUNC(TO_DATE(A.END_DDL_DT)-1, 'IW')+6, 'YYYYMMDD')) B WHERE A.DMT_DVSN_CD(+) = B.DMT_DVSN_CD AND B.DT BETWEEN TO_CHAR(TRUNC(TO_DATE(A.END_DDL_DT(+))-1, 'IW'), 'YYYYMMDD') AND TO_CHAR(TRUNC(TO_DATE(A.END_DDL_DT(+))-1, 'IW')+6, 'YYYYMMDD') ) DD2 , (SELECT *
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000140' AND USE_YN = 'Y') DD3 WHERE DD1.DMT_DVSN_CD = DD2.DMT_DVSN_CD(+) AND DD1.DMT_DVSN_CD = DD3.CD GROUP BY DD1.DMT_DVSN_CD , DD3.USR_DFN_TXT_1 , DD3.USR_DFN_TXT_2 , DD3.USR_DFN_TXT_3 , DD1.TOT_DMT_DVSN_CD ORDER BY FLOOR DESC) TB1