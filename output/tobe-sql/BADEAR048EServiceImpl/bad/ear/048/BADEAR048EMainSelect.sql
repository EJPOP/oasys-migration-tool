SELECT D1.ADT_YR AS ADT_YR /* 감사년도 */,
    D1.ADT_NO AS ADT_NO /* 감사번호 */,
    F_MNG_KND_AUDYRNO(D1.ADT_YR, D1.ADT_NO, D1.ADT_KDCD, '-') AS ADT_CLSF_NO /* 감사분류번호 */,
    D1.SPRVSN_DEPT_CD AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    F_DPT_INFO(D1.SPRVSN_DEPT_CD,'1') AS F_DPT_INFO /* 주관국과명 */,
    D1.MNG_DEPT_CD AS MNG_DEPT_CD /* 관리부서코드 */,
    F_DPT_INFO(D1.MNG_DEPT_CD,'1') AS F_DPT_INFO /* 관리부서명 */,
    D1.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    (SELECT CASE WHEN COUNT(*) > 0 THEN 'Y' ELSE 'N' AS 0
FROM TB_BADEAR030M T1 WHERE T1.CVLCPT_ADT_YR = D1.ADT_YR AND T1.ADT_NO = D1.ADT_NO) AS PRL_SMT_SAVE_YN /*홍보제출테이블 입력 여부*/ , (SELECT CASE WHEN COUNT(*) > 0 THEN 'Y' ELSE 'N' AS 0
FROM TB_BADEAR030M T1 WHERE T1.CVLCPT_ADT_YR = D1.ADT_YR AND T1.ADT_NO = D1.ADT_NO AND T1.PBRL_SBMSN_YN = 'Y') AS PBRL_SBMSN_YN /*홍보제출여부*/ ,(SELECT TO_CHAR(TO_DATE(MAX(S1.ENFC_YMD)),'YYYY-MM-DD') AS ENFC_YMD /* 시행일자 */
FROM TB_BADEAR002D S1 WHERE S1.CVLCPT_ADT_YR = D1.ADT_YR AND S1.ADT_NO = D1.ADT_NO) AS ENFC_YMD ,(SELECT TO_CHAR(TO_DATE(MAX(T1.PBRL_SBMSN_YMD)),'YYYY-MM-DD') AS PBRL_SBMSN_YMD /* 홍보제출일자 */
FROM TB_BADEAR030M T1 WHERE T1.CVLCPT_ADT_YR = D1.ADT_YR AND T1.ADT_NO = D1.ADT_NO) AS PBRL_SBMSN_YMD , CASE WHEN (SELECT MAX(T1.PBRL_SBMSN_YMD) AS PBRL_SBMSN_YMD /* 홍보제출일자 */
FROM TB_BADEAR030M T1 WHERE T1.CVLCPT_ADT_YR = D1.ADT_YR AND T1.ADT_NO = D1.ADT_NO) IS NOT NULL THEN TO_DATE((SELECT MAX(T1.PBRL_SBMSN_YMD) AS PBRL_SBMSN_YMD /* 홍보제출일자 */
FROM TB_BADEAR030M T1 WHERE T1.CVLCPT_ADT_YR = D1.ADT_YR AND T1.ADT_NO = D1.ADT_NO)) - (SELECT TO_DATE(MAX(ENFC_YMD)) AS ENFC_YMD /* 시행일자 */
FROM TB_BADEAR002D S1 WHERE S1.CVLCPT_ADT_YR = D1.ADT_YR AND S1.ADT_NO = D1.ADT_NO) ELSE TO_DATE(SYSDATE) - (SELECT TO_DATE(MAX(ENFC_YMD)) AS ENFC_YMD /* 시행일자 */
FROM TB_BADEAR002D S1 WHERE S1.CVLCPT_ADT_YR = D1.ADT_YR AND S1.ADT_NO = D1.ADT_NO) END AS DAY_CNT /*시행일 이후 경과일수*/ ,( SELECT F_CODE_NM('1000756',NVL(MAX(PRGRS_STTS_SECD),'10')) AS PRGRS_STTS_SECD /* 진행상태구분코드 */
FROM TB_BADEAR030M T1 WHERE T1.CVLCPT_ADT_YR = D1.ADT_YR AND T1.ADT_NO = D1.ADT_NO ) AS PRSS_STA_NM FROM TB_BADDED001M D1 WHERE 1=1 AND D1.MNG_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strUpSpvBrdvCd#))) AND NOT EXISTS ( SELECT 1
FROM TB_BADEAR001M T1 ,TB_BADEAR002D T2 WHERE T1.CVLCPT_ADT_YR = D1.ADT_YR AND T1.ADT_NO = D1.ADT_NO AND T1.CVLCPT_ADT_YR = T2.CVLCPT_ADT_YR AND T1.ADT_NO = T2.ADT_NO AND T1.DSPS_RQT_SQNO = T2.DSPS_RQT_SQNO AND T2.ENFC_YMD IS NULL AND T1.DSPS_RQT_KDCD NOT IN ( '120' /* 무책판정 */ ,'390' /* 현지시정 */ ,'391' /* 현지시정회 */ ,'490' /* 현지주의 */ ,'395' /* 시정(국장전결) */ ,'396' /* 시정(국장전결)회 */ ,'495' /* 주의(국장전결) */ ,'730' /* 수사요청 */ ,'904' /* 종합통보 */ ,'905' /* 개별통보 */ ,'910' /* 자체처리요구 */ ,'911' /* 자체징계 */ ,'912' /* 자체시정 */ ,'913' /* 자체주의 */ ,'914' /* 자체통보 */ ,'915' /* 자체처리고발 */ ,'916' /* 불문 */ ) ) AND EXISTS ( SELECT 1
FROM TB_BADEAR001M T1 WHERE T1.CVLCPT_ADT_YR = D1.ADT_YR AND T1.ADT_NO = D1.ADT_NO AND T1.DSPS_RQT_KDCD NOT IN ( '120' /* 무책판정 */ ,'390' /* 현지시정 */ ,'391' /* 현지시정회 */ ,'490' /* 현지주의 */ ,'395' /* 시정(국장전결) */ ,'396' /* 시정(국장전결)회 */ ,'495' /* 주의(국장전결) */ ,'730' /* 수사요청 */ ,'904' /* 종합통보 */ ,'905' /* 개별통보 */ ,'910' /* 자체처리요구 */ ,'911' /* 자체징계 */ ,'912' /* 자체시정 */ ,'913' /* 자체주의 */ ,'914' /* 자체통보 */ ,'915' /* 자체처리고발 */ ,'916' /* 불문 */ ) ) AND D1.ADT_YR = #CVLCPT_ADT_YR# AND D1.ADT_GRNT_NO = #ADT_GRNT_NO# AND EXISTS (SELECT 1
FROM TB_BADEAR030M T1 WHERE T1.CVLCPT_ADT_YR = D1.ADT_YR AND T1.ADT_NO = D1.ADT_NO AND T1.PBRL_SBMSN_YN = 'Y') AND NOT EXISTS (SELECT 1
FROM TB_BADEAR030M T1 WHERE T1.CVLCPT_ADT_YR = D1.ADT_YR AND T1.ADT_NO = D1.ADT_NO AND T1.PBRL_SBMSN_YN = 'Y') AND D1.MNG_DEPT_CD = #MNG_DEPT_CD# AND D1.ADT_MTTR_NM LIKE '%'||#strAudSbjNm#||'%' AND SUBSTR(D1.ADT_KDCD,3,1) = #strAudYrNoKndCd# ORDER BY D1.ADT_YR DESC, D1.ADT_NO DESC