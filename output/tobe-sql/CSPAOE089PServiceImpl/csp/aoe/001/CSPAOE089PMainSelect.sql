SELECT D1.CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.ADT_KDCD /* 감사종류코드 */,
    NVL(F_MNG_KND_AUDYRNO(D1.CVLCPT_ADT_YR, D1.TSK_NO, D2.ADT_KDCD, '-'),D1.CVLCPT_ADT_YR || '-' || D1.TSK_NO) AS F_MNG_KND_AUDYRNO /* 감사연번호 */,
    NVL(D2.ADT_GRNT_NO, D1.TSK_NO) AS ADT_GRNT_NO /* 감사부여번호 */,
    D1.ADT_MTTR_NM /* 감사사항명 */,
    D1.MNDY_CNT,
    SUBSTR(D2.ADT_KDCD,3,1) AS SUBSTR
FROM TBCSPAOE021M D1 ,TB_BADDED001M D2 WHERE 1=1 AND D1.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND D1.CVLCPT_ADT_YR= D2.ADT_YR(+) AND D1.TSK_NO = D2.ADT_NO(+) D1.ADT_MTTR_NM LIKE '%'||#strAudSbjNm#||'%' CASE WHEN LENGTH(#ADT_GRNT_NO#) = 3 AND D2.ADT_GRNT_NO = #ADT_GRNT_NO# THEN '1' WHEN LENGTH(#ADT_GRNT_NO#) <> 3 AND D1.TSK_NO = #ADT_GRNT_NO# THEN '1' ELSE '' END = '1' SUBSTR(D2.ADT_KDCD,3,1) = #strAudYrNoKndCd# ORDER BY D1.CVLCPT_ADT_YR, D1.TSK_NO