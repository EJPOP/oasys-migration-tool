MERGE INTO TB_BADDED149M USING DUAL ON ( CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND ADT_NO = #ADT_NO# AND ADT_STP_SECD = #ADT_STP_SECD# AND CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND FRS_MDM_SQNO = #FRS_MDM_SQNO# ) WHEN MATCHED THEN UPDATE SET ATRZ_STTS_SECD = DECODE(#APV_STA_CD# ,'20',DECODE((SELECT COUNT(*)
FROM TBDCMACM023L WHERE ATRZ_DOC_NO = #ATRZ_DOC_NO# AND APRVR_KDCD <> '1' AND APVR_SEQ <> 1 AND APV_DH IS NOT NULL AND SUBSTR(APVR_STA_CD, 0,1) = '2'),0,'20','25') ,#APV_STA_CD#) /* 결재상태구분코드 */,  ATRZ_DMND_ID = #ATRZ_DOC_NO# /* 결재요청아이디 */,  EDT_PRM_YMD = #EDT_PRM_YMD# /* 편집허용일자 */,  EDT_PRM_DT = #EDT_PRM_DT# /* 편집허용일시 */,  LAST_USER_ID = #LAST_USER_ID# /* 최종사용자ID */ ,  LAST_PRCS_DEPT_CD = #LAST_PRCS_DEPT_CD# /* 최종거래부서코드 */ ,  LAST_MENU_ID = #LAST_MENU_ID# /* 최종메뉴ID */ ,  LAST_MDFCN_DT = SYSDATE /* 최종수정일시 */ WHEN NOT MATCHED THEN INSERT INSERT ( CVLCPT_ADT_YR , ADT_NO , ADT_STP_SECD , CVLCPT_DOC_ID , FRS_MDM_SQNO , ATRZ_DMND_ID , ATRZ_STTS_SECD , RQSTR_ID , EDT_PRM_YMD , EDT_PRM_DT , FRST_USER_ID , LAST_USER_ID , LAST_PRCS_DEPT_CD , LAST_MENU_ID , FRST_REG_DT , LAST_MDFCN_DT ) VALUES ( #CVLCPT_ADT_YR# , #ADT_NO# , #ADT_STP_SECD# , #CVLCPT_DOC_ID# , (SELECT NVL(MAX(AA.EDT_DMND_SQNO),0) + 1 AS EDT_DMND_SQNO /* 편집요청순번 */
FROM TB_BADDED149M AA WHERE AA.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND AA.ADT_NO = #ADT_NO# AND AA.ADT_STP_SECD = #ADT_STP_SECD# AND AA.CVLCPT_DOC_ID = #CVLCPT_DOC_ID#) , #ATRZ_DOC_NO# , DECODE(#APV_STA_CD# ,'20',DECODE((SELECT COUNT(*)
FROM TBDCMACM023L WHERE ATRZ_DOC_NO = #ATRZ_DOC_NO# AND APRVR_KDCD <> '1' AND APVR_SEQ <> 1 AND APV_DH IS NOT NULL AND SUBSTR(APVR_STA_CD, 0,1) = '2'),0,'20','25') ,#APV_STA_CD#) , #RQR_ID# , #EDT_PRM_YMD# , #EDT_PRM_DT# , #FRT_USR_ID# , #LAST_USER_ID# , #LAST_PRCS_DEPT_CD# , #LAST_MENU_ID# , SYSDATE , SYSDATE )