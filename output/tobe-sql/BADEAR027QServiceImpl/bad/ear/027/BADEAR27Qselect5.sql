SELECT DECODE(T2.CMO_INST_CD,'', '2', '1') AS CMO_INST_CD /* 소관청기관코드 */,
    NVL(F_ORG_INFO (T2.CMO_INST_CD,'1'),'일반회계 합계') AS F_ORG_INFO /* 기관별 */,
    SUM(1) AS 1 /* 합계-건수 */,
    SUM(CASE WHEN T1.DSPS_RQT_KDCD = '110' THEN NVL(T2.PNRT_PRSRV_AMT,0) ELSE 0 END) + SUM(CASE WHEN SUBSTRING(T1.DSPS_RQT_KDCD,1,1) = '3' THEN NVL(T2.PNRT_PRSRV_AMT,0) ELSE 0 END) + SUM(CASE WHEN T1.DSPS_RQT_KDCD IN ('610','620','621','623','625') THEN NVL(T2.PNRT_PRSRV_AMT,0) ELSE 0 END) + SUM(CASE WHEN SUBSTRING(T1.DSPS_RQT_KDCD,1,1) = '3' THEN (NVL(T2.RMBR_AMT,0)+NVL(T2.SPLP_AMT,0)) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN (SUBSTRING(T1.DSPS_RQT_KDCD,1,1) IN ('2','7') OR T1.DSPS_RQT_KDCD IN ('610','620','621','623','625')) THEN NVL(T2.NOP_CONT,0) ELSE 0 END) AS SUBSTRING /* 합계-인원, (통보(시정완료):625 추가 - 2016.11.23 yyh) */,
    SUM(CASE WHEN T1.DSPS_RQT_KDCD = '110' THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN T1.DSPS_RQT_KDCD = '110' THEN NVL(T2.PNRT_PRSRV_AMT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN SUBSTRING(T1.DSPS_RQT_KDCD,1,1) = '2' THEN 1 ELSE 0 END) AS SUBSTRING /* 징계-건수 */,
    SUM(CASE WHEN SUBSTRING(T1.DSPS_RQT_KDCD,1,1) = '2' THEN NVL(T2.NOP_CONT,0) ELSE 0 END) AS SUBSTRING /* 징계-인원 */,
    SUM(CASE WHEN SUBSTRING(T1.DSPS_RQT_KDCD,1,1) = '3' THEN 1 ELSE 0 END) AS SUBSTRING /* 시정-건수 */,
    SUM(CASE WHEN SUBSTRING(T1.DSPS_RQT_KDCD,1,1) = '3' THEN NVL(T2.PNRT_PRSRV_AMT,0) ELSE 0 END) AS SUBSTRING /* 시정-추징회수보전금액 */,
    SUM(CASE WHEN SUBSTRING(T1.DSPS_RQT_KDCD,1,1) = '3' THEN (NVL(T2.RMBR_AMT,0)+NVL(T2.SPLP_AMT,0)) ELSE 0 END) AS SUBSTRING /* 시정-환추급금액 */,
    SUM(CASE WHEN SUBSTRING(T1.DSPS_RQT_KDCD,1,1) = '4' THEN 1 ELSE 0 END) AS SUBSTRING /* 주의-건수 */,
    SUM(CASE WHEN SUBSTRING(T1.DSPS_RQT_KDCD,1,1) = '5' THEN 1 ELSE 0 END) AS SUBSTRING /* 개선-건수 */,
    SUM(CASE WHEN T1.DSPS_RQT_KDCD = '611' THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN T1.DSPS_RQT_KDCD IN ('610','620','621','623','625') THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN T1.DSPS_RQT_KDCD IN ('610','620','621','623','625') THEN NVL(T2.NOP_CONT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN T1.DSPS_RQT_KDCD IN ('610','620','621','623','625') THEN NVL(T2.PNRT_PRSRV_AMT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN SUBSTRING(T1.DSPS_RQT_KDCD,1,1) = '7' THEN 1 ELSE 0 END) AS SUBSTRING /* 고발및수사요청-건수 */,
    SUM(CASE WHEN SUBSTRING(T1.DSPS_RQT_KDCD,1,1) = '7' THEN NVL(T2.NOP_CONT,0) ELSE 0 END) AS SUBSTRING /* 고발및수사요청-인원 */
FROM TB_BADEAR001M T1 , TB_BADEAR002D T2 WHERE 1=1 AND T1.CVLCPT_ADT_YR = T2.ADT_YR AND T1.ADT_NO = T2.ADT_NO AND T1.DSPS_RQT_SQNO = T2.DSPS_RQT_SQNO AND NVL(T2.CFMTN_STTS_SECD, '0') != '0' AND T1.INST_SECD = '10' AND T2.ENFC_YMD BETWEEN #strStartFromDt# AND #strStartToDt# AND EXISTS ( SELECT 1
FROM TB_BADEAR003M T3 WHERE 1=1 AND T3.ADT_YR = T1.CVLCPT_ADT_YR AND T3.ADT_NO = T1.ADT_NO AND T3.DSPS_RQT_SQNO = T1.DSPS_RQT_SQNO AND T3.DSPS_RQT_ACNTG_SECD IN ('011', '100') ) AND SUBSTRING(T1.DSPS_RQT_KDCD,1,1) BETWEEN '1' AND '7' AND T1.DSPS_RQT_KDCD != '120' GROUP BY ROLLUP(T2.CMO_INST_CD) ORDER BY SORT_RANK DESC, COPT_OFI_CD_NM