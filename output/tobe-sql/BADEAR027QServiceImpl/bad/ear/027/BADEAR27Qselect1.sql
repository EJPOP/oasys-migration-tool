SELECT SRECS_REL_INST_CD AS SRECS_REL_INST_CD /* 심사재심의관계기관코드 */,
    REL_INST_NM /* 관계기관명 */,
    NVL(A_GUNSU,0)+NVL(B_GUNSU,0)+NVL(C_GUNSU,0) +NVL(D_GUNSU,0)+NVL(E_GUNSU,0)+NVL(F_GUNSU,0) +NVL(G_GUNSU,0)+NVL(H_GUNSU,0) AS A_GUNSU /* 합계_건수 */,
    NVL(A_AM,0)+NVL(C_AM,0)+NVL(G_AM,0) AS A_AM /* 합계_금액_상 */,
    NVL(B_PSON,0)+NVL(G_PSON,0)+NVL(H_PSON,0) AS B_PSON /* 합계_인원 */,
    NVL(A_AM2,0)+NVL(C_AM2,0)+NVL(G_AM2,0) AS A_AM2 /* 합계_금액_하 */,
    NVL(A_GUNSU,0) AS A_GUNSU /* 변상판정건수 */,
    NVL(A_AM,0) AS A_AM /* 변상판정 금액_상 */,
    NVL(A_AM2,0) AS A_AM2 /* 변상판정 금액_하 */,
    NVL(B_GUNSU,0) AS B_GUNSU /* 징계문책 건수 */,
    NVL(B_PSON,0) AS B_PSON /* 징계문책 인원 */,
    NVL(C_GUNSU,0) AS C_GUNSU /* 시정 건수 */,
    NVL(C_AM,0) AS C_AM /* 시정 금액_상 */,
    NVL(C_AM2,0) AS C_AM2 /* 시정 금액_하 */,
    NVL(D_GUNSU,0) AS D_GUNSU /* 주의 건수 */,
    NVL(E_GUNSU,0) AS E_GUNSU /* 개선 건수 */,
    NVL(F_GUNSU,0) AS F_GUNSU /* 권고 건수 */,
    NVL(G_GUNSU,0) AS G_GUNSU /* 통보 건수 */,
    NVL(G_PSON,0) AS G_PSON /* 통보 인원 */,
    NVL(G_AM,0) AS G_AM /* 통보 금액 상 - 2018.04.16 yyh */,
    NVL(G_AM2,0) AS G_AM2 /* 통보 금액 하 - 2018.04.16 yyh */,
    NVL(H_GUNSU,0) AS H_GUNSU /* 고발 건수 */,
    NVL(H_PSON,0) AS H_PSON /* 고발 인원 */,
    NVL(EXPT_EFCT_AMT,0) AS EXPT_EFCT_AMT /* 기대효과금액 */,
    NVL(IJS_AMT,0) AS IJS_AMT /* 부당금액 */
FROM ( SELECT RLTN.SRECS_REL_INST_CD /* 심사재심의관계기관코드 */,
    F_ORG_INFO(RLTN.SRECS_REL_INST_CD,'1') AS REL_INST_NM /* 관계기관명 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD = '110' THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD = '110' THEN NVL(DETAIL.PNRT_PRSRV_AMT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD = '210' THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD = '210' THEN NVL(DETAIL.NOP_CONT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN SUBSTR(MASTER.DSPS_RQT_KDCD,1,1) = '3' THEN 1 ELSE 0 END) AS SUBSTR /* 시정 건수 */,
    SUM(CASE WHEN SUBSTR(MASTER.DSPS_RQT_KDCD,1,1) = '3' THEN NVL(DETAIL.PNRT_PRSRV_AMT,0) ELSE 0 END) AS SUBSTR /* 시정 금액 */,
    SUM(CASE WHEN SUBSTR(MASTER.DSPS_RQT_KDCD,1,1) = '4' THEN 1 ELSE 0 END) AS SUBSTR /* 주의 건수 */,
    SUM(CASE WHEN SUBSTR(MASTER.DSPS_RQT_KDCD,1,1) = '5' THEN 1 ELSE 0 END) AS SUBSTR /* 개선 건수 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD = '611' THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('610','620','621','623','630','625') THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('610','620','621','623','630','625') THEN NVL(DETAIL.NOP_CONT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('610','620','621','623','630','625') THEN NVL(DETAIL.PNRT_PRSRV_AMT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('610','620','621','623','630','625') THEN NVL(DETAIL.RMBR_AMT,0) + NVL(DETAIL.SPLP_AMT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('710','720','730') THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('710','720','730') THEN NVL(DETAIL.NOP_CONT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM( NVL(DETAIL.BGT_RTRC_AMT,0)+ NVL(DETAIL.INCM_INCRS_AMT,0)+ NVL(DETAIL.PPL_BRDN_RDT_AMT,0)) AS EXPT_EFCT_AMT /* 기대효과금액 */,
    SUM( NVL(DETAIL.IJS_AMT,0)) AS IJS_AMT /* 부당금액 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD = '110' THEN NVL(DETAIL.RMBR_AMT,0)+NVL(DETAIL.SPLP_AMT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('310','320','390','391','395','396') THEN NVL(DETAIL.RMBR_AMT,0)+NVL(DETAIL.SPLP_AMT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */
FROM TBBADEAR001M MASTER ,TBBADEAR002D DETAIL ,(SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    SRECS_REL_INST_CD /* 심사재심의관계기관코드 */
FROM TBBADEAR008M WHERE 1=1 AND SRECS_REL_INST_CD BETWEEN NVL(#strRltnOrgCdF#,'000')||'000000000' AND NVL(#strRltnOrgCdT#,'ZZZ') ||'000000000' GROUP BY CVLCPT_ADT_YR ,ADT_NO ,DSPS_RQT_SQNO ,SRECS_REL_INST_CD) RLTN WHERE MASTER.CVLCPT_ADT_YR = DETAIL.CVLCPT_ADT_YR AND MASTER.ADT_NO = DETAIL.ADT_NO AND MASTER.DSPS_RQT_SQNO = DETAIL.DSPS_RQT_SQNO AND MASTER.CVLCPT_ADT_YR = RLTN.CVLCPT_ADT_YR(+) AND MASTER.ADT_NO = RLTN.ADT_NO(+) AND MASTER.DSPS_RQT_SQNO = RLTN.DSPS_RQT_SQNO(+) AND DETAIL.ENFC_YMD BETWEEN #strStartFromDt# AND #strStartToDt# /*화면 시행기간범위 FROM~ TO*/ AND MASTER.DSPS_RQT_KDCD AND MASTER.INST_SECD = '10' AND MASTER.INST_SECD IN ('21', '22') AND MASTER.INST_SECD = '30' AND (MASTER.INST_SECD NOT IN ('10', '21', '22', '30') OR MASTER.INST_SECD IS NULL) AND ( 1=1 OR EXISTS (SELECT 1
FROM TBBADEAR003M ACNT WHERE ACNT.CVLCPT_ADT_YR = MASTER.CVLCPT_ADT_YR AND ACNT.ADT_NO = MASTER.ADT_NO AND ACNT.DSPS_RQT_SQNO = MASTER.DSPS_RQT_SQNO AND( ( NVL(MASTER.INST_SECD, ' ') IN('10', '30') AND NVL(SUBSTR(DETAIL.VIOL_CS_SECD, 1, 1), ' ') = '1' AND ( ( SUBSTR(DETAIL.ENFC_YMD, 1, 6) >= SUBSTR(#strStartFromDt#,1,4)||'01' /*화면 시행기간범위 FROM*/ AND SUBSTR(DETAIL.ENFC_YMD, 1, 6) = SUBSTR(#strStartFromDt#,1,6) /*화면 시행기간범위 FROM*/ AND SUBSTR(DETAIL.ENFC_YMD, 1, 6) = SUBSTR(#strStartFromDt#,1,6) /*화면 시행기간범위 FROM*/ AND SUBSTR(DETAIL.ENFC_YMD, 1, 6) <= SUBSTR(#strStartToDt#,1,6) /*화면 시행기간범위 TO*/ ) ) ) ) GROUP BY RLTN.SRECS_REL_INST_CD ) ORDER BY SRECS_REL_INST_CD