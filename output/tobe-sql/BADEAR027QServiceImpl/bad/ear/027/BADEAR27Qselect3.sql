SELECT NVL(T1.HOIGYE_NM1, '총계') AS HOIGYE_NM1,
    NVL(T1.HOIGYE_NM, DECODE(T1.HOIGYE_NM1,'','[총 계]', '['||T1.HOIGYE_NM1 || ' 소계]')) AS HOIGYE_NM,
    SUM(T1.T_GUNSU) AS T_GUNSU,
    SUM(T1.T_AM) AS T_AM,
    SUM(T1.T_PSON) AS T_PSON,
    SUM(T1.T_AM2) AS T_AM2,
    SUM(T1.A_GUNSU) AS A_GUNSU,
    SUM(T1.A_AM) AS A_AM,
    SUM(T1.A_AM2) AS A_AM2,
    SUM(T1.B_GUNSU) AS B_GUNSU,
    SUM(T1.B_PSON) AS B_PSON,
    SUM(T1.C_GUNSU) AS C_GUNSU,
    SUM(T1.C_AM) AS C_AM,
    SUM(T1.C_AM2) AS C_AM2,
    SUM(T1.D_GUNSU) AS D_GUNSU,
    SUM(T1.E_GUNSU) AS E_GUNSU,
    SUM(T1.F_GUNSU) AS F_GUNSU,
    SUM(T1.G_GUNSU) AS G_GUNSU,
    SUM(T1.G_PSON) AS G_PSON,
    SUM(T1.G_AM) AS G_AM,
    SUM(T1.G_AM2) AS G_AM2,
    SUM(T1.H_GUNSU) AS H_GUNSU,
    SUM(T1.H_PSON) AS H_PSON
FROM ( SELECT A.HOIGYE_CD AS HOIGYE_CD,
    A.HOIGYE_NM AS HOIGYE_NM,
    CASE WHEN A.HOIGYE_NM LIKE '%특별회계' THEN '특별회계' WHEN A.HOIGYE_NM LIKE '%기금' THEN '기금' ELSE A.HOIGYE_NM END AS HOIGYE_NM,
    NVL(A_GUNSU,0)+NVL(B_GUNSU,0)+NVL(C_GUNSU,0) +NVL(D_GUNSU,0)+NVL(E_GUNSU,0)+NVL(F_GUNSU,0) +NVL(G_GUNSU,0)+NVL(H_GUNSU,0) AS A_GUNSU,
    NVL(A_AM,0)+NVL(C_AM,0)+NVL(G_AM,0) AS A_AM,
    NVL(B_PSON,0)+NVL(G_PSON,0)+NVL(H_PSON,0) AS B_PSON,
    NVL(A_AM2,0)+NVL(C_AM2,0)+NVL(G_AM2,0) AS A_AM2,
    NVL(A_GUNSU,0) AS A_GUNSU,
    NVL(A_AM,0) AS A_AM,
    NVL(A_AM2,0) AS A_AM2,
    NVL(B_GUNSU,0) AS B_GUNSU,
    NVL(B_PSON,0) AS B_PSON,
    NVL(C_GUNSU,0) AS C_GUNSU,
    NVL(C_AM,0) AS C_AM,
    NVL(C_AM2,0) AS C_AM2,
    NVL(D_GUNSU,0) AS D_GUNSU,
    NVL(E_GUNSU,0) AS E_GUNSU,
    NVL(F_GUNSU,0) AS F_GUNSU,
    NVL(G_GUNSU,0) AS G_GUNSU,
    NVL(G_PSON,0) AS G_PSON,
    NVL(G_AM,0) AS G_AM,
    NVL(G_AM2,0) AS G_AM2,
    NVL(H_GUNSU,0) AS H_GUNSU,
    NVL(H_PSON,0) AS H_PSON
FROM ( SELECT CASE WHEN TRIM(ACNT.DSPS_RQT_ACNTG_SECD) IS NULL THEN '999' ELSE NVL(ACNT.DSPS_RQT_ACNTG_SECD,'999') END AS TRIM,
    CASE WHEN (CASE WHEN TRIM(ACNT.DSPS_RQT_ACNTG_SECD) IS NULL THEN '999' ELSE NVL(ACNT.DSPS_RQT_ACNTG_SECD,'999') END) = '999' THEN '기타' ELSE F_CODE_NM('1000004', ACNT.DSPS_RQT_ACNTG_SECD) END AS TRIM,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD = '110' THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD = '110' THEN NVL(DETAIL.PNRT_PRSRV_AMT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD = '210' THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD = '210' THEN NVL(DETAIL.NOP_CONT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN SUBSTR(MASTER.DSPS_RQT_KDCD,1,1) = '3' THEN 1 ELSE 0 END) AS SUBSTR /* 시정 건수 */,
    SUM(CASE WHEN SUBSTR(MASTER.DSPS_RQT_KDCD,1,1) = '3' THEN NVL(DETAIL.PNRT_PRSRV_AMT,0) ELSE 0 END) AS SUBSTR /* 시정 금액 */,
    SUM(CASE WHEN SUBSTR(MASTER.DSPS_RQT_KDCD,1,1) = '4' THEN 1 ELSE 0 END) AS SUBSTR /* 주의 건수 */,
    SUM(CASE WHEN SUBSTR(MASTER.DSPS_RQT_KDCD,1,1) = '5' THEN 1 ELSE 0 END) AS SUBSTR /* 개선 건수 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD = '611' THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('610','620','621','623','630','625') THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('610','620','621','623','630','625') THEN NVL(DETAIL.PNRT_PRSRV_AMT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('610','620','621','623','630','625') THEN NVL(DETAIL.RMBR_AMT,0) + NVL(DETAIL.SPLP_AMT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('620','621','623') THEN NVL(DETAIL.NOP_CONT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('710','720','730') THEN 1 ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD IN ('710','720','730') THEN NVL(DETAIL.NOP_CONT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN MASTER.DSPS_RQT_KDCD = '110' THEN NVL(DETAIL.RMBR_AMT,0)+NVL(DETAIL.SPLP_AMT,0) ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN SUBSTR(MASTER.DSPS_RQT_KDCD,1,1) = '3' AND MASTER.DSPS_RQT_KDCD IN ('110', '310', '320', '390', '391','395','396') THEN NVL(DETAIL.RMBR_AMT,0)+NVL(DETAIL.SPLP_AMT,0) ELSE 0 END) AS SUBSTR /* 시정 금액2 */
FROM TBBADEAR001M MASTER ,TBBADEAR002D DETAIL ,(SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    MIN(DSPS_RQT_ACNTG_SECD) AS DSPS_RQT_ACNTG_SECD /* 처분요구회계구분코드 */
FROM TBBADEAR003M GROUP BY CVLCPT_ADT_YR ,ADT_NO ,DSPS_RQT_SQNO ) ACNT WHERE MASTER.CVLCPT_ADT_YR = DETAIL.CVLCPT_ADT_YR AND MASTER.ADT_NO = DETAIL.ADT_NO AND MASTER.DSPS_RQT_SQNO = DETAIL.DSPS_RQT_SQNO AND MASTER.CVLCPT_ADT_YR = ACNT.CVLCPT_ADT_YR(+) AND MASTER.ADT_NO = ACNT.ADT_NO(+) AND MASTER.DSPS_RQT_SQNO = ACNT.DSPS_RQT_SQNO(+) AND DETAIL.ENFC_YMD BETWEEN #strStartFromDt# AND #strStartToDt# /*화면 시행기간범위 FROM~ TO*/ AND EXISTS (SELECT 1
FROM TBBADEAR008M WHERE 1=1 AND SRECS_REL_INST_CD BETWEEN NVL(#strRltnOrgCdF#,'000')||'000000000' AND NVL(#strRltnOrgCdT#,'ZZZ') ||'000000000' AND MASTER.CVLCPT_ADT_YR = CVLCPT_ADT_YR AND MASTER.ADT_NO = ADT_NO AND MASTER.DSPS_RQT_SQNO = DSPS_RQT_SQNO ) AND MASTER.INST_SECD = '10' AND MASTER.INST_SECD IN ('21', '22') AND MASTER.INST_SECD = '30' AND (MASTER.INST_SECD NOT IN ('10', '21', '22', '30') OR MASTER.INST_SECD IS NULL) AND MASTER.DSPS_RQT_KDCD NOT IN ('904','905') AND NVL(DETAIL.CFMTN_STTS_SECD,'0') != '0' AND ( 1=1 OR EXISTS (SELECT 1
FROM TBBADEAR003M ACNT WHERE ACNT.CVLCPT_ADT_YR = MASTER.CVLCPT_ADT_YR AND ACNT.ADT_NO = MASTER.ADT_NO AND ACNT.DSPS_RQT_SQNO = MASTER.DSPS_RQT_SQNO AND( ( NVL(MASTER.INST_SECD, ' ') IN('10', '30') AND NVL(SUBSTR(DETAIL.VIOL_CS_SECD, 1, 1), ' ') = '1' AND ( ( SUBSTR(DETAIL.ENFC_YMD, 1, 6) >= SUBSTR(#strStartFromDt#,1,4)||'01' /*화면 시행기간범위 FROM*/ AND SUBSTR(DETAIL.ENFC_YMD, 1, 6) = SUBSTR(#strStartFromDt#,1,6) /*화면 시행기간범위 FROM*/ AND SUBSTR(DETAIL.ENFC_YMD, 1, 6) = SUBSTR(#strStartFromDt#,1,6) /*화면 시행기간범위 FROM*/ AND SUBSTR(DETAIL.ENFC_YMD, 1, 6) <= SUBSTR(#strStartToDt#,1,6) /*화면 시행기간범위 TO*/ ) ) ) ) GROUP BY CASE WHEN TRIM(ACNT.DSPS_RQT_ACNTG_SECD) IS NULL THEN '999' ELSE NVL(ACNT.DSPS_RQT_ACNTG_SECD,'999') END ,CASE WHEN (CASE WHEN TRIM(ACNT.DSPS_RQT_ACNTG_SECD) IS NULL THEN '999' ELSE NVL(ACNT.DSPS_RQT_ACNTG_SECD,'999') END) = '999' THEN '기타' ELSE F_CODE_NM('1000004', ACNT.DSPS_RQT_ACNTG_SECD) END ) A ) T1 GROUP BY ROLLUP(T1.HOIGYE_NM1, T1.HOIGYE_NM) ORDER BY T1.HOIGYE_NM1, T1.HOIGYE_NM