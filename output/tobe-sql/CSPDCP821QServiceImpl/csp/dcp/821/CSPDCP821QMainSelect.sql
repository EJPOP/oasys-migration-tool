WITH TBCSPDCP815 AS (SELECT *
FROM TB_CSPDCP815L T1 WHERE (T1.CVLCPT_DCLR_SECD, T1.CVLCPT_RCPT_YR, T1.CVLCPT_DCLR_RCPT_NO, T1.FRS_MDM_SQNO) IN ( SELECT Z.CVLCPT_DCLR_SECD /* 민원신고구분코드 */,
    Z.CVLCPT_RCPT_YR /* 민원접수년도 */,
    Z.CVLCPT_DCLR_RCPT_NO /* 민원신고접수번호 */,
    MIN(Z.CVLCPT_SQNO) AS FRS_MDM_SQNO /* 포렌식매체순번 */
FROM TB_CSPDCP815L Z WHERE T1.CVLCPT_DCLR_SECD = Z.CVLCPT_DCLR_SECD AND T1.CVLCPT_RCPT_YR = Z.CVLCPT_RCPT_YR AND T1.CVLCPT_DCLR_RCPT_NO = Z.CVLCPT_DCLR_RCPT_NO GROUP BY Z.CVLCPT_DCLR_SECD, Z.CVLCPT_RCPT_YR, Z.CVLCPT_DCLR_RCPT_NO )) SELECT T1.CVLCPT_DCLR_SECD /* 민원신고구분코드 */,
    T1.CVLCPT_RCPT_YR /* 민원접수년도 */,
    T1.CVLCPT_DCLR_RCPT_NO /* 민원신고접수번호 */,
    DECODE(T1.CRU_ACTL_RCPT_NO,NULL,NULL,T1.CVLCPT_RCPT_YR||'-'||'청금-'||T1.CRU_ACTL_RCPT_NO) AS NTFCTN_RCPT_SQNO /* 통보접수순번 */,
    T1.CRU_HMPG_APLY_NO /* 부패누리집신청번호 */,
    T1.SLCT_DCLR_KDCD /* 청탁신고종류코드 */,
    F_CODE_NM('1000758',T1.SLCT_DCLR_KDCD) AS F_CODE_NM,
    T1.CRU_DCLR_KND_DTL_SECD /* 부패신고종류상세구분코드 */,
    F_CODE_NM('1000759',T1.CRU_DCLR_KND_DTL_SECD) AS F_CODE_NM,
    T1.INFO_RLPR_NM /* 정보관계자명 */,
    CASE WHEN ( SELECT COUNT(*)
FROM TB_CSPDCP819L S1 WHERE S1.CVLCPT_DCLR_SECD = T1.CVLCPT_DCLR_SECD AND S1.CVLCPT_RCPT_YR = T1.CVLCPT_RCPT_YR AND S1.CVLCPT_DCLR_RCPT_NO = T1.CVLCPT_DCLR_RCPT_NO ) > 0 THEN T1.RSCH_ASMT_TTL||'(합건 : '|| ( SELECT AGGR_CONCAT(S3.CVLCPT_RCPT_YR||'-청금-'||S3.SLCT_ACTL_RCPT_NO, ', ')||' )' AS CVLCPT_RCPT_YR /* 민원접수년도 */
FROM TB_CSPDCP819L S2, TB_CSPDCP811M S3 WHERE T1.CVLCPT_DCLR_SECD = S2.CVLCPT_DCLR_SECD AND T1.CVLCPT_RCPT_YR = S2.CVLCPT_RCPT_YR AND T1.CVLCPT_DCLR_RCPT_NO = S2.CVLCPT_DCLR_RCPT_NO AND S2.CVLCPT_MCA_DCLR_SECD = S3.CVLCPT_DCLR_SECD AND S2.TPOF_MCA_RCPT_YR = S3.CVLCPT_RCPT_YR AND S2.CVLCPT_MCA_DCLR_RCPT_NO = S3.CVLCPT_DCLR_RCPT_NO ) WHEN ( SELECT COUNT(*)
FROM TB_CSPDCP819L S1 WHERE S1.CVLCPT_MCA_DCLR_SECD = T1.CVLCPT_DCLR_SECD AND S1.TPOF_MCA_RCPT_YR = T1.CVLCPT_RCPT_YR AND S1.CVLCPT_MCA_DCLR_RCPT_NO = T1.CVLCPT_DCLR_RCPT_NO) > 0 THEN T1.RSCH_ASMT_TTL ||'(합건 : '|| ( SELECT S3.CVLCPT_RCPT_YR||'-청금-'||S3.SLCT_ACTL_RCPT_NO AS CVLCPT_RCPT_YR /* 민원접수년도 */
FROM TB_CSPDCP819L S2, TB_CSPDCP811M S3 WHERE S2.CVLCPT_DCLR_SECD = S3.CVLCPT_DCLR_SECD AND S2.CVLCPT_RCPT_YR = S3.CVLCPT_RCPT_YR AND S2.CVLCPT_DCLR_RCPT_NO = S3.CVLCPT_DCLR_RCPT_NO AND S2.CVLCPT_MCA_DCLR_SECD = T1.CVLCPT_DCLR_SECD AND S2.TPOF_MCA_RCPT_YR = T1.CVLCPT_RCPT_YR AND S2.CVLCPT_MCA_DCLR_RCPT_NO = T1.CVLCPT_DCLR_RCPT_NO ) || ( SELECT ', '||AGGR_CONCAT(S4.CVLCPT_RCPT_YR||'-청금-'||S4.SLCT_ACTL_RCPT_NO, ', ') AS CVLCPT_RCPT_YR /* 민원접수년도 */
FROM TB_CSPDCP819L S2, TB_CSPDCP819L S3, TB_CSPDCP811M S4 WHERE S2.CVLCPT_MCA_DCLR_SECD = T1.CVLCPT_DCLR_SECD AND S2.TPOF_MCA_RCPT_YR = T1.CVLCPT_RCPT_YR AND S2.CVLCPT_MCA_DCLR_RCPT_NO = T1.CVLCPT_DCLR_RCPT_NO AND S2.CVLCPT_DCLR_SECD = S3.CVLCPT_DCLR_SECD AND S2.CVLCPT_RCPT_YR = S3.CVLCPT_RCPT_YR AND S2.CVLCPT_DCLR_RCPT_NO = S3.CVLCPT_DCLR_RCPT_NO AND S3.CVLCPT_MCA_DCLR_SECD = S4.CVLCPT_DCLR_SECD AND S3.TPOF_MCA_RCPT_YR = S4.CVLCPT_RCPT_YR AND S3.CVLCPT_MCA_DCLR_RCPT_NO = S4.CVLCPT_DCLR_RCPT_NO AND (S4.CVLCPT_DCLR_SECD, S4.CVLCPT_RCPT_YR, S4.CVLCPT_DCLR_RCPT_NO) <> (T1.CVLCPT_DCLR_SECD, T1.CVLCPT_RCPT_YR, T1.CVLCPT_DCLR_RCPT_NO) )||')' ELSE T1.RSCH_ASMT_TTL END AS RSCH_ASMT_TTL ,TO_CHAR(T1.CRU_RCPT_DT,'YYYY-MM-DD HH24:MI') AS CRU_RCPT_DT ,TO_CHAR(T1.FRST_REG_DT,'YYYY-MM-DD HH24:MI') AS FRST_REG_DT ,T1.CRU_RCPT_PATH_SECD ,F_CODE_NM('1000761',T1.CRU_RCPT_PATH_SECD) AS ACP_RUT_NM ,T1.CRU_PRCS_STTS_SECD ,F_CODE_NM('1000760',T1.CRU_PRCS_STTS_SECD) AS PRCS_STTS_NM ,T1.CRU_ACTL_RCPT_NO ,TO_CHAR(T3.TPOF_LAST_PRCS_DT,'YYYY-MM-DD HH24:MI') AS TPOF_LAST_PRCS_DT ,TO_CHAR(TO_DATE(F_GET_NEXT_WORK_DT(TO_CHAR(T1.CRU_RCPT_DT, 'YYYYMMDD'),31)),'YYYY-MM-DD') AS HNDL_LIMIT__DT ,TO_CHAR(T1.CRU_DEL_DT,'YYYY-MM-DD HH24:MI') AS CRU_DEL_DT ,T2.CRU_RPPS_NM ,T2.CRU_RPPS_TELNO ,T2.SLCT_RPPS_CR_NM ,T2.CRU_RPPS_ADDR ,T2.SLCT_CVLPR_CORP_NM ,T1.SLCT_CVLPR_CR_NM ,T1.OTSD_EXPRT_ADDR ,T1.CRU_TELNO ,( SELECT COUNT(*)
FROM TB_CSPDCP811M S1 WHERE S1.CVLCPT_DCLR_SECD = '1' AND S1.CRU_RRNO_SCRTY = T1.CRU_RRNO_SCRTY ) AS JEBOCNT ,F_DPT_INFO(T1.CRU_RCPT_DEPT_CD,'1') AS ACP_DPT_NM ,F_DPT_INFO(T3.ETC_LBSVC_MNG_DEPT_CD,'1') AS PRCS_DEPT_NM ,F_USR_INFO_BY_ID(T3.PRCS_PIC_ID,'2') AS HNDL_CHGR_NAM ,F_CODE_NM(T4.PRCS_SECD,'1000764') AS HNDL_DVSN_NM ,F_DPT_INFO(T4.TRNF_DEPT_CD,'1') AS TRNF_DPT_NM ,( SELECT F_ORG_INFO(MIN(S1.SLCT_INST_CD),'1') AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TB_CSPDCP816L S1 WHERE T4.CVLCPT_DCLR_SECD = S1.CVLCPT_DCLR_SECD AND T4.CVLCPT_RCPT_YR = S1.CVLCPT_RCPT_YR AND T4.CVLCPT_DCLR_RCPT_NO = S1.CVLCPT_DCLR_RCPT_NO AND T4.FRS_MDM_SQNO = S1.FRS_MDM_SQNO ) AS TRNF_ORG_NM ,T1.SLCT_EXMN_AGRE_YN FROM TB_CSPDCP811M T1 ,TB_CSPDCP812M T2 ,TB_CSPDCP813M T3 ,TBCSPDCP815 T4 WHERE T1.CVLCPT_DCLR_SECD = '1' AND T1.CVLCPT_DCLR_SECD = T2.CVLCPT_DCLR_SECD AND T1.CVLCPT_RCPT_YR = T2.CVLCPT_RCPT_YR AND T1.CVLCPT_DCLR_RCPT_NO = T2.CVLCPT_DCLR_RCPT_NO AND T1.CVLCPT_DCLR_SECD = T3.CVLCPT_DCLR_SECD(+) AND T1.CVLCPT_RCPT_YR = T3.CVLCPT_RCPT_YR(+) AND T1.CVLCPT_DCLR_RCPT_NO = T3.CVLCPT_DCLR_RCPT_NO(+) AND T1.CVLCPT_DCLR_SECD = T4.CVLCPT_DCLR_SECD(+) AND T1.CVLCPT_RCPT_YR = T4.CVLCPT_RCPT_YR(+) AND T1.CVLCPT_DCLR_RCPT_NO = T4.CVLCPT_DCLR_RCPT_NO(+) AND T1.CVLCPT_RCPT_YR = #CVLCPT_RCPT_YR# AND T1.CRU_ACTL_RCPT_NO = #CRU_ACTL_RCPT_NO# AND TO_CHAR(T1.CRU_RCPT_DT,'YYYYMMDD') &gt;= #strACP_DHS# AND TO_CHAR(T1.CRU_RCPT_DT,'YYYYMMDD') &lt;= #strACP_DHE# AND T1.SLCT_DCLR_KDCD = #SLCT_DCLR_KDCD# AND T1.CRU_DCLR_KND_DTL_SECD = #CRU_DCLR_KND_DTL_SECD# AND T1.CRU_PRCS_STTS_SECD = #CRU_PRCS_STTS_SECD# AND T1.RSCH_ASMT_TTL LIKE '%'||#strTIT_NM#||'%' AND T1.INFO_RLPR_NM LIKE '%'||#strNAM#||'%' AND T1.CRU_PRCS_STTS_SECD IN ('9','10') AND T1.CRU_PRCS_STTS_SECD NOT IN ('9','10') ORDER BY T1.CVLCPT_RCPT_YR DESC,TO_NUMBER(T1.CRU_ACTL_RCPT_NO) DESC