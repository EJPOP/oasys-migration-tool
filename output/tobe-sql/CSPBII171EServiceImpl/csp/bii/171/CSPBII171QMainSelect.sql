SELECT B.USER_NM /* 사용자명 */,
    F_CODE_NM('1000173', B.JBGD_SECD) AS JBGD_NM /* 직급명 */,
    C.ABR_DPT_NM_1 AS CNSTN_MBCMT_DEPT_NM,
    (SELECT count(*)
FROM TB_CSPBII100M M WHERE M.PRSNR_ENO = A.INFO_PRSNR_ENO AND M.ADT_INFO_PRGRS_STTS_SECD NOT IN ('15','20','99') AND M.SBMSN_YMD BETWEEN #strStrDt# AND #strEndDt# AND M.ADT_INFO_PRGRS_STTS_SECD >= '05') AS SBMSN_NOCS /* 제출건수(평가중) */ , (SELECT count(*)
FROM TB_CSPBII100M M WHERE M.PRSNR_ENO = A.INFO_PRSNR_ENO AND M.ADT_INFO_PRGRS_STTS_SECD IN ('15','20','99') AND M.SBMSN_YMD BETWEEN #strStrDt# AND #strEndDt# AND M.ADT_INFO_PRGRS_STTS_SECD >= '05' AND M.PRCS_DRCTN_SECD != '7') AS SMT_NOC_CPT /* 제출건수(평가완료) */ , (SELECT count(*)
FROM TB_CSPBII100M M WHERE M.PRSNR_ENO = A.INFO_PRSNR_ENO AND M.ADT_INFO_PRGRS_STTS_SECD IN ('15','20','99') AND M.SBMSN_YMD BETWEEN #strStrDt# AND #strEndDt# AND M.ADT_INFO_PRGRS_STTS_SECD >= '05' AND M.PRCS_DRCTN_SECD = '7' ) AS SMT_DEL_CPT /* 폐기건수 */ , A.MLG_TSC_CONT + CRFW_SCR + CRFW_QLT_SCR AS MLG_SUM_CNT /* 마일리지합계총점수(마일리지총점수 + 이월점수) */ , A.MLG_TSC_CONT /* 마일리지총점수 */ , A.CRFW_SCR /* 이월점수 */ , A.CRFW_QLT_SCR /* 이월품질점수 */ , A.SBMSN_WHOL_SCR /* 제출총점수 */ , A.SBMSN_ADD_WHOL_SCR /* 제출추가총점수 */ , A.CTGRY_ADD_TSC /* 분류추가총점수 */ , A.SPCF_INFO_ADD_WHOL_SCR /* 특정정보추가총점수 */ , A.UTLZ_ADD_WHOL_SCR /* 활용추가총점수 */ , A.PRCS_ADD_TSC_CONT /* 처리추가총점수 */ , A.GNRL_ADSC_WHOL_CONT /* 일반가점총점수 */ , A.DEPT_INFO_WHOL_SCR /* 부서정보총점수 */ , A.QLT_ADSC_WHOL_CONT /* 품질가점총점수 */ , A.MLG_ADD_WHOL_NOCS /* 마일리지추가총건수 */ , A.#N/A /* 분기마일리지수1 */ , A.#N/A /* 분기마일리지수2 */ /*, F_GET_MLG_QR_GL_SC(A.YE,A.QR_DVSN_CD,A.CNB) AS USR_QR_GL_SC 사용자용분기목표점수 */ , A.QTR_GOAL_SCR /* 분기목표점수 */ , A.MLG_RMRK_CN /* 마일리지비고 */ , DECODE(A.SBMSN_DEPT_WORK_YN_1, '1', 1, 0) + DECODE(A.SBMSN_DEPT_WORK_YN_2, '1', 1, 0) + DECODE(A.SBMSN_DEPT_WORK_YN_3, '1', 1, 0) + DECODE(A.SBMSN_DEPT_WORK_YN_4, '1', 1, 0) + DECODE(A.SBMSN_DEPT_WORK_YN_5, '1', 1, 0) + DECODE(A.SBMSN_DEPT_WORK_YN_6, '1', 1, 0) AS WRK_MN_CNT /* 근무월수 */ , CASE A.SBMSN_DEPT_WORK_YN_1 WHEN '1' THEN 'Y' WHEN '0' THEN 'N' ELSE '-' END AS SBMSN_DEPT_WORK_YN_1 /* 제출부서근무여부1 */ , CASE A.SBMSN_DEPT_WORK_YN_2 WHEN '1' THEN 'Y' WHEN '0' THEN 'N' ELSE '-' END AS SBMSN_DEPT_WORK_YN_2 /* 제출부서근무여부2 */ , CASE A.SBMSN_DEPT_WORK_YN_3 WHEN '1' THEN 'Y' WHEN '0' THEN 'N' ELSE '-' END AS SBMSN_DEPT_WORK_YN_3 /* 제출부서근무여부3 */ , CASE A.SBMSN_DEPT_WORK_YN_4 WHEN '1' THEN 'Y' WHEN '0' THEN 'N' ELSE '-' END AS SBMSN_DEPT_WORK_YN_4 /* 제출부서근무여부4 */ , CASE A.SBMSN_DEPT_WORK_YN_5 WHEN '1' THEN 'Y' WHEN '0' THEN 'N' ELSE '-' END AS SBMSN_DEPT_WORK_YN_5 /* 제출부서근무여부5 */ , CASE A.SBMSN_DEPT_WORK_YN_6 WHEN '1' THEN 'Y' WHEN '0' THEN 'N' ELSE '-' END AS SBMSN_DEPT_WORK_YN_6 /* 제출부서근무여부6 */ , A.INFO_YR , A.INFO_MLG_QTR_SECD , A.INFO_PRSNR_ENO ,B.CNSTN_MBCMT_HOME_TELNO ,CASE WHEN ( QTR_GOAL_SCR - (MLG_TSC_CONT + CRFW_SCR + CRFW_QLT_SCR)) > 0 THEN QTR_GOAL_SCR - (MLG_TSC_CONT + CRFW_SCR + CRFW_QLT_SCR) ELSE 0 END QTR_SHFA_ADD_SCR , (SELECT CRNT_GD_APM_DT
FROM TBDCMACM903O S1 WHERE S1.CRU_RRNO_SCRTY = B.CRU_RRNO_SCRTY) AS CRNT_DPT_APM_DT , F_CODE_NM('1000176',B.JBPS_CD) AS JBPS_NM , GEN_ADMN_DVSN_CD , F_CODE_NM('1000852',GEN_ADMN_DVSN_CD) AS GEN_ADMN_DVSN_NM , CASE WHEN A.INFO_MLG_QTR_SECD IN ('1','3') THEN 0 ELSE (SELECT S1.MLG_TSC_CONT + S1.PRCS_ADD_TSC_CONT AS MLG_TSC_CONT /* 마일리지총점개수 */
FROM TB_CSPBII160L S1 WHERE S1.TRGT_NOP_ENO = A.INFO_PRSNR_ENO AND S1.INFO_YR = A.INFO_YR AND S1.INFO_MLG_QTR_SECD = A.INFO_MLG_QTR_SECD-1 ) END AS BK_QR_MLG_CNT , NVL(EVL_RSLT_SECD,'0') AS EVL_RSLT_SECD , NVL(ELY_SBMSN_ADD_SCR,0) AS ELY_SBMSN_ADD_SCR /* 조기가점 */ , NVL(CTGRY_ADD_SCR,0) AS CTGRY_ADD_SCR /* 모범가점 */ , NVL(SPCF_INFO_ADD_SCR,0) AS SPCF_INFO_ADD_SCR /* 특정가점 */ , NVL(BARON_ADD_SCR,0) AS BARON_ADD_SCR /* 바론가점 */ FROM TB_CSPBII160L A , TBDCMACM001M B , TBDCMACM002M C , (SELECT SUM(ELY_SBMSN_ADD_SCR) AS ELY_SBMSN_ADD_SCR /* 조기제출추가점수 */,
    SUM(CTGRY_ADD_SCR) AS CTGRY_ADD_SCR /* 범주추가점수 */,
    SUM(SPCF_INFO_ADD_SCR) AS SPCF_INFO_ADD_SCR /* 특정정보추가점수 */,
    SUM(BARON_ADD_SCR) AS BARON_ADD_SCR /* 바론추가점수 */,
    PRSNR_ENO /* 제출자직원전산번호 */
FROM (SELECT PRSNR_ENO /* 제출자직원전산번호 */,
    NVL(ELY_SBMSN_ADD_SCR, 0) AS ELY_SBMSN_ADD_SCR /* 조기제출추가점수 */,
    NVL(CTGRY_ADD_SCR, 0) AS CTGRY_ADD_SCR /* 범주추가점수 */,
    NVL(SPCF_INFO_ADD_SCR, 0) AS SPCF_INFO_ADD_SCR /* 특정정보추가점수 */,
    NVL(BARON_ADD_SCR, 0) AS BARON_ADD_SCR /* 바론추가점수 */
FROM TBCSPBII100M WHERE SBMSN_YMD BETWEEN #strStrDt# AND #strEndDt#) GROUP BY PRSNR_ENO) D WHERE A.INFO_PRSNR_ENO = B.TRGT_NOP_ENO AND A.INFO_YR = #INFO_YR# AND A.INFO_MLG_QTR_SECD = #INFO_MLG_QTR_SECD# AND B.HDOF_SECD != 'DAA' AND B.SRECS_DEPT_CD = C.SRECS_DEPT_CD AND A.INFO_PRSNR_ENO = D.PRSNR_ENO(+) AND A.INFO_PRSNR_ENO = #TRGT_NOP_ENO# AND B.SRECS_DEPT_CD = #SRECS_DEPT_CD# AND A.MLG_RMRK_CN LIKE '%'||#strMlgRmk#||'%' AND QTR_GOAL_SCR - (MLG_TSC_CONT + CRFW_SCR + CRFW_QLT_SCR) > 0 AND QTR_GOAL_SCR - (MLG_TSC_CONT + CRFW_SCR + CRFW_QLT_SCR) AND CASE WHEN C.SRECS_DEPT_CD IN ('062500','062600','062700','062800','170300','170320','071100','071300','180100','180110','100100','081100','081200','081300','081400','081500','081600','081700','081800','081900','0L0100','0L0200','0L0300') THEN 'A' ELSE C.DEPT_TPCD END = #strDPT_TP_CD# AND B.GEN_ADMN_DVSN_CD = #strGEN_ADMN_DVSN_CD# ORDER BY MLG_SUM_CNT DESC, A.INFO_PRSNR_ENO