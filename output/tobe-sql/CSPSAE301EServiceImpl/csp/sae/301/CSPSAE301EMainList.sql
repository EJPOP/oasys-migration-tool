SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_NM /* 과정명 */,
    A.CRS_CDN /* 과정기수 */,
    A.GRNDS_EXMN_AEX_SQNO /* 현장조사수용비순번 */,
    A.TANE_ID,
    A.INFO_RLPR_NM /* 정보관계자명 */,
    A.INST_CD /* 기관코드 */,
    A.PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    A.JBGD_NM /* 직급명 */,
    A.EDU_EXS,
    A.DMT_EXS,
    A.BZTRP_TRVEXP_FDEXP /* 출장여비식비 */,
    (A.EDU_EXS + A.DMT_EXS + A.BZTRP_TRVEXP_FDEXP) AS EDU_EXS,
    A.PD_AMT,
    (A.PD_AMT - (A.EDU_EXS + A.DMT_EXS + A.BZTRP_TRVEXP_FDEXP)) AS UNPAID_AMT /* 미납금액 */,
    A.PD_MEAN_CD,
    A.PD_YN,
    A.EDU_DVSN_NM,
    A.EDU_CAT_NM,
    A.DMT_UE_YN,
    A.BUS_UE_YN,
    A.SEX_CD,
    A.PD_DT,
    A.SLCT_CVLPR_MPNO /* 청탁민원인휴대전화번호 */,
    A.PD_SMS_SEN_DT,
    A.UNP_SMS_SEN_DT,
    A.EDU_DT,
    A.ACTNO_SCRTY /* 계좌번호보안 */
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    B.EDU_DVSN_CD,
    C.EDU_CAT_CD,
    A.CRS_CD,
    D.CRS_NM /* 과정명 */,
    A.CRS_CDN /* 과정기수 */,
    A.GRNDS_EXMN_AEX_SQNO /* 현장조사수용비순번 */,
    A.TANE_ID,
    A.INFO_RLPR_NM /* 정보관계자명 */,
    A.INST_CD /* 기관코드 */,
    E.PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    A.JBGD_NM /* 직급명 */,
    DECODE(NVL(A.EDU_EXS, 0), 0, NVL( (SELECT Z.EDU_EXS
FROM TBCSPSAE113B Z WHERE Z.CRS_CD = A.CRS_CD AND APC_DT = (SELECT MAX(APC_DT)
FROM TBCSPSAE113B X WHERE X.CRS_CD = Z.CRS_CD AND X.APC_DT AND B.EDU_DVSN_CD = #strEDU_DVSN_CD# AND C.EDU_CAT_CD = #strEDU_CAT_CD# AND A.CRS_CD = #strEDU_CRS_CD# AND A.CRS_CDN = #CRS_CDN# AND A.PD_YN = #strPD_YN# AND A.INFO_RLPR_NM LIKE '%' || #strNAM# || '%' ) A ORDER BY A.LINK_YR, A.CRS_CD, A.CRS_CDN, A.GRNDS_EXMN_AEX_SQNO