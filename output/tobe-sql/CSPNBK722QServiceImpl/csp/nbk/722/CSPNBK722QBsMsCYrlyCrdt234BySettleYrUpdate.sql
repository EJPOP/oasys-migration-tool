UPDATE /* CSPNBK722QBsMsCYrlyCrdt234BySettleYrUpdate */ TBCSPNBK502M D1 SET D1.DSPS_RQT_AMT = D1.DSPS_RQT_AMT + NVL(( SELECT SUM(D2.DSPS_RQT_AMT) AS DSPS_RQT_AMT /* 처분요구금액 */
FROM TBCSPNBK301M D2 WHERE D2.SMB_DEAL_DT LIKE TO_CHAR(SYSDATE, 'YYYY') || '%' AND D2.CNL_YN = 'N' AND D2.DEPTS_PMT_DVSN_CD = 'C' AND D2.CRDT_MNST_CLU_CD = D1.MNST_CLU_CD AND D2.CRDT_TAX_SITM_CD = D1.TAXR_SITM_SECD ), 0) ,  ( YRLY_CRDT_AGG_AM, YRLY_CRDT_NOC ) = ( SELECT SUM(D2.DSPS_RQT_AMT) AS DSPS_RQT_AMT /* 처분요구금액 */,
    COUNT(*)
FROM TBCSPNBK301M D2 WHERE D2.SMB_DEAL_DT LIKE TO_CHAR(SYSDATE, 'YYYY') || '%' AND D2.CNL_YN = 'N' AND D2.DEPTS_PMT_DVSN_CD = 'C' AND D2.CRDT_MNST_CLU_CD = D1.MNST_CLU_CD AND D2.CRDT_TAX_SITM_CD = D1.TAXR_SITM_SECD ) WHERE D1.DEAL_DT = TO_CHAR(SYSDATE, 'YYYYMMDD') AND ( D1.MNST_CLU_CD, D1.TAXR_SITM_SECD ) IN ( SELECT D2.CRDT_MNST_CLU_CD,
    D2.CRDT_TAX_SITM_CD
FROM TBCSPNBK301M D2 WHERE D2.SMB_DEAL_DT LIKE TO_CHAR(SYSDATE, 'YYYY') || '%' AND D2.CNL_YN = 'N' AND D2.DEPTS_PMT_DVSN_CD = 'C' AND SUBSTR(D2.CRDT_MNST_CLU_CD, 1, 1 ) IN ( '2', '3', '4') GROUP BY D2.CRDT_MNST_CLU_CD, D2.CRDT_TAX_SITM_CD )