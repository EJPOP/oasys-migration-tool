/* * 미수이자 계산 QUERY */ SELECT A.MOUI_NO AS MOUI_NO,
    C.USER_NM AS USER_NM /* 사용자명 */,
    B.TRGT_NOP_ENO AS TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    D.CNSTN_MBCMT_DEPT_NM AS CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    A.LEND_DT AS LEND_DT,
    A.LEND_AM AS LEND_AM,
    A.LEND_BL AS LEND_BL,
    A.SS_DATE AS SS_DATE,
    A.EE_DATE AS EE_DATE,
    A.R_RATE AS R_RATE,
    CASE WHEN A.EE_DATE = #settleYr#||'1231' THEN TO_DATE(A.EE_DATE)- TO_DATE(A.SS_DATE)+1 ELSE TO_DATE(A.EE_DATE) - TO_DATE(A.SS_DATE) END AS EE_DATE,
    CASE WHEN A.EE_DATE = #settleYr#||'1231' THEN FLOOR(A.LEND_BL*A.R_RATE* (TO_DATE(A.EE_DATE) - TO_DATE(A.SS_DATE) + 1)/365/100) ELSE FLOOR(A.LEND_BL*A.R_RATE*(TO_DATE(A.EE_DATE) - TO_DATE(A.EE_DATE))/365/100) END AS EE_DATE,
    A.T_PENAL_YN AS T_PENAL_YN
FROM ( SELECT A.MOUI_NO AS MOUI_NO,
    A.LEND_KND_CD,
    A.LEND_DT AS LEND_DT,
    A.LEND_AM AS LEND_AM,
    A.LEND_BL AS LEND_BL,
    CASE WHEN B.S_DATE = A.T_END_DATE THEN A.T_STA_DATE WHEN B.S_DATE >= A.T_STA_DATE AND B.E_DATE = A.T_STA_DATE AND B.E_DATE >= A.T_END_DATE THEN B.S_DATE ELSE 'ERROR---------------------------------------------------------------' END AS S_DATE,
    CASE WHEN B.S_DATE = A.T_END_DATE THEN A.T_END_DATE WHEN B.S_DATE >= A.T_STA_DATE AND B.E_DATE = A.T_STA_DATE AND B.E_DATE >= A.T_END_DATE THEN A.T_END_DATE ELSE 'ERROR---------------------------------------------------------------' END AS S_DATE,
    CASE WHEN A.T_PENAL_YN = 'N' THEN B.LEND_ITR WHEN A.T_PENAL_YN = 'Y' THEN B.ARR_ITR END AS T_PENAL_YN,
    A.T_PENAL_YN AS T_PENAL_YN
FROM ( SELECT A.LEND_KND_CD AS LEND_KND_CD, A.MOUI_NO AS MOUI_NO, A.LEND_AM AS LEND_AM, A.LEND_DT AS LEND_DT, A.LEND_BL AS LEND_BL, CASE WHEN B.FNL_RPM_DT 0 AND A.LEND_KND_CD = #LEND_KND_CD# AND A.CNL_YN= 'N' AND B.FNL_RPM_DT = A.T_STA_DATE AND A.T_END_DATE >= B.S_DATE AND B.LEND_KND_CD = A.LEND_KND_CD ) A , TBCSPNBK001M B , TBDCMACM001M C , TBDCMACM002M D WHERE A.MOUI_NO = B.MOUI_NO AND B.TRGT_NOP_ENO = C.TRGT_NOP_ENO AND C.SRECS_DEPT_CD = D.SRECS_DEPT_CD ORDER BY A.MOUI_NO