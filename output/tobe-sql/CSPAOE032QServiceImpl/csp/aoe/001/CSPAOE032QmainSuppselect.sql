SELECT A.CHGR_DVSN_CD /* 담당자구분코드 */,
    (SELECT AS CHGR_DVSN_NM
FROM TBCSPAOE016M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND CHGR_DVSN_CD = A.CHGR_DVSN_CD) AS CHGR_DVSN_NM /*담당자구분명*/ , A.PIC_ENO /*담당자 전산번호*/ , F_USR_INFO(A.PIC_ENO,'2') AS INFO_RLPR_NM /*담당자명*/ , NOCNT AS COFM_N /*미확인 건수*/ , OKCNT AS COFM_Y /*확인완료건수*/ , (NOCNT + OKCNT) AS COFM_ALL /*합계건수*/ , #strEvlYr# AS EVL_YR /*평가년도*/ , #strHlyrDvsnCd# AS HLYR_DVSN_CD /*반기구분코드*/ FROM ( /*CD01:자체평가자 - 지원부서 과장(각 부서마다 과장들이 있다)*/ SELECT A.PIC_ENO /* 담당자직원전산번호 */,
    A.CHGR_DVSN_CD,
    B.CHR_DPT_CD,
    SUM(CASE WHEN C.EVL_DTM_YN IS NULL OR EVL_DTM_YN = 'N' THEN 1 ELSE 0 END) AS EVL_DTM_YN,
    SUM(CASE WHEN C.EVL_DTM_YN ='Y' THEN 1 ELSE 0 END) AS EVL_DTM_YN
FROM TBCSPAOE017D A , (SELECT EVL_YR,
    HLYR_DVSN_CD,
    CHR_DPT_CD
FROM TBCSPAOE026M WHERE EVL_YR = '2015' AND HLYR_DVSN_CD = '10' GROUP BY EVL_YR, HLYR_DVSN_CD,CHR_DPT_CD ) B , (SELECT EVL_YR,
    HLYR_DVSN_CD,
    EVL_DTM_YN,
    EVL_CMTR_CNB,
    EVL_CMTR_DVSN_CD
FROM TBCSPAOE031M WHERE EVL_CMTR_DVSN_CD = 'CD01' AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_DTM_YN, EVL_CMTR_CNB, EVL_CMTR_DVSN_CD ) C WHERE 1 = 1 AND A.EVL_YR = B.EVL_YR(+) AND A.HLYR_DVSN_CD = B.HLYR_DVSN_CD(+) AND A.BLT_DPT_CD = CHR_DPT_CD(+) AND A.EVL_YR = C.EVL_YR(+) AND A.HLYR_DVSN_CD = C.HLYR_DVSN_CD(+) AND A.CHGR_DVSN_CD = C.EVL_CMTR_DVSN_CD(+) AND A.PIC_ENO = C.EVL_CMTR_CNB(+) AND A.EVL_YR = #strEvlYr# AND A.HLYR_DVSN_CD = #strHlyrDvsnCd# AND A.CVLCPT_TASK_SECD = '10002' AND A.CHGR_DVSN_CD = 'CD01' GROUP BY A.PIC_ENO, A.CHGR_DVSN_CD, B.CHR_DPT_CD UNION ALL /*CD02:상급자평가 - 지원부서 국장이기 때문에 국장의 부서코드는 업코드가 들어가있으므로 하위 부서코드를 가져와야한다.*/ SELECT A.PIC_ENO /* 담당자직원전산번호 */,
    A.CHGR_DVSN_CD,
    A.BLT_DPT_CD,
    SUM(CASE WHEN C.EVL_DTM_YN IS NULL OR EVL_DTM_YN = 'N' THEN 1 ELSE 0 END) AS EVL_DTM_YN,
    SUM(CASE WHEN C.EVL_DTM_YN = 'Y' THEN 1 ELSE 0 END) AS EVL_DTM_YN
FROM TBCSPAOE017D A , (SELECT EVL_YR,
    HLYR_DVSN_CD,
    CHR_DPT_CD
FROM TBCSPAOE026M WHERE EVL_YR = '2015' AND HLYR_DVSN_CD = '10' GROUP BY EVL_YR, HLYR_DVSN_CD,CHR_DPT_CD ) B , (SELECT EVL_YR,
    HLYR_DVSN_CD,
    EVL_DTM_YN,
    EVL_CMTR_CNB,
    EVL_CMTR_DVSN_CD
FROM TBCSPAOE031M WHERE EVL_CMTR_DVSN_CD = 'CD02' AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_DTM_YN, EVL_CMTR_CNB, EVL_CMTR_DVSN_CD ) C WHERE 1 = 1 AND A.EVL_YR = B.EVL_YR(+) AND A.HLYR_DVSN_CD = B.HLYR_DVSN_CD(+) AND SUBSTR(A.BLT_DPT_CD, 1 ,3) = SUBSTR(CHR_DPT_CD(+), 1 ,3) AND A.EVL_YR = C.EVL_YR(+) AND A.HLYR_DVSN_CD = C.HLYR_DVSN_CD(+) AND A.CHGR_DVSN_CD = C.EVL_CMTR_DVSN_CD(+) AND A.PIC_ENO = C.EVL_CMTR_CNB(+) AND A.EVL_YR = #strEvlYr# AND A.HLYR_DVSN_CD = #strHlyrDvsnCd# AND A.CVLCPT_TASK_SECD = '10002' AND A.CHGR_DVSN_CD = 'CD02' GROUP BY A.PIC_ENO, A.CHGR_DVSN_CD, A.BLT_DPT_CD UNION ALL /*CD03:지원부서 평가위원 - 부서코드랑 연결할 필요가 없다. 이사람들은 원장, 차장 이런사람들이라서..*/ SELECT A.PIC_ENO /* 담당자직원전산번호 */,
    A.CHGR_DVSN_CD,
    '' AS CHR_DPT_CD,
    SUM(CASE WHEN C.EVL_DTM_YN IS NULL OR EVL_DTM_YN = 'N' THEN 1 ELSE 0 END) AS EVL_DTM_YN,
    SUM(CASE WHEN C.EVL_DTM_YN = 'Y' THEN 1 ELSE 0 END) AS EVL_DTM_YN
FROM (SELECT A.EVL_YR,
    A.HLYR_DVSN_CD,
    A.PIC_ENO /* 담당자직원전산번호 */,
    A.CHGR_DVSN_CD,
    B.CHR_DPT_CD
FROM TBCSPAOE017D A , (SELECT EVL_YR,
    HLYR_DVSN_CD,
    CHR_DPT_CD
FROM TBCSPAOE026M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# GROUP BY EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD) B WHERE 1 = 1 AND A.EVL_YR = B.EVL_YR AND A.HLYR_DVSN_CD = B.HLYR_DVSN_CD AND A.EVL_YR = #strEvlYr# AND A.HLYR_DVSN_CD = #strHlyrDvsnCd# AND A.CVLCPT_TASK_SECD = '10002' AND A.CHGR_DVSN_CD = 'CD03' ) A , (SELECT EVL_YR,
    HLYR_DVSN_CD,
    EVL_DTM_YN,
    EVL_CMTR_DVSN_CD,
    EVL_CMTR_CNB,
    SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TBCSPAOE031M WHERE EVL_CMTR_DVSN_CD = 'CD03' AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_DTM_YN, EVL_CMTR_DVSN_CD, EVL_CMTR_CNB,SRECS_DEPT_CD ) C WHERE A.EVL_YR = C.EVL_YR(+) AND A.HLYR_DVSN_CD = C.HLYR_DVSN_CD(+) AND A.PIC_ENO = C.EVL_CMTR_CNB(+) AND A.CHR_DPT_CD = C.SRECS_DEPT_CD(+) GROUP BY A.PIC_ENO, A.CHGR_DVSN_CD ) A ORDER BY A.CHGR_DVSN_CD, A.PIC_ENO