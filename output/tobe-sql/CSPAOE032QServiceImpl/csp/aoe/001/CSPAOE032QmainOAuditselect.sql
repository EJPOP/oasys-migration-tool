SELECT ( SELECT AS CHGR_DVSN_NM
FROM TBCSPAOE016M WHERE EVL_YR = D6.EVL_YR AND HLYR_DVSN_CD = D6.HLYR_DVSN_CD AND CHGR_DVSN_CD = D6.CHGR_DVSN_CD) AS CHGR_DVSN_NM /*담당자구분명*/ , F_USR_INFO(D6.PIC_ENO, '2') AS INFO_RLPR_NM /*담당자명*/ , NVL(D6.COFM_Y, 0) AS COFM_Y /*확인완료건수*/ , NVL(D6.COFM_N, 0) AS COFM_N /*미확인 건수*/ , NVL(D6.COFM_ALL, 0) AS COFM_ALL /*합계건수*/ , D6.EVL_YR AS EVL_YR /*평가년도*/ , D6.HLYR_DVSN_CD AS HLYR_DVSN_CD /*반기구분코드*/ , D6.CHGR_DVSN_CD AS CHGR_DVSN_CD /*담당자구분코드*/ , D6.PIC_ENO AS PIC_ENO /*담당자 전산번호*/ , D6.EVL_STEP_CD AS EVL_STEP_CD /*평가단계 코드*/ , D6.TASK_KDCD AS AUD_TSK_KND_CD /*감사업무종류코드*/ FROM ( SELECT D3.EVL_YR,
    D3.HLYR_DVSN_CD,
    D3.TASK_KDCD /* 업무종류코드 */,
    D3.CHGR_DVSN_CD,
    D3.EVL_STEP_CD,
    SUM(DECODE( NVL(D5.EVL_STA_CD, 0), 0, 1, '100', 1, '200', 1, 0)) AS EVL_STA_CD /* 미확인 건수 */,
    SUM(DECODE(D5.EVL_STA_CD, '300', 1, 0)) AS EVL_STA_CD /* 확인완료건수 */,
    SUM(DECODE( NVL(D5.EVL_STA_CD, 0), 0, 1, '100', 1, '200', 1, '300', 1, 0)) AS EVL_STA_CD /* 합계건수 */,
    D3.PIC_ENO /* 담당자직원전산번호 */
FROM ( SELECT D1.EVL_YR,
    D1.HLYR_DVSN_CD,
    D1.TASK_KDCD /* 업무종류코드 */,
    D1.TSK_NO,
    D2.CHGR_DVSN_CD,
    DECODE(MOD(SUBSTR(D2.CHGR_DVSN_CD, 4), 2), 1, '600', '700') AS MOD /* 홀수면 평가자, 짝수면 확인자 */,
    D2.PIC_ENO /* 담당자직원전산번호 */
FROM TBCSPAOE024M D1 , TBCSPAOE017D D2 WHERE D1.EVL_YR = D2.EVL_YR AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD AND D2.CVLCPT_TASK_SECD = '10001' /*감사외업무*/ AND D1.TASK_KDCD = D2.AUD_TSK_KND_CD AND D1.EVL_YR = #strEvlYr# AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D2.CHGR_DVSN_CD NOT IN ('CD33', 'CD34') /*감사업무쪽 코드임*/ ) D3 , ( SELECT EVL_YR,
    HLYR_DVSN_CD,
    TASK_KDCD /* 업무종류코드 */,
    TSK_NO
FROM TBCSPAOE025M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# GROUP BY EVL_YR, HLYR_DVSN_CD, TASK_KDCD, TSK_NO ) D4 /*감사외 업무 참여인원이 등록되지 않음 카운트 제외*/ , TBCSPAOE029M D5 WHERE D3.EVL_YR = D4.EVL_YR AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD AND D3.TASK_KDCD = D4.TASK_KDCD AND D3.TSK_NO = D4.TSK_NO AND D3.EVL_YR = D5.EVL_YR (+) AND D3.HLYR_DVSN_CD = D5.HLYR_DVSN_CD (+) AND D5.CVLCPT_TASK_SECD (+) = '10001' AND D3.TASK_KDCD = D5.AUD_TSK_KND_CD (+) AND D3.EVL_STEP_CD = D5.EVL_STEP_CD (+) AND D3.PIC_ENO = D5.EVL_CMTR_CNB (+) AND D3.TSK_NO = D5.TSK_NO (+) AND D3.CHGR_DVSN_CD = D5.EVL_CMTR_DVSN_CD (+) GROUP BY D3.EVL_YR, D3.HLYR_DVSN_CD, D3.TASK_KDCD, D3.CHGR_DVSN_CD, D3.EVL_STEP_CD, D3.PIC_ENO ) D6 ORDER BY SUBSTR(CHGR_DVSN_NM, 0, 4), CASE WHEN SUBSTR(CHGR_DVSN_NM, 0, 4) = '기타업무' THEN TO_NUMBER(SUBSTR(CHGR_DVSN_CD, 3)) ELSE 0 END, D6.PIC_ENO /*2014.02.04 최원형 감사관 요청*/