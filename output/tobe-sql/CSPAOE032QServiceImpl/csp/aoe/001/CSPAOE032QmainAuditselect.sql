SELECT D6.CHGR_DVSN_NM AS CHGR_DVSN_NM /* 담당자구분명 */,
    F_USR_INFO(D6.PIC_ENO, '2') AS INFO_RLPR_NM /* 정보관계자명 */,
    NVL(D6.COFM_N, 0) AS COFM_N /* 확인완료건수 */,
    NVL(D6.COFM_Y, 0) AS COFM_Y /* 미확인 건수 */,
    NVL(D6.COFM_ALL, 0) AS COFM_ALL /* 합계건수 */,
    D6.EVL_YR AS EVL_YR /* 평가년도 */,
    D6.HLYR_DVSN_CD AS HLYR_DVSN_CD /* 반기구분코드 */,
    D6.CHGR_DVSN_CD AS CHGR_DVSN_CD /* 담당자구분코드 */,
    D6.PIC_ENO AS PIC_ENO /* 담당자직원전산번호 */
FROM ( SELECT D3.EVL_YR,
    D3.HLYR_DVSN_CD,
    D3.CHGR_DVSN_CD,
    D3.PIC_ENO /* 담당자직원전산번호 */,
    D3.EVL_STEP_CD,
    D3.CHGR_DVSN_NM,
    SUM(DECODE( NVL(D5.EVL_STA_CD, 0), 0, 1, '100', 1, '200', 1, 0)) AS EVL_STA_CD,
    SUM(DECODE( NVL(D5.EVL_STA_CD, 0), 1, 0, '300', 1, 0)) AS EVL_STA_CD,
    SUM(DECODE( NVL(D5.EVL_STA_CD, 0), 0, 1, '100', 1, '200', 1, '300', 1, 0)) AS EVL_STA_CD /* 합계건수 */
FROM ( SELECT D2.EVL_YR,
    D2.HLYR_DVSN_CD,
    D1.TSK_NO,
    D1.CVLCPT_ADT_YR /* 민원감사년도 */,
    D2.CHGR_DVSN_CD,
    '200' AS EVL_STEP_CD,
    D2.PIC_ENO /* 담당자직원전산번호 */,
    D2.CHGR_DVSN_NM
FROM ( SELECT TSK_NO,
    CVLCPT_ADT_YR /* 민원감사년도 */
FROM ( SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    TSK_NO,
    MIN(ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */,
    MAX(ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */
FROM TBCSPAOE022M /* 감사업무처리단계관리기본 */ WHERE 1 = 1 AND CMPTN_YMD IS NOT NULL AND CMPTN_YMD BETWEEN #strEvlStrDt# AND #strEvlEndDt# GROUP BY CVLCPT_ADT_YR, TSK_NO ) WHERE AUD_STEP_CD_MAX = '10010' ) D1 , ( SELECT D4.CHGR_DVSN_CD,
    D4.PIC_ENO /* 담당자직원전산번호 */,
    D3.CHGR_DVSN_NM,
    D3.EVL_YR,
    D3.HLYR_DVSN_CD
FROM TBCSPAOE016M D3 , TBCSPAOE017D D4 WHERE D3.EVL_YR = D4.EVL_YR AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD AND D3.CVLCPT_TASK_SECD = D4.CVLCPT_TASK_SECD AND D3.AUD_TSK_KND_CD = D4.AUD_TSK_KND_CD AND D3.CHGR_DVSN_CD = D4.CHGR_DVSN_CD AND D3.EVL_YR = #strEvlYr# AND D3.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D3.CVLCPT_TASK_SECD = '10000' AND D3.CHGR_DVSN_CD = 'CD34' ) D2 UNION ALL SELECT D2.EVL_YR,
    D2.HLYR_DVSN_CD,
    D1.TSK_NO,
    D1.CVLCPT_ADT_YR /* 민원감사년도 */,
    D2.CHGR_DVSN_CD,
    '100' AS EVL_STEP_CD,
    D2.PIC_ENO /* 담당자직원전산번호 */,
    D2.CHGR_DVSN_NM
FROM ( SELECT TSK_NO,
    CVLCPT_ADT_YR /* 민원감사년도 */
FROM ( SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    TSK_NO,
    MIN(ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */,
    MAX(ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */
FROM TBCSPAOE022M BASE /* 감사업무처리단계관리기본 */ WHERE 1 = 1 AND CMPTN_YMD IS NOT NULL AND CMPTN_YMD BETWEEN #strEvlStrDt# AND #strEvlEndDt# AND 0 = ( SELECT COUNT(*)
FROM TBCSPAOE029M WHERE EVL_YR || HLYR_DVSN_CD != #strEvlYr# || #strHlyrDvsnCd# AND EVL_STEP_CD = '100' AND EVL_CMTR_DVSN_CD = 'CD33' AND CVLCPT_ADT_YR = BASE.CVLCPT_ADT_YR AND TSK_NO = BASE.TSK_NO ) /*이전에 귀청보고 평가 받지 않은 감사사항만*/ GROUP BY CVLCPT_ADT_YR, TSK_NO ) WHERE ( TO_NUMBER(AUD_STEP_CD_MAX) BETWEEN 10004 AND 10009 AND TO_NUMBER(AUD_STEP_CD_MIN) <= 10004 ) /*귀청보고 ~ ( 귀청보고 - 국장/단장) */ OR AUD_STEP_CD_MAX = '10010' ) D1 , ( SELECT D4.CHGR_DVSN_CD,
    D4.PIC_ENO /* 담당자직원전산번호 */,
    D3.CHGR_DVSN_NM,
    D3.EVL_YR,
    D3.HLYR_DVSN_CD
FROM TBCSPAOE016M D3 , TBCSPAOE017D D4 WHERE D3.EVL_YR = D4.EVL_YR AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD AND D3.CVLCPT_TASK_SECD = D4.CVLCPT_TASK_SECD AND D3.AUD_TSK_KND_CD = D4.AUD_TSK_KND_CD AND D3.CHGR_DVSN_CD = D4.CHGR_DVSN_CD AND D3.EVL_YR = #strEvlYr# AND D3.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D3.CVLCPT_TASK_SECD = '10000' AND D3.CHGR_DVSN_CD = 'CD33' ) D2 ) D3 , TBCSPAOE029M D5 WHERE D3.EVL_YR = D5.EVL_YR (+) AND D3.HLYR_DVSN_CD = D5.HLYR_DVSN_CD (+) AND D5.CVLCPT_TASK_SECD (+) = '10000' /*감사업무*/ AND D3.EVL_STEP_CD = D5.EVL_STEP_CD (+) AND D3.PIC_ENO = D5.EVL_CMTR_CNB (+) AND D3.TSK_NO = D5.TSK_NO (+) AND D3.CVLCPT_ADT_YR = D5.CVLCPT_ADT_YR (+) AND D3.CHGR_DVSN_CD = D5.EVL_CMTR_DVSN_CD (+) GROUP BY D3.EVL_YR, D3.HLYR_DVSN_CD, D3.CHGR_DVSN_CD, D3.PIC_ENO, D3.EVL_STEP_CD, D3.CHGR_DVSN_NM ) D6 ORDER BY CHGR_DVSN_CD, INFO_RLPR_NM