SELECT B.EVL_YR,
    B.EVL_DVSN_CD,
    B.SC_GRN_TG_CD,
    B.SET_ID,
    B.POST_SEQ,
    B.CMMT_SEQ,
    B.TITLE,
    B.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    B.TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    B.USER_NM /* 사용자명 */,
    B.LAST_UPDATE,
    NVL(APRV_YN, 'N') AS APRV_YN /* 승인여부 */
FROM (SELECT EVL_YR,
    EVL_DVSN_CD,
    SC_GRN_TG_CD,
    BRD_NO,
    BRD_BKNO,
    CMNT_NO,
    TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    MAX(APRV_YN) AS APRV_YN /* 승인여부 */
FROM TBAEPGKM016L /* 지식평가내역 */ WHERE 1=1 EVL_YR = #EVL_YR# EVL_DVSN_CD = #EVL_DVSN_CD# AND SC_GRN_TG_CD = #SC_GRN_TG_CD# GROUP BY EVL_YR, EVL_DVSN_CD, SC_GRN_TG_CD, BRD_NO, BRD_BKNO, CMNT_NO, TRGT_NOP_ENO ) AS A, /* 지식평가내역 */ ( SELECT B.EVL_YR,
    B.EVL_DVSN_CD,
    B.SC_GRN_TG_CD,
    D.SET_ID,
    E.POST_SEQ,
    F.CMMT_SEQ,
    F.CONTENT,
    F.CRE_USER_DEPT_NAME AS CNSTN_MBCMT_DEPT_NM,
    F_USR_INFO_BY_ID(E.CRE_USER_ID, '1') AS TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    F.CRE_USER_NAME AS USER_NM,
    F.PROF_RBPRSN_CRT_YMD /* 증명책임자생성일자 */
FROM TBAEPGKM011M A /* 평가기간 */ , TBAEPGKM012L B /* 평가기간별점수부여대상 */ , TBAEPGKM006M C /* 점수부여대상 */ , TBAEPGKM007L D /* 점수부여대상설정 */ , CTT_POST E /* 게시판 */ , CTT_POST_CMMT F /* 댓글 */ WHERE A.EVL_YR = B.EVL_YR AND A.EVL_DVSN_CD = B.EVL_DVSN_CD AND B.SC_GRN_TG_CD = C.SC_GRN_TG_CD AND C.SC_GRN_TG_CD = D.SC_GRN_TG_CD AND D.SET_ID = E.BOARD_ID AND E.BOARD_ID = F.BOARD_ID AND E.POST_SEQ = F.POST_SEQ AND C.EVL_CHGR_DVSN_CD = '1' AND C.SET_DVSN_CD = 'B' /* 댓글 */ AND A.EVL_ACTV_STR_DT = TO_CHAR(E.LAST_UPDATE, 'YYYYMMDD') /* 활동기간내에 등록된 글 */ B.EVL_YR = #EVL_YR# B.EVL_DVSN_CD = #EVL_DVSN_CD# ) AS B WHERE A.EVL_YR (+) = B.EVL_YR AND A.EVL_DVSN_CD (+) = B.EVL_DVSN_CD AND A.SC_GRN_TG_CD (+) = B.SC_GRN_TG_CD AND A.BRD_NO (+) = B.SET_ID AND A.BRD_BKNO (+) = B.POST_SEQ AND A.CMNT_NO (+)= B.CMMT_SEQ AND A.TRGT_NOP_ENO (+)= B.TRGT_NOP_ENO