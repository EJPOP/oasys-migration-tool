SELECT MNG_DEPT_CD /* 관리부서코드 */,
    ADT_CLSF_NO /* 감사분류번호 */,
    ADT_MTTR_NM /* 감사사항명 */,
    RCVR_DSCTN /* 수신자내역 */,
    RCVR_CONT /* 수신자개수 */,
    DECODE(SLCT_RPTP_KDCD, 'A10600960', 'A10600900', SLCT_RPTP_KDCD) AS SLCT_RPTP_KDCD /* 청탁보고서종류코드 */,
    SUM(CASE WHEN SLCT_RPTP_KDCD = 'A10600900' AND APV_YN = 'Y' AND RCVR_CONT > 0 THEN 1 WHEN SLCT_RPTP_KDCD = 'A10600960' AND APV_YN = 'Y' AND RCVR_CONT > 0 AND ADV_YN = 'Y' THEN 1 ELSE 0 END) AS SLCT_RPTP_KDCD /* 청탁보고서종류코드 */,
    SUM(CASE WHEN SLCT_RPTP_KDCD = 'A10601000' AND IMMUN_NO IS NULL AND RCVR_CONT > 0 AND APV_YN = 'Y' THEN 1 WHEN SLCT_RPTP_KDCD = 'A10601000' AND IMMUN_NO IS NOT NULL AND RCVR_CONT > 0 AND APV_YN = 'Y' AND ADV_YN = 'Y' THEN 1 ELSE 0 END) AS SLCT_RPTP_KDCD /* 청탁보고서종류코드 */
FROM ( SELECT MAX(A.MNG_DEPT_CD) AS MNG_DEPT_CD /* 관리부서코드 */,
    F_MNG_KND_AUDYRNO(A.ADT_YR, A.ADT_NO, A.ADT_KDCD, '-') AS ADT_CLSF_NO /* 감사분류번호 */,
    A.ADT_MTTR_NM /* 감사사항명 */,
    C.MFEX_NO AS MFEX_NO /* 소명자료 관리번호 */,
    C.IMMUN_NO AS IMMUN_NO /* 적극행정면책관리번호 */,
    MAX((SELECT DISTINCT 'Y'
FROM TBBADDED103M T1, TBDCMACM023L T2 WHERE T1.ATRZ_DMND_ID = T2.ATRZ_DOC_NO AND T1.CVLCPT_ADT_YR = A.CVLCPT_ADT_YR AND T1.ADT_NO = A.ADT_NO AND T1.ADT_STP_SECD = 'A1060' AND T1.SLCT_RPTP_KDCD = 'A10600200' AND T1.ADT_RPTP_SECD = '10' AND T2.APRVR_JBPS_SECD = '0055700' AND T2.APVR_STA_CD IN ('202','203') )) AS APV_YN /* 개별처리안 사무총장 결재 여부 */ , MAX((SELECT T1.CNSTN_CMT_MTG_END_YN /* 자문위원회회의종료여부 */
FROM TBCSPKDE109M T1 WHERE T1.CNSTN_CMT_MTG_YR = C.CNSTN_CMT_MTG_YR AND T1.CNSTN_CMT_MTG_SQNO = C.CNSTN_CMT_MTG_SQNO)) AS ADV_YN /*자문위원회 종료 여부*/ , MAX(CASE WHEN SLCT_RPTP_KDCD IN ('A10600900', 'A10600960') THEN (SELECT NVL(AGGR_CONCAT(ST.USR_DFN_TXT_1,''), '')
FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000860' AND ST.CD = '20' AND EXISTS (SELECT 1
FROM TBBADDED103M INC , TBBADDED111M IND WHERE INC.CVLCPT_ADT_YR = B.CVLCPT_ADT_YR AND INC.ADT_NO = B.ADT_NO AND INC.CVLCPT_DOC_ID = B.CVLCPT_DOC_ID AND INC.CVLCPT_ADT_YR = IND.CVLCPT_ADT_YR AND INC.ADT_NO = IND.ADT_NO AND IND.RCPTN_DEPT_CD ='180130' AND INC.SLCT_RPTP_KDCD IN ('A10600900', 'A10600960')) ) WHEN SLCT_RPTP_KDCD = 'A10601000' THEN (SELECT AGGR_CONCAT(APRVR_ENO, '') AS APRVR_ENO /* 결재자직원전산번호 */
FROM TBBADDED103M INA , TBDCMACM023L INB WHERE INA.ATRZ_DMND_ID = INB.ATRZ_DOC_NO AND INA.CVLCPT_ADT_YR = B.CVLCPT_ADT_YR AND INA.ADT_NO = B.ADT_NO AND INA.ADT_STP_SECD = 'A1060' AND INA.SLCT_RPTP_KDCD = 'A10600200' AND INA.ADT_RPTP_SECD = '10' AND INB.APVR_STA_CD IN ('202', '203') AND INB.APRVR_JBPS_SECD IN ('0013600', '0015800', '0055600', '0045900') AND EXISTS (SELECT 1
FROM TBBADDED103M INC , TBBADDED111M IND WHERE INC.CVLCPT_ADT_YR = B.CVLCPT_ADT_YR AND INC.ADT_NO = B.ADT_NO AND INC.CVLCPT_DOC_ID = B.CVLCPT_DOC_ID AND INC.CVLCPT_ADT_YR = IND.CVLCPT_ADT_YR AND INC.ADT_NO = IND.ADT_NO AND IND.RCPTN_DEPT_CD ='180130' AND INC.SLCT_RPTP_KDCD = 'A10601000')) ELSE '' END) AS RCVR_DSCTN , MAX(CASE WHEN SLCT_RPTP_KDCD IN ('A10600900', 'A10600960') THEN (SELECT COUNT(ST.USR_DFN_TXT_1)
FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000860' AND ST.CD = '20' AND EXISTS (SELECT 1
FROM TBBADDED103M INC , TBBADDED111M IND WHERE INC.CVLCPT_ADT_YR = B.CVLCPT_ADT_YR AND INC.ADT_NO = B.ADT_NO AND INC.CVLCPT_DOC_ID = B.CVLCPT_DOC_ID AND INC.CVLCPT_ADT_YR = IND.CVLCPT_ADT_YR AND INC.ADT_NO = IND.ADT_NO AND IND.RCPTN_DEPT_CD ='180130' AND INC.SLCT_RPTP_KDCD IN ('A10600900', 'A10600960')) ) WHEN SLCT_RPTP_KDCD = 'A10601000' THEN (SELECT COUNT(*)
FROM TBBADDED103M INA , TBDCMACM023L INB WHERE INA.ATRZ_DMND_ID = INB.ATRZ_DOC_NO AND INA.CVLCPT_ADT_YR = B.CVLCPT_ADT_YR AND INA.ADT_NO = B.ADT_NO AND INA.ADT_STP_SECD = 'A1060' AND INA.SLCT_RPTP_KDCD = 'A10600200' AND INA.ADT_RPTP_SECD = '10' AND INB.APVR_STA_CD IN ('202', '203') AND INB.APRVR_JBPS_SECD IN ('0013600', '0015800', '0055600', '0045900') AND EXISTS (SELECT 1
FROM TBBADDED103M INC , TBBADDED111M IND WHERE INC.CVLCPT_ADT_YR = B.CVLCPT_ADT_YR AND INC.ADT_NO = B.ADT_NO AND INC.CVLCPT_DOC_ID = B.CVLCPT_DOC_ID AND INC.CVLCPT_ADT_YR = IND.CVLCPT_ADT_YR AND INC.ADT_NO = IND.ADT_NO AND IND.RCPTN_DEPT_CD = '180130' AND INC.SLCT_RPTP_KDCD = 'A10601000')) ELSE 0 END) AS RCVR_CONT , B.SLCT_RPTP_KDCD FROM TBBADDED001M A , TBBADDED103M B , TBCSPKDE103M_VIEW C WHERE A.CVLCPT_ADT_YR = B.CVLCPT_ADT_YR AND A.ADT_NO = B.ADT_NO AND B.CVLCPT_ADT_YR = C.CVLCPT_ADT_YR AND B.ADT_NO = C.ADT_NO AND (B.TPOF_RFRNC_YMD = C.FRS_MDM_SQNO||C.EDOC_SECD OR B.TPOF_RFRNC_ID = C.FRS_MDM_SQNO) AND A.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND A.ADT_NO = #ADT_NO# AND B.SLCT_RPTP_KDCD IN ('A10601000', 'A10600900','A10600960') GROUP BY F_MNG_KND_AUDYRNO(A.CVLCPT_ADT_YR, A.ADT_NO, A.ADT_KDCD, '-') , A.ADT_MTTR_NM , C.MFEX_NO , C.IMMUN_NO , B.SLCT_RPTP_KDCD) GROUP BY MNG_DEPT_CD, ADT_CLSF_NO, ADT_MTTR_NM, RCVR_DSCTN, RCVR_CONT , DECODE(SLCT_RPTP_KDCD, 'A10600960', 'A10600900', SLCT_RPTP_KDCD)