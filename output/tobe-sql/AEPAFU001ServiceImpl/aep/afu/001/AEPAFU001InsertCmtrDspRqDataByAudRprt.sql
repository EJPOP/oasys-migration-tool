DECLARE BEGIN INSERT INTO TB_BADDED146H (HSTRY_SECD, FNNC_INFO_SBMSN_RQT_HSTRY_SQNO, CVLCPT_HSTRY_DT, HSTRY_USER_ID, CVLCPT_ADT_YR, ADT_NO, ADT_STP_SECD, CVLCPT_DOC_ID, APRVR_JBPS_SECD, INCDNT_SQNO, DSPS_RQT_SQNO, INDCT_DSPS_RQT_SQNO, ADT_KDCD, ADT_GRNT_NO, RPTP_FLD_ID, INCDNT_DSPS_TPCD, SRECS_REL_INST_CD, ACTN_INST_CD, RFRNC_INST_CD, DSPS_RQT_SECD, DATA_INPT_SECD, NOP_AMT_SECD, NOP_AMT, SRECS_SORT_SQNO, FRST_USER_ID, LAST_USER_ID, LAST_PRCS_DEPT_CD, LAST_MENU_ID, FRST_REG_DT, LAST_MDFCN_DT, CMPTN_YN, ACNTG_INS_SECD, RFRNC_DOC_ID, NOP_SUM_AMT, FRST_ADT_STP_SECD, FRST_DOC_ID, FRST_APRVR_SECD, FRST_INCDNT_SQNO, FRST_DSPS_RQT_SQNO, DSPS_RQT_KYWD_CN_1, DSPS_RQT_KYWD_CN_2, DSPS_RQT_KYWD_CN_3, DSPS_RQT_KYWD_CN_4, DSPS_RQT_KYWD_CN_5) ( SELECT 'C',
    TBBADDED146H_SEQ.NEXTVAL,
    SYSDATE,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    AA.ADT_YR /* 감사년도 */,
    AA.ADT_NO /* 감사번호 */,
    'A1070',
    AA.CVLCPT_DOC_ID /* 문서아이디 */,
    #APRVR_JBPS_SECD#,
    AA.INCDNT_SQNO /* 사건순번 */,
    AA.DSPS_RQT_SQNO /* 처분요구순번 */,
    AA.DSPS_RQT_SQNO /* 처분요구순번 */,
    AA.ADT_KDCD /* 감사종류코드 */,
    AA.ADT_GRNT_NO /* 감사부여번호 */,
    AA.RPTP_FLD_ID /* 보고서분야아이디 */,
    AA.INCDNT_DSPS_TPCD /* 사건처분유형코드 */,
    AA.REL_INST_CD /* 관계기관코드 */,
    AA.ACTN_INST_CD /* 조치기관코드 */,
    AA.RFRNC_INST_CD /* 참조기관코드 */,
    AA.DSPS_RQT_KDCD /* 처분요구종류코드 */,
    AA.DATA_INPT_SECD /* 자료입력구분코드 */,
    AA.NOP_AMT_SECD /* 인원금액구분코드 */,
    AA.NOP_AMT /* 인원금액 */,
    AA.SORT_SQNO /* 정렬순번 */,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    #FNL_DEAL_DPT_CD# AS LAST_PRCS_DEPT_CD /* 최종처리부서코드 */,
    #FNL_MNU_ID# AS LAST_MENU_ID /* 최종메뉴아이디 */,
    SYSDATE,
    SYSDATE,
    AA.CMPTN_YN /* 완료여부 */,
    AA.ACNTG_INS_SECD /* 회계감찰구분코드 */,
    #copyAudRptId#,
    AA.NOP_SUM_AMT /* 인원합계금액 */,
    AA.FRST_ADT_STP_SECD /* 최초감사단계구분코드 */,
    AA.FRST_DOC_ID /* 최초문서아이디 */,
    AA.FRST_APRVR_SECD /* 최초결재자구분코드 */,
    AA.FRST_INCDNT_SQNO /* 최초사건순번 */,
    AA.FRST_DSPS_RQT_SQNO /* 최초처분요구순번 */,
    AA.DSPS_RQT_KYWD_CN_1 /* 처분요구키워드내용1 */,
    AA.DSPS_RQT_KYWD_CN_2 /* 처분요구키워드내용2 */,
    AA.DSPS_RQT_KYWD_CN_3 /* 처분요구키워드내용3 */,
    AA.DSPS_RQT_KYWD_CN_4 /* 처분요구키워드내용4 */,
    AA.DSPS_RQT_KYWD_CN_5 /* 처분요구키워드내용5 */
FROM TB_BADDED146M AA , TB_BADDED145M CC WHERE AA.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND AA.APRVR_JBPS_SECD = #APRVR_JBPS_SECD# AND AA.CVLCPT_ADT_YR = CC.ADT_YR AND AA.ADT_NO = CC.ADT_NO AND AA.CVLCPT_DOC_ID = CC.DOC_ID AND AA.APRVR_JBPS_SECD = CC.APRVR_JBPS_SECD AND AA.INCDNT_SQNO = CC.INCDNT_SQNO AND NOT EXISTS ( SELECT 1
FROM TB_BADDED147M ZZ INNER JOIN TB_BADDED148M YY ON ZZ.CVLCPT_ADT_YR = YY.CVLCPT_ADT_YR AND ZZ.ADT_NO = YY.ADT_NO AND ZZ.ADT_STP_SECD = YY.ADT_STP_SECD AND ZZ.CVLCPT_DOC_ID = YY.CVLCPT_DOC_ID AND ZZ.APRVR_JBPS_SECD = YY.APRVR_JBPS_SECD AND ZZ.INCDNT_SQNO = YY.INCDNT_SQNO AND ZZ.DSPS_RQT_SQNO = YY.DSPS_RQT_SQNO AND ZZ.MPNG_SQNO = YY.MPNG_SQNO WHERE ZZ.CVLCPT_ADT_YR = AA.CVLCPT_ADT_YR AND ZZ.ADT_NO = AA.ADT_NO AND ZZ.CVLCPT_DOC_ID = AA.CVLCPT_DOC_ID AND ZZ.BFR_INCDNT_NO = F_MNG_KND_AUDYRNO(AA.CVLCPT_ADT_YR, AA.ADT_NO, AA.ADT_KDCD, '-') || '-' || CC.INCDNT_KDCD || '-' || AA.INCDNT_DSPS_TPCD AND ZZ.APRVR_JBPS_SECD = #APRVR_JBPS_SECD# AND YY.INCDNT_MPNG_SECD IN ( 'D90', 'D70', 'D80', 'D99' ) ) ) ; INSERT INTO TB_BADDED146M (CVLCPT_ADT_YR, ADT_NO, ADT_STP_SECD, CVLCPT_DOC_ID, APRVR_JBPS_SECD, INCDNT_SQNO, DSPS_RQT_SQNO, INDCT_DSPS_RQT_SQNO, ADT_KDCD, ADT_GRNT_NO, RPTP_FLD_ID, INCDNT_DSPS_TPCD, SRECS_REL_INST_CD, ACTN_INST_CD, RFRNC_INST_CD, DSPS_RQT_SECD, DATA_INPT_SECD, NOP_AMT_SECD, NOP_AMT, SRECS_SORT_SQNO, FRST_USER_ID, LAST_USER_ID, LAST_PRCS_DEPT_CD, LAST_MENU_ID, FRST_REG_DT, LAST_MDFCN_DT, CMPTN_YN, ACNTG_INS_SECD, RFRNC_DOC_ID, NOP_SUM_AMT, FRST_ADT_STP_SECD, FRST_DOC_ID, FRST_APRVR_SECD, FRST_INCDNT_SQNO, FRST_DSPS_RQT_SQNO, DSPS_RQT_KYWD_CN_1, DSPS_RQT_KYWD_CN_2, DSPS_RQT_KYWD_CN_3, DSPS_RQT_KYWD_CN_4, DSPS_RQT_KYWD_CN_5) ( SELECT AA.ADT_YR /* 감사년도 */,
    AA.ADT_NO /* 감사번호 */,
    'A1070',
    AA.CVLCPT_DOC_ID /* 문서아이디 */,
    #APRVR_JBPS_SECD#,
    AA.INCDNT_SQNO /* 사건순번 */,
    AA.DSPS_RQT_SQNO /* 처분요구순번 */,
    AA.DSPS_RQT_SQNO /* 처분요구순번 */,
    AA.ADT_KDCD /* 감사종류코드 */,
    AA.ADT_GRNT_NO /* 감사부여번호 */,
    AA.RPTP_FLD_ID /* 보고서분야아이디 */,
    AA.INCDNT_DSPS_TPCD /* 사건처분유형코드 */,
    AA.REL_INST_CD /* 관계기관코드 */,
    AA.ACTN_INST_CD /* 조치기관코드 */,
    AA.RFRNC_INST_CD /* 참조기관코드 */,
    AA.DSPS_RQT_KDCD /* 처분요구종류코드 */,
    AA.DATA_INPT_SECD /* 자료입력구분코드 */,
    AA.NOP_AMT_SECD /* 인원금액구분코드 */,
    AA.NOP_AMT /* 인원금액 */,
    AA.SORT_SQNO /* 정렬순번 */,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    #FNL_DEAL_DPT_CD# AS LAST_PRCS_DEPT_CD /* 최종처리부서코드 */,
    #FNL_MNU_ID# AS LAST_MENU_ID /* 최종메뉴아이디 */,
    SYSDATE,
    SYSDATE,
    AA.CMPTN_YN /* 완료여부 */,
    AA.ACNTG_INS_SECD /* 회계감찰구분코드 */,
    #copyAudRptId#,
    AA.NOP_SUM_AMT /* 인원합계금액 */,
    AA.FRST_ADT_STP_SECD /* 최초감사단계구분코드 */,
    AA.FRST_DOC_ID /* 최초문서아이디 */,
    AA.FRST_APRVR_SECD /* 최초결재자구분코드 */,
    AA.FRST_INCDNT_SQNO /* 최초사건순번 */,
    AA.FRST_DSPS_RQT_SQNO /* 최초처분요구순번 */,
    AA.DSPS_RQT_KYWD_CN_1 /* 처분요구키워드내용1 */,
    AA.DSPS_RQT_KYWD_CN_2 /* 처분요구키워드내용2 */,
    AA.DSPS_RQT_KYWD_CN_3 /* 처분요구키워드내용3 */,
    AA.DSPS_RQT_KYWD_CN_4 /* 처분요구키워드내용4 */,
    AA.DSPS_RQT_KYWD_CN_5 /* 처분요구키워드내용5 */
FROM TB_BADDED146M AA , TB_BADDED145M CC WHERE AA.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND AA.APRVR_JBPS_SECD = #APRVR_JBPS_SECD# AND AA.CVLCPT_ADT_YR = CC.ADT_YR AND AA.ADT_NO = CC.ADT_NO AND AA.CVLCPT_DOC_ID = CC.DOC_ID AND AA.APRVR_JBPS_SECD = CC.APRVR_JBPS_SECD AND AA.INCDNT_SQNO = CC.INCDNT_SQNO AND NOT EXISTS ( SELECT 1
FROM TB_BADDED147M ZZ INNER JOIN TB_BADDED148M YY ON ZZ.CVLCPT_ADT_YR = YY.CVLCPT_ADT_YR AND ZZ.ADT_NO = YY.ADT_NO AND ZZ.ADT_STP_SECD = YY.ADT_STP_SECD AND ZZ.CVLCPT_DOC_ID = YY.CVLCPT_DOC_ID AND ZZ.APRVR_JBPS_SECD = YY.APRVR_JBPS_SECD AND ZZ.INCDNT_SQNO = YY.INCDNT_SQNO AND ZZ.DSPS_RQT_SQNO = YY.DSPS_RQT_SQNO AND ZZ.MPNG_SQNO = YY.MPNG_SQNO WHERE ZZ.CVLCPT_ADT_YR = AA.CVLCPT_ADT_YR AND ZZ.ADT_NO = AA.ADT_NO AND ZZ.CVLCPT_DOC_ID = AA.CVLCPT_DOC_ID AND ZZ.BFR_INCDNT_NO = F_MNG_KND_AUDYRNO(AA.CVLCPT_ADT_YR, AA.ADT_NO, AA.ADT_KDCD, '-') || '-' || CC.INCDNT_KDCD || '-' || AA.INCDNT_DSPS_TPCD AND ZZ.APRVR_JBPS_SECD = #APRVR_JBPS_SECD# AND YY.INCDNT_MPNG_SECD IN ( 'D90', 'D70', 'D80', 'D99' ) ) ) ; END;