DECLARE V_IF_SEQ NUMBER(18); V_IF_REF_SEQ NUMBER(18); V_DATA_CNT NUMBER(1); V_SAVE_INF_YN CHAR(1); BEGIN SELECT COUNT(1) INTO AS 1
FROM TBCSPTSM001M WHERE FMDA_AUD_YR = #AUD_YR# AND FMDA_AUD_NO = #AUD_NO#; IF V_DATA_CNT > 0 THEN SELECT NVL(FMDA_PUBLIC_YN,'N') INTO AS FMDA_PUBLIC_YN /* 공개여부에 따라 연계 처리 여부 체크 */
FROM TBCSPTSM001M WHERE FMDA_AUD_YR = #AUD_YR# AND FMDA_AUD_NO = #AUD_NO#; UPDATE TBCSPTSM001M T1 SET FMDA_PROC = #FMDA_PROC# ,  FMDA_UP_DT = SYSDATE ,  FMDA_PUBLIC_DT = TO_DATE(#FMDA_PUBLIC_DT#, 'YYYY/MM/DD HH24:MI:SS') WHERE FMDA_AUD_YR = #AUD_YR# AND FMDA_AUD_NO = #AUD_NO#; IF V_SAVE_INF_YN = 'Y' THEN /*단계 업데이트 시 FMDA_PUBLIC_YN 값이 'Y' 인 경우 연계처리 하도록 수정 2017.07.24 kimsy*/ SELECT IF_SEQ.NEXTVAL INTO AS NEXTVAL
FROM DUAL; SELECT NULL INTO AS V_IF_REF_SEQ
FROM DUAL; INSERT INTO EH_INF_SP_HP_002 (LINK_SQNO, CLM_LINK_TRRC_SECD, LINK_IDNO, USER_HSTRY_SECD, FMDA_IDX, FMDA_AUDIT_ST, FMDA_AUDIT_ET, FMDA_DEPT, FMDA_PART, FMDA_PROC, FMDA_DT, FMDA_TXT, ENAIS_PST_ATCH_FILE_ID, FMDA_SJ, FMDA_RDCNT, FMDA_OPN_REGCNT, FMDA_UP_DT, USE_AT, FMDA_PUBLIC_DT, FMDA_PUBLIC_YN, REG_SECD) SELECT V_IF_SEQ,
    'SND',
    '',
    'COMTMEDIA',
    FMDA_IDX,
    FMDA_AUDIT_ST,
    FMDA_AUDIT_ET,
    FMDA_DEPT,
    FMDA_PART,
    FMDA_PROC,
    FMDA_DT,
    FMDA_TXT,
    ENAIS_PST_ATCH_FILE_ID /* ENAIS게시물첨부파일아이디 */,
    FMDA_SJ,
    FMDA_RDCNT,
    FMDA_OPN_REGCNT,
    FMDA_UP_DT,
    USE_AT,
    FMDA_PUBLIC_DT,
    FMDA_PUBLIC_YN,
    'U'
FROM TBCSPTSM001M T1 WHERE T1.FMDA_AUD_YR = #AUD_YR# AND T1.FMDA_AUD_NO = #AUD_NO#; INSERT INTO BAI_INF_DB_SND_001 (LINK_SQNO /*연계순번*/, LINK_TBL_NM /*테이블명*/, LINK_RFRNC_SQNO /*참조연계순번*/, LINK_STTS_SECD /*연계상태코드*/, ENAIS_ATCH_FILE_LINK_CTPV_NMTM /*연계시도횟수*/, LINK_REG_DT /*IF_RAISE_DT*/) VALUES ( V_IF_SEQ ,'EH_INF_SP_HP_002' ,V_IF_REF_SEQ ,'SS' ,0 ,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') ) ; END IF; END IF; END;