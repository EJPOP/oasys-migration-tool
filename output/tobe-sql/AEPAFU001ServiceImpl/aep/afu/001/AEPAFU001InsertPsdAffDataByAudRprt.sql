DECLARE BEGIN INSERT INTO TB_BADDED145H (HSTRY_SECD, FNNC_INFO_SBMSN_RQT_HSTRY_SQNO, CVLCPT_HSTRY_DT, HSTRY_USER_ID, CVLCPT_ADT_YR, ADT_NO, ADT_STP_SECD, CVLCPT_DOC_ID, APRVR_JBPS_SECD, INCDNT_SQNO, ADT_KDCD, ADT_GRNT_NO, RPTP_FLD_ID, INCDNT_KDCD, LIST_SQNO, SBCN_SECD, INCDNT_FLD_CN, SBCM_AGND_NM, INDCT_TTL, QPB_YN, QPB_YMD, ADTR_NM, DTL_DOC_NO, DATA_INPT_SECD, SNTHS_DPP_SE_YN, SCRT_YN /* 증권여부 */, SRECS_SORT_SQNO, DPP_RVWR_ENO, FRST_USER_ID, LAST_USER_ID, LAST_PRCS_DEPT_CD, LAST_MENU_ID, FRST_REG_DT, LAST_MDFCN_DT, CMPTN_YN) ( SELECT 'C',
    TBBADDED145H_SEQ.NEXTVAL,
    SYSDATE,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    ADT_STP_SECD /* 감사단계구분코드 */,
    CVLCPT_DOC_ID /* 민원문서아이디 */,
    APRVR_JBPS_SECD /* 결재자직위구분코드 */,
    INCDNT_SQNO /* 사건순번 */,
    ADT_KDCD /* 감사종류코드 */,
    ADT_GRNT_NO /* 감사부여번호 */,
    RPTP_FLD_ID /* 보고서분야아이디 */,
    INCDNT_KDCD /* 사건종류코드 */,
    LIST_SQNO /* 목록순번 */,
    SBCN_SECD /* 부의구분코드 */,
    INCDNT_FLD_CN /* 사건분야내용 */,
    SBCM_AGND_NM /* 소위원회안건명 */,
    SBCM_AGND_NM /* 소위원회안건명 */,
    QPB_YN /* 질문서발부여부 */,
    QPB_YMD /* 질문서발부일자 */,
    ADTR_NM /* 감사인명 */,
    DTL_DOC_NO /* 상세문서번호 */,
    DATA_INPT_SECD /* 자료입력구분코드 */,
    SNTHS_DPP_SE_YN /* 종합처리안구분여부 */,
    SCRT_YN /* 증권여부 */,
    SRECS_SORT_SQNO /* 심사재심의정렬순번 */,
    DPP_RVWR_ENO /* 처리안검토자직원전산번호 */,
    FRST_USER_ID /* 최초사용자아이디 */,
    LAST_USER_ID /* 최종사용자아이디 */,
    LAST_PRCS_DEPT_CD /* 최종처리부서코드 */,
    LAST_MENU_ID /* 최종메뉴아이디 */,
    FRST_REG_DT /* 최초등록일시 */,
    LAST_MDFCN_DT /* 최종수정일시 */,
    CMPTN_YN /* 완료여부 */
FROM (SELECT DISTINCT AA.ADT_YR AS ADT_YR /* 감사년도 */,
    AA.ADT_NO /* 감사번호 */,
    'A1060' AS ADT_STP_SECD /* 감사단계구분코드 */,
    AA.CVLCPT_DOC_ID /* 문서아이디 */,
    '0055700' AS APRVR_JBPS_SECD /* 결재자직위구분코드 */,
    AA.INCDNT_SQNO /* 사건순번 */,
    AA.ADT_KDCD /* 감사종류코드 */,
    AA.ADT_GRNT_NO /* 감사부여번호 */,
    AA.RPTP_FLD_ID /* 보고서분야아이디 */,
    AA.INCDNT_KDCD /* 사건종류코드 */,
    AA.LIST_SQNO /* 목록순번 */,
    AA.SBCN_SECD /* 부의구분코드 */,
    AA.INCDNT_FLD_CN /* 사건분야내용 */,
    AA.INCDNT_NM /* 사건명 */,
    AA.QPB_YN /* 질문서발부여부 */,
    AA.QPB_YMD /* 질문서발부일자 */,
    AA.ADTR_NM /* 감사인명 */,
    AA.DTL_DOC_NO /* 상세문서번호 */,
    AA.DATA_INPT_SECD /* 자료입력구분코드 */,
    AA.SNTHS_DPP_SE_YN /* 종합처리안구분여부 */,
    AA.SCRT_YN /* 증권여부 */,
    AA.SORT_SQNO /* 정렬순번 */,
    AA.DPP_RVWR_ENO /* 처리안검토자직원전산번호 */,
    #FNL_USR_ID# AS FRST_USER_ID /* 최초사용자아이디 */,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    #FNL_DEAL_DPT_CD# AS LAST_PRCS_DEPT_CD /* 최종처리부서코드 */,
    #FNL_MNU_ID# AS LAST_MENU_ID /* 최종메뉴아이디 */,
    SYSDATE AS FRST_REG_DT,
    SYSDATE AS LAST_MDFCN_DT,
    AA.CMPTN_YN /* 완료여부 */
FROM TBBADDED145M AA , TBBADDED146M CC WHERE AA.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND AA.APRVR_JBPS_SECD IN ( '0055600', '0045900') AND AA.CVLCPT_ADT_YR = CC.ADT_YR AND AA.ADT_NO = CC.ADT_NO AND AA.CVLCPT_DOC_ID = CC.DOC_ID AND AA.APRVR_JBPS_SECD = CC.APRVR_JBPS_SECD AND AA.INCDNT_SQNO = CC.INCDNT_SQNO AND NOT EXISTS ( SELECT 1
FROM TBBADDED147M ZZ INNER JOIN TBBADDED148M YY ON ZZ.CVLCPT_ADT_YR = YY.CVLCPT_ADT_YR AND ZZ.ADT_NO = YY.ADT_NO AND ZZ.ADT_STP_SECD = YY.ADT_STP_SECD AND ZZ.CVLCPT_DOC_ID = YY.CVLCPT_DOC_ID AND ZZ.APRVR_JBPS_SECD = YY.APRVR_JBPS_SECD AND ZZ.INCDNT_SQNO = YY.INCDNT_SQNO AND ZZ.DSPS_RQT_SQNO = YY.DSPS_RQT_SQNO AND ZZ.MPNG_SQNO = YY.MPNG_SQNO WHERE ZZ.CVLCPT_ADT_YR = AA.CVLCPT_ADT_YR AND ZZ.ADT_NO = AA.ADT_NO AND ZZ.CVLCPT_DOC_ID = AA.CVLCPT_DOC_ID AND ZZ.BFR_INCDNT_NO = F_MNG_KND_AUDYRNO(AA.CVLCPT_ADT_YR, AA.ADT_NO, AA.ADT_KDCD, '-') || '-' || AA.INCDNT_KDCD || '-' || CC.INCDNT_DSPS_TPCD AND ZZ.APRVR_JBPS_SECD = '0055700' AND YY.INCDNT_MPNG_SECD IN ( 'D90', 'D70', 'D80', 'D99' ) ) ) ) ; INSERT INTO TB_BADDED145M (CVLCPT_ADT_YR, ADT_NO, ADT_STP_SECD, CVLCPT_DOC_ID, APRVR_JBPS_SECD, INCDNT_SQNO, ADT_KDCD, ADT_GRNT_NO, RPTP_FLD_ID, INCDNT_KDCD, LIST_SQNO, SBCN_SECD, INCDNT_FLD_CN, SBCM_AGND_NM, INDCT_TTL, QPB_YN, QPB_YMD, ADTR_NM, DTL_DOC_NO, DATA_INPT_SECD, SNTHS_DPP_SE_YN, SCRT_YN /* 증권여부 */, SRECS_SORT_SQNO, DPP_RVWR_ENO, FRST_USER_ID, LAST_USER_ID, LAST_PRCS_DEPT_CD, LAST_MENU_ID, FRST_REG_DT, LAST_MDFCN_DT, CMPTN_YN) (SELECT DISTINCT AA.ADT_YR AS ADT_YR /* 감사년도 */,
    AA.ADT_NO /* 감사번호 */,
    'A1060',
    AA.CVLCPT_DOC_ID /* 문서아이디 */,
    '0055700',
    AA.INCDNT_SQNO /* 사건순번 */,
    AA.ADT_KDCD /* 감사종류코드 */,
    AA.ADT_GRNT_NO /* 감사부여번호 */,
    AA.RPTP_FLD_ID /* 보고서분야아이디 */,
    AA.INCDNT_KDCD /* 사건종류코드 */,
    AA.LIST_SQNO /* 목록순번 */,
    AA.SBCN_SECD /* 부의구분코드 */,
    AA.INCDNT_FLD_CN /* 사건분야내용 */,
    AA.INCDNT_NM /* 사건명 */,
    AA.INCDNT_NM /* 사건명 */,
    AA.QPB_YN /* 질문서발부여부 */,
    AA.QPB_YMD /* 질문서발부일자 */,
    AA.ADTR_NM /* 감사인명 */,
    AA.DTL_DOC_NO /* 상세문서번호 */,
    AA.DATA_INPT_SECD /* 자료입력구분코드 */,
    AA.SNTHS_DPP_SE_YN /* 종합처리안구분여부 */,
    AA.SCRT_YN /* 증권여부 */,
    AA.SORT_SQNO /* 정렬순번 */,
    AA.DPP_RVWR_ENO /* 처리안검토자직원전산번호 */,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    #FNL_DEAL_DPT_CD# AS LAST_PRCS_DEPT_CD /* 최종처리부서코드 */,
    #FNL_MNU_ID# AS LAST_MENU_ID /* 최종메뉴아이디 */,
    SYSDATE,
    SYSDATE,
    AA.CMPTN_YN /* 완료여부 */
FROM TB_BADDED145M AA , TB_BADDED146M CC WHERE AA.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND AA.APRVR_JBPS_SECD IN ( '0055600', '0045900') AND AA.CVLCPT_ADT_YR = CC.ADT_YR AND AA.ADT_NO = CC.ADT_NO AND AA.CVLCPT_DOC_ID = CC.DOC_ID AND AA.APRVR_JBPS_SECD = CC.APRVR_JBPS_SECD AND AA.INCDNT_SQNO = CC.INCDNT_SQNO AND NOT EXISTS ( SELECT 1
FROM TB_BADDED147M ZZ INNER JOIN TB_BADDED148M YY ON ZZ.CVLCPT_ADT_YR = YY.CVLCPT_ADT_YR AND ZZ.ADT_NO = YY.ADT_NO AND ZZ.ADT_STP_SECD = YY.ADT_STP_SECD AND ZZ.CVLCPT_DOC_ID = YY.CVLCPT_DOC_ID AND ZZ.APRVR_JBPS_SECD = YY.APRVR_JBPS_SECD AND ZZ.INCDNT_SQNO = YY.INCDNT_SQNO AND ZZ.DSPS_RQT_SQNO = YY.DSPS_RQT_SQNO AND ZZ.MPNG_SQNO = YY.MPNG_SQNO WHERE ZZ.CVLCPT_ADT_YR = AA.CVLCPT_ADT_YR AND ZZ.ADT_NO = AA.ADT_NO AND ZZ.CVLCPT_DOC_ID = AA.CVLCPT_DOC_ID AND ZZ.BFR_INCDNT_NO = F_MNG_KND_AUDYRNO(AA.CVLCPT_ADT_YR, AA.ADT_NO, AA.ADT_KDCD, '-') || '-' || AA.INCDNT_KDCD || '-' || CC.INCDNT_DSPS_TPCD AND ZZ.APRVR_JBPS_SECD = '0055700' AND YY.INCDNT_MPNG_SECD IN ( 'D90', 'D70', 'D80', 'D99' ) ) ) ; END;