DECLARE BEGIN INSERT INTO TB_BADDED147H (HSTRY_SECD, FNNC_INFO_SBMSN_RQT_HSTRY_SQNO, CVLCPT_HSTRY_DT, HSTRY_USER_ID, CVLCPT_ADT_YR, ADT_NO, ADT_STP_SECD, APRVR_JBPS_SECD, ADT_KDCD, ADT_GRNT_NO, CVLCPT_DOC_ID, RPTP_FLD_ID, BFR_INCDNT_NO, INCDNT_NO, INCDNT_SQNO, DSPS_RQT_SQNO, MPNG_SQNO, SRECS_SORT_SQNO, FRST_USER_ID, LAST_USER_ID, LAST_PRCS_DEPT_CD, LAST_MENU_ID, FRST_REG_DT, LAST_MDFCN_DT) ( SELECT 'C',
    TBBADDED147H_SEQ.NEXTVAL,
    SYSDATE,
    (SELECT AS USER_ID /* 사용자아이디 */
FROM TBDCMACM001M WHERE TRGT_NOP_ENO = T1.APRVR_ENO) , CVLCPT_ADT_YR , ADT_NO , ADT_STP_SECD , #APVR_PST_CD# , ADT_KDCD , ADT_GRNT_NO , CVLCPT_DOC_ID , RPTP_FLD_ID , INCDNT_NO , INCDNT_NO , INCDNT_SQNO , DSPS_RQT_SQNO , SEQ_MPP.NEXTVAL , SRECS_SORT_SQNO , (SELECT USER_ID /* 사용자아이디 */
FROM TBDCMACM001M WHERE TRGT_NOP_ENO = T1.APRVR_ENO) , (SELECT USER_ID /* 사용자아이디 */
FROM TBDCMACM001M WHERE TRGT_NOP_ENO = T1.APRVR_ENO) , (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TBDCMACM001M WHERE TRGT_NOP_ENO = T1.APRVR_ENO) , #FNL_MNU_ID# , SYSDATE , SYSDATE FROM (SELECT DISTINCT AA.ADT_YR AS ADT_YR /* 감사년도 */,
    AA.ADT_NO /* 감사번호 */,
    DECODE(#APVR_PST_CD#, '0010600', 'A1070', AA.ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */,
    AA.ADT_KDCD /* 감사종류코드 */,
    MAX(AA.ADT_GRNT_NO) AS ADT_GRNT_NO /* 감사부여번호 */,
    AA.CVLCPT_DOC_ID /* 문서아이디 */,
    MAX(AA.RPTP_FLD_ID) AS RPTP_FLD_ID /* 보고서분야아이디 */,
    AA.INCDNT_NO /* 사건번호 */,
    AA.INCDNT_SQNO /* 사건순번 */,
    AA.DSPS_RQT_SQNO /* 처분요구순번 */,
    MIN(AA.SORT_SQNO) AS SRECS_SORT_SQNO /* 심사재심의정렬순번 */,
    BB.APRVR_ENO /* 결재자직원전산번호 */
FROM TBBADDED147M AA LEFT OUTER JOIN TBBADDED148M DD ON AA.CVLCPT_ADT_YR = DD.CVLCPT_ADT_YR AND AA.ADT_NO = DD.ADT_NO AND AA.ADT_STP_SECD = DD.ADT_STP_SECD AND AA.CVLCPT_DOC_ID = DD.CVLCPT_DOC_ID AND AA.APRVR_JBPS_SECD = DD.APRVR_JBPS_SECD AND AA.INCDNT_SQNO = DD.INCDNT_SQNO AND AA.DSPS_RQT_SQNO = DD.DSPS_RQT_SQNO AND AA.MPNG_SQNO = DD.MPNG_SQNO , ( SELECT A.CVLCPT_DOC_ID /* 민원문서아이디 */,
    B.APRVR_ENO /* 결재자직원전산번호 */,
    CASE WHEN B.APRVR_JBPS_SECD IN ('0058100','0035100') THEN '0015800' WHEN B.APRVR_JBPS_SECD = ('0045900') THEN '0055600' WHEN B.APRVR_JBPS_SECD IN ('0057400','0035400') THEN '0013600' ELSE B.APRVR_JBPS_SECD END AS APRVR_JBPS_SECD /* 결재자직위구분코드 */
FROM TBBADDED103M A , TBDCMACM023L B WHERE B.ATRZ_DOC_NO = #ATRZ_DOC_NO# AND A.ATRZ_DMND_ID = B.ATRZ_DOC_NO AND B.APV_SNO = ( SELECT MAX(D.APV_SNO)
FROM TBBADDED103M C , TBDCMACM023L D WHERE D.ATRZ_DOC_NO = B.ATRZ_DOC_NO AND C.ATRZ_DMND_ID = D.ATRZ_DOC_NO AND D.APV_SNO <> 1 AND C.SLCT_RPTP_KDCD = #SLCT_RPTP_KDCD# AND C.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# /* AND D.APVR_STA_CD IN ('202','203','204')*/ AND D.APRVR_JBPS_SECD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400') ) AND A.SLCT_RPTP_KDCD = #SLCT_RPTP_KDCD# /* AND B.APVR_STA_CD IN ('202','203','204')*/ AND A.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND ROWNUM = 1 ) BB WHERE AA.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND AA.CVLCPT_DOC_ID = BB.CVLCPT_DOC_ID /* AND CASE WHEN AA.APVR_CD IN ('0058100','0035100') THEN '0015800' WHEN AA.APVR_CD = ('0045900') THEN '0055600' ELSE AA.APVR_CD END = BB.APVR_PST_CD */ AND (DD.INCDNT_MPNG_SECD IS NULL OR DD.INCDNT_MPNG_SECD NOT IN ( 'D90', 'D70', 'D80', 'D99' ) ) GROUP BY AA.CVLCPT_ADT_YR, AA.ADT_NO, AA.ADT_STP_SECD, AA.ADT_KDCD, AA.CVLCPT_DOC_ID, AA.INCDNT_NO, AA.INCDNT_SQNO, AA.DSPS_RQT_SQNO, BB.APRVR_ENO) T1) ; INSERT INTO TB_BADDED147M (CVLCPT_ADT_YR, ADT_NO, ADT_STP_SECD, APRVR_JBPS_SECD, ADT_KDCD, ADT_GRNT_NO, CVLCPT_DOC_ID, RPTP_FLD_ID, BFR_INCDNT_NO, INCDNT_NO, INCDNT_SQNO, DSPS_RQT_SQNO, MPNG_SQNO, SRECS_SORT_SQNO, FRST_USER_ID, LAST_USER_ID, LAST_PRCS_DEPT_CD, LAST_MENU_ID, FRST_REG_DT, LAST_MDFCN_DT) ( SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    ADT_STP_SECD /* 감사단계구분코드 */,
    #APVR_PST_CD# AS APRVR_JBPS_SECD /* 결재자직위구분코드 */,
    ADT_KDCD /* 감사종류코드 */,
    ADT_GRNT_NO /* 감사부여번호 */,
    CVLCPT_DOC_ID /* 민원문서아이디 */,
    RPTP_FLD_ID /* 보고서분야아이디 */,
    INCDNT_NO /* 사건번호 */,
    INCDNT_NO /* 사건번호 */,
    INCDNT_SQNO /* 사건순번 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    SEQ_MPP.NEXTVAL,
    SRECS_SORT_SQNO /* 심사재심의정렬순번 */,
    (SELECT AS USER_ID /* 사용자아이디 */
FROM TBDCMACM001M WHERE TRGT_NOP_ENO = T1.APRVR_ENO) , (SELECT USER_ID /* 사용자아이디 */
FROM TBDCMACM001M WHERE TRGT_NOP_ENO = T1.APRVR_ENO) , (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TBDCMACM001M WHERE TRGT_NOP_ENO = T1.APRVR_ENO) , #FNL_MNU_ID# , SYSDATE , SYSDATE FROM (SELECT DISTINCT AA.ADT_YR AS ADT_YR /* 감사년도 */,
    AA.ADT_NO /* 감사번호 */,
    DECODE(#APVR_PST_CD#, '0010600', 'A1070', AA.ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */,
    AA.ADT_KDCD /* 감사종류코드 */,
    MAX(AA.ADT_GRNT_NO) AS ADT_GRNT_NO /* 감사부여번호 */,
    AA.CVLCPT_DOC_ID /* 문서아이디 */,
    MAX(AA.RPTP_FLD_ID) AS RPTP_FLD_ID /* 보고서분야아이디 */,
    AA.INCDNT_NO /* 사건번호 */,
    AA.INCDNT_SQNO /* 사건순번 */,
    AA.DSPS_RQT_SQNO /* 처분요구순번 */,
    MIN(AA.SORT_SQNO) AS SRECS_SORT_SQNO /* 심사재심의정렬순번 */,
    BB.APRVR_ENO /* 결재자직원전산번호 */
FROM TBBADDED147M AA LEFT OUTER JOIN TBBADDED148M DD ON AA.CVLCPT_ADT_YR = DD.CVLCPT_ADT_YR AND AA.ADT_NO = DD.ADT_NO AND AA.ADT_STP_SECD = DD.ADT_STP_SECD AND AA.CVLCPT_DOC_ID = DD.CVLCPT_DOC_ID AND AA.APRVR_JBPS_SECD = DD.APRVR_JBPS_SECD AND AA.INCDNT_SQNO = DD.INCDNT_SQNO AND AA.DSPS_RQT_SQNO = DD.DSPS_RQT_SQNO AND AA.MPNG_SQNO = DD.MPNG_SQNO , ( SELECT A.CVLCPT_DOC_ID /* 민원문서아이디 */,
    B.APRVR_ENO /* 결재자직원전산번호 */,
    CASE WHEN B.APRVR_JBPS_SECD IN ('0058100','0035100') THEN '0015800' WHEN B.APRVR_JBPS_SECD = ('0045900') THEN '0055600' WHEN B.APRVR_JBPS_SECD IN ('0057400','0035400') THEN '0013600' ELSE B.APRVR_JBPS_SECD END AS APRVR_JBPS_SECD /* 결재자직위구분코드 */
FROM TBBADDED103M A , TBDCMACM023L B WHERE B.ATRZ_DOC_NO = #ATRZ_DOC_NO# AND A.ATRZ_DMND_ID = B.ATRZ_DOC_NO AND B.APV_SNO = ( SELECT MAX(D.APV_SNO)
FROM TBBADDED103M C , TBDCMACM023L D WHERE D.ATRZ_DOC_NO = B.ATRZ_DOC_NO AND C.ATRZ_DMND_ID = D.ATRZ_DOC_NO AND D.APV_SNO <> 1 AND C.SLCT_RPTP_KDCD = #SLCT_RPTP_KDCD# AND C.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# /* AND D.APVR_STA_CD IN ('202','203','204')*/ AND D.APRVR_JBPS_SECD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400') ) AND A.SLCT_RPTP_KDCD = #SLCT_RPTP_KDCD# /* AND B.APVR_STA_CD IN ('202','203','204')*/ AND A.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND ROWNUM = 1 ) BB WHERE AA.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND AA.CVLCPT_DOC_ID = BB.CVLCPT_DOC_ID /* AND CASE WHEN AA.APVR_CD IN ('0058100','0035100') THEN '0015800' WHEN AA.APVR_CD = ('0045900') THEN '0055600' ELSE AA.APVR_CD END = BB.APVR_PST_CD */ AND (DD.INCDNT_MPNG_SECD IS NULL OR DD.INCDNT_MPNG_SECD NOT IN ( 'D90', 'D70', 'D80', 'D99' ) ) GROUP BY AA.CVLCPT_ADT_YR, AA.ADT_NO, AA.ADT_STP_SECD, AA.ADT_KDCD, AA.CVLCPT_DOC_ID, AA.INCDNT_NO, AA.INCDNT_SQNO, AA.DSPS_RQT_SQNO, BB.APRVR_ENO) T1) ; END;