DECLARE BEGIN INSERT INTO TB_BADDED147H (HSTRY_SECD, FNNC_INFO_SBMSN_RQT_HSTRY_SQNO, CVLCPT_HSTRY_DT, HSTRY_USER_ID, CVLCPT_ADT_YR, ADT_NO, ADT_STP_SECD, APRVR_JBPS_SECD, ADT_KDCD, ADT_GRNT_NO, CVLCPT_DOC_ID, RPTP_FLD_ID, BFR_INCDNT_NO, INCDNT_NO, INCDNT_SQNO, DSPS_RQT_SQNO, MPNG_SQNO, SRECS_SORT_SQNO, FRST_USER_ID, LAST_USER_ID, LAST_PRCS_DEPT_CD, LAST_MENU_ID, FRST_REG_DT, LAST_MDFCN_DT) ( SELECT 'C',
    TBBADDED147H_SEQ.NEXTVAL,
    SYSDATE,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    'A1070',
    #TARGET_APVR_CD#,
    ADT_KDCD /* 감사종류코드 */,
    ADT_GRNT_NO /* 감사부여번호 */,
    CVLCPT_DOC_ID /* 민원문서아이디 */,
    RPTP_FLD_ID /* 보고서분야아이디 */,
    INCDNT_NO /* 사건번호 */,
    INCDNT_NO /* 사건번호 */,
    INCDNT_SQNO /* 사건순번 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    SEQ_MPP.NEXTVAL,
    SRECS_SORT_SQNO /* 심사재심의정렬순번 */,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    #FNL_DEAL_DPT_CD# AS LAST_PRCS_DEPT_CD /* 최종처리부서코드 */,
    #FNL_MNU_ID# AS LAST_MENU_ID /* 최종메뉴아이디 */,
    SYSDATE,
    SYSDATE
FROM (SELECT DISTINCT AA.ADT_YR AS ADT_YR /* 감사년도 */,
    AA.ADT_NO /* 감사번호 */,
    AA.ADT_KDCD /* 감사종류코드 */,
    MAX(AA.ADT_GRNT_NO) AS ADT_GRNT_NO /* 감사부여번호 */,
    AA.CVLCPT_DOC_ID /* 문서아이디 */,
    MAX(AA.RPTP_FLD_ID) AS RPTP_FLD_ID /* 보고서분야아이디 */,
    AA.INCDNT_NO /* 사건번호 */,
    AA.INCDNT_SQNO /* 사건순번 */,
    AA.DSPS_RQT_SQNO /* 처분요구순번 */,
    MIN(AA.SORT_SQNO) AS SRECS_SORT_SQNO /* 심사재심의정렬순번 */
FROM TBBADDED147M AA LEFT OUTER JOIN TBBADDED148M BB ON AA.CVLCPT_ADT_YR = BB.CVLCPT_ADT_YR AND AA.ADT_NO = BB.ADT_NO AND AA.ADT_STP_SECD = BB.ADT_STP_SECD AND AA.CVLCPT_DOC_ID = BB.CVLCPT_DOC_ID AND AA.APRVR_JBPS_SECD = BB.APRVR_JBPS_SECD AND AA.INCDNT_SQNO = BB.INCDNT_SQNO AND AA.DSPS_RQT_SQNO = BB.DSPS_RQT_SQNO AND AA.MPNG_SQNO = BB.MPNG_SQNO WHERE AA.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND AA.APRVR_JBPS_SECD = #APRVR_JBPS_SECD# AND (BB.INCDNT_MPNG_SECD IS NULL OR BB.INCDNT_MPNG_SECD NOT IN('D90', 'D70', 'D80', 'D99' ) ) GROUP BY AA.CVLCPT_ADT_YR , AA.ADT_NO , AA.ADT_KDCD , AA.CVLCPT_DOC_ID , AA.INCDNT_NO , AA.INCDNT_SQNO , AA.DSPS_RQT_SQNO ) ) ; INSERT INTO TB_BADDED147M (CVLCPT_ADT_YR, ADT_NO, ADT_STP_SECD, APRVR_JBPS_SECD, ADT_KDCD, ADT_GRNT_NO, CVLCPT_DOC_ID, RPTP_FLD_ID, BFR_INCDNT_NO, INCDNT_NO, INCDNT_SQNO, DSPS_RQT_SQNO, MPNG_SQNO, SRECS_SORT_SQNO, FRST_USER_ID, LAST_USER_ID, LAST_PRCS_DEPT_CD, LAST_MENU_ID, FRST_REG_DT, LAST_MDFCN_DT) ( SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    'A1070',
    #TARGET_APVR_CD#,
    ADT_KDCD /* 감사종류코드 */,
    ADT_GRNT_NO /* 감사부여번호 */,
    CVLCPT_DOC_ID /* 민원문서아이디 */,
    RPTP_FLD_ID /* 보고서분야아이디 */,
    INCDNT_NO /* 사건번호 */,
    INCDNT_NO /* 사건번호 */,
    INCDNT_SQNO /* 사건순번 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    SEQ_MPP.NEXTVAL,
    SRECS_SORT_SQNO /* 심사재심의정렬순번 */,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    #FNL_USR_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    #FNL_DEAL_DPT_CD# AS LAST_PRCS_DEPT_CD /* 최종처리부서코드 */,
    #FNL_MNU_ID# AS LAST_MENU_ID /* 최종메뉴아이디 */,
    SYSDATE,
    SYSDATE
FROM (SELECT DISTINCT AA.ADT_YR AS ADT_YR /* 감사년도 */,
    AA.ADT_NO /* 감사번호 */,
    AA.ADT_KDCD /* 감사종류코드 */,
    MAX(AA.ADT_GRNT_NO) AS ADT_GRNT_NO /* 감사부여번호 */,
    AA.CVLCPT_DOC_ID /* 문서아이디 */,
    MAX(AA.RPTP_FLD_ID) AS RPTP_FLD_ID /* 보고서분야아이디 */,
    AA.INCDNT_NO /* 사건번호 */,
    AA.INCDNT_SQNO /* 사건순번 */,
    AA.DSPS_RQT_SQNO /* 처분요구순번 */,
    MIN(AA.SORT_SQNO) AS SRECS_SORT_SQNO /* 심사재심의정렬순번 */
FROM TBBADDED147M AA LEFT OUTER JOIN TBBADDED148M BB ON AA.CVLCPT_ADT_YR = BB.CVLCPT_ADT_YR AND AA.ADT_NO = BB.ADT_NO AND AA.ADT_STP_SECD = BB.ADT_STP_SECD AND AA.CVLCPT_DOC_ID = BB.CVLCPT_DOC_ID AND AA.APRVR_JBPS_SECD = BB.APRVR_JBPS_SECD AND AA.INCDNT_SQNO = BB.INCDNT_SQNO AND AA.DSPS_RQT_SQNO = BB.DSPS_RQT_SQNO AND AA.MPNG_SQNO = BB.MPNG_SQNO WHERE AA.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND AA.APRVR_JBPS_SECD = #APRVR_JBPS_SECD# AND (BB.INCDNT_MPNG_SECD IS NULL OR BB.INCDNT_MPNG_SECD NOT IN('D90', 'D70', 'D80', 'D99' ) ) GROUP BY AA.CVLCPT_ADT_YR , AA.ADT_NO , AA.ADT_KDCD , AA.CVLCPT_DOC_ID , AA.INCDNT_NO , AA.INCDNT_SQNO , AA.DSPS_RQT_SQNO ) ) ; END;