INSERT INTO TB_BADDED146D (CVLCPT_ADT_YR, ADT_NO, ADT_STP_SECD, CVLCPT_DOC_ID, APRVR_JBPS_SECD, INCDNT_SQNO, DSPS_RQT_SQNO, TRPR_SQNO, TRPR_NM, TRPR_BRDT, TRPR_JBGD_SECD, TRPR_INST_CD, TRPR_DEPT_NM, FRST_USER_ID, LAST_USER_ID, LAST_PRCS_DEPT_CD, LAST_MENU_ID, FRST_REG_DT, LAST_MDFCN_DT) ( SELECT AA.ADT_YR /* 감사년도 */,
    AA.ADT_NO /* 감사번호 */,
    'A1070',
    AA.CVLCPT_DOC_ID /* 문서아이디 */,
    #APRVR_JBPS_SECD#,
    AA.INCDNT_SQNO /* 사건순번 */,
    AA.DSPS_RQT_SQNO /* 처분요구순번 */,
    (SELECT NVL(MAX(ST.TRPR_SQNO),0)+1 AS TRPR_SQNO /* 대상자순번 */
FROM TB_BADDED146D ST WHERE ST.CVLCPT_ADT_YR = AA.CVLCPT_ADT_YR AND ST.ADT_NO = AA.ADT_NO AND ST.ADT_STP_SECD = AA.ADT_STP_SECD AND ST.CVLCPT_DOC_ID = AA.CVLCPT_DOC_ID AND ST.APRVR_JBPS_SECD = #APRVR_JBPS_SECD# AND ST.INCDNT_SQNO = AA.INCDNT_SQNO AND ST.DSPS_RQT_SQNO = AA.DSPS_RQT_SQNO) AS TRPR_SQNO , AA.TRPR_NM , AA.TRPR_BRDT , AA.TRPR_JBGD_SECD , AA.TRPR_INST_CD , AA.TRPR_DEPT_NM , #FNL_USR_ID# , #FNL_USR_ID# , #FNL_DEAL_DPT_CD# , #FNL_MNU_ID# , SYSDATE , SYSDATE FROM TB_BADDED146D AA , TB_BADDED145M CC WHERE AA.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND AA.APRVR_JBPS_SECD = #APRVR_JBPS_SECD# AND AA.CVLCPT_ADT_YR = CC.ADT_YR AND AA.ADT_NO = CC.ADT_NO AND AA.CVLCPT_DOC_ID = CC.DOC_ID AND AA.APRVR_JBPS_SECD = CC.APRVR_JBPS_SECD AND AA.INCDNT_SQNO = CC.INCDNT_SQNO AND NOT EXISTS ( SELECT 1
FROM TB_BADDED146D ZZ WHERE ZZ.CVLCPT_ADT_YR = AA.CVLCPT_ADT_YR AND ZZ.ADT_NO = AA.ADT_NO AND ZZ.ADT_STP_SECD = AA.ADT_STP_SECD AND ZZ.CVLCPT_DOC_ID = AA.CVLCPT_DOC_ID AND ZZ.APRVR_JBPS_SECD = #APRVR_JBPS_SECD# AND ZZ.INCDNT_SQNO = AA.INCDNT_SQNO AND ZZ.DSPS_RQT_SQNO = AA.DSPS_RQT_SQNO AND ZZ.TRPR_NM = AA.TRPR_NM AND ZZ.TRPR_BRDT = AA.TRPR_BRDT ) AND NOT EXISTS ( SELECT 1
FROM TB_BADDED147M ZZ INNER JOIN TB_BADDED148M YY ON ZZ.CVLCPT_ADT_YR = YY.CVLCPT_ADT_YR AND ZZ.ADT_NO = YY.ADT_NO AND ZZ.ADT_STP_SECD = YY.ADT_STP_SECD AND ZZ.CVLCPT_DOC_ID = YY.CVLCPT_DOC_ID AND ZZ.APRVR_JBPS_SECD = YY.APRVR_JBPS_SECD AND ZZ.INCDNT_SQNO = YY.INCDNT_SQNO AND ZZ.DSPS_RQT_SQNO = YY.DSPS_RQT_SQNO AND ZZ.MPNG_SQNO = YY.MPNG_SQNO WHERE ZZ.CVLCPT_ADT_YR = AA.CVLCPT_ADT_YR AND ZZ.ADT_NO = AA.ADT_NO AND ZZ.CVLCPT_DOC_ID = AA.CVLCPT_DOC_ID AND ZZ.BFR_INCDNT_NO = F_MNG_KND_AUDYRNO(AA.CVLCPT_ADT_YR, AA.ADT_NO, CC.ADT_KDCD, '-') || '-' || CC.INCDNT_KDCD || '-' || (SELECT ST.INCDNT_DSPS_TPCD /* 사건처분유형코드 */
FROM TB_BADDED146M ST WHERE ST.CVLCPT_ADT_YR = AA.CVLCPT_ADT_YR AND ST.ADT_NO = AA.ADT_NO AND ST.ADT_STP_SECD = AA.ADT_STP_SECD AND ST.CVLCPT_DOC_ID = AA.CVLCPT_DOC_ID AND ST.APRVR_JBPS_SECD = AA.APRVR_JBPS_SECD AND ST.INCDNT_SQNO = AA.INCDNT_SQNO AND ST.DSPS_RQT_SQNO = AA.DSPS_RQT_SQNO) AND ZZ.APRVR_JBPS_SECD = #APRVR_JBPS_SECD# AND YY.INCDNT_MPNG_SECD IN ( 'D90', 'D70', 'D80', 'D99' ) ) )