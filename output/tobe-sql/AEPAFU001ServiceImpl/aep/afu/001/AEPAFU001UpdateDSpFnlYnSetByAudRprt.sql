DECLARE BEGIN UPDATE TB_BADDED146M SET CMPTN_YN = 'Y' /* 완료여부 */WHERE CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND APRVR_JBPS_SECD = (SELECT MAX(B.APRVR_JBPS_SECD) AS APRVR_JBPS_SECD /* 결재자직위구분코드 */
FROM TB_BADDED103M A , TBDCMACM023L B WHERE B.ATRZ_DOC_NO = #ATRZ_DOC_NO# AND A.ATRZ_DMND_ID = B.ATRZ_DOC_NO AND B.APV_SNO = ( SELECT MAX(D.APV_SNO)
FROM TB_BADDED103M C , TBDCMACM023L D WHERE D.ATRZ_DOC_NO = B.ATRZ_DOC_NO AND C.ATRZ_DMND_ID = D.ATRZ_DOC_NO AND D.APV_SNO <> 1 AND C.SLCT_RPTP_KDCD = #SLCT_RPTP_KDCD# AND C.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND D.APVR_STA_CD IN ('202','203','204') AND D.APRVR_JBPS_SECD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400') ) AND A.RPTP_KDCD = #SLCT_RPTP_KDCD# AND B.APVR_STA_CD IN ('202','203','204') AND ROWNUM = 1) ; INSERT INTO TB_BADDED146H (HSTRY_SECD, FNNC_INFO_SBMSN_RQT_HSTRY_SQNO, CVLCPT_HSTRY_DT, HSTRY_USER_ID, CVLCPT_ADT_YR, ADT_NO, ADT_STP_SECD, CVLCPT_DOC_ID, APRVR_JBPS_SECD, INCDNT_SQNO, DSPS_RQT_SQNO, INDCT_DSPS_RQT_SQNO, ADT_KDCD, ADT_GRNT_NO, RPTP_FLD_ID, INCDNT_DSPS_TPCD, SRECS_REL_INST_CD, ACTN_INST_CD, RFRNC_INST_CD, DSPS_RQT_SECD, DATA_INPT_SECD, NOP_AMT_SECD, NOP_AMT, SRECS_SORT_SQNO, ACNTG_INS_SECD, CMPTN_YN, FRST_USER_ID, LAST_USER_ID, LAST_PRCS_DEPT_CD, LAST_MENU_ID, FRST_REG_DT, LAST_MDFCN_DT, NOP_SUM_AMT, FRST_ADT_STP_SECD, FRST_DOC_ID, FRST_APRVR_SECD, FRST_INCDNT_SQNO, FRST_DSPS_RQT_SQNO, RFRNC_DOC_ID, HLDOF_ADT_STP_SECD, HLDOF_DOC_ID, HLDOF_APRVR_SECD, HLDOF_INCDNT_SQNO, HLDOF_DSPS_RQT_SQNO, DSPS_RQT_KYWD_CN_1, DSPS_RQT_KYWD_CN_2, DSPS_RQT_KYWD_CN_3, DSPS_RQT_KYWD_CN_4, DSPS_RQT_KYWD_CN_5) SELECT 'U',
    TBBADDED146H_SEQ.NEXTVAL,
    SYSDATE,
    'SYSTEM',
    CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    ADT_STP_SECD /* 감사단계구분코드 */,
    CVLCPT_DOC_ID /* 민원문서아이디 */,
    APRVR_JBPS_SECD /* 결재자직위구분코드 */,
    INCDNT_SQNO /* 사건순번 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    INDCT_DSPS_RQT_SQNO /* 표시처분요구순번 */,
    ADT_KDCD /* 감사종류코드 */,
    ADT_GRNT_NO /* 감사부여번호 */,
    RPTP_FLD_ID /* 보고서분야아이디 */,
    INCDNT_DSPS_TPCD /* 사건처분유형코드 */,
    SRECS_REL_INST_CD /* 심사재심의관계기관코드 */,
    ACTN_INST_CD /* 조치기관코드 */,
    RFRNC_INST_CD /* 참조기관코드 */,
    DSPS_RQT_SECD /* 처분요구구분코드 */,
    DATA_INPT_SECD /* 자료입력구분코드 */,
    NOP_AMT_SECD /* 인원금액구분코드 */,
    NOP_AMT /* 인원금액 */,
    SRECS_SORT_SQNO /* 심사재심의정렬순번 */,
    ACNTG_INS_SECD /* 회계감찰구분코드 */,
    CMPTN_YN /* 완료여부 */,
    FRST_USER_ID /* 최초사용자아이디 */,
    LAST_USER_ID /* 최종사용자아이디 */,
    LAST_PRCS_DEPT_CD /* 최종처리부서코드 */,
    LAST_MENU_ID /* 최종메뉴아이디 */,
    FRST_REG_DT /* 최초등록일시 */,
    LAST_MDFCN_DT /* 최종수정일시 */,
    NOP_SUM_AMT /* 인원합계금액 */,
    FRST_ADT_STP_SECD /* 최초감사단계구분코드 */,
    FRST_DOC_ID /* 최초문서아이디 */,
    FRST_APRVR_SECD /* 최초결재자구분코드 */,
    FRST_INCDNT_SQNO /* 최초사건순번 */,
    FRST_DSPS_RQT_SQNO /* 최초처분요구순번 */,
    RFRNC_DOC_ID /* 참조문서아이디 */,
    HLDOF_ADT_STP_SECD /* 보류감사단계구분코드 */,
    HLDOF_DOC_ID /* 보류문서아이디 */,
    HLDOF_APRVR_SECD /* 보류결재자구분코드 */,
    HLDOF_INCDNT_SQNO /* 보류사건순번 */,
    HLDOF_DSPS_RQT_SQNO /* 보류처분요구순번 */,
    DSPS_RQT_KYWD_CN_1 /* 처분요구키워드내용1 */,
    DSPS_RQT_KYWD_CN_2 /* 처분요구키워드내용2 */,
    DSPS_RQT_KYWD_CN_3 /* 처분요구키워드내용3 */,
    DSPS_RQT_KYWD_CN_4 /* 처분요구키워드내용4 */,
    DSPS_RQT_KYWD_CN_5 /* 처분요구키워드내용5 */
FROM TB_BADDED146M WHERE CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND APRVR_JBPS_SECD = (SELECT MAX(B.APRVR_JBPS_SECD) AS APRVR_JBPS_SECD /* 결재자직위구분코드 */
FROM TB_BADDED103M A , TBDCMACM023L B WHERE B.ATRZ_DOC_NO = #ATRZ_DOC_NO# AND A.ATRZ_DMND_ID = B.ATRZ_DOC_NO AND B.APV_SNO = ( SELECT MAX(D.APV_SNO)
FROM TB_BADDED103M C , TBDCMACM023L D WHERE D.ATRZ_DOC_NO = B.ATRZ_DOC_NO AND C.ATRZ_DMND_ID = D.ATRZ_DOC_NO AND D.APV_SNO <> 1 AND C.SLCT_RPTP_KDCD = #SLCT_RPTP_KDCD# AND C.CVLCPT_DOC_ID = #CVLCPT_DOC_ID# AND D.APVR_STA_CD IN ('202','203','204') AND D.APRVR_JBPS_SECD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400') ) AND A.RPTP_KDCD = #SLCT_RPTP_KDCD# AND B.APVR_STA_CD IN ('202','203','204') AND ROWNUM = 1) ; END;