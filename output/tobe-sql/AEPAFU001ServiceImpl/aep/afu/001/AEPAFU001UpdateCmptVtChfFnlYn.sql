DECLARE BEGIN UPDATE TB_BADDED145M T1 SET T1.CMPTN_YN = 'N' /* 완료여부 */,  T1.LAST_USER_ID = #LAST_USER_ID# /* 최종사용자아이디 */,  T1.LAST_PRCS_DEPT_CD = #LAST_PRCS_DEPT_CD# /* 최종처리부서코드 */,  T1.LAST_MENU_ID = #LAST_MENU_ID# /* 최종메뉴아이디 */,  T1.LAST_MDFCN_DT = SYSDATE /* 최종수정일시 */WHERE T1.ADT_YR = #CVLCPT_ADT_YR# AND T1.ADT_NO = #ADT_NO# AND T1.APRVR_JBPS_SECD = '0010600' AND EXISTS (SELECT 1
FROM TB_BADDED113M ST1 WHERE ST1.CVLCPT_ADT_YR = T1.ADT_YR AND ST1.ADT_NO = T1.ADT_NO AND ST1.CVLCPT_DOC_ID = T1.DOC_ID AND ST1.APRVR_JBPS_SECD = T1.APRVR_JBPS_SECD AND ST1.INCDNT_SQNO = T1.INCDNT_SQNO AND ST1.SBCN_DCS_SECD IS NOT NULL) ; INSERT INTO TB_BADDED145H (HSTRY_SECD, FNNC_INFO_SBMSN_RQT_HSTRY_SQNO, CVLCPT_HSTRY_DT, HSTRY_USER_ID, CVLCPT_ADT_YR, ADT_NO, ADT_STP_SECD, CVLCPT_DOC_ID, APRVR_JBPS_SECD, INCDNT_SQNO, ADT_KDCD, ADT_GRNT_NO, RPTP_FLD_ID, INCDNT_KDCD, LIST_SQNO, SBCN_SECD, INCDNT_FLD_CN, SBCM_AGND_NM, INDCT_TTL, QPB_YN, QPB_YMD, ADTR_NM, DTL_DOC_NO, DATA_INPT_SECD, SNTHS_DPP_SE_YN, SCRT_YN /* 증권여부 */, SRECS_SORT_SQNO, DPP_RVWR_ENO, CMPTN_YN, FRST_USER_ID, LAST_USER_ID, LAST_PRCS_DEPT_CD, LAST_MENU_ID, FRST_REG_DT, LAST_MDFCN_DT, RFRNC_DOC_ID) SELECT 'U',
    TBBADDED145H_SEQ.NEXTVAL,
    SYSDATE,
    #LAST_USER_ID# AS LAST_USER_ID /* 최종사용자아이디 */,
    T1.ADT_YR /* 감사년도 */,
    T1.ADT_NO /* 감사번호 */,
    T1.ADT_STP_SECD /* 감사단계구분코드 */,
    T1.DOC_ID /* 문서아이디 */,
    T1.APRVR_JBPS_SECD /* 결재자직위구분코드 */,
    T1.INCDNT_SQNO /* 사건순번 */,
    T1.ADT_KDCD /* 감사종류코드 */,
    T1.ADT_GRNT_NO /* 감사부여번호 */,
    T1.RPTP_FLD_ID /* 보고서분야아이디 */,
    T1.INCDNT_KDCD /* 사건종류코드 */,
    T1.LIST_SQNO /* 목록순번 */,
    T1.SBCN_SECD /* 부의구분코드 */,
    T1.INCDNT_FLD_CN /* 사건분야내용 */,
    T1.INCDNT_NM /* 사건명 */,
    T1.INDCT_TTL /* 표시제목 */,
    T1.QPB_YN /* 질문서발부여부 */,
    T1.QPB_YMD /* 질문서발부일자 */,
    T1.ADTR_NM /* 감사인명 */,
    T1.DTL_DOC_NO /* 상세문서번호 */,
    T1.DATA_INPT_SECD /* 자료입력구분코드 */,
    T1.SNTHS_DPP_SE_YN /* 종합처리안구분여부 */,
    T1.SCRT_YN /* 증권여부 */,
    T1.SORT_SQNO /* 정렬순번 */,
    T1.DPP_RVWR_ENO /* 처리안검토자직원전산번호 */,
    T1.CMPTN_YN /* 완료여부 */,
    T1.FRST_USER_ID /* 최초사용자아이디 */,
    T1.LAST_USER_ID /* 최종사용자아이디 */,
    T1.LAST_PRCS_DEPT_CD /* 최종처리부서코드 */,
    T1.LAST_MENU_ID /* 최종메뉴아이디 */,
    T1.FRST_REG_DT /* 최초등록일시 */,
    T1.LAST_MDFCN_DT /* 최종수정일시 */,
    T1.LAST_ADT_RPTP_RFRNC_DOC_ID /* 최종감사보고서참조문서아이디 */
FROM TB_BADDED145M T1 WHERE T1.ADT_YR = #CVLCPT_ADT_YR# AND T1.ADT_NO = #ADT_NO# AND T1.APRVR_JBPS_SECD = '0010600' AND EXISTS (SELECT 1
FROM TB_BADDED113M ST1 WHERE ST1.CVLCPT_ADT_YR = T1.ADT_YR AND ST1.ADT_NO = T1.ADT_NO AND ST1.CVLCPT_DOC_ID = T1.DOC_ID AND ST1.APRVR_JBPS_SECD = T1.APRVR_JBPS_SECD AND ST1.INCDNT_SQNO = T1.INCDNT_SQNO AND ST1.SBCN_DCS_SECD IS NOT NULL) ; END;