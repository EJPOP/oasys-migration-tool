SELECT NVL2(A.END_DDL_DT, TO_CHAR(TO_DATE(A.END_DDL_DT)-1, 'YYYY'), '합계') AS LINK_YR /* 연계년도 */,
    DECODE(NVL2(A.END_DDL_DT, TO_CHAR(TO_DATE(A.END_DDL_DT)-1, 'YYYY'), '합계'), '합계', '', NVL2(A.END_DDL_DT, TO_CHAR(TO_DATE(A.END_DDL_DT)-1, 'MM'), '소계')) AS NVL2,
    DECODE(NVL2(A.END_DDL_DT, TO_CHAR(TO_DATE(A.END_DDL_DT)-1, 'MM'), '소계'), '소계', '', NVL2(TO_CHAR(A.WEK), TO_CHAR(A.WEK), '소계')) AS NVL2,
    DECODE(NVL2(TO_CHAR(A.WEK), TO_CHAR(A.WEK), '소계'), '소계', '', NVL2(E.CNSTN_MBCMT_DEPT_NM, E.CNSTN_MBCMT_DEPT_NM, '소계')) AS CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    D.USER_NM /* 사용자명 */,
    (SELECT AS CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000173' AND CD = D.JBGD_SECD) AS JBGD_SECD , (SELECT CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000140' AND CD = C.DMT_DVSN_CD) AS DMT_DVSN_CD , C.RMN_NM , B.BSC_SRNO , SUBSTR(B.APL_DT, 0, 4) || '-' || SUBSTR(B.APL_DT, 5, 2) || '-' || SUBSTR(B.APL_DT, 7, 2) AS APL_DT , SUBSTR(C.USE_STR_DT, 0, 4) || '-' || SUBSTR(C.USE_STR_DT, 5, 2) || '-' || SUBSTR(C.USE_STR_DT, 7, 2) || ' ~ ' || SUBSTR(C.USE_END_DT, 0, 4) || '-' || SUBSTR(C.USE_END_DT, 5, 2) || '-' || SUBSTR(C.USE_END_DT, 7, 2) AS USE_DT , C.USE_FEE , CASE WHEN C.USE_FEE = 0 THEN CASE WHEN F.CNT <> 1 THEN 0 ELSE B.UE_NOP_CNT END ELSE B.UE_NOP_CNT END AS UE_NOP_CNT , DECODE(C.USE_YN, 'Y', '사용', DECODE(C.USE_YN, 'N', '미사용', '')) AS USE_YN , D.CNSTN_MBCMT_HOME_TELNO , B.IO_CAR_TXT FROM TBCSPSAE134B A , TBCSPSAE501M B , TBCSPSAE501D C , TBDCMACM001M D , TBDCMACM002M E , ( SELECT COUNT(FRS_MDM_SQNO) AS FRS_MDM_SQNO /* 포렌식매체순번 */,
    TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    APL_DT,
    USE_STR_DT,
    BSC_SRNO
FROM TBCSPSAE501D WHERE USE_STR_DT BETWEEN #strFromDt# AND #strToDt# GROUP BY TRGT_NOP_ENO, APL_DT, BSC_SRNO, USE_STR_DT ) F WHERE C.TRGT_NOP_ENO = B.TRGT_NOP_ENO AND C.APL_DT = B.APL_DT AND C.BSC_SRNO = B.BSC_SRNO AND C.USE_STR_DT = TO_CHAR(TO_DATE(A.END_DDL_DT)-1,'YYYYMMDD') AND D.TRGT_NOP_ENO = B.TRGT_NOP_ENO AND E.SRECS_DEPT_CD = D.SRECS_DEPT_CD AND F.TRGT_NOP_ENO = B.TRGT_NOP_ENO AND F.APL_DT = B.APL_DT AND F.USE_STR_DT = C.USE_STR_DT AND F.BSC_SRNO = B.BSC_SRNO AND C.USE_STR_DT BETWEEN #strFromDt# AND #strToDt# AND E.SRECS_DEPT_CD = #SRECS_DEPT_CD# AND D.USER_NM LIKE '%' || #strUSR_NAM# || '%' AND C.DMT_DVSN_CD = #strDMT_DVSN_CD# AND C.COFM_STA_CD = #strCOFM_STA_CD# AND C.USE_YN = #USE_YN# ORDER BY LINK_YR, M, WEK, E.SRECS_DEPT_CD, USER_NM, JBGD_SECD, DMT_DVSN_CD, RMN_NM, APL_DT, USE_DT