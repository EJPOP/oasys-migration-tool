SELECT BASE.BZTRP_YR /* 출장년도 */,
    BASE.BZTRP_SQNO /* 출장순번 */,
    BASE.ADT_KDCD /* 감사종류코드 */,
    BASE.REL_ADT_YR /* 관계감사년도 */,
    BASE.REL_ADT_NO /* 관계감사번호 */,
    BASE.CVLCPT_ADT_STP_SQNO /* 민원감사단계순번 */,
    BASE.DSPS_RQT_NM /* 처분요구명 */,
    BASE.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    NVL(APTD.SUM_AUD_DCN, BASE.ADT_DCN) AS ADT_DCN /* 감사일수 */,
    BASE.BZTRP_TL_JBGD_SECD /* 출장반장직급구분코드 */,
    BASE.TRIP_LEADER_NM,
    TRIP_LEADER_TIT_TXT,
    BASE.JBPS_CD /* 직위코드 */,
    BASE.JBGD_SECD /* 직급구분코드 */,
    BASE.BZTRP_DEPT_CD /* 출장부서코드 */,
    BASE.PSON,
    AUD_DATE,
    REP_ORG_NM
FROM ( SELECT SITU.BZTRP_YR /* 출장년도 */,
    SITU.BZTRP_SQNO /* 출장순번 */,
    AUD.SPVR_ENO /* 감리원직원전산번호 */,
    SITU.ADT_DCN /* 감사일수 */,
    (CASE WHEN SITU.ADT_BZTRP_KDCD IN('02','03') THEN (SELECT SUBSTR(CD_NM, 1, 2) AS ADT_BZTRP_KDCD /* 감사출장종류코드 */
FROM TBDCMACM013C WHERE CD= AUD.ADT_KDCD AND CMM_CD_DVSN_CD='1000007') ELSE (SELECT SUBSTR(CD_NM, 1, 4)
FROM TBDCMACM013C WHERE CD= SITU.ADT_BZTRP_KDCD AND CMM_CD_DVSN_CD='1000030') END ) ADT_KDCD, SITU.REL_ADT_YR, SITU.REL_ADT_NO, SITU.CVLCPT_ADT_STP_SQNO, /*NVL(APTD.SUM_AUD_DCN, SITU.AUD_DCN) AUD_DCN,*/ SITU.DSPS_RQT_NM, F_DPT_INFO(SITU.BZTRP_DEPT_CD, '4') CNSTN_MBCMT_DEPT_NM, SITU.BZTRP_TL_JBGD_SECD, USR.USER_NM TRIP_LEADER_NM, NVL(F_CODE_NM('1000176',USR.JBPS_CD),F_CODE_NM('1000173',SITU.BZTRP_TL_JBGD_SECD)) TRIP_LEADER_TIT_TXT, USR.JBPS_CD, USR.JBGD_SECD, SITU.BZTRP_DEPT_CD, NVL(PSON.CNT, 0) || CASE WHEN NVL(PSON.EXT_CNT, 0) > 0 THEN CHR(10) || '(차출 등' || PSON.EXT_CNT ||')' END AS PSON, CASE WHEN SUBSTR(SITU.ADT_BGNG_YMD, 5, 1) = '0' THEN SUBSTR(SITU.ADT_BGNG_YMD, 6, 1) ELSE SUBSTR(SITU.ADT_BGNG_YMD, 5, 2) END || '.' || CASE WHEN SUBSTR(SITU.ADT_BGNG_YMD, 7, 1) = '0' THEN SUBSTR(SITU.ADT_BGNG_YMD, 8, 1) ELSE SUBSTR(SITU.ADT_BGNG_YMD, 7, 2) END || '.~' || CASE WHEN SUBSTR(SITU.ADT_END_YMD, 5, 1) = '0' THEN SUBSTR(SITU.ADT_END_YMD, 6, 1) ELSE SUBSTR(SITU.ADT_END_YMD, 5, 2) END || '.' || CASE WHEN SUBSTR(SITU.ADT_END_YMD, 7, 1) = '0' THEN SUBSTR(SITU.ADT_END_YMD, 8, 1) ELSE SUBSTR(SITU.ADT_END_YMD, 7, 2) END || '.' AS AUD_DATE, /*금일국과별현황 출력의 실지감사활동현황 감사기간 수정(박진호감사관, 20250729)*/ F_ORG_INFO(TTO.REP_ORG_CD,'1') REP_ORG_NM FROM TBBADDED002M SITU, TBBADDED001M AUD, TBDCMACM001M USR, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    SUM(CASE WHEN AS1.EMP_SECD != '0' THEN 1 ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    COUNT(*) AS CNT
FROM (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    EMP_SECD /* 직원구분코드 */
FROM TBBADDED005L WHERE BZTRP_BGNG_YMD =#ADT_BGNG_YMD# GROUP BY BZTRP_YR, BZTRP_SQNO, BZTRVR_ENO, EMP_SECD) AS1 GROUP BY BZTRP_YR, BZTRP_SQNO) PSON, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    MIN(INST_CD) AS INST_CD /* 기관코드 */
FROM TBBADDED008L GROUP BY BZTRP_YR, BZTRP_SQNO) AS TTO WHERE SITU.REL_ADT_YR = AUD.CVLCPT_ADT_YR AND SITU.REL_ADT_NO = AUD.ADT_NO AND SITU.BZTRP_YR = TTO.BZTRP_YR(+) AND SITU.BZTRP_SQNO = TTO.BZTRP_SQNO(+) AND SITU.BZTRP_YR = PSON.BZTRP_YR(+) AND SITU.BZTRP_SQNO = PSON.BZTRP_SQNO(+) AND SITU.BZTRP_SECD ='1' AND SITU.ADT_BGNG_YMD = #ADT_BGNG_YMD# AND USR.TRGT_NOP_ENO(+) = SITU.BZTRP_TL_ENO /* 감찰담당관실은 조회시 제외하며, 로그인 한 담당자가 감찰담당관일때만 포함하여 모두 보임 - 2016.01.04 yyh */ AND AUD.SPRVSN_DEPT_CD != '100100' ) BASE , (SELECT TMA.BZTRP_YR /* 출장년도 */,
    TMA.BZTRP_SQNO /* 출장순번 */,
    TMA.BZTRVR_ENO /* 출장자직원전산번호 */,
    SUM(NVL(PTD.ADT_DCN, 0)) AS ADT_DCN /* 감사일수 */
FROM TBBADDED005L TMA, TBBADDED006L PTD WHERE TMA.BZTRP_YR = PTD.BZTRP_YR AND TMA.BZTRP_SQNO = PTD.BZTRP_SQNO AND TMA.FT_SQNO = PTD.FT_SQNO AND TMA.BZTRVR_ALTMNT_SQNO = PTD.BZTRVR_ALTMNT_SQNO GROUP BY TMA.BZTRP_YR, TMA.BZTRP_SQNO, TMA.BZTRVR_ENO) APTD WHERE BASE.BZTRP_YR = APTD.BZTRP_YR(+) AND BASE.BZTRP_SQNO = APTD.BZTRP_SQNO(+) AND BASE.SPVR_ENO = APTD.BZTRVR_ENO(+) ORDER BY BASE.BZTRP_DEPT_CD