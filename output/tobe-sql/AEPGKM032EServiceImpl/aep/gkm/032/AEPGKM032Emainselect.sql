SELECT CASE WHEN EVL.APRV_YN IS NULL THEN '신규' ELSE '수정' END AS APRV_YN /* 승인여부 */,
    KLD.KNB /* 지식번호 */,
    KLD.KLD_NM /* 지식명 */,
    KLD.REGN_DPT_NM /* 등록자부서명 */,
    KLD.OTSD_EXPRT_RGTR_ENO /* 외부전문가등록자직원전산번호 */,
    KLD.REGN_USR_NM /* 등록자명 */,
    KLD.EVL_YR /* 평가년도 */,
    KLD.EVL_DVSN_CD /* 평가구분 */,
    KLD.SC_GRN_TG_CD /* 점수부여대상코드 */,
    KLD.KLD_ACTV_NM /* 점수부여대상명 */,
    KLD.EVLT_CNB,
    F_USR_INFO(KLD.EVLT_CNB, 2) AS F_USR_INFO /* 평가자전산번호 */,
    KLD.BSC_SC /* 기본점수 */,
    KLD.MIN_SC /* 최소점수 */,
    KLD.MAX_SC /* 최대점수 */,
    KLD.ADD_SC /* 가산점수 */,
    NVL(KLD.CFMTN_YN, 'N') AS CFMTN_YN /* 확정여부 */,
    NVL(EVL.BSC_SC, KLD.BSC_SC) AS EVL_BSC_SC /* 기본점수 */ $condition[]$,
    NVL(EVL.ADD_SC, 0) AS ADD_SC /* 가산점수 */,
    TO_NUMBER(NVL(EVL.BSC_SC, KLD.BSC_SC) + NVL(EVL_CLU_SC, 0) + NVL(EVL.ADD_SC, 0)) AS TO_NUMBER /* 점수합계 */,
    NVL(EVL.APRV_YN, 'N') AS APRV_YN /* 승인여부 */
FROM ( SELECT A.EVL_YR /* 평가년도 */,
    A.EVL_DVSN_CD /* 평가구분 */,
    A.SC_GRN_TG_CD /* 점수부여대상코드 */,
    A.KLD_ACTV_NM /* 점수부여대상명 */,
    A.SET_ID /* 설정ID */,
    A.TG_CAT_NM /* 설정명(지식카테고리명) */,
    A.EVLT_CNB /* 평가자전산번호 */,
    A.CFMTN_YN /* 확정여부 */,
    B.KNB /* 지식번호 */,
    B.KLD_NM /* 지식명 */,
    B.REGN_DPT_NM /* 등록자부서명 */,
    B.OTSD_EXPRT_RGTR_ENO /* 외부전문가등록자직원전산번호 */,
    F_USR_INFO(B.OTSD_EXPRT_RGTR_ENO, '2') AS F_USR_INFO /* 등록자명 */,
    A.BSC_SC /* 기본점수 */,
    A.MIN_SC /* 최소점수 */,
    A.MAX_SC /* 최대점수 */,
    A.ADD_SC /* 가산점수 */
FROM ( SELECT A1.EVL_YR /* 평가년도 */,
    A1.EVL_DVSN_CD /* 평가구분 */,
    A1.EVL_ACTV_STR_DT /* 평가활동시작일 */,
    A1.EVL_ACTV_END_DT /* 평가활동종료일 */,
    A1.CFMTN_YN /* 확정여부 */,
    A2.SC_GRN_TG_CD /* 점수부여대상코드 */,
    A3.KLD_ACTV_NM /* 점수부여대상명 */,
    A3.BSC_SC /* 기본점수 */,
    A3.MIN_SC /* 최소점수 */,
    A3.MAX_SC /* 최대점수 */,
    A3.ADD_SC /* 가산점수 */,
    A4.SET_ID /* 설정ID */,
    A5.TG_CAT_NM /* 설정명(지식카테고리명) */,
    A6.TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBAEPGKM011M A1 /* 평가기간기본 */ ,TBAEPGKM012L A2 /* 평가기간별점수부여대상내역 */ ,TBAEPGKM006M A3 /* 점수부여대상내역 */ ,TBAEPGKM007L A4 /* 점수부여대상설정내역 */ ,TBAEPGKM017M A5 /* 대상분류기본 (지식카테고리) */ ,TBAEPGKM013L A6 /* 평가기간별평가자내역 */ WHERE A1.EVL_YR = A2.EVL_YR AND A1.EVL_DVSN_CD = A2.EVL_DVSN_CD AND A2.SC_GRN_TG_CD = A3.SC_GRN_TG_CD AND A3.SC_GRN_TG_CD = A4.SC_GRN_TG_CD AND A4.SET_ID = A5.TG_CAT_ID AND A1.EVL_YR = A6.EVL_YR AND A1.EVL_DVSN_CD = A6.EVL_DVSN_CD AND A1.EVL_YR = #EVL_YR# AND A1.EVL_DVSN_CD = #EVL_DVSN_CD# AND A2.SC_GRN_TG_CD IN ( SELECT A.SC_GRN_TG_CD
FROM TBAEPGKM012L AS A ,TBAEPGKM006M AS B WHERE A.SC_GRN_TG_CD = B.SC_GRN_TG_CD AND B.SET_DVSN_CD = 'C' AND A.EVL_YR = #EVL_YR# AND A.EVL_DVSN_CD = #EVL_DVSN_CD# ) ORDER BY A1.EVL_YR, A1.EVL_DVSN_CD, A2.SC_GRN_TG_CD, A6.TRGT_NOP_ENO, A4.SET_ID ) A ,TBAEPGKM001M B WHERE A.SET_ID = B.KLD_CAT_CD /* 점수부여대상에서 선택된 카테고리에 해당하는 지식 */ AND A.EVL_ACTV_STR_DT = B.REG_DMND_YMD /* 평가활동기간내에 등록된 지식 */ AND A.EVL_YR = #EVL_YR# AND A.EVL_DVSN_CD = #EVL_DVSN_CD# A.SC_GRN_TG_CD = #GRN_TG# F_USR_INFO(B.OTSD_EXPRT_RGTR_ENO, '2') LIKE '%' || #NM# || '%' B.KLD_NM LIKE '%' || #TITLE# || '%' ) KLD ,( SELECT EVL_YR /* 평가년도 */,
    EVL_DVSN_CD /* 평가구분코드 */,
    SC_GRN_TG_CD /* 점수부여대상코드 */,
    KNB /* 지식번호 */,
    EVLT_CNB /* 평가자전산번호 */,
    TRGT_NOP_ENO AS TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    APRV_YN /* 승인여부 */,
    MAX(CASE WHEN SC_CAT_CD = '1' THEN SC END) AS BSC_SC /* 기본점수 */ SUM(CASE WHEN SC_CAT_CD = '2' AND EVL_CLU_CD = SUBSTR(#condition[]#, 9) THEN EVL_RK_CD END) AS $condition[]$,
    SUM(CASE WHEN SC_CAT_CD = '2' THEN SC END) AS SC_CAT_CD,
    SUM(CASE WHEN SC_CAT_CD = '3' THEN SC END) AS SC_CAT_CD /* 가산점수 */
FROM TBAEPGKM016L /* 지식평가기본 */ WHERE SC_GRN_TG_CD IN ( SELECT A.SC_GRN_TG_CD
FROM TBAEPGKM012L AS A ,TBAEPGKM006M AS B WHERE A.SC_GRN_TG_CD = B.SC_GRN_TG_CD AND B.SET_DVSN_CD = 'C' AND A.EVL_YR = #EVL_YR# AND A.EVL_DVSN_CD = #EVL_DVSN_CD# ) AND EVL_YR = #EVL_YR# AND EVL_DVSN_CD = #EVL_DVSN_CD# GROUP BY EVL_YR, EVL_DVSN_CD, SC_GRN_TG_CD, KNB, EVLT_CNB, TRGT_NOP_ENO, APRV_YN ) EVL WHERE KLD.EVL_YR = EVL.EVL_YR(+) AND KLD.EVL_DVSN_CD = EVL.EVL_DVSN_CD(+) AND KLD.SC_GRN_TG_CD = EVL.SC_GRN_TG_CD(+) AND KLD.KNB = EVL.KNB(+) AND KLD.EVLT_CNB = EVL.EVLT_CNB(+) AND KLD.OTSD_EXPRT_RGTR_ENO = EVL.OTSD_EXPRT_RGTR_ENO(+) ORDER BY KLD.SC_GRN_TG_CD, KLD.KNB, KLD.OTSD_EXPRT_RGTR_ENO, EVL.EVLT_CNB