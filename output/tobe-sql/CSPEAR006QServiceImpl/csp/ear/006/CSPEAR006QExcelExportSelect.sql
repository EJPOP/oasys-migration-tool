SELECT DECODE(D1.CVLCPT_CLM_SECD ,'2','국민','3','공익') AS CLM_SE_NM /* 청구구분명 */,
    D1.TPOF_RCPT_YR /* 제보접수년도 */,
    D1.TPOF_RCPT_YR||'-'||DECODE(D1.CVLCPT_CLM_SECD ,'2','국민','3','공익')||'-'||D1.TPOF_RCPT_NO AS NTFCTN_RCPT_SQNO /* 통보접수순번 */,
    TO_CHAR(D1.TPOF_RCPT_DT,'YYYY-MM-DD') AS NTFCTN_RCPT_YMD /* 통보접수일자 */,
    D1.TPOF_NM /* 제보명 */,
    CASE WHEN D1.TPOF_STTS_SECD ='170' THEN '완결' ELSE '미결' END AS TPOF_STTS_SECD /* 제보상태구분코드 */,
    CASE WHEN D1.TPOF_STTS_SECD = '110' THEN F_CODE_NM('1000361','30') WHEN D1.TPOF_STTS_SECD IN ('150','160') AND D3.PRGRS_STP_SECD NOT IN ('02','03','04','05','06','07','08','09') THEN '감사실시예정' WHEN D1.TPOF_STTS_SECD IN ('150','160') AND D3.PRGRS_STP_SECD ='02' THEN '감사실시중' WHEN D1.TPOF_STTS_SECD IN ('150','160') AND D3.PRGRS_STP_SECD = '03' THEN '귀청보고' WHEN D1.TPOF_STTS_SECD IN ('150','160') AND D3.PRGRS_STP_SECD IN ('04','05','06','07','08','09') THEN '처리안작성중' WHEN D1.TPOF_STTS_SECD ='170' THEN '완결' ELSE F_CODE_NM('1000361', D1.TPOF_STTS_SECD) END AS PRCS_NM /* 처리명 */,
    F_CODE_NM('1000610',OCRN_TPCD) AS F_CODE_NM,
    ( SELECT CASE WHEN COUNT(*) > 1 THEN F_ORG_INFO(MIN(INST_CD),'1')||'외 '|| TO_CHAR(COUNT(*)-1)||'건' ELSE F_ORG_INFO(MIN(INST_CD),'1') AS 1
FROM TB_BADDED002M Z1, TB_BADDED008L Z2 WHERE D3.ADT_YR = Z1.REL_ADT_YR AND D3.ADT_NO = Z1.REL_ADT_NO AND Z1.BZTRP_YR = Z2.BZTRP_YR AND Z1.BZTRP_SQNO = Z2.BZTRP_SQNO) AS INST_CONT , ( SELECT F_CODE_NM('1000119',F_ORG_INFO(MIN(INST_CD),'2')) AS INST_CD /* 기관코드 */
FROM TB_BADDED002M Z1, TB_BADDED008L Z2 WHERE D3.ADT_YR = Z1.REL_ADT_YR AND D3.ADT_NO = Z1.REL_ADT_NO AND Z1.BZTRP_YR = Z2.BZTRP_YR AND Z1.BZTRP_SQNO = Z2.BZTRP_SQNO ) AS INST_SECD , DECODE(D1.TPOF_CLMT_KDCD,'1',D1.TPOF_CVLPR_NM || ' 외 ' ||NVL(D2.CLMT_NOPE,0)||'명',D1.TPOF_CVLPR_NM) AS TPOF_CVLPR_NM ,D1.TPOF_CVLPR_RPRSV_NM ,F_CODE_NM('1000080',CLMT_KDCD) AS CLMT_TYPE_NM , F_DPT_INFO(D2.ETC_LBSVC_MNG_DEPT_CD,'1') AS PRCS_DEPT_NM , F_USR_INFO_BY_ID(D2.PRCS_PIC_ID,'2') AS SRECS_PRCS_PIC_NM , TO_CHAR(TO_DATE(D2.PREI_ATRZ_YMD),'YYYY-MM-DD') AS PREI_ATRZ_YMD ,( SELECT AGGR_CONCAT(X.BZTRVR_NM,',') AS BZTRVR_NM /* 출장자명 */
FROM TB_BADDED002M Z ,TB_BADDED005L X WHERE D3.ADT_YR = Z.REL_ADT_YR AND D3.ADT_NO = Z.REL_ADT_NO AND Z.BZTRP_YR = X.BZTRP_YR AND Z.BZTRP_SQNO = X.BZTRP_SQNO AND Z.ADT_BZTRP_KDCD ='00' ) AS MTRL_PCT_NM /*자료수집 출장자*/ , D2.TRNF_YMD , F_DPT_INFO(D2.TRNF_DEPT_CD,'1') AS TRNF_DPT_NM , ( SELECT TO_CHAR(TO_DATE(MIN(Z.ADT_BGNG_YMD)),'YYYY-MM-DD') AS ADT_BGNG_YMD /* 감사시작일자 */
FROM TB_BADDED002M Z WHERE D3.ADT_YR = Z.REL_ADT_YR AND D3.ADT_NO = Z.REL_ADT_NO AND Z.ADT_BZTRP_KDCD ='00' ) AS MTRL_STR_DT /* 자료수집 시작일*/ , ( SELECT TO_CHAR(TO_DATE(MAX(Z.ADT_END_YMD)),'YYYY-MM-DD') AS ADT_END_YMD /* 감사종료일자 */
FROM TB_BADDED002M Z WHERE D3.ADT_YR = Z.REL_ADT_YR AND D3.ADT_NO = Z.REL_ADT_NO AND Z.ADT_BZTRP_KDCD ='00' ) AS MTRL_END_DT /*자료수집 종료일*/ , CASE WHEN D2.CMT_HDMT_YN = 'Y' THEN D2.SRECS_CMT_HDMT_YR||'-'||D2.SRECS_CMT_CYCL ELSE '' END SRECS_CMT_CYCL/*위원회*/ , TO_CHAR(TO_DATE(D2.SRECS_CMT_HDMT_YMD),'YYYY-MM-DD') AS SRECS_CMT_HDMT_YMD , CASE WHEN D2.ADT_RSLT_SECD = '08' THEN TO_CHAR(D1.TPOF_DISCON_DT,'YYYY-MM-DD') ELSE TO_CHAR(TO_DATE(D2.RVW_RPT_ATRZ_YMD),'YYYY-MM-DD') END AS RVW_RPT_ATRZ_YMD /*감사실시결정일*/ , CASE WHEN D2.ADT_RSLT_SECD = '08' THEN '취하' ELSE F_CODE_NM('1000380',D2.RVW_RSLT_SECD) END AS REQ_EXAM_RSLT_NM /*검토결과*/ , CASE WHEN D2.ADT_RSLT_SECD = '08' THEN TO_CHAR(D1.TPOF_DISCON_DT,'YYYY-MM-DD') ELSE TO_CHAR(TO_DATE(D2.RVW_RSLT_RPLY_YMD),'YYYY-MM-DD') END AS RVW_RSLT_RPLY_YMD /*검토결과회신일*/ , ( SELECT SUM(X.ADT_DCN) AS ADT_DCN /* 감사일수 */
FROM TB_BADDED002M Z, TB_BADDED006L X WHERE D3.ADT_YR = Z.REL_ADT_YR AND D3.ADT_NO = Z.REL_ADT_NO AND Z.BZTRP_YR = X.BZTRP_YR AND Z.BZTRP_SQNO = X.BZTRP_SQNO AND Z.ADT_BZTRP_KDCD ='02' ) AS ADT_DCN /*감사 연인원*/ ,( SELECT AGGR_CONCAT(X.BZTRVR_NM,',') AS BZTRVR_NM /* 출장자명 */
FROM TB_BADDED002M Z ,TB_BADDED005L X WHERE D3.ADT_YR = Z.REL_ADT_YR AND D3.ADT_NO = Z.REL_ADT_NO AND Z.BZTRP_YR = X.BZTRP_YR AND Z.BZTRP_SQNO = X.BZTRP_SQNO AND Z.ADT_BZTRP_KDCD ='02' ) AS AUD_PCT_NM /*실지감사 출장자*/ , ( SELECT TO_CHAR(TO_DATE(MIN(Z.ADT_BGNG_YMD)),'YYYY-MM-DD') AS ADT_BGNG_YMD /* 감사시작일자 */
FROM TB_BADDED002M Z WHERE D3.ADT_YR = Z.REL_ADT_YR AND D3.ADT_NO = Z.REL_ADT_NO AND Z.ADT_BZTRP_KDCD ='02' ) AS ADT_BGNG_YMD /* 실지감사 시작일*/ , ( SELECT TO_CHAR(TO_DATE(MAX(Z.ADT_END_YMD)),'YYYY-MM-DD') AS ADT_END_YMD /* 감사종료일자 */
FROM TB_BADDED002M Z WHERE D3.ADT_YR = Z.REL_ADT_YR AND D3.ADT_NO = Z.REL_ADT_NO AND Z.ADT_BZTRP_KDCD ='02' ) AS ADT_END_YMD /*실지감사 종료일*/ , TO_CHAR(TO_DATE(D4.DAG_RPT_YMD),'YYYY-MM-DD') AS DAG_RPT_YMD /*귀청보고일*/ , F_USR_INFO(D4.LDRV_ENO,'2') AS LDRV_NM /*주심위원성명*/ , TO_CHAR(TO_DATE(D4.AB_ATRZ_YMD),'YYYY-MM-DD') AS AB_ATRZ_YMD /*과장결재일*/ , TO_CHAR(TO_DATE(D4.AJMT_OFER_ATRZ_YMD),'YYYY-MM-DD') AS AJMT_OFER_ATRZ_YMD /*조정담당자*/ , TO_CHAR(TO_DATE(D4.AJMT_DDG_ATRZ_YMD),'YYYY-MM-DD') AS AJMT_DDG_ATRZ_YMD /*조정담당관*/ , TO_CHAR(TO_DATE(D4.JDAF_SRNG_OFER_ATRZ_YMD),'YYYY-MM-DD') AS JDAF_SRNG_OFER_ATRZ_YMD /*심의실장*/ , TO_CHAR(TO_DATE(D4.OW_DHD_ATRZ_YMD),'YYYY-MM-DD') AS OW_DHD_ATRZ_YMD /*총.차장*/ , TO_CHAR(TO_DATE(D4.LDRV_MBCMT_ATRZ_YMD),'YYYY-MM-DD') AS LDRV_MBCMT_ATRZ_YMD /*주심위원*/ , TO_CHAR(TO_DATE(D4.ENFC_ATRZ_YMD),'YYYY-MM-DD') AS ENFC_ATRZ_YMD /*시행일(부의일)*/ , ( SELECT AGGR_CONCAT(F_CODE_NM('1000002',Z.DSPS_RQT_KDCD)||' '||COUNT(*),',') AS DSPS_RQT_KDCD /* 처분요구종류코드 */
FROM TB_BADEAR001M Z WHERE D3.ADT_YR = Z.CVLCPT_ADT_YR AND D3.ADT_NO = Z.ADT_NO GROUP BY DSPS_RQT_KDCD ) AS DSPS_RQT_KND_CVN /*처분요구종류별건수*/ , TO_CHAR(TO_DATE(D2.DSPS_RQT_ENFC_YMD),'YYYY-MM-DD') AS DSPS_RQT_ENFC_YMD /*처분요구시행*/ , CASE WHEN D2.ADT_RSLT_SECD IN ('05','07') THEN TO_CHAR(TO_DATE(D2.ADT_RSLT_RPLY_YMD),'YYYY-MM-DD') ELSE '' END AS AUD_RSLT_DT , CASE WHEN D2.ADT_RSLT_SECD = '08' THEN TO_CHAR(D1.TPOF_DISCON_DT,'YYYY-MM-DD') ELSE TO_CHAR(TO_DATE(D2.ADT_RSLT_RPLY_YMD),'YYYY-MM-DD') END AS ADT_RSLT_RPLY_YMD , CASE WHEN D2.ADT_RSLT_SECD = '08' THEN TO_CHAR(D1.TPOF_DISCON_DT,'YYYY') ELSE TO_CHAR(TO_DATE(D2.ADT_RSLT_RPLY_YMD),'YYYY') END AS ADT_RSLT_RPLY_YMD , F_CODE_NM('1000380',D2.ADT_RSLT_SECD) AS CLM_RSLT_NM , NULL AS WHY , NULL AS ETC , CASE WHEN D1.TPOF_STTS_SECD = '170' AND D2.RVW_RSLT_SECD IN ('01','02','03','04') THEN TO_DATE(D2.RVW_RPT_ATRZ_YMD) - TO_DATE(TO_CHAR(D1.TPOF_RCPT_DT,'YYYYMMDD')) WHEN D1.TPOF_STTS_SECD = '170' AND D2.PREI_RJTN_YN = 'Y' THEN TO_DATE(D2.PREI_ATRZ_YMD) - TO_DATE(TO_CHAR(D1.TPOF_RCPT_DT,'YYYYMMDD')) WHEN D1.TPOF_STTS_SECD = '170' AND D2.ADT_RSLT_SECD = '08' THEN TO_DATE(TO_CHAR(D1.TPOF_DISCON_DT,'YYYYMMDD')) - TO_DATE(TO_CHAR(D1.TPOF_RCPT_DT,'YYYYMMDD')) ELSE NULL END AS EXAM_ACP_DT , CASE WHEN D1.TPOF_STTS_SECD = '170' AND D2.RVW_RSLT_SECD IN ('01','02','03','04') THEN TO_DATE(D2.RVW_RSLT_RPLY_YMD) - TO_DATE(D2.RVW_RPT_ATRZ_YMD) WHEN D1.TPOF_STTS_SECD ='170' AND D2.PREI_RJTN_YN = 'Y' THEN TO_DATE(D2.PREI_RPLY_YMD) - TO_DATE(D2.PREI_ATRZ_YMD) WHEN D1.TPOF_STTS_SECD ='170' AND D2.ADT_RSLT_SECD = '08' THEN TO_DATE(TO_CHAR(D1.TPOF_DISCON_DT,'YYYYMMDD')) - TO_DATE(TO_CHAR(D1.TPOF_DISCON_DT,'YYYYMMDD')) ELSE NULL END AS EXAM_RPL_DT , CASE WHEN D1.TPOF_STTS_SECD = '170' AND D2.ADT_RSLT_SECD IN ('02','03','04','06','07') THEN TO_DATE(D2.ADT_RSLT_RPLY_YMD) - TO_DATE(TO_CHAR(D1.TPOF_RCPT_DT,'YYYYMMDD')) WHEN D1.TPOF_STTS_SECD = '170' AND D2.ADT_RSLT_SECD = '08' THEN TO_DATE(TO_CHAR(D1.TPOF_DISCON_DT,'YYYYMMDD')) - TO_DATE(TO_CHAR(D1.TPOF_RCPT_DT,'YYYYMMDD')) ELSE NULL END AS RESULT_DT FROM TB_CSPDCP101M D1 , TB_CSPEAR001M D2 , TB_BADDED001M D3 , TB_BADDED003M D4 WHERE D1.CVLCPT_CLM_SECD = D2.CLM_SECD(+) AND D1.TPOF_RCPT_YR = D2.CVLCPT_RCPT_YR(+) AND D1.TPOF_RCPT_NO = D2.CVLCPT_RCPT_RCPT(+) AND D1.CVLCPT_CLM_SECD = D3.CLM_SECD(+) AND D1.TPOF_RCPT_YR = D3.INFO_RCPT_YR(+) AND D1.TPOF_RCPT_NO = D3.CVLCPT_NO(+) AND D3.ADT_YR = D4.ADT_YR(+) AND D3.ADT_NO = D4.ADT_NO(+) AND D1.TPOF_STTS_SECD <> ('21') AND D1.CVLCPT_CLM_SECD = #CLM_SECD# AND D1.CVLCPT_CLM_SECD IN ('2','3') AND TO_CHAR(D1.TPOF_RCPT_DT,'YYYYMMDD') &gt;= #strACP_DHS# AND TO_CHAR(D1.TPOF_RCPT_DT,'YYYYMMDD') &lt;= #strACP_DHE# AND D1.TPOF_NM LIKE '%'||#strTIT_NM#||'%' AND D1.TPOF_RCPT_YR = #CVLCPT_RCPT_YR# AND D1.TPOF_RCPT_NO = #CVLCPT_RCPT_RCPT# AND D2.CLMT_KDCD = #CLMT_KDCD# AND D1.TPOF_STTS_SECD = #CRU_PRCS_PRCS_STTS# AND D2.ETC_LBSVC_MNG_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TBDCMACM002M WHERE CNSTN_MBCMT_DEPT_NM LIKE '%'||#strHNDL_DPT_NM#||'%') AND D2.OCRN_TPCD = #OCRN_TPCD# AND D1.TPOF_RCPT_PATH_SECD = #CRU_RCPT_PATH_SECD# ORDER BY D1.TPOF_RCPT_YR DESC , D1.TPOF_RCPT_NO DESC