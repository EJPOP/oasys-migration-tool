SELECT A.EVL_YR,
    A.EVL_DVSN_CD,
    A.TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    MAX(A.USER_NM) AS USER_NM /* 사용자명 */,
    MAX(A.CNSTN_MBCMT_DEPT_NM) AS CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    SUM(A.SC) AS TOT SUM(CASE WHEN A.SC_GRN_TG_CD = #condition[]# THEN A.SC ELSE 0 END) AS SC$condition[]$ SUM(CASE WHEN A.SC_GRN_TG_CD = #condition[]# THEN 1 ELSE 0 END) AS CT$condition[]$,
    (CASE WHEN B.TRGT_NOP_ENO IS NULL THEN 'N' ELSE 'Y' END) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    (CASE WHEN B.TRGT_NOP_ENO IS NULL THEN '미승인' ELSE '승인' END) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM ( SELECT EVL_YR,
    EVL_DVSN_CD,
    SC_GRN_TG_CD,
    TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    KNB,
    USER_NM /* 사용자명 */,
    CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    ROUND(AVG(BSC_SC + EVL_SC + ADD_SC)) AS ROUND
FROM ( SELECT EVL_YR,
    EVL_DVSN_CD,
    SC_GRN_TG_CD,
    KNB,
    EVLT_CNB,
    TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    F_USR_INFO(TRGT_NOP_ENO, '2') AS USER_NM /* 사용자명 */,
    F_DPT_INFO(F_USR_INFO(TRGT_NOP_ENO, '5'), '1') AS CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    MAX(CASE WHEN SC_CAT_CD=1 THEN SC ELSE 0 END) AS SC_CAT_CD,
    SUM(CASE WHEN SC_CAT_CD=2 THEN SC ELSE 0 END) AS SC_CAT_CD,
    MAX(CASE WHEN SC_CAT_CD=3 THEN SC ELSE 0 END) AS SC_CAT_CD
FROM TBAEPGKM016L WHERE 1=1 GROUP BY EVL_YR ,EVL_DVSN_CD ,SC_GRN_TG_CD ,KNB ,EVLT_CNB ,TRGT_NOP_ENO ) WHERE 1=1 GROUP BY EVL_YR ,EVL_DVSN_CD ,SC_GRN_TG_CD ,TRGT_NOP_ENO ,KNB ,USER_NM ,CNSTN_MBCMT_DEPT_NM ) AS A, TBAEPGKM014L AS B WHERE A.EVL_YR = B.EVL_YR(+) AND A.EVL_DVSN_CD = B.EVL_DVSN_CD(+) AND A.TRGT_NOP_ENO = B.TRGT_NOP_ENO(+) AND A.EVL_YR = #EVL_YR# AND A.EVL_DVSN_CD = #EVL_DVSN_CD# GROUP BY A.EVL_YR ,A.EVL_DVSN_CD ,A.TRGT_NOP_ENO ,B.TRGT_NOP_ENO ORDER BY TRGT_NOP_ENO