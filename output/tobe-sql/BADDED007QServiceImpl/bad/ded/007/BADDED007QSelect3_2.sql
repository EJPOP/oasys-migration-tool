SELECT AAA.BZTRP_YR /* 출장년도 */,
    AAA.BZTRP_SQNO /* 출장순번 */,
    AAA.FT_SQNO /* 출장조순번 */,
    AAA.INST_CD /* 기관코드 */,
    F_ORG_INFO(AAA.INST_CD,'1') AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    AAA.RGN_CD /* 지역코드 */,
    AAA.ADT_BGNG_YMD /* 감사시작일자 */,
    AAA.ADT_END_YMD /* 감사종료일자 */,
    AAA.ADT_DCN /* 감사일수 */,
    AAA.BZTRP_TL_ENO /* 출장반장직원전산번호 */,
    AAA.ADT_KDCD /* 감사종류코드 */,
    AAA.SPRVSN_DEPT_CD /* 주관부서코드 */,
    AAA.ADT_MTTR_NM /* 감사사항명 */,
    AAA.ADT_NO /* 감사번호 */,
    AAA.IN_PSON_CNT,
    AAA.EXT_PSON_CNT,
    AAA.IN_PSON_MAN_CNT,
    AAA.EXT_PSON_MAN_CNT,
    AAA.AUD_DCN_CNT,
    BBB.CD_NM,
    CCC.CD_NM,
    DDD.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    EEE.USER_NM /* 사용자명 */
FROM (SELECT AA.*,
    BB.IN_PSON_CNT,
    BB. AS BB.,
    CC.IN_PSON_MAN_CNT,
    CC. AS CC.,
    CC.AUD_DCN_CNT
FROM (SELECT A.BZTRP_YR /* 출장년도 */,
    A.BZTRP_SQNO /* 출장순번 */,
    A.FT_SQNO /* 출장조순번 */,
    A.INST_CD /* 기관코드 */,
    A.RGN_CD /* 지역코드 */,
    A.ADT_BGNG_YMD /* 감사시작일자 */,
    A.ADT_END_YMD /* 감사종료일자 */,
    B.ADT_DCN /* 감사일수 */,
    B.BZTRP_TL_ENO /* 출장반장직원전산번호 */,
    C.ADT_KDCD /* 감사종류코드 */,
    C.SPRVSN_DEPT_CD /* 주관부서코드 */,
    C.ADT_MTTR_NM /* 감사사항명 */,
    C.ADT_YR || '-' || C.ADT_ASMT_SECD || '-' || C.INST_SECD|| '-' || SUBSTR(C.ADT_KDCD, 3, 1) || '-' || C.SPRVSN_DEPT_CD || '-' || C.ADT_MTHD_SECD || '-' || C.ADT_NO AS ADT_NO /* 감사번호 */
FROM TBBADDED008L A , TBBADDED002M B , TBBADDED001M C WHERE 1 = 1 AND A.BZTRP_YR BETWEEN #strBztStYY# AND #strBztEndYY# AND SUBSTRING(A.ADT_BGNG_YMD, 1, 6) BETWEEN #strBztStYY#||#strBztStMM# AND #strBztEndYY#||#strBztEndMM# AND A.INST_CD =#INST_CD# /*SQL_MASTER의 ORG_CD 대입*/ AND B.BZTRP_YR = A.BZTRP_YR AND B.BZTRP_SQNO = A.BZTRP_SQNO AND B.BZTRP_SECD = '1' AND C.CVLCPT_ADT_YR = B.REL_ADT_YR AND C.ADT_NO = B.REL_ADT_NO ) AA , (SELECT /*+ INDEX(A KBBADBADDED005001) */ BZTRP_YR AS BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    FT_SQNO /* 출장조순번 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN 1 ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN 0 ELSE 1 END) AS EMP_SECD /* 직원구분코드 */
FROM (SELECT DISTINCT AS BZTRP_YR,
    BZTRP_SQNO /* 출장순번 */,
    FT_SQNO /* 출장조순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    EMP_SECD /* 직원구분코드 */
FROM TBBADDED005L) A GROUP BY BZTRP_YR, BZTRP_SQNO, FT_SQNO ) BB , (SELECT /*+INDEX(B, KBBADBADDED006001) */ A.BZTRP_YR AS BZTRP_YR /* 출장년도 */,
    A.BZTRP_SQNO /* 출장순번 */,
    A.FT_SQNO /* 출장조순번 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN B.ADT_DCN ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN 0 ELSE B.ADT_DCN END) AS EMP_SECD /* 직원구분코드 */,
    MAX(B.ADT_DCN) AS ADT_DCN /* 감사일수 */
FROM TBBADDED005L A , TBBADDED006L B WHERE B.BZTRP_YR = A.BZTRP_YR AND B.BZTRP_SQNO = A.BZTRP_SQNO AND B.FT_SQNO = A.FT_SQNO AND B.BZTRVR_ALTMNT_SQNO = A.BZTRVR_ALTMNT_SQNO GROUP BY A.BZTRP_YR, A.BZTRP_SQNO, A.FT_SQNO ) CC WHERE BB.BZTRP_YR(+) = AA.BZTRP_YR AND BB.BZTRP_SQNO(+) = AA.BZTRP_SQNO AND BB.FT_SQNO(+) = AA.FT_SQNO AND CC.BZTRP_YR(+) = AA.BZTRP_YR AND CC.BZTRP_SQNO(+) = AA.BZTRP_SQNO AND CC.FT_SQNO(+) = AA.FT_SQNO ) AAA , (SELECT CD,
    CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000001') BBB , (SELECT CD,
    CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000007') CCC , TBDCMACM002M DDD , TBDCMACM001M EEE WHERE BBB.CD(+) = AAA.RGN_CD AND CCC.CD(+) = AAA.ADT_KDCD AND DDD.SRECS_DEPT_CD(+) = AAA.SPRVSN_DEPT_CD AND EEE.TRGT_NOP_ENO(+) = AAA.BZTRP_TL_ENO