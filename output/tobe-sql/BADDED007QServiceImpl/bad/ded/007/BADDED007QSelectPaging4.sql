SELECT A.CVLCPT_ADT_YR /* 민원감사년도 */,
    A.ADT_NO /* 감사번호 */,
    A.AUD_YRNO,
    A.ADT_ASMT_SECD /* 감사과제구분코드 */,
    A.INST_SECD /* 기관구분코드 */,
    A.ADT_KDCD /* 감사종류코드 */,
    A.SPRVSN_DEPT_CD /* 주관부서코드 */,
    A.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    A.ADT_MTHD_SECD /* 감사방법구분코드 */,
    A.ADT_MTTR_NM /* 감사사항명 */,
    A.PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    A.AUD_EXEC_DVSN_CD_NM,
    B.CVLCPT_ADT_YR /* 민원감사년도 */,
    B.ADT_NO /* 감사번호 */,
    B.INST_CD /* 기관코드 */,
    B.PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    B.DAYS,
    B.GEN_TRIP_CATE_NM,
    B.IN_PSON_CNT,
    B.EXT_PSON_CNT,
    B.STT_RMK_PSON_CNT,
    B.INST_SECD /* 기관구분코드 */,
    B.ORG_TYPE_SUM,
    B.ORG_TYPE_A,
    B.ORG_TYPE_B,
    B.ORG_TYPE_C,
    B.ORG_TYPE_D,
    B.BZTRP_DCN /* 출장일수 */
FROM ( select D.ADT_YR /* 감사년도 */,
    D.ADT_NO /* 감사번호 */,
    F_MNG_KND_AUDYRNO(D.ADT_YR, D.ADT_NO, max(D.ADT_KDCD), '-') AS F_MNG_KND_AUDYRNO,
    max(D.ADT_ASMT_SECD) AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    max(D.INST_SECD) AS INST_SECD /* 기관구분코드 */,
    max(D.ADT_KDCD) AS ADT_KDCD /* 감사종류코드 */,
    max(D.SPRVSN_DEPT_CD) AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    F_DPT_INFO(max(D.SPRVSN_DEPT_CD),'1') AS CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    /*부서명*/ max(D.ADT_MTHD_SECD) AS ADT_MTHD_SECD /* 감사방법구분코드 */,
    max(D.ADT_MTTR_NM) AS ADT_MTTR_NM /* 감사사항명 */,
    F_ORG_INFO(MAX(B.INST_CD),'1') AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    F_CODE_NM('1000007',MAX(D.ADT_KDCD)) AS F_CODE_NM
from TBBADDED008L B, TBBADDED002M C, TBBADDED001M D where 1=1 and C.BZTRP_YR between #strBztStYY# and #strBztEndYY# /*인자값1*/ and C.ADT_BGNG_YMD between #strBztStYY#||#strBztStMM# AND #strBztEndYY#||#strBztEndMM# /*인자값2*/ and C.BZTRP_YR = B.BZTRP_YR and C.BZTRP_SQNO = B.BZTRP_SQNO and C.BZTRP_SECD = '1' and D.CVLCPT_ADT_YR = C.REL_ADT_YR and D.ADT_NO = C.REL_ADT_NO and substring(D.ADT_KDCD, 3, 1) between #strAudKndCdSt# and #strAudKndCdEnd# group by D.CVLCPT_ADT_YR, D.ADT_NO order by AUD_EXEC_DVSN_CD_NM, D.ADT_NO ) A, ( Select /*+NO_MERGE*/ AA.CVLCPT_ADT_YR AS CVLCPT_ADT_YR /* 민원감사년도 */,
    /*감사년도*/ AA.ADT_NO AS ADT_NO /* 감사번호 */,
    /*감사순번*/ AA.INST_CD AS INST_CD /* 기관코드 */,
    /*기관코드*/ max(AA.PROF_RBPRSN_INST_NM) AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    /*기관명*/ AA.DAYS AS DAYS,
    /*감사일수*/ max(AA.CD_NM) AS CD_NM,
    /* 집행상태명*/ max(IN_PSON_CNT) AS IN_PSON_CNT,
    /*내부인원*/ max(EXT_PSON_CNT) AS EXT_PSON_CNT,
    /*수견인원*/ max(STT_RMK_PSON_CNT) AS STT_RMK_PSON_CNT,
    /*차출등*/ max( BB.INST_SECD) AS INST_SECD /* 기관구분코드 */,
    max(BB.ORG_TYPE_SUM) AS ORG_TYPE_SUM,
    /*기관합계*/ max(BB.ORG_TYPE_A) AS ORG_TYPE_A,
    max(BB.ORG_TYPE_B) AS ORG_TYPE_B,
    max(BB.ORG_TYPE_C) AS ORG_TYPE_C,
    max(BB.ORG_TYPE_D) AS ORG_TYPE_D,
    max(AA.BZTRP_DCN) AS BZTRP_DCN /* 출장일수 */
from (select MAX(ROWNUM),
    CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    INST_CD /* 기관코드 */,
    DAYS,
    max(PROF_RBPRSN_INST_NM) AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    max(CD_NM) AS CD_NM,
    max(BZTRP_DCN) AS BZTRP_DCN /* 출장일수 */,
    sum( case when A.EMP_SECD = '0' then A.ADT_DCN else 0 end) AS EMP_SECD /* 직원구분코드 */,
    sum( case when A.EMP_SECD = '1' then A.ADT_DCN else 0 end) AS EMP_SECD /* 직원구분코드 */,
    sum( case when A.EMP_SECD not in ('0','1') then A.ADT_DCN else 0 end) AS EMP_SECD /* 직원구분코드 */
from (select A.ADT_YR /* 감사년도 */,
    A.ADT_NO /* 감사번호 */,
    B.ADT_DCN /* 감사일수 */,
    C.INST_CD /* 기관코드 */,
    D.EMP_SECD /* 직원구분코드 */,
    E.ADT_DCN /* 감사일수 */,
    F_ORG_INFO(C.INST_CD,'1') AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    F_CODE_NM('1000007',B.GNRL_BZTRP_KDCD) AS F_CODE_NM,
    H.BZTRP_DCN /* 출장일수 */
from TBBADDED001M A, TBBADDED002M B, TBBADDED008L C, TBBADDED005L D, TBBADDED006L E, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    MAX(BZTRP_DCN) AS BZTRP_DCN /* 출장일수 */
FROM TBBADDED011L GROUP BY BZTRP_YR, BZTRP_SQNO) H where 1 =1 and A.CVLCPT_ADT_YR = A.CVLCPT_ADT_YR /*인자값1 AUD_YR*/ and B.ADT_BGNG_YMD between #strBztStYY#||#strBztStMM# AND #strBztEndYY#||#strBztEndMM#/*인자값2*/ and B.REL_ADT_YR = A.CVLCPT_ADT_YR and B.REL_ADT_NO = A.ADT_NO and B.BZTRP_SECD = '1' and C.BZTRP_YR = B.BZTRP_YR and C.BZTRP_SQNO = B.BZTRP_SQNO and D.BZTRP_YR = C.BZTRP_YR and D.BZTRP_SQNO = C.BZTRP_SQNO and D.FT_SQNO = C.FT_SQNO and E.BZTRP_YR = D.BZTRP_YR and E.BZTRP_SQNO = D.BZTRP_SQNO and E.FT_SQNO = D.FT_SQNO and E.FT_TRGT_INST_SQNO = C.FT_TRGT_INST_SQNO and E.BZTRVR_ALTMNT_SQNO = D.BZTRVR_ALTMNT_SQNO and B.BZTRP_YR = H.BZTRP_YR(+) and B.BZTRP_SQNO = H.BZTRP_SQNO(+) ) A group by CVLCPT_ADT_YR, ADT_NO, INST_CD, DAYS ) AA, (select ROWNUM,
    CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    INST_CD /* 기관코드 */,
    case when substring(INST_SECD, 1, 1) not in ('1', '2', '3') then '9' else substring(INST_SECD, 1, 1) end AS INST_SECD /* 기관구분코드 */,
    case when substring(A.INST_SECD, 1, 1) = '1' then 1 else 0 end || case when substring(A.INST_SECD, 1, 1) = '2' then 1 else 0 end || case when substring(A.INST_SECD, 1, 1) = '3' then 1 else 0 end || case when substring(A.INST_SECD, 1, 1) not in ('1', '2', '3') then 1 else 0 end AS SUBSTRING,
    case when substring(A.INST_SECD, 1, 1) = '1' then 1 else 0 end AS SUBSTRING,
    case when substring(A.INST_SECD, 1, 1) = '2' then 1 else 0 end AS SUBSTRING,
    case when substring(A.INST_SECD, 1, 1) = '3' then 1 else 0 end AS SUBSTRING,
    case when substring(A.INST_SECD, 1, 1) not in ('1', '2', '3') then 1 else 0 end AS SUBSTRING
from (select distinct A.ADT_YR AS ADT_YR /* 감사년도 */,
    A.ADT_NO /* 감사번호 */,
    C.BZTRP_YR /* 출장년도 */,
    C.BZTRP_SQNO /* 출장순번 */,
    C.INST_CD /* 기관코드 */,
    D.INST_SECD /* 기관구분코드 */
from TBBADDED001M A, TBBADDED002M B, TBBADDED008L C, TBDCMACM015M D where 1=1 and A.CVLCPT_ADT_YR = A.CVLCPT_ADT_YR /*인자값1 AUD_YR*/ and B.ADT_BGNG_YMD between #strBztStYY#||#strBztStMM# AND #strBztEndYY#||#strBztEndMM# /*인자값2*/ and B.REL_ADT_YR = A.CVLCPT_ADT_YR and B.REL_ADT_NO = A.ADT_NO and C.BZTRP_YR = B.BZTRP_YR and C.BZTRP_SQNO = B.BZTRP_SQNO and D.INST_CD(+) = C.INST_CD ) A ) BB where 1 =1 and BB.CVLCPT_ADT_YR = AA.CVLCPT_ADT_YR and BB.ADT_NO = AA.ADT_NO and BB.INST_CD = AA.INST_CD group by AA.CVLCPT_ADT_YR, AA.ADT_NO, AA.INST_CD, AA.DAYS ) B WHERE A.CVLCPT_ADT_YR = B.CVLCPT_ADT_YR AND A.ADT_NO = B.ADT_NO