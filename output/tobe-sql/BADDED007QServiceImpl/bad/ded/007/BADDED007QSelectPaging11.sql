SELECT A.RGN_CD AS RGN_CD /* 지역코드 */,
    A.RGN_NM,
    A.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    A.PROF_RBPRSN_INST_NM AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    SUBSTR(A.ADT_BGNG_YMD, 5, 2) || '.' || SUBSTR(A.ADT_BGNG_YMD, 7, 2) || '~' || SUBSTR(A.ADT_END_YMD, 5, 2) || '.' || SUBSTR(A.ADT_END_YMD, 7, 2) AS ADT_YMD /* 감사일자 */,
    F_CODE_NM('1000173', B.BZTRVR_JBGD_SECD) || ' ' || B.BZTRVR_NM || CASE WHEN NVL(B.TPOF_NOPE, 0) > 0 THEN ' 외' || B.TPOF_NOPE END AS F_CODE_NM
FROM(SELECT A.BZTRP_YR /* 출장년도 */,
    A.BZTRP_SQNO /* 출장순번 */,
    A.FT_SQNO /* 출장조순번 */,
    A.FT_TRGT_INST_SQNO /* 출장조대상기관순번 */,
    A.RGN_CD /* 지역코드 */,
    A.INST_CD /* 기관코드 */,
    A.ADT_BGNG_YMD /* 감사시작일자 */,
    A.ADT_END_YMD /* 감사종료일자 */,
    C.ADT_MTTR_NM /* 감사사항명 */,
    C.ADT_KDCD /* 감사종류코드 */,
    F_CODE_NM('1000001', A.RGN_CD) AS F_CODE_NM,
    /*지역명*/ F_ORG_INFO(A.INST_CD,'1') AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBBADDED008L A, TBBADDED002M B, TBBADDED001M C WHERE 1 = 1 AND A.BZTRP_YR BETWEEN #strBztStYY# AND #strBztEndYY# AND A.ADT_BGNG_YMD BETWEEN #strBztStYY#||#strBztStMM#||#strBztStDD# AND #strBztEndYY#||#strBztEndMM#||#strBztEndDD# AND A.RGN_CD IS NOT NULL AND A.INST_CD != '999000000000' AND EXISTS (SELECT *
FROM TBBADDED001M WHERE 1=1 AND SUBSTR(ADT_KDCD, 3, 1) IN ('1','2','3',' 5','6') ) AND B.BZTRP_YR = A.BZTRP_YR AND B.BZTRP_SQNO = A.BZTRP_SQNO AND B.BZTRP_SECD = '1' AND C.CVLCPT_ADT_YR = B.REL_ADT_YR AND C.ADT_NO = B.REL_ADT_NO AND A.INST_CD >= #strOrgCdSt# AND A.INST_CD GROUP BY A.BZTRP_YR, A.BZTRP_SQNO, A.FT_SQNO, A.FT_TRGT_INST_SQNO, A.RGN_CD, A.INST_CD, A.ADT_BGNG_YMD, A.ADT_END_YMD, C.ADT_MTTR_NM, C.ADT_KDCD ) A, (SELECT BB.BZTRP_YR /* 출장년도 */,
    BB.BZTRP_SQNO /* 출장순번 */,
    BB.FT_SQNO /* 출장조순번 */,
    BB.FT_TRGT_INST_SQNO /* 출장조대상기관순번 */,
    BB2.BZTRVR_NM /* 출장자명 */,
    BB2.BZTRVR_JBGD_SECD /* 출장자직급구분코드 */,
    BB.TPOF_NOPE /* 제보인원수 */
FROM (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    FT_SQNO /* 출장조순번 */,
    FT_TRGT_INST_SQNO /* 출장조대상기관순번 */,
    COUNT(*) - 1 AS TPOF_NOPE /* 제보인원수 */,
    MIN(BZTRVR_ALTMNT_SQNO) AS BZTRVR_ALTMNT_SQNO /* 출장자배정순번 */
FROM TBBADDED006L GROUP BY BZTRP_YR, BZTRP_SQNO, FT_SQNO, FT_TRGT_INST_SQNO) BB, TBBADDED005L BB2 WHERE BB.BZTRP_YR=BB2.BZTRP_YR AND BB.BZTRP_SQNO = BB2.BZTRP_SQNO AND BB.FT_SQNO = BB2.FT_SQNO AND BB.BZTRVR_ALTMNT_SQNO = BB2.BZTRVR_ALTMNT_SQNO) B WHERE A.BZTRP_YR = B.BZTRP_YR AND A.BZTRP_SQNO = B.BZTRP_SQNO AND A.FT_SQNO = B.FT_SQNO AND A.FT_TRGT_INST_SQNO = B.FT_TRGT_INST_SQNO