SELECT F_MNG_KND_AUDYRNO(AAA.CVLCPT_ADT_YR, AAA.ADT_NO, AAA.ADT_KDCD, '-') || '(' || AAA.CVLCPT_ADT_STP_SQNO || ')' AS F_MNG_KND_AUDYRNO,
    CCC.CD_NM || '(' || EEE.CD_NM || ')' AS CD_NM,
    F_DPT_INFO(AAA.SPRVSN_DEPT_CD,'1') AS F_DPT_INFO,
    BBB.PROF_RBPRSN_INST_NM AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    AAA.INST_CONT AS INST_CONT /* 기관개수 */,
    TO_CHAR(TO_DATE(AAA.ADT_BGNG_YMD),'YYYY.MM.DD') || '~' || TO_CHAR(TO_DATE(AAA.ADT_END_YMD),'YYYY.MM.DD') AS TO_CHAR,
    AAA.ADT_DCN AS ADT_DCN /* 감사일수 */,
    DDD.USER_NM AS USER_NM /* 사용자명 */,
    AAA.IN_PSON_CNT || '(' || AAA.IN_PSON_MAN_CNT || ')' AS IN_PSON_CNT,
    AAA.EXT_PSON_CNT || '(' || AAA.EXT_PSON_MAN_CNT || ')' AS EXT_PSON_CNT,
    AAA.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    AAA.BZTRP_YR /* 출장년도 */,
    AAA.BZTRP_SQNO /* 출장순번 */
FROM (SELECT AA.*,
    BB.IN_PSON_CNT,
    BB.EXT_PSON_CNT,
    CC.IN_PSON_MAN_CNT,
    CC.EXT_PSON_MAN_CNT,
    CC.ADT_DCN /* 감사일수 */,
    DD.INST_CONT /* 기관개수 */
FROM (SELECT A.BZTRP_YR /* 출장년도 */,
    A.BZTRP_SQNO /* 출장순번 */,
    B.ADT_STP_SQNO /* 감사단계순번 */,
    MIN(A.INST_CD) AS INST_CD /* 기관코드 */,
    MAX(A.FT_SQNO) AS FT_SQNO /* 출장조순번 */,
    MIN(A.ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    MAX(A.ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */,
    MAX(B.BZTRP_TL_ENO) AS BZTRP_TL_ENO /* 출장반장직원전산번호 */,
    MAX(C.ADT_YR) AS CVLCPT_ADT_YR /* 민원감사년도 */,
    MAX(C.ADT_NO) AS ADT_NO /* 감사번호 */,
    MAX(ADT_ASMT_SECD) AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    MAX(C.INST_SECD) AS INST_SECD /* 기관구분코드 */,
    MAX(C.ADT_KDCD) AS ADT_KDCD /* 감사종류코드 */,
    MAX(C.SPRVSN_DEPT_CD) AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    MAX(C.ADT_MTHD_SECD) AS ADT_MTHD_SECD /* 감사방법구분코드 */,
    MAX(C.ADT_MTTR_NM) AS ADT_MTTR_NM /* 감사사항명 */,
    MAX(B.ADT_BZTRP_KDCD) AS ADT_BZTRP_KDCD /* 감사출장종류코드 */
FROM TBBADDED008L A , TBBADDED002M B , TBBADDED001M C WHERE 1 = 1 AND SUBSTRING(B.ADT_BGNG_YMD, 1, 6) BETWEEN #strBztStYY#||#strBztStMM# AND #strBztEndYY#||#strBztEndMM# AND B.BZTRP_YR = A.BZTRP_YR AND B.BZTRP_SQNO = A.BZTRP_SQNO AND B.BZTRP_SECD = '1' AND C.CVLCPT_ADT_YR = B.REL_ADT_YR AND C.ADT_NO = B.REL_ADT_NO AND C.SPRVSN_DEPT_CD = #SPRVSN_DEPT_CD# /*주관국과코드*/ GROUP BY A.BZTRP_YR, A.BZTRP_SQNO, B.CVLCPT_ADT_STP_SQNO ) AA , (SELECT /*+ INDEX(A KBBADBADDED005001) */ BZTRP_YR AS BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN 1 ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN 0 ELSE 1 END) AS EMP_SECD /* 직원구분코드 */
FROM (SELECT DISTINCT AS BZTRP_YR,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    EMP_SECD /* 직원구분코드 */
FROM TBBADDED005L) A GROUP BY BZTRP_YR, BZTRP_SQNO ) BB , (SELECT /*+ USE_NL_WITH_INDEX(A, KBBADBADDED005001)*/ A.BZTRP_YR AS BZTRP_YR /* 출장년도 */,
    A.BZTRP_SQNO /* 출장순번 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN B.ADT_DCN ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN 0 ELSE B.ADT_DCN END) AS EMP_SECD /* 직원구분코드 */,
    MIN(B.ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    MAX(B.ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */,
    MAX(B.ADT_DCN) AS ADT_DCN /* 감사일수 */
FROM TBBADDED005L A , TBBADDED006L B WHERE B.BZTRP_YR = A.BZTRP_YR AND B.BZTRP_SQNO = A.BZTRP_SQNO AND B.FT_SQNO = A.FT_SQNO AND B.BZTRVR_ALTMNT_SQNO = A.BZTRVR_ALTMNT_SQNO GROUP BY A.BZTRP_YR, A.BZTRP_SQNO ) CC , (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    COUNT(DISTINCT INST_CD) AS INST_CONT /* 기관개수 */
FROM TBBADDED008L GROUP BY BZTRP_YR, BZTRP_SQNO) DD WHERE AA.BZTRP_YR = BB.BZTRP_YR(+) AND AA.BZTRP_SQNO = BB.BZTRP_SQNO(+) AND AA.BZTRP_YR = CC.BZTRP_YR(+) AND AA.BZTRP_SQNO = CC.BZTRP_SQNO(+) AND AA.BZTRP_YR = DD.BZTRP_YR(+) AND AA.BZTRP_SQNO = DD.BZTRP_SQNO(+) ) AAA , TBDCMACM015M BBB , (SELECT CD,
    CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000007') CCC , TBDCMACM001M DDD , (SELECT CD,
    CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD='1000030') EEE WHERE BBB.INST_CD = AAA.INST_CD AND EEE.CD = AAA.ADT_BZTRP_KDCD AND CCC.CD = AAA.ADT_KDCD AND DDD.TRGT_NOP_ENO = AAA.BZTRP_TL_ENO