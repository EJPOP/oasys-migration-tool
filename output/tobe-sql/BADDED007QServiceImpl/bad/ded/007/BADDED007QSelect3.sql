SELECT A.BZTRP_YR /* 출장년도 */,
    A.INST_CD /* 기관코드 */,
    A.PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    B.BZTRP_YR /* 출장년도 */,
    B.BZTRP_SQNO /* 출장순번 */,
    B.FT_SQNO /* 출장조순번 */,
    B.INST_CD /* 기관코드 */,
    F_ORG_INFO(B.INST_CD,'1') AS F_ORG_INFO,
    /*대표기관명*/ B.RGN_CD AS RGN_CD /* 지역코드 */,
    B.ADT_BGNG_YMD /* 감사시작일자 */,
    B.ADT_END_YMD /* 감사종료일자 */,
    B.ADT_DCN /* 감사일수 */,
    B.BZTRP_TL_ENO /* 출장반장직원전산번호 */,
    B.ADT_KDCD /* 감사종류코드 */,
    B.SPRVSN_DEPT_CD /* 주관부서코드 */,
    B.ADT_MTTR_NM /* 감사사항명 */,
    B.ADT_NO /* 감사번호 */,
    B.IN_PSON_CNT,
    B.EXT_PSON_CNT,
    B.IN_PSON_MAN_CNT,
    B.EXT_PSON_MAN_CNT,
    B.AUD_DCN_CNT,
    B.LCL_NM,
    B.AUD_EXEC_DVSN_CD_NM,
    B.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    B.USER_NM /* 사용자명 */
FROM (select A.BZTRP_YR /* 출장년도 */,
    A.INST_CD /* 기관코드 */,
    max(C.PROF_RBPRSN_INST_NM) AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
from TBBADDED008L A, TBBADDED002M B, TBDCMACM015M C where 1 = 1 and A.BZTRP_YR between #strBztStYY# and #strBztEndYY# /*인자값1*/ and SUBSTR(A.ADT_BGNG_YMD, 1, 6) between #strBztStYY#||#strBztStMM# and #strBztEndYY#||#strBztEndMM# /*인자값2*/ and A.INST_CD between #strOrgCdSt# AND #strOrgCdEnd# /*인자값3*/ and B.BZTRP_YR = A.BZTRP_YR and B.BZTRP_SQNO = A.BZTRP_SQNO and B.BZTRP_SECD = '1' and C.INST_CD = A.INST_CD group by A.BZTRP_YR, A.INST_CD) A, ( select AAA.BZTRP_YR /* 출장년도 */,
    AAA.BZTRP_SQNO /* 출장순번 */,
    AAA.FT_SQNO /* 출장조순번 */,
    AAA.INST_CD /* 기관코드 */,
    AAA.RGN_CD /* 지역코드 */,
    AAA.ADT_BGNG_YMD /* 감사시작일자 */,
    AAA.ADT_END_YMD /* 감사종료일자 */,
    AAA.ADT_DCN /* 감사일수 */,
    AAA.BZTRP_TL_ENO /* 출장반장직원전산번호 */,
    AAA.ADT_KDCD /* 감사종류코드 */,
    AAA.SPRVSN_DEPT_CD /* 주관부서코드 */,
    AAA.ADT_MTTR_NM /* 감사사항명 */,
    AAA.ADT_NO /* 감사번호 */,
    AAA.IN_PSON_CNT,
    AAA.EXT_PSON_CNT,
    AAA.IN_PSON_MAN_CNT,
    AAA.EXT_PSON_MAN_CNT,
    AAA.AUD_DCN_CNT,
    BBB.CD_NM,
    CCC.CD_NM,
    DDD.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    EEE.USER_NM /* 사용자명 */
from (select AA.BZTRP_YR /* 출장년도 */,
    AA.BZTRP_SQNO /* 출장순번 */,
    AA.FT_SQNO /* 출장조순번 */,
    AA.INST_CD /* 기관코드 */,
    AA.RGN_CD /* 지역코드 */,
    AA.ADT_BGNG_YMD /* 감사시작일자 */,
    AA.ADT_END_YMD /* 감사종료일자 */,
    AA.ADT_DCN /* 감사일수 */,
    AA.BZTRP_TL_ENO /* 출장반장직원전산번호 */,
    AA.ADT_KDCD /* 감사종류코드 */,
    AA.SPRVSN_DEPT_CD /* 주관부서코드 */,
    AA.ADT_MTTR_NM /* 감사사항명 */,
    AA.ADT_NO /* 감사번호 */,
    BB.IN_PSON_CNT,
    BB. AS BB.,
    CC.IN_PSON_MAN_CNT,
    CC. AS CC.,
    CC.AUD_DCN_cnt
FROM (select A.BZTRP_YR /* 출장년도 */,
    A.BZTRP_SQNO /* 출장순번 */,
    A.FT_SQNO /* 출장조순번 */,
    A.INST_CD /* 기관코드 */,
    A.RGN_CD /* 지역코드 */,
    A.ADT_BGNG_YMD /* 감사시작일자 */,
    A.ADT_END_YMD /* 감사종료일자 */,
    B.ADT_DCN /* 감사일수 */,
    B.BZTRP_TL_ENO /* 출장반장직원전산번호 */,
    C.ADT_KDCD /* 감사종류코드 */,
    C.SPRVSN_DEPT_CD /* 주관부서코드 */,
    C.ADT_MTTR_NM /* 감사사항명 */,
    /* C.AUD_YR || '-' || C.AUD_TASK_CD || '-' || C.ORG_DVSN_CD|| '-' || substr(C.AUD_KND_CD, 3, 1) || '-' || C.SPV_BRDV_CD || '-' || C.AUD_WAY_CD || '-' || C.AUD_NO as AUD_NO */ /* 감사연번호 수정 - 2016.04.08 yyh */ F_MNG_KND_AUDYRNO(C.ADT_YR, C.ADT_NO, C.ADT_KDCD, '-') AS ADT_NO /* 감사번호 */
from TBBADDED008L A, TBBADDED002M B, TBBADDED001M C where 1 = 1 and A.BZTRP_YR between #strBztStYY# and #strBztEndYY# and substring(A.ADT_BGNG_YMD, 1, 6) between #strBztStYY#||#strBztStMM# and #strBztEndYY#||#strBztEndMM# and A.INST_CD between #strOrgCdSt# AND #strOrgCdEnd# /*인자값3*/ and B.BZTRP_YR = A.BZTRP_YR and B.BZTRP_SQNO = A.BZTRP_SQNO and B.BZTRP_SECD = '1' and C.CVLCPT_ADT_YR = B.REL_ADT_YR and C.ADT_NO = B.REL_ADT_NO ) AA, (select BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    FT_SQNO /* 출장조순번 */,
    sum( case when A.EMP_SECD = '0' then 1 else 0 end) AS EMP_SECD /* 직원구분코드 */,
    sum( case when A.EMP_SECD = '0' then 0 else 1 end) AS EMP_SECD /* 직원구분코드 */
from (select distinct AS BZTRP_YR,
    BZTRP_SQNO /* 출장순번 */,
    FT_SQNO /* 출장조순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    EMP_SECD /* 직원구분코드 */
from TBBADDED005L WHERE BZTRP_YR between #strBztStYY# and #strBztEndYY# ) A group by BZTRP_YR, BZTRP_SQNO, FT_SQNO ) BB, (select A.BZTRP_YR /* 출장년도 */,
    A.BZTRP_SQNO /* 출장순번 */,
    A.FT_SQNO /* 출장조순번 */,
    sum( case when A.EMP_SECD = '0' then B.ADT_DCN else 0 end) AS EMP_SECD /* 직원구분코드 */,
    sum( case when A.EMP_SECD = '0' then 0 else B.ADT_DCN end) AS EMP_SECD /* 직원구분코드 */,
    MAX(B.ADT_DCN) AS ADT_DCN /* 감사일수 */
from TBBADDED005L A, TBBADDED006L B where B.BZTRP_YR = A.BZTRP_YR and B.BZTRP_SQNO = A.BZTRP_SQNO and B.FT_SQNO = A.FT_SQNO and B.BZTRVR_ALTMNT_SQNO = A.BZTRVR_ALTMNT_SQNO and B.BZTRP_YR between #strBztStYY# and #strBztEndYY# and substring(B.ADT_BGNG_YMD, 1, 6) between #strBztStYY#||#strBztStMM# and #strBztEndYY#||#strBztEndMM# group by A.BZTRP_YR, A.BZTRP_SQNO, A.FT_SQNO ) CC where BB.BZTRP_YR(+) = AA.BZTRP_YR and BB.BZTRP_SQNO(+) = AA.BZTRP_SQNO and BB.FT_SQNO(+) = AA.FT_SQNO and CC.BZTRP_YR(+) = AA.BZTRP_YR and CC.BZTRP_SQNO(+) = AA.BZTRP_SQNO and CC.FT_SQNO(+) = AA.FT_SQNO ) AAA, (select CD,
    CD_NM
from TBDCMACM013C where CMM_CD_DVSN_CD = '1000001') BBB, (select CD,
    CD_NM
from TBDCMACM013C where CMM_CD_DVSN_CD = '1000007') CCC, TBDCMACM002M DDD, TBDCMACM001M EEE where BBB.CD(+) = AAA.RGN_CD and CCC.CD(+) = AAA.ADT_KDCD and DDD.SRECS_DEPT_CD(+) = AAA.SPRVSN_DEPT_CD and EEE.TRGT_NOP_ENO(+) = AAA.BZTRP_TL_ENO ) B WHERE A.BZTRP_YR = B.BZTRP_YR AND A.INST_CD = B.INST_CD order by A.BZTRP_YR,A.INST_CD;