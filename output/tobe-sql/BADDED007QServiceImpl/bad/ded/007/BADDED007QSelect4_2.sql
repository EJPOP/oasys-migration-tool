SELECT AA.CVLCPT_ADT_YR /* 민원감사년도 */,
    AA.ADT_NO /* 감사번호 */,
    AA.INST_CD /* 기관코드 */,
    MAX(AA.PROF_RBPRSN_INST_NM) AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    AA.DAYS AS DAYS,
    MAX(AA.CD_NM) AS CD_NM,
    MAX(IN_PSON_CNT) AS IN_PSON_CNT,
    MAX(EXT_PSON_CNT) AS EXT_PSON_CNT,
    MAX(STT_RMK_PSON_CNT) AS STT_RMK_PSON_CNT,
    MAX( BB.INST_SECD) AS INST_SECD /* 기관구분코드 */,
    MAX(BB.ORG_TYPE_SUM) AS ORG_TYPE_SUM,
    MAX(BB.ORG_TYPE_A) AS ORG_TYPE_A,
    MAX(BB.ORG_TYPE_B) AS ORG_TYPE_B,
    MAX(BB.ORG_TYPE_C) AS ORG_TYPE_C,
    MAX(BB.ORG_TYPE_D) AS ORG_TYPE_D,
    MAX(AA.BZTRP_DCN) AS BZTRP_DCN /* 출장일수 */
FROM (SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    INST_CD /* 기관코드 */,
    DAYS,
    MAX(PROF_RBPRSN_INST_NM) AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    MAX(CD_NM) AS CD_NM,
    MAX(BZTRP_DCN) AS BZTRP_DCN /* 출장일수 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN A.ADT_DCN ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    SUM( CASE WHEN A.EMP_SECD = '1' THEN A.ADT_DCN ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    SUM( CASE WHEN A.EMP_SECD NOT IN ('0' ,'1') THEN A.ADT_DCN ELSE 0 END) AS EMP_SECD /* 직원구분코드 */
FROM (SELECT A.ADT_YR /* 감사년도 */,
    A.ADT_NO /* 감사번호 */,
    B.ADT_DCN /* 감사일수 */,
    C.INST_CD /* 기관코드 */,
    D.EMP_SECD /* 직원구분코드 */,
    E.ADT_DCN /* 감사일수 */,
    F.PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    G.CD_NM,
    H.BZTRP_DCN /* 출장일수 */
FROM TBBADDED001M A , TBBADDED002M B , TBBADDED008L C , TBBADDED005L D , TBBADDED006L E , TBDCMACM015M F , TBDCMACM013C G , (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    MAX(BZTRP_DCN) AS BZTRP_DCN /* 출장일수 */
FROM TBBADDED011L GROUP BY BZTRP_YR, BZTRP_SQNO) H WHERE 1 =1 AND A.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# /*인자값1 AUD_YR*/ AND A.ADT_NO = #ADT_NO# /*인자값1 AUD_NO*/ AND B.ADT_BGNG_YMD BETWEEN #strBztStYY#||#strBztStMM#||#strBztStDD# AND #strBztEndYY#||#strBztEndMM#||#strBztEndDD# /*인자값2*/ AND B.REL_ADT_YR = A.CVLCPT_ADT_YR AND B.REL_ADT_NO = A.ADT_NO AND B.BZTRP_SECD = '1' AND C.BZTRP_YR = B.BZTRP_YR AND C.BZTRP_SQNO = B.BZTRP_SQNO AND D.BZTRP_YR = C.BZTRP_YR AND D.BZTRP_SQNO = C.BZTRP_SQNO AND D.FT_SQNO = C.FT_SQNO AND E.BZTRP_YR = D.BZTRP_YR AND E.BZTRP_SQNO = D.BZTRP_SQNO AND E.FT_SQNO = D.FT_SQNO AND E.FT_TRGT_INST_SQNO = C.FT_TRGT_INST_SQNO AND E.BZTRVR_ALTMNT_SQNO = D.BZTRVR_ALTMNT_SQNO AND F.INST_CD(+) = C.INST_CD AND G.CD(+) = B.GNRL_BZTRP_KDCD AND G.CMM_CD_DVSN_CD(+) = '10000010' AND B.BZTRP_YR = H.BZTRP_YR(+) AND B.BZTRP_SQNO = H.BZTRP_SQNO(+) ) A GROUP BY CVLCPT_ADT_YR, ADT_NO, INST_CD, DAYS ) AA , (SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    INST_CD /* 기관코드 */,
    CASE WHEN SUBSTRING(INST_SECD, 1, 1) NOT IN ('1' , '2' , '3') THEN '9' ELSE SUBSTRING(INST_SECD, 1, 1) END AS INST_SECD /* 기관구분코드 */,
    CASE WHEN SUBSTRING(A.INST_SECD, 1, 1) = '1' THEN 1 ELSE 0 END || CASE WHEN SUBSTRING(A.INST_SECD, 1, 1) = '2' THEN 1 ELSE 0 END || CASE WHEN SUBSTRING(A.INST_SECD, 1, 1) = '3' THEN 1 ELSE 0 END || CASE WHEN SUBSTRING(A.INST_SECD, 1, 1) NOT IN ('1' , '2' , '3') THEN 1 ELSE 0 END AS SUBSTRING,
    CASE WHEN SUBSTRING(A.INST_SECD, 1, 1) = '1' THEN 1 ELSE 0 END AS SUBSTRING,
    CASE WHEN SUBSTRING(A.INST_SECD, 1, 1) = '2' THEN 1 ELSE 0 END AS SUBSTRING,
    CASE WHEN SUBSTRING(A.INST_SECD, 1, 1) = '3' THEN 1 ELSE 0 END AS SUBSTRING,
    CASE WHEN SUBSTRING(A.INST_SECD, 1, 1) NOT IN ('1' , '2' , '3') THEN 1 ELSE 0 END AS SUBSTRING
FROM (SELECT DISTINCT A.ADT_YR AS ADT_YR /* 감사년도 */,
    A.ADT_NO /* 감사번호 */,
    C.BZTRP_YR /* 출장년도 */,
    C.BZTRP_SQNO /* 출장순번 */,
    C.INST_CD /* 기관코드 */,
    D.INST_SECD /* 기관구분코드 */
FROM TBBADDED001M A , TBBADDED002M B , TBBADDED008L C , TBDCMACM015M D WHERE 1=1 AND A.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# /*인자값1 AUD_YR*/ AND A.ADT_NO = #ADT_NO# /*인자값1 AUD_NO*/ AND B.ADT_BGNG_YMD BETWEEN #strBztStYY#||#strBztStMM#||#strBztStDD# AND #strBztEndYY#||#strBztEndMM#||#strBztEndDD# /*인자값2*/ AND B.REL_ADT_YR = A.CVLCPT_ADT_YR AND B.REL_ADT_NO = A.ADT_NO AND C.BZTRP_YR = B.BZTRP_YR AND C.BZTRP_SQNO = B.BZTRP_SQNO AND D.INST_CD(+) = C.INST_CD ) A ) BB WHERE 1 =1 AND BB.CVLCPT_ADT_YR = AA.CVLCPT_ADT_YR AND BB.ADT_NO = AA.ADT_NO AND BB.INST_CD = AA.INST_CD AND AA.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# /*인자값1 AUD_YR*/ AND AA.ADT_NO = #ADT_NO# /*인자값1 AUD_NO*/ GROUP BY AA.CVLCPT_ADT_YR, AA.ADT_NO, AA.INST_CD, AA.DAYS