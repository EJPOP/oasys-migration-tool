SELECT F_MNG_KND_AUDYRNO(AAA.CVLCPT_ADT_YR, AAA.ADT_NO, AAA.ADT_KDCD, '-') || '(' || AAA.CVLCPT_ADT_STP_SQNO || ')' AS F_MNG_KND_AUDYRNO,
    CCC.CD_NM || '(' || FFF.CD_NM || ')' AS CD_NM,
    EEE.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    BBB.PROF_RBPRSN_INST_NM AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    AAA.INST_CONT AS INST_CONT /* 기관개수 */,
    TO_CHAR(TO_DATE(AAA.ADT_BGNG_YMD),'YYYY.MM.DD') || '~' || TO_CHAR(TO_DATE(AAA.ADT_END_YMD),'YYYY.MM.DD') AS TO_CHAR,
    AAA.ADT_DCN AS ADT_DCN /* 감사일수 */,
    AAA.IN_PSON_CNT || '(' || AAA.IN_PSON_MAN_CNT || ')' AS IN_PSON_CNT,
    AAA.EXT_PSON_CNT || '(' || AAA.EXT_PSON_MAN_CNT || ')' AS EXT_PSON_CNT,
    DDD.USER_NM AS USER_NM /* 사용자명 */,
    AAA.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */
FROM (SELECT AA.*,
    BB.IN_PSON_CNT,
    BB. AS BB.,
    CC.IN_PSON_MAN_CNT,
    CC. AS CC.,
    CC.ADT_DCN /* 감사일수 */,
    DD.INST_CONT /* 기관개수 */
FROM (SELECT A.ADT_YR /* 감사년도 */,
    A.ADT_NO /* 감사번호 */,
    B.ADT_STP_SQNO /* 감사단계순번 */,
    MAX(B.ADT_DCN) AS ADT_DCN /* 감사일수 */,
    MAX(A.ADT_ASMT_SECD) AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    MAX(A.INST_SECD) AS INST_SECD /* 기관구분코드 */,
    MAX(A.ADT_KDCD) AS ADT_KDCD /* 감사종류코드 */,
    MAX(A.SPRVSN_DEPT_CD) AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    MAX(A.ADT_MTHD_SECD) AS ADT_MTHD_SECD /* 감사방법구분코드 */,
    MAX(A.ADT_MTTR_NM) AS ADT_MTTR_NM /* 감사사항명 */,
    MAX(B.ADT_BZTRP_KDCD) AS ADT_BZTRP_KDCD /* 감사출장종류코드 */,
    MAX(B.BZTRP_YR) AS BZTRP_YR /* 출장년도 */,
    MAX(B.BZTRP_SQNO) AS BZTRP_SQNO /* 출장순번 */,
    MAX(B.BZTRP_TL_ENO) AS BZTRP_TL_ENO /* 출장반장직원전산번호 */,
    MIN(C.INST_CD) AS INST_CD /* 기관코드 */,
    MAX(C.FT_SQNO) AS FT_SQNO /* 출장조순번 */,
    MIN(C.ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    MAX(C.ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */
FROM TBBADDED001M A , TBBADDED002M B , TBBADDED008L C WHERE 1 = 1 AND A.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# /* 감사연번종류코드 - 2015.12.18 yyh */ AND SUBSTR(A.ADT_KDCD,3,1) = #strAudYrNoKndCd# AND A.ADT_NO >= #strAudNoSt# AND A.ADT_NO AND B.REL_ADT_YR = A.CVLCPT_ADT_YR AND B.REL_ADT_NO = A.ADT_NO AND B.BZTRP_SECD = '1' AND C.BZTRP_YR = B.BZTRP_YR AND C.BZTRP_SQNO = B.BZTRP_SQNO GROUP BY A.CVLCPT_ADT_YR, A.ADT_NO, B.CVLCPT_ADT_STP_SQNO ) AA , (SELECT /*+ INDEX(A KBBADBADDED005001) */ BZTRP_YR AS BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN 1 ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN 0 ELSE 1 END) AS EMP_SECD /* 직원구분코드 */
FROM (SELECT DISTINCT AS BZTRP_YR,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    EMP_SECD /* 직원구분코드 */
FROM TBBADDED005L) A GROUP BY BZTRP_YR, BZTRP_SQNO ) BB , (SELECT /*+INDEX(B, KBBADBADDED006001) */ A.BZTRP_YR AS BZTRP_YR /* 출장년도 */,
    A.BZTRP_SQNO /* 출장순번 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN B.ADT_DCN ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    SUM( CASE WHEN A.EMP_SECD = '0' THEN 0 ELSE B.ADT_DCN END) AS EMP_SECD /* 직원구분코드 */,
    MIN(B.ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */,
    MAX(B.ADT_END_YMD) AS ADT_END_YMD /* 감사종료일자 */,
    MAX(B.ADT_DCN) AS ADT_DCN /* 감사일수 */
FROM TBBADDED005L A , TBBADDED006L B WHERE B.BZTRP_YR = A.BZTRP_YR AND B.BZTRP_SQNO = A.BZTRP_SQNO AND B.FT_SQNO = A.FT_SQNO AND B.BZTRVR_ALTMNT_SQNO = A.BZTRVR_ALTMNT_SQNO GROUP BY A.BZTRP_YR, A.BZTRP_SQNO ) CC , (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    COUNT(DISTINCT INST_CD) AS INST_CONT /* 기관개수 */
FROM TBBADDED008L GROUP BY BZTRP_YR, BZTRP_SQNO) DD WHERE BB.BZTRP_YR(+) = AA.BZTRP_YR AND BB.BZTRP_SQNO(+) = AA.BZTRP_SQNO AND CC.BZTRP_YR(+) = AA.BZTRP_YR AND CC.BZTRP_SQNO(+) = AA.BZTRP_SQNO AND DD.BZTRP_YR(+) = AA.BZTRP_YR AND DD.BZTRP_SQNO(+) = AA.BZTRP_SQNO ) AAA , TBDCMACM015M BBB , (SELECT CD,
    CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000007') CCC , TBDCMACM001M DDD , TBDCMACM002M EEE , (SELECT CD,
    CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000030') FFF WHERE BBB.INST_CD(+) = AAA.INST_CD AND EEE.SRECS_DEPT_CD(+) = AAA.SPRVSN_DEPT_CD AND FFF.CD(+) = AAA.ADT_BZTRP_KDCD AND CCC.CD(+) = AAA.ADT_KDCD AND DDD.TRGT_NOP_ENO = AAA.BZTRP_TL_ENO