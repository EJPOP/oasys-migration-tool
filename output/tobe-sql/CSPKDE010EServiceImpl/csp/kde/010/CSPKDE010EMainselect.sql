SELECT D1.REGI_SRNO AS REGI_SRNO /* 일련번호 */,
    D1.REG_YMD AS REG_YMD /* 등록일자 */,
    D1.REG_DEPT_CD AS REG_DEPT_CD /* 등록부서코드 */,
    F_DPT_INFO(D1.REG_DEPT_CD,'1') AS F_DPT_INFO /* 등록부서명 */,
    F_DPT_INFO(D1.REG_DEPT_CD,'4') AS F_DPT_INFO /* 약칭 등록부서명 */,
    D1.OTSD_EXPRT_RGTR_ENO AS OTSD_EXPRT_RGTR_ENO /* 외부전문가등록자직원전산번호 */,
    F_USR_INFO(D1.OTSD_EXPRT_RGTR_ENO,'2') AS F_USR_INFO /* 등록자전산번호 성명 */,
    D1.OGDP_INST_CD AS OGDP_INST_CD /* 소속기관코드 */,
    F_ORG_INFO(D1.OGDP_INST_CD,'1') AS TPOF_OGDP_INST_NM /* 제보소속기관명 */,
    D1.CRU_OGDP_DEPT_NM AS CRU_OGDP_DEPT_NM /* 부패소속부서명 */,
    F_ORG_INFO(D1.OGDP_INST_CD,'1') || '(' || D1.CRU_OGDP_DEPT_NM || ')' AS F_ORG_INFO /* 목록 소속기관부서명 */,
    F_ORG_INFO(D1.OGDP_INST_CD,'1') AS F_ORG_INFO /* 소속기관부서명 */,
    D1.JBGD_NM AS JBGD_NM /* 직급명 */,
    D1.INFO_RLPR_NM AS INFO_RLPR_NM /* 정보관계자명 */,
    D1.CRU_RRNO_SCRTY AS CRU_RRNO_SCRTY /* 부패주민등록번호보안 */,
    CASE WHEN NVL(D1.PRGRS_STTS_SECD,'07') >= '03' THEN D1.INSPC_STR_DT ELSE '' END AS PRGRS_STTS_SECD /* 진행상태구분코드 */,
    CASE WHEN NVL(D1.PRGRS_STTS_SECD,'07') >= '06' THEN D1.INSPC_RLS_DT ELSE '' END AS PRGRS_STTS_SECD /* 진행상태구분코드 */,
    D1.CPADT_NTFCTN_YMD AS CPADT_NTFCTN_YMD /* 위탁대행감사통보일자 */,
    D1.END_YMD AS END_YMD /* 종료일자 */,
    NVL2(D3.REG_DEPT_CD, F_DPT_INFO(D3.REG_DEPT_CD, '1') || '(' || F_USR_INFO(D3.OTSD_EXPRT_RGTR_ENO, '2') || ')' , '') AS NVL2 /* 관련의원면직신청 */,
    D2.ADT_GRNT_NO /* 감사부여번호 */,
    D1.CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.ADT_NO /* 감사번호 */,
    D2.ADT_GRNT_NO /* 감사부여번호 */,
    CASE WHEN D2.ADT_YR >= '2016' THEN D2.ADT_KDCD ELSE '' END AS ADT_YR /* 감사년도 */,
    D2.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    D1.REG_APV_DOC_NO AS REG_APV_DOC_NO,
    D1.RLS_APV_DOC_NO AS RLS_APV_DOC_NO,
    NVL(D1.PRGRS_STTS_SECD, '07') AS PRGRS_STTS_SECD /* 진행상태구분코드 */
FROM TBCSPKDE007M D1 , TB_BADDED001M D2 , (SELECT REG_DEPT_CD /* 등록부서코드 */,
    OTSD_EXPRT_RGTR_ENO /* 외부전문가등록자직원전산번호 */,
    TRIM(INFO_RLPR_NM) AS INFO_RLPR_NM /* 정보관계자명 */,
    TRIM(CRU_RRNO_SCRTY) AS CRU_RRNO_SCRTY /* 부패주민등록번호보안 */
FROM (SELECT REG_DEPT_CD /* 등록부서코드 */,
    OTSD_EXPRT_RGTR_ENO /* 외부전문가등록자직원전산번호 */,
    INFO_RLPR_NM /* 정보관계자명 */,
    CRU_RRNO_SCRTY /* 부패주민등록번호보안 */,
    ROW_NUMBER() OVER(PARTITION BY INFO_RLPR_NM , CRU_RRNO_SCRTY ORDER BY FRST_REG_DT DESC) AS ROW_NUMBER
from TBCSPKDE005M) WHERE RN =1) D3 WHERE D1.CVLCPT_ADT_YR = D2.ADT_YR(+) AND D1.ADT_NO = D2.ADT_NO(+) AND TRIM(D1.CRU_RRNO_SCRTY) = D3.CRU_RRNO_SCRTY(+) AND TRIM(D1.INFO_RLPR_NM) = D3.INFO_RLPR_NM(+) AND NVL(D1.PRGRS_STTS_SECD, '07') NOT IN ('01','02') /*조사시작등록 결재전, 결재중*/ AND D1.REG_DEPT_CD IN (SELECT CASE WHEN (SELECT AS MANPOWER_POOL_SYE_YN
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = #SRECS_DEPT_CD#) = 'Y' THEN #SRECS_DEPT_CD# ELSE '' END AS SRECS_DEPT_CD FROM DUAL UNION SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', CASE WHEN #strDptAuth# = 'ALL' THEN #SRECS_DEPT_CD# WHEN (SELECT MANPOWER_POOL_SYE_YN
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = F_USR_INFO(#strCnb#,'5')) = 'N' THEN F_USR_INFO(#strCnb#,'5') WHEN (SELECT MANPOWER_POOL_SYE_YN
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = (SELECT HIRK_DPT_CD
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = F_USR_INFO(#strCnb#,'5'))) = 'Y' THEN (SELECT HIRK_DPT_CD
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = F_USR_INFO(#strCnb#,'5')) ELSE #SRECS_DEPT_CD# END))) AND D1.REG_DEPT_CD = #REG_DEPT_CD# AND D1.INSPC_RLS_DT IS NULL AND D1.CPADT_NTFCTN_YMD IS NULL AND D1.END_YMD IS NULL AND D1.CPADT_NTFCTN_YMD IS NOT NULL AND D1.END_YMD IS NULL AND ((D1.INSPC_RLS_DT IS NOT NULL AND D1.CPADT_NTFCTN_YMD IS NULL ) OR (D1.END_YMD IS NOT NULL)) AND D1.OGDP_INST_CD = #OGDP_INST_CD# AND D1.INFO_RLPR_NM LIKE '%' || #strNam# || '%'