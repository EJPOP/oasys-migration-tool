/* faa/cav/006/FAACAV006EMainselect2 */ /* 총 대상건수 */ WITH TB_ALL AS( SELECT SUM(CASE WHEN (MN1_STTS_SECD &lt;&gt; '*' OR MN1_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'01' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'01' THEN 1 ELSE 0 END) AS MN1_STTS_SECD /* 1월상태구분코드 */,
    SUM(CASE WHEN (MN2_STTS_SECD &lt;&gt; '*' OR MN2_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'02' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'02' THEN 1 ELSE 0 END) AS MN2_STTS_SECD /* 2월상태구분코드 */,
    SUM(CASE WHEN (MN3_STTS_SECD &lt;&gt; '*' OR MN3_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'03' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'03' THEN 1 ELSE 0 END) AS MN3_STTS_SECD /* 3월상태구분코드 */,
    SUM(CASE WHEN (MN4_STTS_SECD &lt;&gt; '*' OR MN4_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'04' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'04' THEN 1 ELSE 0 END) AS MN4_STTS_SECD /* 4월상태구분코드 */,
    SUM(CASE WHEN (MN5_STTS_SECD &lt;&gt; '*' OR MN5_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'05' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'05' THEN 1 ELSE 0 END) AS MN5_STTS_SECD /* 5월상태구분코드 */,
    SUM(CASE WHEN (MN6_STTS_SECD &lt;&gt; '*' OR MN6_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'06' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'06' THEN 1 ELSE 0 END) AS MN6_STTS_SECD /* 6월상태구분코드 */,
    SUM(CASE WHEN (MN7_STTS_SECD &lt;&gt; '*' OR MN7_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'07' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'07' THEN 1 ELSE 0 END) AS MN7_STTS_SECD /* 7월상태구분코드 */,
    SUM(CASE WHEN (MN8_STTS_SECD &lt;&gt; '*' OR MN8_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'08' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'08' THEN 1 ELSE 0 END) AS MN8_STTS_SECD /* 8월상태구분코드 */,
    SUM(CASE WHEN (MN9_STTS_SECD &lt;&gt; '*' OR MN9_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'09' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'09' THEN 1 ELSE 0 END) AS MN9_STTS_SECD /* 9월상태구분코드 */,
    SUM(CASE WHEN (MN10_STTS_SECD &lt;&gt; '*' OR MN10_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'10' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'10' THEN 1 ELSE 0 END) AS MN10_STTS_SECD /* 10월상태구분코드 */,
    SUM(CASE WHEN (MN11_STTS_SECD &lt;&gt; '*' OR MN11_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'11' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'11' THEN 1 ELSE 0 END) AS MN11_STTS_SECD /* 11월상태구분코드 */,
    SUM(CASE WHEN (MN12_STTS_SECD &lt;&gt; '*' OR MN12_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'12' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'12' THEN 1 ELSE 0 END) AS MN12_STTS_SECD /* 12월상태구분코드 */,
    SUM(CASE WHEN (MN13_STTS_SECD &lt;&gt; '*' OR MN13_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'12' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'12' THEN 1 ELSE 0 END) AS TOT_CNT13 SUM(CASE WHEN (MN1_STTS_SECD &lt;&gt; '*' OR MN1_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'01' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'03' THEN 1 ELSE 0 END) AS MN13_STTS_SECD /* 13월상태구분코드 */,
    SUM(CASE WHEN (MN2_STTS_SECD &lt;&gt; '*' OR MN2_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'04' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'06' THEN 1 ELSE 0 END) AS MN2_STTS_SECD /* 2월상태구분코드 */,
    SUM(CASE WHEN (MN3_STTS_SECD &lt;&gt; '*' OR MN3_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'07' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'09' THEN 1 ELSE 0 END) AS MN3_STTS_SECD /* 3월상태구분코드 */,
    SUM(CASE WHEN (MN4_STTS_SECD &lt;&gt; '*' OR MN4_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'10' AND A.PROF_RBPRSN_CRT_YMD &lt;= #PROF_YM#||'13' THEN 1 ELSE 0 END) AS TOT_CNT4 SUM(CASE WHEN (MN1_STTS_SECD &lt;&gt; '*' OR MN1_STTS_SECD IS NULL) AND NVL(A.PROF_RBPRSN_ABL_YMD,'999999') &gt;= #PROF_YM#||'00' AND A.PROF_RBPRSN_CRT_YMD AS PROF_RBPRSN_ABL_YMD /* 증명책임자폐지일자 */
FROM TWFAACAV007M B, (SELECT A.JRSD_CD /* 소관코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.BLL_KDCD /* 계산서종류코드 */,
    A.PROF_RBPRSN_SQNO /* 증명책임자순번 */,
    A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO /* 관서운영경비출납공무원순번 */,
    A.PROF_RBPRSN_CRT_YMD /* 증명책임자생성일자 */,
    A.PROF_RBPRSN_ABL_YMD /* 증명책임자폐지일자 */
FROM TWFAACAV003M A WHERE A.MDFCN_SECD NOT IN ('D') AND A.SRECS_RCPT_SECD NOT IN ('P') AND A.PROF_RBPRSN_ABL_YMD >= #PROF_YM#||'00' AND A.PROF_RBPRSN_CRT_YMD ) A WHERE 1=1 AND B.JRSD_CD = A.JRSD_CD AND B.ACNTG_CD = A.ACNTG_CD AND B.BLL_KDCD = A.BLL_KDCD AND B.PROF_RBPRSN_SQNO = A.PROF_RBPRSN_SQNO AND B.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO AND B.PROF_YR = #PROF_YM# ), /* 검산대상건수 */ TB_DO AS( SELECT B.PROF_YM /* 증명연월 */,
    COUNT(B.JRSD_CD) AS JRSD_CD /* 소관코드 */
FROM (SELECT DISTINCT A.JRSD_CD AS JRSD_CD /* 소관코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.BLL_KDCD /* 계산서종류코드 */,
    A.PROF_RBPRSN_SQNO /* 증명책임자순번 */,
    A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO /* 관서운영경비출납공무원순번 */,
    A.PROF_YM /* 증명연월 */,
    CASE WHEN A.PROF_YM = #PROF_YM#||'13' THEN #PROF_YM#||'12' ELSE A.PROF_YM END AS PROF_YM /* 증명연월 */,
    CASE WHEN A.PROF_YM = #PROF_YM#||'13' THEN #PROF_YM#||'12' ELSE A.PROF_YM END AS CRE_DT_PROF_YM CASE A.PROF_YM WHEN #PROF_YM#||'01' THEN #PROF_YM#||'01' WHEN #PROF_YM#||'02' THEN #PROF_YM#||'04' WHEN #PROF_YM#||'03' THEN #PROF_YM#||'07' WHEN #PROF_YM#||'04' THEN #PROF_YM#||'10' END AS PROF_YM /* 증명연월 */,
    CASE A.PROF_YM WHEN #PROF_YM#||'01' THEN #PROF_YM#||'03' WHEN #PROF_YM#||'02' THEN #PROF_YM#||'06' WHEN #PROF_YM#||'03' THEN #PROF_YM#||'09' WHEN #PROF_YM#||'04' THEN #PROF_YM#||'13' END AS CRE_DT_PROF_YM #PROF_YM#||'00' AS PROF_YM /* 증명연월 */,
    #PROF_YM#||'13' AS #PROF_YM#
FROM TWFAACAV001M A WHERE A.PROF_YM BETWEEN #PROF_YM#||'00' AND #PROF_YM#||'13' AND A.BLL_PRCS_STTS_TPCD NOT IN ('Y','S') ) B, (SELECT A.JRSD_CD /* 소관코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.BLL_KDCD /* 계산서종류코드 */,
    A.PROF_RBPRSN_SQNO /* 증명책임자순번 */,
    A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO /* 관서운영경비출납공무원순번 */,
    A.PROF_RBPRSN_CRT_YMD /* 증명책임자생성일자 */,
    A.PROF_RBPRSN_ABL_YMD /* 증명책임자폐지일자 */
FROM TWFAACAV003M A WHERE A.MDFCN_SECD NOT IN ('D') AND A.SRECS_RCPT_SECD NOT IN ('P') AND A.PROF_RBPRSN_ABL_YMD >= #PROF_YM#||'00' AND A.PROF_RBPRSN_CRT_YMD AND B.CRE_DT_PROF_YM >= A.PROF_RBPRSN_CRT_YMD AND B.ABLT_DT_PROF_YM GROUP BY B.PROF_YM ), /* 불부합확정 */ TB_ERR AS ( SELECT B.PROF_YM /* 증명연월 */,
    COUNT(B.JRSD_CD) AS JRSD_CD /* 소관코드 */
FROM (SELECT DISTINCT A.JRSD_CD AS JRSD_CD /* 소관코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.BLL_KDCD /* 계산서종류코드 */,
    A.PROF_RBPRSN_SQNO /* 증명책임자순번 */,
    A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO /* 관서운영경비출납공무원순번 */,
    A.PROF_YM /* 증명연월 */,
    CASE WHEN A.PROF_YM = #PROF_YM#||'13' THEN #PROF_YM#||'12' ELSE A.PROF_YM END AS PROF_YM /* 증명연월 */,
    CASE WHEN A.PROF_YM = #PROF_YM#||'13' THEN #PROF_YM#||'12' ELSE A.PROF_YM END AS CRE_DT_PROF_YM CASE A.PROF_YM WHEN #PROF_YM#||'01' THEN #PROF_YM#||'01' WHEN #PROF_YM#||'02' THEN #PROF_YM#||'04' WHEN #PROF_YM#||'03' THEN #PROF_YM#||'07' WHEN #PROF_YM#||'04' THEN #PROF_YM#||'10' END AS PROF_YM /* 증명연월 */,
    CASE A.PROF_YM WHEN #PROF_YM#||'01' THEN #PROF_YM#||'03' WHEN #PROF_YM#||'02' THEN #PROF_YM#||'06' WHEN #PROF_YM#||'03' THEN #PROF_YM#||'09' WHEN #PROF_YM#||'04' THEN #PROF_YM#||'13' END AS CRE_DT_PROF_YM #PROF_YM#||'00' AS PROF_YM /* 증명연월 */,
    #PROF_YM#||'13' AS #PROF_YM#
FROM TWFAACAV001M A WHERE A.PROF_YM BETWEEN #PROF_YM#||'00' AND #PROF_YM#||'13' AND A.BLL_PRCS_STTS_TPCD = 'S' ) B, (SELECT A.JRSD_CD /* 소관코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.BLL_KDCD /* 계산서종류코드 */,
    A.PROF_RBPRSN_SQNO /* 증명책임자순번 */,
    A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO /* 관서운영경비출납공무원순번 */,
    A.PROF_RBPRSN_CRT_YMD /* 증명책임자생성일자 */,
    A.PROF_RBPRSN_ABL_YMD /* 증명책임자폐지일자 */
FROM TWFAACAV003M A WHERE A.MDFCN_SECD NOT IN ('D') AND A.SRECS_RCPT_SECD NOT IN ('P') AND A.PROF_RBPRSN_ABL_YMD >= #PROF_YM#||'00' AND A.PROF_RBPRSN_CRT_YMD AND B.CRE_DT_PROF_YM >= A.PROF_RBPRSN_CRT_YMD AND B.ABLT_DT_PROF_YM GROUP BY B.PROF_YM ), /* 총검산테이블의 증명년월 */ TB_RCV AS ( SELECT PROF_YM /* 증명연월 */,
    COUNT(JRSD_CD) AS JRSD_CD /* 소관코드 */
FROM TWFAACAV001M A WHERE PROF_YM BETWEEN #PROF_YM#||'00' AND #PROF_YM#||'13' GROUP BY PROF_YM ), /* 검산완료 */ TB_DONE AS ( SELECT B.PROF_YM /* 증명연월 */,
    COUNT(B.JRSD_CD) AS JRSD_CD /* 소관코드 */
FROM (SELECT DISTINCT A.JRSD_CD AS JRSD_CD /* 소관코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.BLL_KDCD /* 계산서종류코드 */,
    A.PROF_RBPRSN_SQNO /* 증명책임자순번 */,
    A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO /* 관서운영경비출납공무원순번 */,
    A.PROF_YM /* 증명연월 */,
    CASE WHEN A.PROF_YM = #PROF_YM#||'13' THEN #PROF_YM#||'12' ELSE A.PROF_YM END AS PROF_YM /* 증명연월 */,
    CASE WHEN A.PROF_YM = #PROF_YM#||'13' THEN #PROF_YM#||'12' ELSE A.PROF_YM END AS CRE_DT_PROF_YM CASE A.PROF_YM WHEN #PROF_YM#||'01' THEN #PROF_YM#||'01' WHEN #PROF_YM#||'02' THEN #PROF_YM#||'04' WHEN #PROF_YM#||'03' THEN #PROF_YM#||'07' WHEN #PROF_YM#||'04' THEN #PROF_YM#||'10' END AS PROF_YM /* 증명연월 */,
    CASE A.PROF_YM WHEN #PROF_YM#||'01' THEN #PROF_YM#||'03' WHEN #PROF_YM#||'02' THEN #PROF_YM#||'06' WHEN #PROF_YM#||'03' THEN #PROF_YM#||'09' WHEN #PROF_YM#||'04' THEN #PROF_YM#||'13' END AS CRE_DT_PROF_YM #PROF_YM#||'00' AS PROF_YM /* 증명연월 */,
    #PROF_YM#||'13' AS #PROF_YM#
FROM TWFAACAV001M A WHERE A.PROF_YM BETWEEN #PROF_YM#||'00' AND #PROF_YM#||'13' AND A.BLL_PRCS_STTS_TPCD = 'Y' ) B, (SELECT A.JRSD_CD /* 소관코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.BLL_KDCD /* 계산서종류코드 */,
    A.PROF_RBPRSN_SQNO /* 증명책임자순번 */,
    A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO /* 관서운영경비출납공무원순번 */,
    A.PROF_RBPRSN_CRT_YMD /* 증명책임자생성일자 */,
    A.PROF_RBPRSN_ABL_YMD /* 증명책임자폐지일자 */
FROM TWFAACAV003M A WHERE A.MDFCN_SECD NOT IN ('D') AND A.SRECS_RCPT_SECD NOT IN ('P') AND A.PROF_RBPRSN_ABL_YMD >= #PROF_YM#||'00' AND A.PROF_RBPRSN_CRT_YMD AND B.CRE_DT_PROF_YM >= A.PROF_RBPRSN_CRT_YMD AND B.ABLT_DT_PROF_YM GROUP BY B.PROF_YM ) /* 전체총건수 */ SELECT KEY,
    PROF_YM /* 증명연월 */,
    ALL_CNT,
    DONE_CNT,
    DO_CNT,
    ERR_CNT,
    SUM(ALL_CNT - DONE_CNT - ERR_CNT - DO_CNT) AS ALL_CNT
FROM ( SELECT ROWNUM,
    TB_RCV.PROF_YM /* 증명연월 */,
    CASE WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '01' THEN NVL(TB_ALL.TOT_CNT1,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '02' THEN NVL(TB_ALL.TOT_CNT2,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '03' THEN NVL(TB_ALL.TOT_CNT3,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '04' THEN NVL(TB_ALL.TOT_CNT4,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '05' THEN NVL(TB_ALL.TOT_CNT5,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '06' THEN NVL(TB_ALL.TOT_CNT6,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '07' THEN NVL(TB_ALL.TOT_CNT7,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '08' THEN NVL(TB_ALL.TOT_CNT8,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '09' THEN NVL(TB_ALL.TOT_CNT9,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '10' THEN NVL(TB_ALL.TOT_CNT10,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '11' THEN NVL(TB_ALL.TOT_CNT11,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '12' THEN NVL(TB_ALL.TOT_CNT12,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '13' THEN NVL(TB_ALL.TOT_CNT13,0) END AS SUBSTR,
    CASE WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '01' THEN NVL(TB_ALL.TOT_CNT1,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '02' THEN NVL(TB_ALL.TOT_CNT2,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '03' THEN NVL(TB_ALL.TOT_CNT3,0) WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '04' THEN NVL(TB_ALL.TOT_CNT4,0) END AS SUBSTR,
    CASE WHEN SUBSTR(TB_RCV.PROF_YM,5,2) = '00' THEN NVL(TB_ALL.TOT_CNT1,0) END AS SUBSTR,
    NVL(TB_DONE.DONE_CNT,0) AS DONE_CNT,
    NVL(TB_DO.DO_CNT,0) AS DO_CNT,
    NVL(TB_ERR.ERR_CNT,0) AS ERR_CNT
FROM TB_ALL, TB_RCV, TB_DONE, TB_ERR, TB_DO WHERE TB_RCV.PROF_YM = TB_DONE.PROF_YM(+) AND TB_RCV.PROF_YM = TB_DO.PROF_YM(+) AND TB_RCV.PROF_YM = TB_ERR.PROF_YM(+) ) GROUP BY KEY, PROF_YM, ALL_CNT, DONE_CNT, DO_CNT, ERR_CNT ORDER BY PROF_YM