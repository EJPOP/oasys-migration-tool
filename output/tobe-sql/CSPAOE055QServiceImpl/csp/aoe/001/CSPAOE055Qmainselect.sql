SELECT MAN.TSK_NM AS TSK_NM /* 업무명 */,
    F_DPT_INFO(MAN.CHR_DPT_CD, '1') AS TKCG_DEPT_NM /* 담당부서명 */,
    F_CODE_NM('1000272', MAN.TASK_KDCD) AS F_CODE_NM /* 업무종류 */,
    D9.STND_ASC AS STND_ASC /* 표준평점 */,
    F_CODE_NM('1000280', NVL(D7.EVL_STA_CD, '100')) AS F_CODE_NM /* 평가상태 */,
    D8.IDVT_INDEX_VAL AS IDVT_INDEX_VAL /* 가중치 */,
    ROUND(D9.STND_ASC * D8.IDVT_INDEX_VAL, 2) AS ROUND /* 평점 - (표준평점*가중치) */
FROM ( SELECT D5.EVL_YR,
    D5.HLYR_DVSN_CD,
    D5.TASK_KDCD /* 업무종류코드 */,
    D5.TSK_NM,
    D5.CHR_DPT_CD,
    D5.EVL_CMTR_DVSN_CD,
    D6.PIC_ENO /* 담당자직원전산번호 */,
    D5.TSK_NO
FROM ( /*평가자가 평가 완료한 리스트를 걸러낸다.*/ SELECT D3.EVL_YR,
    D3.HLYR_DVSN_CD,
    D3.TASK_KDCD /* 업무종류코드 */,
    D3.TSK_NM,
    D3.CHR_DPT_CD,
    D3.TSK_NO,
    'CD' || LPAD(TO_NUMBER(SUBSTR(D4.EVL_CMTR_DVSN_CD,3)) + 1, 2,0) AS LPAD /* 확인자 구분코드 (평가자 다음 코드가 확인자) */
FROM TBCSPAOE024M D3 , TBCSPAOE029M D4 WHERE D3.EVL_YR = D4.EVL_YR AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD AND D4.CVLCPT_TASK_SECD = '10001' /*감사외업무*/ AND D3.TASK_KDCD = D4.AUD_TSK_KND_CD AND D4.EVL_STEP_CD = '600' /*평가자*/ AND D3.TSK_NO = D4.TSK_NO AND D4.EVL_STA_CD = '300' /*평가완료*/ AND D3.EVL_YR = #strEvlYr# AND D3.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D3.TASK_KDCD = #TASK_KDCD# ) D5 , ( SELECT D1.EVL_YR,
    D1.HLYR_DVSN_CD,
    D1.CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    D1.AUD_TSK_KND_CD,
    D1.CHGR_DVSN_CD,
    D2.PIC_ENO /* 담당자직원전산번호 */
FROM TBCSPAOE016M D1 , TBCSPAOE017D D2 WHERE D1.EVL_YR = D2.EVL_YR AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD AND D1.CVLCPT_TASK_SECD = D2.CVLCPT_TASK_SECD AND D1.AUD_TSK_KND_CD = D2.AUD_TSK_KND_CD AND D1.CHGR_DVSN_CD = D2.CHGR_DVSN_CD AND D1.CVLCPT_TASK_SECD = '10001' /*감사외업무*/ AND D1.EVL_YR = #strEvlYr# AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D1.AUD_TSK_KND_CD = #TASK_KDCD# AND TO_NUMBER(SUBSTR(D2.CHGR_DVSN_CD, 3)) BETWEEN 5 AND 200 /*감사외 업무 평가자 및 확인자는 CD05 ~ CD152*/ AND MOD(SUBSTR(D2.CHGR_DVSN_CD, 4), 2) = 0 /*확인자 리스트만 뽑아낸다.*/ AND D2.CHGR_DVSN_CD NOT IN ('CD33','CD34') /*감사업무쪽 코드임*/ ) D6 /*담당관리자에 등록된 확인자 리스트*/ WHERE D5.EVL_YR = D6.EVL_YR AND D5.HLYR_DVSN_CD = D6.HLYR_DVSN_CD AND D5.TASK_KDCD = D6.AUD_TSK_KND_CD AND D5.EVL_CMTR_DVSN_CD = D6.CHGR_DVSN_CD ) MAN , TBCSPAOE029M D7 , TBCSPAOE010D D8 , TBCSPAOE006M D9 WHERE MAN.EVL_YR = D7.EVL_YR (+) AND MAN.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+) AND D7.CVLCPT_TASK_SECD (+) = '10001' AND MAN.TASK_KDCD = D7.AUD_TSK_KND_CD (+) AND D7.EVL_STEP_CD (+) = '700' /*확인자 단계*/ AND MAN.PIC_ENO = D7.EVL_CMTR_CNB (+) AND MAN.TSK_NO = D7.TSK_NO (+) AND MAN.EVL_CMTR_DVSN_CD = D7.EVL_CMTR_DVSN_CD (+) AND D7.EVL_YR = D8.EVL_YR (+) AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD (+) AND D7.CVLCPT_TASK_SECD = D8.CVLCPT_TASK_SECD (+) AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD (+) AND D7.EVL_RK_CD = D8.RK_CD (+) AND MAN.EVL_YR = D9.EVL_YR AND MAN.HLYR_DVSN_CD = D9.HLYR_DVSN_CD AND D9.CVLCPT_TASK_SECD = '10001' AND MAN.TASK_KDCD = D9.TASK_KDCD ORDER BY MAN.TSK_NO