SELECT T.*,
    ROW_NUMBER() OVER( ORDER BY FMDA_AUDIT_ST DESC, FMDA_IDX DESC ) AS ROW_NUMBER
FROM (SELECT DT.*,
    COUNT(1) OVER() AS 1
FROM ( SELECT A.FMDA_IDX,
    TO_CHAR(A.FMDA_AUDIT_ST, 'YYYY-MM-DD') || ' ~ ' ||TO_CHAR(A.FMDA_AUDIT_ET, 'YYYY-MM-DD') AS TO_CHAR,
    TO_CHAR(A.FMDA_AUDIT_ST, 'YYYY-MM-DD') AS TO_CHAR,
    TO_CHAR(A.FMDA_AUDIT_ET, 'YYYY-MM-DD') AS TO_CHAR,
    A.FMDA_TXT,
    A.FMDA_DEPT,
    (SELECT AS CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */
FROM tbdcmacm002m WHERE USE_YN = 'Y' AND SRECS_DEPT_CD = A.FMDA_DEPT ) AS FMDA_DEPT_NM , A.FMDA_PART , A.FMDA_PROC , (CASE WHEN A.FMDA_PROC='0' THEN '실지감사' WHEN A.FMDA_PROC='1' THEN '의견수렴' WHEN A.FMDA_PROC='2' THEN '감사보고서작성' WHEN A.FMDA_PROC='3' THEN '감사보고서 검토 및 심의' WHEN A.FMDA_PROC='4' THEN '감사보고서 시행 및 공개 준비' WHEN A.FMDA_PROC='5' THEN '감사보고서 공개' END) AS FMDA_PROC_NM , A.FMDA_DT , A.FMDA_SJ , A.FMDA_RDCNT , A.FMDA_OPN_REGCNT , A.ENAIS_PST_ATCH_FILE_ID AS CVLCPT_DOC_ID , TO_CHAR(A.FMDA_PUBLIC_DT, 'YYYY-MM-DD') AS FMDA_PUBLIC_DT , A.FMDA_PUBLIC_YN , (CASE WHEN A.FMDA_PUBLIC_YN='Y' THEN '공개' ELSE '비공개' END ) AS FMDA_PUBLIC_NM , (CASE WHEN A.FMDA_PUBLIC_YN IS NULL THEN '공개전' WHEN A.FMDA_PUBLIC_YN = 'Y' AND TO_CHAR(SYSDATE,'YYYYMMDD') = TO_CHAR(A.fmda_public_dt,'YYYYMMDD' ) AND TO_CHAR(SYSDATE,'YYYYMMDD') NOT BETWEEN TO_CHAR(A.fmda_public_dt,'YYYYMMDD' ) AND TO_CHAR(A.fmda_public_dt+14,'YYYYMMDD' ) THEN '공개기간 경과' END) AS FMDA_HOME_ST FROM TBCSPTSM001M A WHERE USE_AT = 'Y' AND A.FMDA_DEPT IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#strCnb#, #dptAuth#, '', #strUpSpvBrdvCd#))) /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/ AND A.FMDA_DEPT = #strSpvBrdvCd# AND A.FMDA_PROC = #strFMDA_PROC# AND SUBSTR(a.FMDA_DT,1,4) = #strYr# AND ( UPPER(A.FMDA_SJ) LIKE UPPER('%' || #strSearchBox# || '%') OR UPPER(A.FMDA_TXT) LIKE UPPER('%' || #strSearchBox# || '%') ) ) DT ORDER BY FMDA_AUDIT_ST DESC, FMDA_IDX DESC ) T