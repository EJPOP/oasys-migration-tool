SELECT A.BOKG_DT,
    B.CFR_RM_INSPC_RNM,
    (SELECT COUNT(BOKG_DT)
FROM TBCSPPMR002M T1, TBCSPPMR001M T2 WHERE 1=1 AND T1.CFR_RM_INSPC_RM_ID = T2.CFR_RM_INSPC_RM_ID AND T2.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2') AND T1.BOKG_DT= A.BOKG_DT) AS RESERV_CNT, /*예약자수*/ (SELECT COUNT(BOKG_DT)
FROM TBCSPPMR002M T1, TBCSPPMR001M T2 WHERE 1=1 AND T1.CFR_RM_INSPC_RM_ID = T2.CFR_RM_INSPC_RM_ID AND T2.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2') AND T1.BOKG_DT= A.BOKG_DT AND T1.CHECKIN_DH IS NOT NULL) AS USE_CNT, /*이용자수*/ D.CNSTN_MBCMT_DEPT_NM, F_CODE_NM('1000173', C.JBGD_SECD) AS RANK_NAM, C.USER_NM, A.RSCH_ASMT_TTL, (CASE WHEN A.CHECKIN_DH IS NULL THEN '이용 안함' ELSE '' END) CHECKIN_DH FROM TBCSPPMR002M A, TBCSPPMR001M B, TBDCMACM001M C, TBDCMACM002M D WHERE 1=1 AND A.CFR_RM_INSPC_RM_ID = B.CFR_RM_INSPC_RM_ID AND A.RESERVE_USER_ID = C.USER_ID AND C.SRECS_DEPT_CD = D.SRECS_DEPT_CD AND B.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2') AND B.CFR_RM_INSPC_RM_DVSN_CD = #cbbDvsn# AND A.BOKG_DT BETWEEN #toYmd# AND #fromYmd# GROUP BY A.BOKG_DT, D.CNSTN_MBCMT_DEPT_NM, C.USER_NM, C.JBGD_SECD,A.RSCH_ASMT_TTL,CHECKIN_DH,B.CFR_RM_INSPC_RNM ORDER BY A.BOKG_DT, D.CNSTN_MBCMT_DEPT_NM