SELECT TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    OGDP_DEPT_CD /* 소속부서코드 */,
    F_DPT_INFO(OGDP_DEPT_CD, 1) AS F_DPT_INFO,
    F_CODE_NM('1000173', JBGD_SECD) AS JBGD_NM /* 직급명 */,
    INFO_RLPR_NM /* 정보관계자명 */,
    COUNT(VI_PPS_CD) AS VI_PPS_CD,
    SUM(CASE WHEN VI_PPS_CD = '1' THEN 1 ELSE 0 END) AS VI_PPS_CD,
    SUM(CASE WHEN VI_PPS_CD = '2' THEN 1 ELSE 0 END) AS VI_PPS_CD,
    SUM(CASE WHEN VI_PPS_CD = '3' THEN 1 ELSE 0 END) AS VI_PPS_CD,
    SUM(CASE WHEN VI_PPS_CD = '4' THEN 1 ELSE 0 END) AS VI_PPS_CD,
    SUM(CASE WHEN VI_PPS_CD = '5' THEN 1 ELSE 0 END) AS VI_PPS_CD,
    SUM(CASE WHEN VI_PPS_CD = '6' THEN 1 ELSE 0 END) AS VI_PPS_CD,
    TO_CHAR(TO_DATE(#fromYmd#), 'YYYY-MM-DD') AS TO_CHAR,
    TO_CHAR(TO_DATE(#toYmd#), 'YYYY-MM-DD') AS TO_CHAR
FROM TBCSPOEP001M WHERE 1=1 AND TRGT_NOP_ENO IS NOT NULL AND VI_DT >= #fromYmd# AND VI_DT <= #toYmd# GROUP BY TRGT_NOP_ENO, OGDP_DEPT_CD, JBGD_SECD, INFO_RLPR_NM ORDER BY OGDP_DEPT_CD, TRGT_NOP_ENO