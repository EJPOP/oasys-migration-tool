SELECT A.TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    DECODE(A.TRGT_NOP_ENO,'합계','',A.OGDP_DEPT_CD) AS OGDP_DEPT_CD /* 소속부서코드 */,
    DECODE(A.TRGT_NOP_ENO,'합계','',A.JBGD_NM) AS JBGD_NM /* 직급명 */,
    DECODE(A.TRGT_NOP_ENO,'합계','',A.INFO_RLPR_NM) AS INFO_RLPR_NM /* 정보관계자명 */,
    F_DPT_INFO(DECODE(A.TRGT_NOP_ENO, '합계', '', A.OGDP_DEPT_CD), 1) AS F_DPT_INFO,
    TO_CHAR(A.TOTAL, 'FM999,999') AS TO_CHAR,
    TO_CHAR(A.T1, 'FM999,999') AS TO_CHAR,
    TO_CHAR(A.T2, 'FM999,999') AS TO_CHAR,
    TO_CHAR(A.T3, 'FM999,999') AS TO_CHAR,
    TO_CHAR(A.T4, 'FM999,999') AS TO_CHAR,
    TO_CHAR(A.T5, 'FM999,999') AS TO_CHAR,
    TO_CHAR(A.T6, 'FM999,999') AS TO_CHAR,
    TO_CHAR(TO_DATE(#fromYmd#), 'YYYY-MM-DD') AS TO_CHAR,
    TO_CHAR(TO_DATE(#toYmd#), 'YYYY-MM-DD') AS TO_CHAR
FROM ( SELECT NVL2(TRGT_NOP_ENO,TRGT_NOP_ENO,'합계') AS TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    MAX(OGDP_DEPT_CD) AS OGDP_DEPT_CD /* 소속부서코드 */,
    F_CODE_NM('1000173', MAX(JBGD_SECD)) AS JBGD_NM /* 직급명 */,
    MAX(INFO_RLPR_NM) AS INFO_RLPR_NM /* 정보관계자명 */,
    COUNT(VI_PPS_CD) AS VI_PPS_CD,
    SUM(CASE WHEN VI_PPS_CD = '1' THEN 1 ELSE 0 END) AS VI_PPS_CD,
    SUM(CASE WHEN VI_PPS_CD = '2' THEN 1 ELSE 0 END) AS VI_PPS_CD,
    SUM(CASE WHEN VI_PPS_CD = '3' THEN 1 ELSE 0 END) AS VI_PPS_CD,
    SUM(CASE WHEN VI_PPS_CD = '4' THEN 1 ELSE 0 END) AS VI_PPS_CD,
    SUM(CASE WHEN VI_PPS_CD = '5' THEN 1 ELSE 0 END) AS VI_PPS_CD,
    SUM(CASE WHEN VI_PPS_CD = '6' THEN 1 ELSE 0 END) AS VI_PPS_CD
FROM TBCSPOEP001M WHERE 1=1 AND TRGT_NOP_ENO IS NOT NULL AND VI_DT >= #fromYmd# AND VI_DT <= #toYmd# GROUP BY ROLLUP(TRGT_NOP_ENO) ) A ORDER BY DECODE(A.TRGT_NOP_ENO,'합계','99999999',NVL(OGDP_DEPT_CD,'99999998')), DECODE(A.TRGT_NOP_ENO,'합계','99999999',TRGT_NOP_ENO)