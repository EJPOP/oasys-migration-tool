SELECT SUBSTR(E.SV_DT, 0, 4) || '-' || SUBSTR(E.SV_DT, 5, 2) AS SUBSTR,
    A.EDU_DVSN_NM,
    B.EDU_CAT_NM,
    C.CRS_NM /* 과정명 */,
    X.CRS_CDN /* 과정기수 */,
    X.SV_QEST_NO || '. ' || X.SV_QEST_TXT AS SV_QEST_NO,
    X.SV_QEST_NO,
    X.SUM_CNT,
    D.TANE_CNT,
    DECODE(D.TANE_CNT, 0, 0, CASE X.SUM_CNT WHEN 0 THEN 0 ELSE ROUND (X.SUM_CNT/D.TANE_CNT*100, 2) END) AS TANE_CNT
FROM ( SELECT DATA.LINK_YR /* 연계년도 */,
    DATA.CRS_CD,
    DATA.CRS_CDN /* 과정기수 */,
    DATA.SV_QEST_TXT,
    DATA.SV_QEST_NO,
    MIN(DATA.SV_CLU_NO) AS SV_CLU_NO,
    SUM(DATA.SUM_CNT) AS SUM_CNT
FROM ( SELECT D.LINK_YR /* 연계년도 */,
    D.CRS_CD,
    D.CRS_CDN /* 과정기수 */,
    B.SV_QEST_TXT,
    B.SV_QEST_NO,
    C.SV_CLU_NO,
    SUM(E.RP_CNT_1) + SUM(E.RP_CNT_2) + SUM(E.RP_CNT_3) +SUM(E.RP_CNT_4) + SUM(E.RP_CNT_5) + SUM(E.RP_CNT_6) AS RP_CNT_1
FROM TBCSPSAE121C A , TBCSPSAE122C B , TBCSPSAE123C C , TBCSPSAE302D D , ( SELECT D.LINK_YR /* 연계년도 */,
    B.QEST_DVSN_CD,
    D.SV_TIT_CD,
    A.SV_TIT_NM,
    B.SV_QEST_NO,
    C.SV_CLU_NO,
    D.CRS_CD,
    D.CRS_CDN /* 과정기수 */,
    DECODE(C.SV_CLU_NO, 1, SUM(D.RP_CNT), 0) AS SV_CLU_NO,
    DECODE(C.SV_CLU_NO, 2, SUM(D.RP_CNT), 0) AS SV_CLU_NO,
    DECODE(C.SV_CLU_NO, 3, SUM(D.RP_CNT), 0) AS SV_CLU_NO,
    DECODE(C.SV_CLU_NO, 4, SUM(D.RP_CNT), 0) AS SV_CLU_NO,
    DECODE(C.SV_CLU_NO, 5, SUM(D.RP_CNT), 0) AS SV_CLU_NO,
    DECODE(C.SV_CLU_NO, 6, SUM(D.RP_CNT), 0) AS SV_CLU_NO
FROM TBCSPSAE121C A, TBCSPSAE122C B, TBCSPSAE123C C, TBCSPSAE302D D WHERE A.SV_TIT_CD = B.SV_TIT_CD AND B.SV_QEST_NO = C.SV_QEST_NO AND B.SV_TIT_CD = C.SV_TIT_CD AND D.SV_QEST_NO = C.SV_QEST_NO AND D.SV_CLU_NO = C.SV_CLU_NO AND D.SV_TIT_CD = C.SV_TIT_CD AND A.USE_YN = 'Y' AND D.LINK_YR BETWEEN #strFromY# AND #strToY# AND B.QEST_DVSN_CD = '1' GROUP BY D.LINK_YR, B.QEST_DVSN_CD, D.SV_TIT_CD, A.SV_TIT_NM, B.SV_QEST_NO, C.SV_CLU_NO, D.CRS_CD, D.CRS_CDN ORDER BY D.LINK_YR, B.QEST_DVSN_CD, D.SV_TIT_CD, A.SV_TIT_NM, B.SV_QEST_NO, C.SV_CLU_NO, D.CRS_CD, D.CRS_CDN ) E WHERE A.SV_TIT_CD = B.SV_TIT_CD AND B.SV_QEST_NO = C.SV_QEST_NO AND B.SV_TIT_CD = C.SV_TIT_CD AND D.SV_QEST_NO = C.SV_QEST_NO AND D.SV_CLU_NO = C.SV_CLU_NO AND D.SV_TIT_CD = C.SV_TIT_CD AND E.SV_QEST_NO = D.SV_QEST_NO AND E.SV_CLU_NO = D.SV_CLU_NO AND E.SV_TIT_CD = D.SV_TIT_CD AND E.QEST_DVSN_CD = B.QEST_DVSN_CD AND E.SV_TIT_NM = A.SV_TIT_NM AND E.CRS_CD = D.CRS_CD AND E.CRS_CDN = D.CRS_CDN AND E.LINK_YR = D.LINK_YR AND A.USE_YN = 'Y' AND D.LINK_YR BETWEEN #strFromY# AND #strToY# AND B.QEST_DVSN_CD = '1' GROUP BY D.LINK_YR, D.CRS_CD, D.CRS_CDN, B.SV_QEST_TXT, B.SV_QEST_NO, C.SV_CLU_NO ORDER BY D.LINK_YR, D.CRS_CD, D.CRS_CDN, B.SV_QEST_TXT, B.SV_QEST_NO, C.SV_CLU_NO ) DATA GROUP BY DATA.LINK_YR, DATA.CRS_CD, DATA.CRS_CDN, DATA.SV_QEST_TXT, DATA.SV_QEST_NO ORDER BY DATA.LINK_YR, DATA.CRS_CD, DATA.CRS_CDN, DATA.SV_QEST_NO ) X , TBCSPSAE101C A , TBCSPSAE102C B , TBCSPSAE103C C , ( SELECT Y.LINK_YR /* 연계년도 */,
    Y.CRS_CD,
    Y.CRS_CDN /* 과정기수 */,
    NVL(MAX(X.TANE_CNT), 0) AS TANE_CNT
FROM ( SELECT LINK_YR /* 연계년도 */,
    CRS_CD,
    CRS_CDN /* 과정기수 */,
    COUNT(TANE_ID) AS TANE_ID
FROM TBCSPSAE301D WHERE FIN_YN = 'Y' AND LINK_YR BETWEEN #strFromY# AND #strToY# GROUP BY LINK_YR, CRS_CD, CRS_CDN ) X , TBCSPSAE301D Y WHERE X.LINK_YR(+) = Y.LINK_YR AND X.CRS_CD(+) = Y.CRS_CD AND X.CRS_CDN(+) = Y.CRS_CDN GROUP BY Y.LINK_YR, Y.CRS_CD, Y.CRS_CDN ) D , TBCSPSAE201D E WHERE C.CRS_CD = X.CRS_CD AND B.EDU_CAT_CD = C.EDU_CAT_CD AND A.EDU_DVSN_CD = B.EDU_DVSN_CD AND A.EDU_DVSN_CD = C.EDU_DVSN_CD AND D.LINK_YR = X.LINK_YR AND D.CRS_CD = X.CRS_CD AND D.CRS_CDN = X.CRS_CDN AND E.LINK_YR = X.LINK_YR AND E.CRS_CD = X.CRS_CD AND E.CRS_CDN = X.CRS_CDN AND SUBSTR(E.SV_DT, 0, 6) BETWEEN #strFromY# || #strFromM# AND #strToY# || #strToM# AND A.EDU_DVSN_CD = #strEDU_DVSN_CD# AND B.EDU_CAT_CD = #strEDU_CAT_CD# AND X.CRS_CD = #strEDU_CRS_CD# AND X.CRS_CDN = #CRS_CDN# ORDER BY SV_DT, A.EDU_DVSN_CD, B.EDU_CAT_CD, C.CRS_CD, X.CRS_CDN, X.SV_QEST_NO, X.SV_CLU_NO