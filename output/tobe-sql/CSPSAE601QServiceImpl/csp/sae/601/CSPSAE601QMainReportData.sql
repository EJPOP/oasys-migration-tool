SELECT A.LINK_YR /* 연계년도 */,
    A.EDU_DVSN_NM,
    A.CRS_NM /* 과정명 */,
    A.CRS_CDN /* 과정기수 */,
    A.CRS_CD,
    A.EDU_PRD_TXT,
    A.ONTM_NOP_CNT,
    A.EDU_NBC AS EDU_NBC,
    A.TOT_NOP_CNT AS TOT_NOP_CNT,
    A.CNT_CRS_CDN AS CNT_CRS_CDN,
    A.CNT_TANE_ID AS CNT_TANE_ID,
    A.AVR_TG_CNT AS AVR_TG_CNT
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    A.EDU_DVSN_CD,
    B.EDU_DVSN_NM,
    C.EDU_CAT_CD,
    A.CRS_CD,
    A.CRS_NM /* 과정명 */,
    A.CRS_CDN /* 과정기수 */,
    A.EDU_PRD_TXT,
    A.ONTM_NOP_CNT,
    A.EDU_NBC,
    A.TOT_NOP_CNT,
    A.CNT_CRS_CDN,
    A.CNT_TANE_ID,
    A.AVR_TG_CNT
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    B.EDU_DVSN_CD,
    B.EDU_CAT_CD,
    A.CRS_CD,
    B.CRS_NM /* 과정명 */,
    A.CRS_CDN /* 과정기수 */,
    A.EDU_PRD_TXT,
    A.ONTM_NOP_CNT,
    A.EDU_NBC,
    A.TOT_NOP_CNT,
    A.CNT_CRS_CDN,
    A.CNT_TANE_ID,
    ( CASE NVL(A.TOT_NOP_CNT, 0) WHEN 0 THEN 0 ELSE ROUND( (( A.CNT_TANE_ID / A.TOT_NOP_CNT ) * 100) , 2) END ) AS TOT_NOP_CNT
FROM ( SELECT B.LINK_YR /* 연계년도 */,
    B.CRS_CD,
    B.CRS_CDN /* 과정기수 */,
    B.EDU_PRD_TXT,
    B.ONTM_NOP_CNT,
    B.EDU_NBC,
    B.TOT_NOP_CNT,
    NVL(A.CNT_CRS_CDN, 0) AS CNT_CRS_CDN,
    NVL(A.CNT_TANE_ID, 0) AS CNT_TANE_ID
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    COUNT(CRS_CDN) AS CRS_CDN /* 과정기수 */,
    SUM(A.CNT_TANE_ID) AS CNT_TANE_ID
FROM ( SELECT LINK_YR /* 연계년도 */,
    CRS_CD,
    CRS_CDN /* 과정기수 */,
    COUNT(TANE_ID) AS TANE_ID
FROM TBCSPSAE301D WHERE FIN_YN = 'Y' AND LINK_YR BETWEEN #strFromY# AND #strToY# GROUP BY LINK_YR, CRS_CD, CRS_CDN ) A GROUP BY A.LINK_YR, A.CRS_CD ) A , ( SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    MAX(B.CRS_CDN) AS CRS_CDN /* 과정기수 */,
    NVL(A.EDU_PRD_TXT, '-') AS EDU_PRD_TXT,
    NVL(A.ONTM_NOP_CNT, 0) AS ONTM_NOP_CNT,
    NVL(A.EDU_NBC, 0) AS EDU_NBC,
    NVL(A.TOT_NOP_CNT, 0) AS TOT_NOP_CNT
FROM TBCSPSAE201M A , TBCSPSAE201D B WHERE B.LINK_YR = A.LINK_YR AND B.CRS_CD = A.CRS_CD AND SUBSTR(B.EDU_BGNG_YMD, 0, 6) BETWEEN #strFromY# || #strFromM# AND #strToY# || #strToM# GROUP BY A.LINK_YR, A.CRS_CD, A.EDU_PRD_TXT, A.ONTM_NOP_CNT, A.EDU_NBC, A.TOT_NOP_CNT ) B WHERE B.LINK_YR = A.LINK_YR(+) AND B.CRS_CD = A.CRS_CD(+) ) A, TBCSPSAE103C B WHERE B.CRS_CD = A.CRS_CD AND B.USE_YN = 'Y' ) A , TBCSPSAE101C B , TBCSPSAE102C C WHERE B.EDU_DVSN_CD = A.EDU_DVSN_CD AND C.EDU_DVSN_CD = B.EDU_DVSN_CD AND C.EDU_CAT_CD = A.EDU_CAT_CD ) A WHERE 1=1 AND A.LINK_YR BETWEEN #strFromY# AND #strToY# AND A.EDU_DVSN_CD = #strEDU_DVSN_CD# AND A.EDU_CAT_CD = #strEDU_CAT_CD# AND A.CRS_CD = #strEDU_CRS_CD# ORDER BY A.LINK_YR, A.EDU_DVSN_NM ASC , A.CRS_CD ASC