SELECT NVL2(A.LINK_YR, A.LINK_YR, '합계') AS LINK_YR /* 연계년도 */,
    DECODE(NVL2(A.LINK_YR, A.LINK_YR, '합계'), '합계', '', NVL2(A.EDU_DVSN_NM, A.EDU_DVSN_NM, '소계')) AS NVL2,
    A.CRS_NM /* 과정명 */,
    A.CRS_CDN /* 과정기수 */,
    DECODE(A.EDU_BGNG_YMD, NULL, '', SUBSTR(A.EDU_BGNG_YMD, 0, 4) || '-' || SUBSTR(A.EDU_BGNG_YMD, 5, 2) || '-' || SUBSTR(A.EDU_BGNG_YMD, 7, 2) || '~' || SUBSTR(A.EDU_END_YMD, 0, 4) || '-' || SUBSTR(A.EDU_END_YMD, 5, 2) || '-' || SUBSTR(A.EDU_END_YMD, 7, 2)) AS EDU_BGNG_YMD /* 교육시작일자 */,
    SUM(A.TOT_PERIOD) AS TOT_PERIOD,
    SUM(A.PERIOD_01) AS PERIOD_01,
    SUM(A.PERIOD_02) AS PERIOD_02,
    SUM(A.PERIOD_03) AS PERIOD_03,
    SUM(A.PERIOD_04) AS PERIOD_04,
    SUM(A.PERIOD_05) AS PERIOD_05
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    B.EDU_DVSN_NM,
    B.EDU_DVSN_CD,
    A.EDU_CAT_CD,
    A.CRS_NM /* 과정명 */,
    A.CRS_CD,
    A.CRS_CDN /* 과정기수 */,
    A.EDU_BGNG_YMD /* 교육시작일자 */,
    A.EDU_END_YMD /* 교육종료일자 */,
    NVL(D.PERIOD_01 + D.PERIOD_02 + D.PERIOD_03 + D.PERIOD_04 + D.PERIOD_05, 0) AS PERIOD_01,
    NVL(D.PERIOD_01, 0) AS PERIOD_01,
    NVL(D.PERIOD_02, 0) AS PERIOD_02,
    NVL(D.PERIOD_03, 0) AS PERIOD_03,
    NVL(D.PERIOD_04, 0) AS PERIOD_04,
    NVL(D.PERIOD_05, 0) AS PERIOD_05
FROM ( SELECT B.LINK_YR /* 연계년도 */,
    C.EDU_DVSN_CD,
    C.EDU_CAT_CD,
    B.CRS_CD,
    B.CNT_CRS_CD,
    C.CRS_NM /* 과정명 */,
    B.CRS_CDN /* 과정기수 */,
    B.EDU_BGNG_YMD /* 교육시작일자 */,
    B.EDU_END_YMD /* 교육종료일자 */,
    SUM(CASE WHEN A.WRK_PRD_TXT = '0006' AND A.WRK_PRD_TXT = '0100' AND A.WRK_PRD_TXT = '0300' AND A.WRK_PRD_TXT = '0500' THEN 1 ELSE 0 END) AS WRK_PRD_TXT
FROM TBCSPSAE301D A , (SELECT LINK_YR /* 연계년도 */,
    CRS_CD,
    CRS_CDN /* 과정기수 */,
    COUNT(CRS_CD) AS CRS_CD,
    EDU_BGNG_YMD /* 교육시작일자 */,
    EDU_END_YMD /* 교육종료일자 */
FROM TBCSPSAE201D WHERE 1=1 AND LINK_YR BETWEEN #strFromY# AND #strToY# AND SUBSTR(EDU_BGNG_YMD, 0, 6) BETWEEN #strFromY# || #strFromM# AND #strToY# || #strToM# GROUP BY LINK_YR, CRS_CD, CRS_CDN, EDU_BGNG_YMD, EDU_END_YMD) B , TBCSPSAE103C C WHERE 1=1 AND A.LINK_YR(+) = B.LINK_YR AND A.CRS_CD(+) = B.CRS_CD AND A.CRS_CDN(+) = B.CRS_CDN AND B.CRS_CD = C.CRS_CD GROUP BY B.LINK_YR, C.EDU_DVSN_CD, C.EDU_CAT_CD, B.CRS_CD, C.CRS_NM, B.CNT_CRS_CD, B.CRS_CDN, B.EDU_BGNG_YMD, B.EDU_END_YMD ) A , TBCSPSAE101C B , TBCSPSAE102C C , ( SELECT B.LINK_YR /* 연계년도 */,
    C.EDU_DVSN_CD,
    C.EDU_CAT_CD,
    B.CRS_CD,
    B.CNT_CRS_CD,
    C.CRS_NM /* 과정명 */,
    B.CRS_CDN /* 과정기수 */,
    B.EDU_BGNG_YMD /* 교육시작일자 */,
    B.EDU_END_YMD /* 교육종료일자 */,
    SUM(CASE WHEN A.WRK_PRD_TXT = '0006' AND A.WRK_PRD_TXT = '0100' AND A.WRK_PRD_TXT = '0300' AND A.WRK_PRD_TXT = '0500' THEN 1 ELSE 0 END) AS WRK_PRD_TXT
FROM TBCSPSAE301D A , (SELECT LINK_YR /* 연계년도 */,
    CRS_CD,
    CRS_CDN /* 과정기수 */,
    COUNT(CRS_CD) AS CRS_CD,
    EDU_BGNG_YMD /* 교육시작일자 */,
    EDU_END_YMD /* 교육종료일자 */
FROM TBCSPSAE201D WHERE 1=1 AND LINK_YR BETWEEN #strFromY# AND #strToY# AND SUBSTR(EDU_BGNG_YMD, 0, 6) BETWEEN #strFromY# || #strFromM# AND #strToY# || #strToM# GROUP BY LINK_YR, CRS_CD, CRS_CDN, EDU_BGNG_YMD, EDU_END_YMD) B , TBCSPSAE103C C WHERE 1=1 AND A.LINK_YR(+) = B.LINK_YR AND A.CRS_CD(+) = B.CRS_CD AND A.CRS_CDN(+) = B.CRS_CDN AND B.CRS_CD = C.CRS_CD AND A.FIN_YN = 'Y' GROUP BY B.LINK_YR, C.EDU_DVSN_CD, C.EDU_CAT_CD, B.CRS_CD, C.CRS_NM, B.CNT_CRS_CD, B.CRS_CDN, B.EDU_BGNG_YMD, B.EDU_END_YMD ) D WHERE A.EDU_DVSN_CD = B.EDU_DVSN_CD AND C.EDU_DVSN_CD = B.EDU_DVSN_CD AND C.EDU_CAT_CD = A.EDU_CAT_CD AND D.LINK_YR(+) = A.LINK_YR AND D.CRS_CD(+) = A.CRS_CD AND D.CRS_CDN(+) = A.CRS_CDN ) A WHERE 1=1 AND A.EDU_DVSN_CD = #strEDU_DVSN_CD# AND A.EDU_CAT_CD = #strEDU_CAT_CD# AND A.CRS_CD = #strEDU_CRS_CD# GROUP BY ROLLUP(A.LINK_YR, A.EDU_DVSN_CD , (A.EDU_DVSN_NM, A.CRS_CD, A.CRS_NM, A.CRS_CDN, A.EDU_BGNG_YMD, A.EDU_END_YMD) ) ORDER BY A.LINK_YR , A.EDU_DVSN_CD , A.CRS_CD , A.CRS_CDN