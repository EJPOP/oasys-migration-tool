SELECT NVL2(A.LINK_YR, A.LINK_YR, '합계') AS LINK_YR /* 연계년도 */,
    DECODE(NVL2(A.LINK_YR, A.LINK_YR, '합계'), '합계', '', NVL2(A.EDU_DVSN_NM, A.EDU_DVSN_NM, '소계')) AS NVL2,
    A.CRS_NM /* 과정명 */,
    A.CRS_CDN /* 과정기수 */,
    DECODE(A.EDU_BGNG_YMD, NULL, '', SUBSTR(A.EDU_BGNG_YMD, 0, 4) || '-' || SUBSTR(A.EDU_BGNG_YMD, 5, 2) || '-' || SUBSTR(A.EDU_BGNG_YMD, 7, 2) || '~' || SUBSTR(A.EDU_END_YMD, 0, 4) || '-' || SUBSTR(A.EDU_END_YMD, 5, 2) || '-' || SUBSTR(A.EDU_END_YMD, 7, 2)) AS EDU_BGNG_YMD /* 교육시작일자 */,
    SUM(A.ONTM_NOP_CNT) AS ONTM_NOP_CNT,
    SUM(A.TANE_ID) AS TANE_ID,
    A.AVR_TG_CNT
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    A.EDU_DVSN_CD,
    B.EDU_DVSN_NM,
    A.EDU_CAT_CD,
    A.CNT_CRS_CD,
    A.CRS_CD,
    A.CRS_NM /* 과정명 */,
    A.CRS_CDN /* 과정기수 */,
    A.EDU_BGNG_YMD /* 교육시작일자 */,
    A.EDU_END_YMD /* 교육종료일자 */,
    A.ONTM_NOP_CNT,
    A.TANE_ID,
    A.AVR_TG_CNT
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    B.EDU_DVSN_CD,
    B.EDU_CAT_CD,
    A.CNT_CRS_CD,
    A.CRS_CD,
    B.CRS_NM /* 과정명 */,
    A.CRS_CDN /* 과정기수 */,
    A.EDU_BGNG_YMD /* 교육시작일자 */,
    A.EDU_END_YMD /* 교육종료일자 */,
    A.ONTM_NOP_CNT,
    A.TANE_ID,
    A.AVR_TG_CNT
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_CDN /* 과정기수 */,
    COUNT(A.CRS_CD) AS CRS_CD,
    A.EDU_BGNG_YMD /* 교육시작일자 */,
    A.EDU_END_YMD /* 교육종료일자 */,
    A.ONTM_NOP_CNT,
    A.TANE_ID,
    ( CASE NVL(A.ONTM_NOP_CNT, 0) WHEN 0 THEN 0 ELSE ROUND( (( A.TANE_ID / A.ONTM_NOP_CNT ) * 100), 0) END ) AS ONTM_NOP_CNT
FROM ( SELECT B.LINK_YR /* 연계년도 */,
    B.CRS_CD,
    B.CRS_CDN /* 과정기수 */,
    B.EDU_BGNG_YMD /* 교육시작일자 */,
    B.EDU_END_YMD /* 교육종료일자 */,
    B.ONTM_NOP_CNT,
    NVL(A.TANE_ID, 0) AS TANE_ID
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_CDN /* 과정기수 */,
    COUNT(A.TANE_ID) AS TANE_ID
FROM TBCSPSAE301D A WHERE A.FIN_YN = 'Y' AND A.LINK_YR BETWEEN #strFromY# AND #strToY# GROUP BY A.LINK_YR, A.CRS_CD, A.CRS_CDN ) A, ( SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_CDN /* 과정기수 */,
    A.EDU_BGNG_YMD /* 교육시작일자 */,
    A.EDU_END_YMD /* 교육종료일자 */,
    NVL(ONTM_NOP_CNT, 0) AS ONTM_NOP_CNT
FROM TBCSPSAE201D A, TBCSPSAE201M B WHERE B.LINK_YR = A.LINK_YR AND B.CRS_CD = A.CRS_CD AND A.LINK_YR BETWEEN #strFromY# AND #strToY# AND SUBSTR(A.EDU_BGNG_YMD, 0, 6) BETWEEN #strFromY# || #strFromM# AND #strToY# || #strToM# ) B WHERE B.LINK_YR = A.LINK_YR(+) AND B.CRS_CD = A.CRS_CD(+) AND B.CRS_CDN = A.CRS_CDN(+) ) A GROUP BY A.LINK_YR, A.CRS_CD, A.CRS_CDN, A.EDU_BGNG_YMD, A.EDU_END_YMD, A.ONTM_NOP_CNT, A.TANE_ID ) A, TBCSPSAE103C B WHERE B.CRS_CD = A.CRS_CD AND B.USE_YN = 'Y' ) A, TBCSPSAE101C B WHERE B.EDU_DVSN_CD = A.EDU_DVSN_CD ) A WHERE 1=1 AND A.EDU_DVSN_CD = #strEDU_DVSN_CD# AND A.EDU_CAT_CD = #strEDU_CAT_CD# AND A.CRS_CD = #strEDU_CRS_CD# GROUP BY ROLLUP(A.LINK_YR, A.EDU_DVSN_CD , (A.EDU_DVSN_NM , A.CRS_CD, A.CRS_NM , A.CNT_CRS_CD , A.CRS_CDN , A.EDU_BGNG_YMD , A.EDU_END_YMD , A.AVR_TG_CNT) ) ORDER BY A.LINK_YR, A.EDU_DVSN_CD ASC, A.CRS_CD ASC, A.CRS_CDN ASC