SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_NM /* 과정명 */,
    A.CRS_CDN /* 과정기수 */,
    A.TANE_ID,
    A.INFO_RLPR_NM /* 정보관계자명 */,
    DECODE(A.EDU_EXS, 0, 'N' , 'Y') AS EDU_EXS,
    A.DMT_EXS,
    A.BZTRP_TRVEXP_FDEXP /* 출장여비식비 */
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    D.CRS_NM /* 과정명 */,
    A.CRS_CDN /* 과정기수 */,
    A.TANE_ID,
    A.INFO_RLPR_NM /* 정보관계자명 */,
    A.EDU_EXS,
    NVL( (SELECT Z.DMT_EXS
FROM TBCSPSAE113B Z WHERE Z.CRS_CD = A.CRS_CD AND APC_DT = (SELECT MAX(APC_DT)
FROM TBCSPSAE113B X WHERE X.CRS_CD = Z.CRS_CD AND X.APC_DT < F.EDU_BGNG_YMD) )* (DECODE(A.DMT_UE_YN, 'Y', F.EDU_DAY-1, 0) + DECODE(A.SNDY_LODG_YN, 'Y', 1, 0)), (SELECT Y.DMT_EXS
FROM TBCSPSAE113B Y WHERE Y.CRS_CD = '000' AND APC_DT = (SELECT MAX(APC_DT)
FROM TBCSPSAE113B X WHERE X.CRS_CD = '000' AND X.APC_DT < F.EDU_BGNG_YMD) )* (DECODE(A.DMT_UE_YN, 'Y', F.EDU_DAY-1, 0) + DECODE(A.SNDY_LODG_YN, 'Y', 1, 0)) ) AS DMT_EXS /*기숙사비*/ , NVL( (SELECT DECODE(A.DMT_UE_YN, 'Y', Z.BRKF_FDEX*(F.EDU_DAY-1) + Z.LUNCH_FDEX*(F.EDU_DAY) +Z.DINR_FDEX*(F.EDU_DAY-1) , Z.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정_천은정감사관 */
FROM TBCSPSAE113B Z WHERE Z.CRS_CD = A.CRS_CD AND APC_DT = (SELECT MAX(APC_DT)
FROM TBCSPSAE113B X WHERE X.CRS_CD = Z.CRS_CD AND X.APC_DT < F.EDU_BGNG_YMD) ), (SELECT DECODE(A.DMT_UE_YN, 'Y', Y.BRKF_FDEX*(F.EDU_DAY-1) + Y.LUNCH_FDEX*(F.EDU_DAY) +Y.DINR_FDEX*(F.EDU_DAY-1) , Y.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정_천은정감사관 */
FROM TBCSPSAE113B Y WHERE Y.CRS_CD = '000' AND APC_DT = (SELECT MAX(APC_DT)
FROM TBCSPSAE113B X WHERE X.CRS_CD = '000' AND X.APC_DT < F.EDU_BGNG_YMD) )) AS BZTRP_TRVEXP_FDEXP /*식비*/ FROM TBCSPSAE301D A , TBCSPSAE101C B , TBCSPSAE102C C , TBCSPSAE103C D , TBDCMACM015M E , (SELECT TO_DATE(A.EDU_END_YMD, 'YYYYMMDD')+1 - TO_DATE(A.EDU_BGNG_YMD, 'YYYYMMDD') AS TO_DATE,
    CEIL((TO_DATE(A.EDU_END_YMD, 'YYYYMMDD') - NEXT_DAY(TO_DATE(A.EDU_BGNG_YMD, 'YYYYMMDD') -1, '6') +1)/7) AS CEIL /* 20240613 교육과정 점심식비에 금요일 미포함 계산식 조정으로 추가 */,
    A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_CDN /* 과정기수 */,
    A.EDU_BGNG_YMD /* 교육시작일자 */,
    A.EDU_END_YMD /* 교육종료일자 */,
    B.ACTNO_SCRTY /* 계좌번호보안 */
FROM TBCSPSAE201D A , TBCSPSAE201M B WHERE A.LINK_YR = B.LINK_YR AND A.CRS_CD = B.CRS_CD) F WHERE B.EDU_DVSN_CD = D.EDU_DVSN_CD AND B.EDU_DVSN_CD = C.EDU_DVSN_CD AND C.EDU_CAT_CD = D.EDU_CAT_CD AND D.CRS_CD = A.CRS_CD AND E.INST_CD(+) = A.INST_CD AND F.LINK_YR = A.LINK_YR AND F.CRS_CD = A.CRS_CD AND F.CRS_CDN = A.CRS_CDN AND A.INST_CD IS NOT NULL AND A.LINK_YR = #LINK_YR# AND A.CRS_CD = #CRS_CD# AND A.CRS_CDN = #CRS_CDN# AND A.TANE_ID = #TANE_ID# ) A ORDER BY A.LINK_YR, A.CRS_CD, A.CRS_CDN, A.TANE_ID