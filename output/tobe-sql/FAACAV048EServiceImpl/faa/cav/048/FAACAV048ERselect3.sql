/* faa/cav/048/FAACAV048ERselect3 */ WITH MST AS( SELECT 'A' AS GUBUN,
    ACNTG_YR /* 회계년도 */,
    JRSD_CD /* 소관코드 */,
    ACNTG_CD /* 회계코드 */,
    TCODE,
    TKWAMOK,
    ACNTG_CD /* 계정코드 */,
    SSEC_CD /* 관코드 */,
    DITM_CD /* 세항코드 */,
    SITM_CD /* 목코드 */,
    RCVMT_AMT /* 수납금액 */,
    JINGSU_AMT,
    SUM(JINGSU_AMT - RCVMT_AMT) AS JINGSU_AMT
FROM (SELECT A.ACNTG_YR /* 회계년도 */,
    A.DTL_JRSD_SECD AS DTL_JRSD_SECD /* 상세소관구분코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.DTL_JRSD_SECD||'-'||A.ACNTG_CD AS DTL_JRSD_SECD /* 상세소관구분코드 */,
    A.ACNTG_CD||'-'||A.SSEC_CD||'-'||A.DITM_CD||'-'||A.SITM_CD AS ACNTG_CD /* 계정코드 */,
    A.ACNTG_CD /* 계정코드 */,
    A.SSEC_CD /* 관코드 */,
    A.DITM_CD /* 세항코드 */,
    A.SITM_CD /* 목코드 */,
    B.RCVMT_AMT /* 수납금액 */,
    SUM(A.#N/A) AS #N/A /* 전체결산금액2 */
FROM TWFAACAV061L A, TWFAACAV038L B WHERE A.ACNT_YR = B.ACNT_YR AND A.DTIL_COPT_CD = B.COPT_CD AND A.ACNT_CD = B.ACNT_CD AND A.ACCT_CD = B.ACCT_CD AND A.SSEC_CD = LTRIM(RTRIM(B.SSEC_CD)) AND A.DITM_CD = LTRIM(RTRIM(SUBSTR(B.DITM_CD,1,2))) AND A.SITM_CD = B.SITM_CD AND A.ACNT_YR = #strYr# AND A.SOA_SECD = 'B' AND (A.#N/A != 0 OR B.RCVMT_AMT != 0) GROUP BY A.ACNTG_YR, A.DTL_JRSD_SECD, A.ACNTG_CD, A.ACNT_CD, A.SSEC_CD, A.DITM_CD, A.SITM_CD, B.RCVMT_AMT ) M1 WHERE M1.RCVMT_AMT != M1.JINGSU_AMT GROUP BY ACNTG_YR, JRSD_CD, ACNTG_CD, TCODE, TKWAMOK, ACNT_CD, SSEC_CD, DITM_CD, SITM_CD, RCVMT_AMT, JINGSU_AMT UNION SELECT 'B' AS GUBUN,
    ACNTG_YR /* 회계년도 */,
    JRSD_CD /* 소관코드 */,
    ACNTG_CD /* 회계코드 */,
    TCODE,
    TKWAMOK,
    ACNTG_CD /* 계정코드 */,
    SSEC_CD /* 관코드 */,
    DITM_CD /* 세항코드 */,
    SITM_CD /* 목코드 */,
    RCVMT_AMT /* 수납금액 */,
    JINGSU_AMT,
    SUM(JINGSU_AMT - RCVMT_AMT) AS JINGSU_AMT
FROM (SELECT A.ACNTG_YR /* 회계년도 */,
    A.DTL_JRSD_SECD AS DTL_JRSD_SECD /* 상세소관구분코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.DTL_JRSD_SECD||'-'||A.ACNTG_CD AS DTL_JRSD_SECD /* 상세소관구분코드 */,
    A.ACNTG_CD||'-'||A.SSEC_CD||'-'||A.DITM_CD||'-'||A.SITM_CD AS ACNTG_CD /* 계정코드 */,
    A.ACNTG_CD /* 계정코드 */,
    A.SSEC_CD /* 관코드 */,
    A.DITM_CD /* 세항코드 */,
    A.SITM_CD /* 목코드 */,
    0 AS RCVMT_AMT,
    SUM(A.#N/A) AS #N/A /* 전체결산금액2 */
FROM TWFAACAV061L A WHERE A.ACNT_YR = #strYr# AND A.SOA_SECD = 'B' AND A.SUM_SE_ID = '11' AND A.#N/A != 0 AND NOT EXISTS (SELECT 'X'
FROM TWFAACAV038L B WHERE A.ACNTG_YR = B.ACNTG_YR AND A.DTL_JRSD_SECD = B.JRSD_CD AND A.ACNTG_CD = B.ACNTG_CD AND A.ACNT_CD = B.ACNT_CD AND A.SSEC_CD = LTRIM(RTRIM(B.SSEC_CD)) AND A.DITM_CD = LTRIM(RTRIM(SUBSTR(B.DITM_CD,1,2))) AND A.SITM_CD = B.SITM_CD) GROUP BY A.ACNTG_YR, A.DTL_JRSD_SECD, A.ACNTG_CD, A.ACNT_CD, A.SSEC_CD, A.DITM_CD, A.SITM_CD ) M2 GROUP BY ACNTG_YR, JRSD_CD, ACNTG_CD, TCODE, TKWAMOK, ACNT_CD, SSEC_CD, DITM_CD, SITM_CD, RCVMT_AMT, JINGSU_AMT UNION SELECT 'C' AS GUBUN,
    ACNTG_YR /* 회계년도 */,
    JRSD_CD /* 소관코드 */,
    ACNTG_CD /* 회계코드 */,
    TCODE,
    TKWAMOK,
    ACNTG_CD /* 계정코드 */,
    SSEC_CD /* 관코드 */,
    DITM_CD /* 세항코드 */,
    SITM_CD /* 목코드 */,
    RCVMT_AMT /* 수납금액 */,
    JINGSU_AMT,
    -RCVMT_AMT AS RCVMT_AMT /* 수납금액 */
FROM (SELECT A.ACNTG_YR /* 회계년도 */,
    A.JRSD_CD /* 소관코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.JRSD_CD||'-'||A.ACNTG_CD AS JRSD_CD /* 소관코드 */,
    A.ACNTG_CD||'-'||LTRIM(RTRIM(A.SSEC_CD))||'-'||LTRIM(RTRIM(SUBSTR(A.DITM_CD,1,2)))||'-'||A.SITM_CD AS ACNTG_CD /* 계정코드 */,
    A.ACNTG_CD /* 계정코드 */,
    LTRIM(RTRIM(A.SSEC_CD)) AS SSEC_CD /* 관코드 */,
    LTRIM(RTRIM(SUBSTR(A.DITM_CD,1,2))) AS DITM_CD /* 세항코드 */,
    A.SITM_CD /* 목코드 */,
    A.RCVMT_AMT /* 수납금액 */,
    0
FROM TWFAACAV038L A WHERE A.ACNTG_YR = #ACNTG_YR# AND A.RCVMT_AMT != 0 AND NOT EXISTS (SELECT 'X'
FROM TWFAACAV061L B WHERE A.ACNTG_YR = B.ACNTG_YR AND A.JRSD_CD = B.DTL_JRSD_SECD AND A.ACNTG_CD = B.ACNTG_CD AND A.ACNT_CD = B.ACNT_CD AND LTRIM(RTRIM(A.SSEC_CD)) = B.SSEC_CD AND LTRIM(RTRIM(SUBSTR(A.DITM_CD,1,2))) = B.DITM_CD AND A.SITM_CD = B.SITM_CD AND B.SOA_SECD = 'B' AND B.SUM_SE_ID = '11') GROUP BY A.ACNTG_YR, A.JRSD_CD, A.ACNTG_CD, A.ACNT_CD, A.SSEC_CD, A.DITM_CD, A.SITM_CD, A.RCVMT_AMT ) M3 GROUP BY ACNTG_YR, JRSD_CD, ACNTG_CD, TCODE, TKWAMOK, ACNT_CD, SSEC_CD, DITM_CD, SITM_CD, RCVMT_AMT ) SELECT A.GUBUN AS 구분,
    A.TCODE||A.TKWAMOK AS 분류,
    A.TCODE AS 소관회계,
    A.TKWAMOK AS 예산과목,
    A.RCVMT_AMT AS 기재부제출자료 AS RCVMT_AMT /* 수납금액 */,
    B.#N/A AS 당원제출자료 AS #N/A /* 전체결산금액2 */,
    A.JINGSU_AMT AS 당원제출합계,
    SUM(A.JINGSU_AMT - A.RCVMT_AMT) 차액 AS RCVMT_AMT /* 수납금액 */,
    B.JRSD_CD||'-'||B.ACNTG_CD||'-'||B.BLL_KDCD||'-'||B.PROF_RBPRSN_SQNO||'-'||B.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO AS 증명책임자부호 AS JRSD_CD /* 소관코드 */,
    B.ACNT_CD||'-'||B.SSEC_CD||'-'||B.DITM_CD||'-'||B.SITM_CD AS 예산과목DTL AS ACNT_CD /* 계정코드 */,
    C.PROF_RBPRSN_INST_NM AS 기관명 AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM MST AS A, TWFAACAV061L B, TWFAACAV003M C WHERE A.ACNT_YR = B.ACNT_YR AND A.COPT_CD = B.DTIL_COPT_CD AND A.ACNT_CD = B.ACNT_CD AND A.ACCT_CD = B.ACCT_CD AND A.SSEC_CD = B.SSEC_CD AND A.DITM_CD = B.DITM_CD AND A.SITM_CD = B.SITM_CD AND B.DTIL_COPT_CD = C.COPT_CD AND B.ACNT_CD = C.ACNT_CD AND B.BLL_CD = C.BLL_CD AND B.PROF_DRTR_SRNO = C.PROF_DRTR_SRNO AND B.DL_XPN_RCDB_PBSVT_SRNO = C.DL_XPN_RCDB_PBSVT_SRNO AND B.ACNT_YR = #strYr# AND B.SOA_SECD = 'B' AND A.GUBUN IN ('A','B') AND B.#N/A != 0 GROUP BY A.GUBUN, A.TCODE, A.TKWAMOK, A.RCVMT_AMT, B.#N/A, A.JINGSU_AMT, B.JRSD_CD||'-'||B.ACNTG_CD||'-'||B.BLL_KDCD||'-'||B.PROF_RBPRSN_SQNO||'-'||B.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO, B.ACNT_CD||'-'||B.SSEC_CD||'-'||B.DITM_CD||'-'||B.SITM_CD, C.PROF_RBPRSN_INST_NM UNION SELECT A.GUBUN AS 구분,
    A.TCODE||A.TKWAMOK AS 분류,
    A.TCODE AS 소관회계,
    A.TKWAMOK AS 예산과목,
    A.RCVMT_AMT AS 기재부제출자료 AS RCVMT_AMT /* 수납금액 */,
    A.JINGSU_AMT AS 당원제출자료,
    A.JINGSU_AMT AS 당원제출합계,
    A.CHAI_AMT AS 차액,
    '' AS 증명책임자부호,
    '' AS 예산과목DTL,
    '' AS 기관명
FROM MST AS A, TWFAACAV038L B WHERE A.ACNTG_YR = B.ACNTG_YR AND A.JRSD_CD = B.JRSD_CD AND A.ACNTG_CD = B.ACNTG_CD AND A.ACNT_CD = B.ACNT_CD AND A.SSEC_CD = LTRIM(RTRIM(B.SSEC_CD)) AND A.DITM_CD = LTRIM(RTRIM(SUBSTR(B.DITM_CD,1,2))) AND A.SITM_CD = B.SITM_CD AND B.ACNTG_YR = #ACNTG_YR# AND A.GUBUN = 'C' ORDER BY 3,4,9