/* faa/cav/048/FAACAV048ERselect */ WITH AAA AS ( SELECT 'A' AS GUBUN,
    ACNTG_YR /* 회계년도 */,
    JRSD_CD /* 소관코드 */,
    ACNTG_CD /* 회계코드 */,
    TCODE,
    TKWASITM_CD,
    ACNTG_CD /* 계정코드 */,
    CHIF_CD /* 장코드 */,
    SSEC_CD /* 관코드 */,
    DITM_CD /* 세항코드 */,
    SITM_CD /* 목코드 */,
    EXPND_AMT /* 지출금액 */,
    TOTAMT,
    SUM(TOTAMT - EXPND_AMT) AS TOTAMT
FROM (SELECT A.ACNTG_YR /* 회계년도 */,
    A.JRSD_CD /* 소관코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.JRSD_CD||'-'||A.ACNTG_CD AS JRSD_CD /* 소관코드 */,
    A.ACNTG_CD||'-'||A.CHIF_CD||'-'||A.SSEC_CD||'-'||A.DITM_CD||'-'||A.SITM_CD AS ACNTG_CD /* 계정코드 */,
    A.ACNTG_CD /* 계정코드 */,
    A.CHIF_CD /* 장코드 */,
    A.SSEC_CD /* 관코드 */,
    A.DITM_CD /* 세항코드 */,
    A.SITM_CD /* 목코드 */,
    B.EXPND_AMT /* 지출금액 */,
    SUM(A.#N/A) AS #N/A /* 전체결산금액2 */
FROM TWFAACAV061L A, TWFAACAV039L B WHERE A.ACNT_YR = #strYr# AND A.SOA_SECD = 'A' AND A.ACNTG_YR = B.ACNTG_YR AND A.JRSD_CD = B.JRSD_CD AND A.ACNTG_CD = B.ACNTG_CD AND A.ACNT_CD = B.ACNT_CD AND A.CHIF_CD = B.CHIF_CD AND A.SSEC_CD = B.SSEC_CD AND A.DITM_CD = B.DITM_CD AND A.SITM_CD = B.SITM_CD GROUP BY A.ACNTG_YR, A.JRSD_CD, A.ACNTG_CD, A.ACNT_CD, A.CHIF_CD, A.SSEC_CD, A.DITM_CD, A.SITM_CD, B.EXPND_AMT ) MST WHERE MST.EXPND_AMT != MST.TOTAMT GROUP BY ACNTG_YR, JRSD_CD, ACNTG_CD, TCODE, TKWASITM_CD, ACNT_CD, CHIF_CD, SSEC_CD, DITM_CD, SITM_CD, EXPND_AMT, TOTAMT UNION ALL SELECT 'B' AS GUBUN,
    ACNTG_YR /* 회계년도 */,
    JRSD_CD /* 소관코드 */,
    ACNTG_CD /* 회계코드 */,
    TCODE,
    TKWASITM_CD,
    ACNTG_CD /* 계정코드 */,
    CHIF_CD /* 장코드 */,
    SSEC_CD /* 관코드 */,
    DITM_CD /* 세항코드 */,
    SITM_CD /* 목코드 */,
    EXPND_AMT /* 지출금액 */,
    TOTAMT,
    SUM(TOTAMT - EXPND_AMT) AS TOTAMT
FROM (SELECT A.ACNTG_YR /* 회계년도 */,
    A.JRSD_CD /* 소관코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.JRSD_CD||'-'||A.ACNTG_CD AS JRSD_CD /* 소관코드 */,
    A.ACNTG_CD||'-'||A.CHIF_CD||'-'||A.SSEC_CD||'-'||A.DITM_CD||'-'||A.SITM_CD AS ACNTG_CD /* 계정코드 */,
    A.ACNTG_CD /* 계정코드 */,
    A.CHIF_CD /* 장코드 */,
    A.SSEC_CD /* 관코드 */,
    A.DITM_CD /* 세항코드 */,
    A.SITM_CD /* 목코드 */,
    0 AS EXPND_AMT,
    SUM(A.#N/A) AS #N/A /* 전체결산금액2 */
FROM TWFAACAV061L A WHERE A.ACNT_YR = #strYr# AND A.SOA_SECD = 'A' AND A.SUM_SE_ID NOT IN ('49','51') AND NOT EXISTS (SELECT 'X'
FROM TWFAACAV039L B WHERE A.ACNTG_YR = B.ACNTG_YR AND A.JRSD_CD = B.JRSD_CD AND A.ACNTG_CD = B.ACNTG_CD AND A.ACNT_CD = B.ACNT_CD AND A.CHIF_CD = B.CHIF_CD AND A.SSEC_CD = B.SSEC_CD AND A.DITM_CD = B.DITM_CD AND A.SITM_CD = B.SITM_CD ) GROUP BY A.ACNTG_YR, A.JRSD_CD, A.ACNTG_CD, A.ACNT_CD, A.CHIF_CD, A.SSEC_CD, A.DITM_CD, A.SITM_CD ) SUB_1 GROUP BY ACNTG_YR, JRSD_CD, ACNTG_CD, TCODE, TKWASITM_CD, ACNT_CD, CHIF_CD, SSEC_CD, DITM_CD, SITM_CD, EXPND_AMT, TOTAMT UNION ALL SELECT 'C' AS GUBUN,
    ACNTG_YR /* 회계년도 */,
    JRSD_CD /* 소관코드 */,
    ACNTG_CD /* 회계코드 */,
    TCODE,
    TKWASITM_CD,
    ACNTG_CD /* 계정코드 */,
    CHIF_CD /* 장코드 */,
    SSEC_CD /* 관코드 */,
    DITM_CD /* 세항코드 */,
    SITM_CD /* 목코드 */,
    EXPND_AMT /* 지출금액 */,
    TOTAMT,
    SUM(TOTAMT - EXPND_AMT) AS TOTAMT
FROM (SELECT A.ACNTG_YR /* 회계년도 */,
    A.JRSD_CD /* 소관코드 */,
    A.ACNTG_CD /* 회계코드 */,
    A.JRSD_CD||'-'||A.ACNTG_CD AS JRSD_CD /* 소관코드 */,
    A.ACNTG_CD||'-'||A.CHIF_CD||'-'||A.SSEC_CD||'-'||A.DITM_CD||'-'||A.SITM_CD AS ACNTG_CD /* 계정코드 */,
    A.ACNTG_CD /* 계정코드 */,
    A.CHIF_CD /* 장코드 */,
    A.SSEC_CD /* 관코드 */,
    A.DITM_CD /* 세항코드 */,
    A.SITM_CD /* 목코드 */,
    A.EXPND_AMT AS EXPND_AMT /* 지출금액 */,
    0
FROM TWFAACAV039L A WHERE A.ACNTG_YR = #ACNTG_YR# AND A.EXPND_AMT != 0 AND NOT EXISTS (SELECT 'X'
FROM TWFAACAV061L B WHERE A.ACNTG_YR = B.ACNTG_YR AND A.JRSD_CD = B.JRSD_CD AND A.ACNTG_CD = B.ACNTG_CD AND A.ACNT_CD = B.ACNT_CD AND A.CHIF_CD = B.CHIF_CD AND A.SSEC_CD = B.SSEC_CD AND A.DITM_CD = B.DITM_CD AND A.SITM_CD = B.SITM_CD AND B.SOA_SECD = 'A' AND B.SUM_SE_ID NOT IN ('49','51') ) GROUP BY A.ACNTG_YR, A.JRSD_CD, A.ACNTG_CD, A.ACNT_CD, A.CHIF_CD, A.SSEC_CD, A.DITM_CD, A.SITM_CD, A.EXPND_AMT ) SUB_2 GROUP BY ACNTG_YR, JRSD_CD, ACNTG_CD, TCODE, TKWASITM_CD, ACNT_CD, CHIF_CD, SSEC_CD, DITM_CD, SITM_CD, EXPND_AMT, TOTAMT ORDER BY 1,3,4,6 ) SELECT A.GUBUN AS 구분,
    A.TCODE||A.TKWASITM_CD AS 분류,
    A.TCODE AS 소관회계,
    A.TKWASITM_CD AS 예산과목,
    A.EXPND_AMT AS 기재부제출자료 AS EXPND_AMT /* 지출금액 */,
    B.#N/A AS 당원제출자료 AS #N/A /* 전체결산금액2 */,
    A.TOTAMT AS 당원제출합계,
    SUM(A.TOTAMT - A.EXPND_AMT) AS 차액 AS EXPND_AMT /* 지출금액 */,
    B.JRSD_CD||'-'||B.ACNTG_CD||'-'||B.BLL_KDCD||'-'||B.PROF_RBPRSN_SQNO||'-'||B.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO AS 증명책임자부호 AS JRSD_CD /* 소관코드 */,
    B.ACNT_CD||'-'||B.CHIF_CD||'-'||B.SSEC_CD||'-'||B.DITM_CD||'-'||B.SITM_CD as 예산과목DTL AS ACNT_CD /* 계정코드 */,
    C.PROF_RBPRSN_INST_NM AS 기관명 AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM AAA A, TWFAACAV061L B, TWFAACAV003M C WHERE B.ACNT_YR = #strYr# AND B.SOA_SECD = 'A' AND A.JRSD_CD = B.JRSD_CD AND A.ACNTG_CD = B.ACNTG_CD AND A.ACNT_CD = B.ACNT_CD AND A.CHIF_CD = B.CHIF_CD AND A.SSEC_CD = B.SSEC_CD AND A.DITM_CD = B.DITM_CD AND A.SITM_CD = B.SITM_CD AND C.JRSD_CD = B.JRSD_CD(+) AND C.ACNTG_CD = B.ACNTG_CD(+) AND C.BLL_KDCD = B.BLL_KDCD(+) AND C.PROF_RBPRSN_SQNO = B.PROF_RBPRSN_SQNO(+) AND C.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = B.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO(+) AND A.GUBUN IN ('A','B') GROUP BY A.GUBUN, A.TCODE, A.TKWASITM_CD, A.EXPND_AMT, A.TOTAMT, B.#N/A, B.JRSD_CD||'-'||B.ACNTG_CD||'-'||B.BLL_KDCD||'-'||B.PROF_RBPRSN_SQNO||'-'||B.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO, B.ACNT_CD||'-'||B.CHIF_CD||'-'||B.SSEC_CD||'-'||B.DITM_CD||'-'||B.SITM_CD, C.PROF_RBPRSN_INST_NM UNION ALL SELECT A.GUBUN AS 구분,
    A.TCODE||A.TKWASITM_CD AS 분류,
    A.TCODE AS 소관회계,
    A.TKWASITM_CD AS 예산과목,
    A.EXPND_AMT AS 기재부제출자료 AS EXPND_AMT /* 지출금액 */,
    A.TOTAMT AS 당원제출자료,
    A.TOTAMT AS 당원제출합계,
    A.CHA AS 차액,
    '' AS 증명책임자부호,
    '' as 예산과목DTL,
    '' AS 기관명
FROM AAA A, TWFAACAV039L B WHERE A.ACNTG_YR = #ACNTG_YR# AND A.JRSD_CD(+) = B.JRSD_CD AND A.ACNTG_CD(+) = B.ACNTG_CD AND A.ACNT_CD(+) = B.ACNT_CD AND A.CHIF_CD(+) = B.CHIF_CD AND A.SSEC_CD(+) = B.SSEC_CD AND A.DITM_CD(+) = B.DITM_CD AND A.SITM_CD(+) = B.SITM_CD AND A.GUBUN = 'C' GROUP BY A.GUBUN, A.TCODE, A.TKWASITM_CD, A.EXPND_AMT, A.TOTAMT, A.CHA