SELECT A.COPT_CAT_CD,
    /*소관분류코드*/ A.BOO_KND_CD,
    F_CODE_NM('1000149',A.BOO_KND_CD) AS F_CODE_NM,
    /*도서종류코드*/ A.BOO_NO,
    /*도서번호*/ A.BOO_NO||'-'||A.BOO_VLE_NO AS BOO_NO,
    A.BOO_VLE_NO,
    SUBSTR(A.CAT_SYM_NM,1,1) AS SUBSTR,
    SUBSTR(A.CAT_SYM_NM,2,3) AS SUBSTR,
    SUBSTR(A.CAT_SYM_NM,5,3) AS SUBSTR,
    A.CAT_SYM_NM,
    A.BOO_ACP_DT,
    A.BAR_CD,
    A.DRVT_SYM_NM,
    A.BOO_SYM_NM,
    A.BOO_TIT_NM,
    A.PBC_PLAC_NM,
    A.PBC_RGN_NM,
    A.PBC_DT,
    A.PBC_YR,
    A.RSCH_RPTP_AUT_NM /* 연구보고서저자명 */,
    A.PON,
    A.SZ_VAL,
    A.KYWD_NM,
    A.BOO_RMK,
    A.ORI_NM,
    A.STN_PEN_NM,
    A.BOO_PBC_BR_CD,
    A.LIB_SBJ,
    A.CLC_WAY_CD,
    A.BOO_PUR_PR,
    A.INTNA_STND_BOO_NO,
    A.DEG_NM,
    A.MTRL_MNG_YR,
    A.MTRL_MNG_DVSN_NO,
    A.MTRL_MNG_NO,
    A.CVLCPT_RCPT_YR /* 민원접수년도 */,
    A.PBLC_KND_CD,
    A.INTNA_STND_PBLC_SRNO,
    A.SSCR_PRD_STR_DT,
    A.SSCR_PRD_END_DT,
    A.YRLY_SSCR_FEE,
    A.SSCR_COT,
    A.AVDOC_SHP_CD,
    A.BOO_MAIN_TXT,
    A.BOO_RPRT_NO,
    A.ASTR_TXT,
    NVL(A.BOO_LEND_DVSN_CD,1) AS BOO_LEND_DVSN_CD,
    /*대출여부 0: 예(대출중) 1:아니오(미대출)*/ (CASE WHEN BOO_LEND_DVSN_CD = '0' THEN '0' WHEN (BOO_LEND_DVSN_CD = '1' OR BOO_LEND_DVSN_CD IS NULL ) AND B.BOO_BOKG_NO = 1 THEN '1' WHEN (BOO_LEND_DVSN_CD = '1' OR BOO_LEND_DVSN_CD IS NULL ) AND B.BOO_BOKG_NO > 1 THEN '0' WHEN B.BOO_BOKG_NO IS NULL AND (SELECT COUNT(*)
FROM TBCSPQBO003H C WHERE A.COPT_CAT_CD = C.COPT_CAT_CD AND A.BOO_KND_CD = C.BOO_KND_CD AND A.BOO_NO = C.BOO_NO AND A.CAT_SYM_NM = C.CAT_SYM_NM AND A.BOO_VLE_NO = C.BOO_VLE_NO AND C.LEND_BOKG_STA_CD = 'Y' ) = 0 THEN '1' ELSE '0' END ) BOO_LEND_POSS_YN, /*대출가능여부 1 : 예(대출가능) 0: 아니오(대출불가능)*/ C.BOO_REN_APT_DT /*반납예정일자*/ ,C.BOO_LEND_SLN ,DECODE((SELECT COUNT(*)
FROM TBCSPQBO003H H WHERE A.COPT_CAT_CD = H.COPT_CAT_CD AND A.BOO_KND_CD = H.BOO_KND_CD AND A.BOO_NO = H.BOO_NO AND A.CAT_SYM_NM = H.CAT_SYM_NM AND A.BOO_VLE_NO = H.BOO_VLE_NO AND H.LEND_BOKG_STA_CD = 'Y'),0,'N','Y' ) AS BOO_BOKG_YN /*대출예약여부 Y 예약, N 미예약*/ ,F_USR_INFO(C.LAG_INV_CNB, '2') AS LAG_INV_NAM ,C.LAG_INV_CNB ,F_DPT_INFO(F_USR_INFO(C.LAG_INV_CNB, '5'), '1') AS LAG_INV_DPT_NM /*대출부서*/ ,F_USR_INFO(C.LAG_INV_CNB, '5') AS LAG_INV_DPT_CD /*대출부서코드*/ FROM TBCSPQBO001M A, (SELECT A.COPT_CAT_CD,
    A.BOO_KND_CD,
    A.BOO_NO,
    A.CAT_SYM_NM,
    A.BOO_VLE_NO,
    A.LEND_BOKG_PEN_CNB,
    A.LEND_BOKG_STA_CD,
    RANK() OVER (PARTITION BY A.COPT_CAT_CD, A.BOO_KND_CD, A.BOO_NO, A.CAT_SYM_NM, A.BOO_VLE_NO ORDER BY A.BOO_BOKG_SLN ASC) AS RANK
FROM TBCSPQBO003H A WHERE A.LEND_BOKG_STA_CD = 'Y' ) B, TBCSPQBO002H C WHERE 1=1 AND A.COPT_CAT_CD = B.COPT_CAT_CD(+) AND A.BOO_KND_CD = B.BOO_KND_CD(+) AND A.BOO_NO = B.BOO_NO(+) AND A.CAT_SYM_NM = B.CAT_SYM_NM(+) AND A.BOO_VLE_NO = B.BOO_VLE_NO(+) AND A.COPT_CAT_CD = C.COPT_CAT_CD (+) AND A.BOO_KND_CD = C.BOO_KND_CD (+) AND A.BOO_NO = C.BOO_NO (+) AND A.CAT_SYM_NM = C.CAT_SYM_NM (+) AND A.BOO_VLE_NO = C.BOO_VLE_NO (+) AND C.BOO_REN_YN_CD(+) = '0' AND B.LEND_BOKG_PEN_CNB(+) = #strUsrCnb# AND A.COPT_CAT_CD = #strCoptCatCd# AND A.BOO_KND_CD IN (SELECT SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) AS SUBSTR
FROM DUAL A CROSS JOIN(SELECT ','|| #strBooKndCd# ||',' AS #STRBOOKNDCD#
FROM DUAL) B CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 ) AND A.BOO_NO = #strBooNo# AND A.CAT_SYM_NM = #strCatSymNm# AND A.BAR_CD = #strBarCd# AND A.BOO_TIT_NM LIKE '%'||#strBooTitNm#||'%' AND A.PBC_PLAC_NM LIKE '%'||#strPbcPlacNm#||'%' AND A.RSCH_RPTP_AUT_NM LIKE '%'||#strAtrNm#||'%' AND A.KYWD_NM LIKE '%'||#strKywdNm#||'%'