SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_CDN /* 과정기수 */,
    A.PFSR_ID,
    A.PFSR_DVSN_CD,
    A.PFSR_DVSN_NM,
    A.INFO_RLPR_NM /* 정보관계자명 */,
    A.SUBJ_CD,
    A.BLL_SBJCT_NM /* 계산서과목명 */,
    A.SV_DVSN_CD,
    A.SV_DVSN_NM,
    B.EDU_STFT_TXT_1,
    DECODE(C.TOT_STFT, 0, 0, ROUND(B.EDU_STFT_TXT_1 / C.TOT_STFT * 100, 0)) AS TOT_STFT,
    B.EDU_STFT_TXT_2,
    DECODE(C.TOT_STFT, 0, 0, ROUND(B.EDU_STFT_TXT_2 / C.TOT_STFT * 100, 0)) AS TOT_STFT,
    B.EDU_STFT_TXT_3,
    DECODE(C.TOT_STFT, 0, 0, ROUND(B.EDU_STFT_TXT_3 / C.TOT_STFT * 100, 0)) AS TOT_STFT,
    B.EDU_STFT_TXT_4,
    DECODE(C.TOT_STFT, 0, 0, ROUND(B.EDU_STFT_TXT_4 / C.TOT_STFT * 100, 0)) AS TOT_STFT,
    B.EDU_STFT_TXT_5,
    DECODE(C.TOT_STFT, 0, 0, ROUND(B.EDU_STFT_TXT_5 / C.TOT_STFT * 100, 0)) AS TOT_STFT,
    D.TOT_SCORE
FROM (SELECT DISTINCT B.LINK_YR AS LINK_YR /* 연계년도 */,
    B.CRS_CD,
    B.CRS_CDN /* 과정기수 */,
    E.PFSR_ID,
    E.PFSR_DVSN_CD,
    (SELECT AS CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000312' AND CD = E.PFSR_DVSN_CD) AS PFSR_DVSN_NM , E.INFO_RLPR_NM , B.SUBJ_CD , D.BLL_SBJCT_NM , C.CD AS SV_DVSN_CD , (SELECT CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000317' AND CD = C.CD) AS SV_DVSN_NM FROM TBCSPSAE304D A , TBCSPSAE101D B , (SELECT CD
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000317' AND CD != '000000000') AS C , TBCSPSAE101M D , TBCSPSAE109M E WHERE 1=1 AND B.LINK_YR = A.LINK_YR(+) AND B.CRS_CD = A.CRS_CD(+) AND B.CRS_CDN = A.CRS_CDN(+) AND D.SUBJ_CD = B.SUBJ_CD AND E.PFSR_ID = B.PFSR_ID AND B.LINK_YR = #LINK_YR# AND B.CRS_CD = #strEDU_CRS_CD# AND B.CRS_CDN = #CRS_CDN# AND D.BSC_OP_SUBJ_YN != 'Y' ORDER BY E.PFSR_DVSN_CD, B.SUBJ_CD, C.CD ) A , TBCSPSAE304D B , ( SELECT EDU_STFT_TXT_1 + EDU_STFT_TXT_2 + EDU_STFT_TXT_3 + EDU_STFT_TXT_4 + EDU_STFT_TXT_5 AS EDU_STFT_TXT_1,
    SUBJ_CD,
    SV_DVSN_CD
FROM TBCSPSAE304D WHERE LINK_YR = #LINK_YR# AND CRS_CD = #strEDU_CRS_CD# AND CRS_CDN = #CRS_CDN# ) C , ( SELECT ROUND(SUM((DECODE((EDU_STFT_TXT_1 + EDU_STFT_TXT_2 + EDU_STFT_TXT_3 + EDU_STFT_TXT_4 + EDU_STFT_TXT_5), 0, 0, ROUND(EDU_STFT_TXT_1 / (EDU_STFT_TXT_1 + EDU_STFT_TXT_2 + EDU_STFT_TXT_3 + EDU_STFT_TXT_4 + EDU_STFT_TXT_5) * 100, 0))*1) + (DECODE((EDU_STFT_TXT_1 + EDU_STFT_TXT_2 + EDU_STFT_TXT_3 + EDU_STFT_TXT_4 + EDU_STFT_TXT_5), 0, 0, ROUND(EDU_STFT_TXT_2 / (EDU_STFT_TXT_1 + EDU_STFT_TXT_2 + EDU_STFT_TXT_3 + EDU_STFT_TXT_4 + EDU_STFT_TXT_5) * 100, 0))*0.8) + (DECODE((EDU_STFT_TXT_1 + EDU_STFT_TXT_2 + EDU_STFT_TXT_3 + EDU_STFT_TXT_4 + EDU_STFT_TXT_5), 0, 0, ROUND(EDU_STFT_TXT_3 / (EDU_STFT_TXT_1 + EDU_STFT_TXT_2 + EDU_STFT_TXT_3 + EDU_STFT_TXT_4 + EDU_STFT_TXT_5) * 100, 0))*0.6) + (DECODE((EDU_STFT_TXT_1 + EDU_STFT_TXT_2 + EDU_STFT_TXT_3 + EDU_STFT_TXT_4 + EDU_STFT_TXT_5), 0, 0, ROUND(EDU_STFT_TXT_4 / (EDU_STFT_TXT_1 + EDU_STFT_TXT_2 + EDU_STFT_TXT_3 + EDU_STFT_TXT_4 + EDU_STFT_TXT_5) * 100, 0))*0.4) + (DECODE((EDU_STFT_TXT_1 + EDU_STFT_TXT_2 + EDU_STFT_TXT_3 + EDU_STFT_TXT_4 + EDU_STFT_TXT_5), 0, 0, ROUND(EDU_STFT_TXT_5 / (EDU_STFT_TXT_1 + EDU_STFT_TXT_2 + EDU_STFT_TXT_3 + EDU_STFT_TXT_4 + EDU_STFT_TXT_5) * 100, 0))*0.2))/3, 0) AS ROUND,
    SUBJ_CD
FROM TBCSPSAE304D WHERE LINK_YR = #LINK_YR# AND CRS_CD = #strEDU_CRS_CD# AND CRS_CDN = #CRS_CDN# GROUP BY SUBJ_CD ) D WHERE 1=1 AND A.LINK_YR = B.LINK_YR(+) AND A.CRS_CD = B.CRS_CD(+) AND A.CRS_CDN = B.CRS_CDN(+) AND A.SUBJ_CD = B.SUBJ_CD(+) AND A.SV_DVSN_CD = B.SV_DVSN_CD(+) AND C.SUBJ_CD(+) = B.SUBJ_CD AND C.SV_DVSN_CD(+) = B.SV_DVSN_CD AND D.SUBJ_CD(+) = B.SUBJ_CD ORDER BY A.PFSR_DVSN_CD, A.CRS_CDN, A.INFO_RLPR_NM, A.SUBJ_CD, A.SV_DVSN_CD