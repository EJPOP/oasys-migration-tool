WITH DATA AS ( SELECT A.APC_DT,
    A.EDU_EXS,
    A.DMT_EXS,
    A.BRKF_FDEX,
    A.LUNCH_FDEX,
    A.DINR_FDEX
FROM TBCSPSAE113B A WHERE A.APC_DT = (SELECT NVL(MAX(B.APC_DT), (SELECT MAX(APC_DT)
FROM TBCSPSAE113B WHERE CRS_CD = '000' AND APC_DT < (SELECT EDU_BGNG_YMD /* 교육시작일자 */
FROM TBCSPSAE201D WHERE LINK_YR = #LINK_YR# AND CRS_CD = #strEDU_CRS_CD# AND CRS_CDN = #CRS_CDN#))) AS APC_DT FROM TBCSPSAE201D A , TBCSPSAE113B B WHERE B.APC_DT < A.EDU_BGNG_YMD AND A.CRS_CD = B.CRS_CD /* 150520 교육과정이 전체가 아니면 그 교육과정에 대한 금액을 들고가도록 변경 */ AND A.LINK_YR = #LINK_YR# AND A.CRS_CD = #strEDU_CRS_CD# AND A.CRS_CDN = #CRS_CDN# ) AND A.CRS_CD = NVL((SELECT A.CRS_CD
FROM TBCSPSAE201D A , TBCSPSAE113B B WHERE B.APC_DT < A.EDU_BGNG_YMD AND A.CRS_CD = B.CRS_CD /* 150520 교육과정이 전체가 아니면 그 교육과정에 대한 금액을 들고가도록 변경 */ AND A.LINK_YR = #LINK_YR# AND A.CRS_CD = #strEDU_CRS_CD# AND A.CRS_CDN = #CRS_CDN# GROUP BY A.CRS_CD ),'000') ) SELECT '' AS REG_SECD /* 등록구분코드 */,
    A.LINK_YR /* 연계년도 */,
    A.CRS_CD /* 과정코드 */,
    A.CRS_CDN /* 과정기수 */,
    A.GRNDS_EXMN_AEX_SQNO /* 현장조사수용비순번 */,
    A.TANE_ID /* 교육생ID */,
    A.INFO_RLPR_NM /* 정보관계자명 */,
    A.DSPS_RQT_TRPR_BRDT /* 처분요구대상자생년월일 */,
    SUBSTR(REPLACE(A.SLCT_CVLPR_MPNO, '-', ''), 0, 3) || '-' || SUBSTR(REPLACE(A.SLCT_CVLPR_MPNO, '-', ''), 4, 4) || '-' || SUBSTR(REPLACE(A.SLCT_CVLPR_MPNO, '-', ''), 8, 4) AS SLCT_CVLPR_MPNO /* 청탁민원인휴대전화번호 */,
    A.NPL_BLT_NM /* 기관명 */,
    NVL((SELECT AS EDU_EXS
FROM TBCSPSAE113B WHERE CRS_CD = A.CRS_CD AND APC_DT < B.EDU_BGNG_YMD), (SELECT EDU_EXS
FROM DATA )) AS STD_EDU_EXS /* 교육비 */ , NVL((SELECT DMT_EXS
FROM TBCSPSAE113B WHERE CRS_CD = A.CRS_CD AND APC_DT < B.EDU_BGNG_YMD), (SELECT DMT_EXS
FROM DATA )) AS STD_DMT_EXS /* 기숙사비 */ , NVL((SELECT BRKF_FDEX
FROM TBCSPSAE113B WHERE CRS_CD = A.CRS_CD AND APC_DT < B.EDU_BGNG_YMD), (SELECT BRKF_FDEX
FROM DATA )) AS STD_BRKF_FDEX /* 아침식비 */ , NVL((SELECT LUNCH_FDEX
FROM TBCSPSAE113B WHERE CRS_CD = A.CRS_CD AND APC_DT < B.EDU_BGNG_YMD), (SELECT LUNCH_FDEX
FROM DATA )) AS STD_LUNCH_FDEX /* 점심식비 */ , NVL((SELECT DINR_FDEX
FROM TBCSPSAE113B WHERE CRS_CD = A.CRS_CD AND APC_DT < B.EDU_BGNG_YMD), (SELECT DINR_FDEX
FROM DATA )) AS STD_DINR_FDEX /* 저녁식비 */ FROM TBCSPSAE301D A , TBCSPSAE201D B WHERE 1=1 AND B.LINK_YR = A.LINK_YR AND B.CRS_CD = A.CRS_CD AND B.CRS_CDN = A.CRS_CDN AND A.LINK_YR = #LINK_YR# AND A.CRS_CD = #strEDU_CRS_CD# AND A.CRS_CDN = #CRS_CDN# ORDER BY A.LINK_YR, A.CRS_CD, A.CRS_CDN, A.INFO_RLPR_NM