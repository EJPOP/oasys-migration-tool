SELECT MASTER.CVLCPT_ADT_YR AS CVLCPT_ADT_YR /* 민원감사년도 */,
    /*감사년도*/ MASTER.ADT_NO AS ADT_NO /* 감사번호 */,
    /*감사순번*/ F_MNG_KND_AUDYRNO(MASTER.CVLCPT_ADT_YR, MASTER.ADT_NO, AUD.ADT_KDCD, '-') ||'-'|| MASTER.DSPS_RQT_SQNO AS ADT_CLSF_NO /* 감사분류번호 */,
    /*화면에 보여주는 관리번호 수정 - 2015.12.22 yyh*/ MASTER.DSPS_RQT_SQNO AS DSPS_RQT_SQNO /* 처분요구순번 */,
    /*처분요구순번*/ (SELECT MIN(ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */
FROM TB_BADDED002M WHERE REL_ADT_YR = MASTER.CVLCPT_ADT_YR AND REL_ADT_NO = MASTER.ADT_NO ) AS ADT_BGNG_YMD , /*감사시작일자*/ AUD.SPRVSN_DEPT_CD AS SPRVSN_DEPT_CD , /*주관부서코드*/ AUD.ADT_KDCD AS ADT_KDCD , /*감사종류코드*/ AUD.ADT_MTTR_NM AS ADT_MTTR_NM , /*감사사항명*/ RTRIM(DETAIL.ENFC_YMD) AS ENFC_YMD , /*시행일*/ DETAIL.ENFC_DEPT_CD AS ENFC_DEPT_CD , /*시행국과코드*/ DETAIL.IMPL_MNG_JRSD_DEPT_CD AS IMPL_MNG_JRSD_DEPT_CD , /*집행관리국과코드*/ (SELECT PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBDCMACM015M WHERE INST_CD = (SELECT MIN(SRECS_REL_INST_CD) AS SRECS_REL_INST_CD /* 심사재심의관계기관코드 */
FROM TB_BADEAR006M WHERE CVLCPT_ADT_YR = MASTER.CVLCPT_ADT_YR AND ADT_NO = MASTER.ADT_NO AND DSPS_RQT_SQNO = MASTER.DSPS_RQT_SQNO)) AS SRECS_REL_INST_CD , /*관계기관코드*/ (SELECT CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000002' AND CD = MASTER.DSPS_RQT_KDCD) AS DSPS_RQT_KDCD , /*처분종류코드*/ MASTER.DSPS_RQT_NM AS DISP_TIT_TXT , /*처분명*/ DETAIL.TPOF_NOPE AS TPOF_NOPE , /*인원수*/ DETAIL.PNRT_PRSRV_AMT AS PNRT_PRSRV_AMT , /*추징회수보전금액*/ (NVL(DETAIL.PNRT_PRSRV_AMT,0) + NVL(DETAIL.RMBR_AMT,0) + NVL(DETAIL.SPLP_AMT,0)) AS DISP_REQ_AM , /*환추급금액*/ CASE WHEN NVL(DETAIL.CFMTN_STTS_SECD, '0') = '1' AND (DETAIL.CFMTN_YN <> 'Y' OR DETAIL.CFMTN_YN IS NULL) THEN '미결' WHEN NVL(DETAIL.CFMTN_STTS_SECD, '0') = '1' AND NVL(DETAIL.CFMTN_YN,'N') = 'Y' THEN '완결' WHEN NVL(DETAIL.CFMTN_STTS_SECD, '0') = '2' THEN '확정' ELSE '' END AS CFMTN_STTS_SECD , /*집행상태*/ NVL(DETAIL.CFMTN_YN, '0') AS CFMTN_YN , /*확정여부*/ (SELECT CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = AUD.SPRVSN_DEPT_CD) AS EXEC_DPT_NM, /*주관부서명*/ (SELECT CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000007' AND CD = AUD.ADT_KDCD) AS AUD_EXEC_DVSN_CD_NM , /*감사종류명*/ (SELECT CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = DETAIL.ENFC_DEPT_CD) AS OPER_BURDIV_NM, /*시행국과명*/ (SELECT CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000002' AND CD = MASTER.DSPS_RQT_KDCD) AS DSP_RQ_KND_CD_NM , /*처분종류명*/ (SELECT PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBDCMACM015M WHERE INST_CD = (SELECT MIN(SRECS_REL_INST_CD) AS SRECS_REL_INST_CD /* 심사재심의관계기관코드 */
FROM TB_BADEAR008M WHERE CVLCPT_ADT_YR = MASTER.CVLCPT_ADT_YR AND ADT_NO = MASTER.ADT_NO AND DSPS_RQT_SQNO = MASTER.DSPS_RQT_SQNO)) AS COMPTAUTH_NM, /*소관청명*/ NVL(DETAIL.DSPS_RQT_ATRZ_STTS_SECD, '0') AS DSPS_RQT_ATRZ_STTS_SECD, /*처분요구결재상태코드*/ CPLT_YMD, F_ORG_INFO(REL.IMPL_MNG_INST_CD,'1') AS ENFM_MNG_ORG_NM, /*조치기관 - 2017.05.15 yyh*/ CASE WHEN DETAIL.SDIN_STTS_SECD = '3' THEN '송부' ELSE '미송부' END AS SND_STA_NM, /*송부여부 - 2017.07.05 yyh*/ CASE WHEN DETAIL.SDIN_STTS_SECD = '3' THEN DECODE(DETAIL.CFMTN_STTS_SECD, 0, '미확정', '확정') ELSE '미송부' END AS DTM_STA_NM1, /*처분상태추가 - 2018.02.23 yyh*/ (SELECT F_CODE_NM('1000774',T1.SBCN_SECD) AS SBCN_SECD /* 부의구분코드 */
FROM TB_BADDED145M T1 INNER JOIN TB_BADDED146M T2 ON T1.CVLCPT_ADT_YR = T2.CVLCPT_ADT_YR AND T1.ADT_NO = T2.ADT_NO AND T1.ADT_STP_SECD = T2.ADT_STP_SECD AND T1.APRVR_JBPS_SECD = T2.APRVR_JBPS_SECD AND T1.CVLCPT_DOC_ID = T2.CVLCPT_DOC_ID AND T1.INCDNT_SQNO = T2.INCDNT_SQNO AND T1.ADT_STP_SECD = 'A1070' AND T1.CVLCPT_ADT_YR > '2017' AND T1.APRVR_JBPS_SECD = 'A1070' WHERE T1.CVLCPT_ADT_YR = MASTER.CVLCPT_ADT_YR AND T1.ADT_NO = MASTER.ADT_NO AND T2.DSPS_RQT_SQNO = MASTER.ADT_DSPS_RQT_SQNO) AS REFER_DVSN_NM /* 부의 위임여부 - 2022.01.03 EUNOK */ FROM TB_BADEAR001M MASTER ,TB_BADEAR002D DETAIL ,TB_BADDED001M AUD ,(SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    MIN(SRECS_REL_INST_CD) AS SRECS_REL_INST_CD /* 심사재심의관계기관코드 */,
    MIN(IMPL_MNG_INST_CD) AS IMPL_MNG_INST_CD /* 집행관리기관코드 */
FROM TBBADEAR006M WHERE 1=1 GROUP BY CVLCPT_ADT_YR ,ADT_NO ,DSPS_RQT_SQNO ) REL WHERE 1=1 AND MASTER.CVLCPT_ADT_YR = DETAIL.CVLCPT_ADT_YR AND MASTER.ADT_NO = DETAIL.ADT_NO AND MASTER.DSPS_RQT_SQNO = DETAIL.DSPS_RQT_SQNO AND MASTER.CVLCPT_ADT_YR = AUD.CVLCPT_ADT_YR AND MASTER.ADT_NO = AUD.ADT_NO AND MASTER.CVLCPT_ADT_YR = REL.CVLCPT_ADT_YR(+) AND MASTER.ADT_NO = REL.ADT_NO(+) AND MASTER.DSPS_RQT_SQNO = REL.DSPS_RQT_SQNO(+) AND DETAIL.SDIN_STTS_SECD = '3' /*송부여부 - 송부*/ /*화면 감사자를 입력했을때 */ AND EXISTS (SELECT 1
FROM TB_BADEAR004M ETR WHERE 1=1 AND ETR.ADT_YR = MASTER.CVLCPT_ADT_YR AND ETR.ADT_NO = MASTER.ADT_NO AND ETR.DSPS_RQT_SQNO = MASTER.DSPS_RQT_SQNO AND EXTT_ID =#EXTT_ID# ) /*검색일자가 시행일자일때*/ AND DETAIL.ENFC_YMD BETWEEN NVL(#strEnfStDt#,'19000101') AND NVL(#strEnfEndDt#,'99991231') /*검색일자가 시행일자일때*/ AND DETAIL.IMPL_WHLS_CFMTN_YMD BETWEEN NVL(#strEnfStDt#,'19000101') AND NVL(#strEnfEndDt#,'99991231') AND MASTER.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND AUD.ADT_GRNT_NO = #ADT_GRNT_NO# /*화면의 감사사항을 입력 했을때*/ AND AUD.ADT_MTTR_NM LIKE '%'||#strSbjNm# ||'%' /*화면의 관계기관 FROM 만 입력 했을때*/ AND REL.SRECS_REL_INST_CD = #SRECS_REL_INST_CD# /*화면의 관계기관 FROM - TO를 다 입력 했을때*/ AND REL.SRECS_REL_INST_CD BETWEEN #SRECS_REL_INST_CD# AND #strRltnOrgCdEnd# /*화면의 관계기관 TO만 다 입력 했을때*/ AND REL.SRECS_REL_INST_CD BETWEEN '000000000000' AND #strRltnOrgCdEnd# AND REL.SRECS_REL_INST_CD IN #strSelectOrgCds[]# /* 제목,내용 검색 수정 - 2018.08.07 yyh */ /* 제목+키워드를 제목, 키워드로 분리함 - 2018.10.11 yyh */ AND ( 1 = 2 /* 제목 */ OR MASTER.DSPS_RQT_NM LIKE '%'||#strTitTxt#||'%' /* 키워드 검색 */ OR ( SELECT COUNT(1)
FROM TB_BADEAR037M WHERE CVLCPT_ADT_YR = MASTER.CVLCPT_ADT_YR AND ADT_NO = MASTER.ADT_NO AND DSPS_RQT_SQNO = MASTER.DSPS_RQT_SQNO AND DSPS_RQT_KYWD_CN LIKE '%'||#strTitTxt#||'%' ) > 0 /* 내용 검색 */ OR ( SELECT COUNT(1)
FROM TB_BADEAR005M WHERE CVLCPT_ADT_YR = MASTER.CVLCPT_ADT_YR AND ADT_NO = MASTER.ADT_NO AND DSPS_RQT_SQNO = MASTER.DSPS_RQT_SQNO AND ( SVW_CN LIKE '%'||#strTitTxt#||'%' OR DSPS_RQT_ACTN_MTTR_CN LIKE '%'||#strTitTxt#||'%' ) ) > 0 ) /* 감사연번종류코드 추가 - 2015.12.22 yyh */ /*감사연번종류코드 조회를 from ~ to에서 하나로 변경 */ AND SUBSTR(AUD.ADT_KDCD,3,1) = SUBSTR(#strAudYrNoKndCdSt#,3,1)