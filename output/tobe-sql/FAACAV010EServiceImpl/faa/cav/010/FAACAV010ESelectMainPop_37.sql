/* faa/cav/010/FAACAV010ESelectMainPop_37 */ SELECT CASE WHEN SUM_SE_ID='51' THEN '월계' ELSE CASE WHEN SUM_SE_ID='49' THEN '합계' ELSE SUM_SE_ID END END AS SUM_SE_ID /* 합계구분아이디 */,
    ACNTG_CD||'-'||CHIF_CD||'-'||SSEC_CD||'-'||DITM_CD||'-'||SITM_CD AS ACNTG_CD /* 계정코드 */,
    CASE WHEN length(ABS(TSMM_EXPND_LIM_AMT)) > 3 THEN TO_CHAR(substr(TSMM_EXPND_LIM_AMT, 0, length(TSMM_EXPND_LIM_AMT) -3),'FM999,999,999,999,999') ||'.'||substr(TSMM_EXPND_LIM_AMT,length(TSMM_EXPND_LIM_AMT) -2) ELSE TO_CHAR(TSMM_EXPND_LIM_AMT) END AS TSMM_EXPND_LIM_AMT /* 당월지출한도금액 */,
    CASE WHEN length(ABS(TSMM_EXPND_LIM_ACTOT_AMT)) > 3 THEN TO_CHAR(substr(TSMM_EXPND_LIM_ACTOT_AMT, 0, length(TSMM_EXPND_LIM_ACTOT_AMT) -3),'FM999,999,999,999,999') ||'.'||substr(TSMM_EXPND_LIM_ACTOT_AMT,length(TSMM_EXPND_LIM_ACTOT_AMT) -2) ELSE TO_CHAR(TSMM_EXPND_LIM_ACTOT_AMT) END AS TSMM_EXPND_LIM_ACTOT_AMT /* 당월지출한도누계금액 */,
    CASE WHEN length(ABS(TSMM_EXPND_AMT)) > 3 THEN TO_CHAR(substr(TSMM_EXPND_AMT, 0, length(TSMM_EXPND_AMT) -3),'FM999,999,999,999,999') ||'.'||substr(TSMM_EXPND_AMT,length(TSMM_EXPND_AMT) -2) ELSE TO_CHAR(TSMM_EXPND_AMT) END AS TSMM_EXPND_AMT /* 당월지출금액 */,
    CASE WHEN length(ABS(PRVMM_EXPND_ACTOT_AMT)) > 3 THEN TO_CHAR(substr(PRVMM_EXPND_ACTOT_AMT, 0, length(PRVMM_EXPND_ACTOT_AMT) -3),'FM999,999,999,999,999') ||'.'||substr(PRVMM_EXPND_ACTOT_AMT,length(PRVMM_EXPND_ACTOT_AMT) -2) ELSE TO_CHAR(PRVMM_EXPND_ACTOT_AMT) END AS PRVMM_EXPND_ACTOT_AMT /* 전월지출누계금액 */,
    CASE WHEN length(ABS(TSMM_RTN_EXPND_AMT)) > 3 THEN TO_CHAR(substr(TSMM_RTN_EXPND_AMT, 0, length(TSMM_RTN_EXPND_AMT) -3),'FM999,999,999,999,999') ||'.'||substr(TSMM_RTN_EXPND_AMT,length(TSMM_RTN_EXPND_AMT) -2) ELSE TO_CHAR(TSMM_RTN_EXPND_AMT) END AS TSMM_RTN_EXPND_AMT /* 당월반납지출금액 */,
    CASE WHEN length(ABS(TSMM_SBJCT_RCTF_EXPND_AMT)) > 3 THEN TO_CHAR(substr(TSMM_SBJCT_RCTF_EXPND_AMT, 0, length(TSMM_SBJCT_RCTF_EXPND_AMT) -3),'FM999,999,999,999,999') ||'.'||substr(TSMM_SBJCT_RCTF_EXPND_AMT,length(TSMM_SBJCT_RCTF_EXPND_AMT) -2) ELSE TO_CHAR(TSMM_SBJCT_RCTF_EXPND_AMT) END AS TSMM_SBJCT_RCTF_EXPND_AMT /* 당월과목경정지출금액 */,
    CASE WHEN length(ABS(EXPND_SBTR_ACTOT_AMT)) > 3 THEN TO_CHAR(substr(EXPND_SBTR_ACTOT_AMT, 0, length(EXPND_SBTR_ACTOT_AMT) -3),'FM999,999,999,999,999') ||'.'||substr(EXPND_SBTR_ACTOT_AMT,length(EXPND_SBTR_ACTOT_AMT) -2) ELSE TO_CHAR(EXPND_SBTR_ACTOT_AMT) END AS EXPND_SBTR_ACTOT_AMT /* 지출차감누계금액 */,
    CASE WHEN length(ABS(EXPND_LIM_BLNC)) > 3 THEN TO_CHAR(substr(EXPND_LIM_BLNC, 0, length(EXPND_LIM_BLNC) -3),'FM999,999,999,999,999') ||'.'||substr(EXPND_LIM_BLNC,length(EXPND_LIM_BLNC) -2) ELSE TO_CHAR(EXPND_LIM_BLNC) END AS EXPND_LIM_BLNC /* 지출한도잔액 */,
    F_AV_BLL_COPT_CD_NM(JRSD_CD) AS JRSD_NM /* 소관명 */,
    F_AV_ACNT_CD_NM(ACNTG_CD) AS ACNTG_CDNM /* 회계코드명 */,
    (SELECT AGGR_CONCAT (M.EAN_CD,', ')
FROM (SELECT dguard.decrypt('TB_ENC','EAN',ACTNO_SCRTY) || '-' || ACNT_SBJCT_SECD AS DECRYPT
FROM TWFAACAV062L WHERE JRSD_CD = #JRSD_CD# AND ACNTG_CD = #ACNTG_CD# AND BLL_KDCD = #BLL_KDCD# AND PROF_RBPRSN_SQNO = #PROF_RBPRSN_SQNO# AND GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# AND ACNTG_YR = SUBSTR(#PROF_YM#,0,4)) M ) AS ACNB_CD ,F_AV_ACCMN_NM(JRSD_CD,ACNTG_CD,BLL_KDCD,PROF_RBPRSN_SQNO,GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO) AS PROF_RBPRSN_INST_NM ,SUM_SE_ID ,JRSD_CD ,ACNTG_CD ,BLL_KDCD ,PROF_RBPRSN_SQNO ,GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO ,PROF_YM ,ACNT_CD, CHIF_CD,SSEC_CD,DITM_CD,SITM_CD FROM TWFAACAV048L WHERE JRSD_CD = #JRSD_CD# AND ACNTG_CD = #ACNTG_CD# AND BLL_KDCD = #BLL_KDCD# AND PROF_RBPRSN_SQNO = #PROF_RBPRSN_SQNO# AND GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = #GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO# AND PROF_YM = #PROF_YM# ORDER BY SUM_SE_ID DESC, ACNT_CD, CHIF_CD, DITM_CD, SITM_CD