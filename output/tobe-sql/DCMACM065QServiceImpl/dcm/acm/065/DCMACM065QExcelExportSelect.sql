SELECT ROW_NUMBER() OVER(ORDER BY DPT_SNO ASC) AS ROW_NUMBER,
    A.*
FROM ( SELECT T1.LINK_YR /* 연계년도 */,
    (SELECT AS DPT_SNO
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = T1.SRECS_DEPT_CD) AS DPT_SNO ,F_DPT_INFO(T1.SRECS_DEPT_CD,'1') AS CNSTN_MBCMT_DEPT_NM /* 부서 */ ,F_CODE_NM('1000173',T1.JBGD_SECD) AS JBGD_NM /* 직급 */ ,F_CODE_NM('1000176',T2.JBPS_CD) AS JBPS_NM /* 직위 */ ,(CASE WHEN (SELECT COUNT(TRGT_NOP_ENO) AS TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBDCMACM065D3 WHERE TRGT_NOP_ENO = T1.APL_CNB ) > 0 THEN 'Y' ELSE 'N' END ) AS SPRT_YN /* 전문인력여부 */ ,T1.APL_CNB /* 신청자 전산번호 */ ,T1.APL_NAM /* 신청자 명 */ ,F_CODE_NM('1000852',T1.GEN_ADMN_DVSN_CD) AS GEN_ADMN_DVSN_NM /* 직렬 */ ,TO_CHAR(NVL(T1.NTFCTN_RCPT_YMD, T1.APL_DT), 'YYYY.MM.DD') AS NTFCTN_RCPT_YMD /* 신청일 */ ,T1.RSCH_ASMT_TTL /* 제목 */ ,F_CODE_NM('1000887',T1.DTIL_SPH) AS DTIL_SPH /* 세부분야 */ ,(CASE WHEN T1.SPH = '01' THEN T1.APL_AM ELSE NULL END ) TITLE1 /* 직무 */ ,(CASE WHEN T1.SPH = '08' THEN T1.APL_AM ELSE NULL END ) TITLE8 /* 직무 (응시료)*/ ,(CASE WHEN T1.SPH = '02' THEN T1.APL_AM ELSE NULL END ) TITLE2 /* 어학(강의-50%) */ ,(CASE WHEN T1.SPH = '06' THEN T1.APL_AM ELSE NULL END ) TITLE3 /* 어학(응시료) */ ,(CASE WHEN T1.SPH = '07' THEN T1.APL_AM ELSE NULL END ) TITLE4 /* 어학(강의-100%) */ ,(CASE WHEN T1.SPH = '03' THEN T1.APL_AM ELSE NULL END ) TITLE5 /* 도서 */ ,(CASE WHEN T1.SPH = '04' THEN T1.APL_AM ELSE NULL END ) TITLE6 /* 지식 */ ,T1.APL_AM /* 신청금액 */ ,T1.SPRT_EXPT_AM /* 지급예상금액 */ ,T1.NCSY /*필요성*/ ,T1.PRSS_PLN /*진행계획*/ ,T1.DTIL1 /* 상세1 */ ,T1.DTIL2 /* 상세2 */ ,T1.DTIL3 /* 상세3 */ ,T1.DTIL4 /* 상세4 */ ,T1.DTIL5 /* 상세5 */ ,F_CODE_NM('1000166', T1.BZT_TREXP_RCIT_BNK_CD) AS BNK_NM /* 출장여비수령은행명 */ ,DGUARD.DECRYPT('TB_ENC','EAN', T1.BZT_TREXP_RCIT_EAN) AS ACTNO_SCRTY /*주석해제시 컬럼명 확인*/ /*,T1.BZT_TREXP_RCIT_EAN AS EAN 출장여비수령암호화계좌번호 */ ,TO_CHAR(T1.APV_DT, 'YYYY.MM.DD') AS APV_DT /* 결재일 (지급일) */ ,T1.PMT_AM /* 지급금액 */ ,F_CODE_NM('1000884',T1.HNDL_STEP) AS HNDL_STEP /* 처리상태 */ FROM TBDCMACM065M T1,TBDCMACM001M T2 WHERE 1=1 AND T1.APL_CNB = T2.TRGT_NOP_ENO AND T1.LINK_YR = #LINK_YR# AND T1.FRS_MDM_SQNO = #FRS_MDM_SQNO# AND T1.APL_CNB = #strCNB# AND (T1.APL_CNB = #strCnb# OR T1.HNDL_STEP >= '2') /* ALL 권한자이면 모든 '신청'된 등록 사항을 조회 */ AND T1.SRECS_DEPT_CD = #SRECS_DEPT_CD# AND T1.GEN_ADMN_DVSN_CD = #strGEN_ADMN_DVSN_CD# AND T1.HNDL_STEP = #strHNDL_STEP# AND T1.SPH = #strSPH# T1.RSCH_ASMT_TTL LIKE '%'||#strTIT_NM# ||'%' AND TO_CHAR(NVL(T1.NTFCTN_RCPT_YMD, T1.APL_DT) ,'YYYYMMDD') >= #strACP_DTS# AND TO_CHAR(NVL(T1.NTFCTN_RCPT_YMD, T1.APL_DT) ,'YYYYMMDD') ORDER BY DPT_SNO ASC, T1.APL_NAM, T1.NTFCTN_RCPT_YMD DESC, T1.APL_DT DESC, T1.SPH ASC ) A