/* faa/cav/032/FAACAV032ERSelect_3 */ WITH DETAIL_SQL AS ( SELECT A.*,
    A.COL11+A.COL12+A.COL13+A.COL14+A.COL15+A.COL16+A.COL17+A.COL18+A.COL19+A.COL19_1+A.COL20+A.COL21+A.COL22+A.COL24+A.COL28+A.COL29+A.COL30+A.COL31+A.COL32+A.COL33+A.COL34+A.COL35+A.COL41+A.COL42+A.COL51+A.COL52+A.COL53+A.COL54+A.COL55+A.COL56+A.COL57 AS COL11
FROM ( SELECT DECODE(M.ACNTG_CD, '일반', '111', '222') AS ACNTG_CD /* 회계코드 */,
    CD.ACNTG_CDNM AS ACNTG_CDNM /* 회계코드명 */,
    CD.ACNTG_CD AS ACNTG_CD /* 회계코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '11' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '12' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '13' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '14' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '15' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '16' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN (ACC.BLL_KDCD = '17' OR ACC.BLL_KDCD = '18') AND GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO ='000' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN (ACC.BLL_KDCD = '17' OR ACC.BLL_KDCD = '18') AND GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO <> '000' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '19' AND GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '19' AND GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO <> '000' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '20' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '21' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN (ACC.BLL_KDCD = '22' OR ACC.BLL_KDCD = '23' OR ACC.BLL_KDCD = '24') AND GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = '000' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN (ACC.BLL_KDCD = '22' OR ACC.BLL_KDCD = '23' OR ACC.BLL_KDCD = '24') AND GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO <> '000' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '28' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '29' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '30' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '31' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '32' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '33' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '34' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '35' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '41' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '42' OR ACC.BLL_KDCD = '43' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '51' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '52' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '53' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '54' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '55' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '56' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '57' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */
FROM TWFAACAV003M ACC, TWFAACAV024C CD, (SELECT '일반' AS ACNTG_CD /* 회계코드 */
FROM DUAL UNION ALL SELECT '특별' AS ACNTG_CD /* 회계코드 */
FROM DUAL) M WHERE ((PROF_RBPRSN_CRT_YMD BETWEEN #strYrFrom#||#strMmFrom# AND #strYrTo#||#strMmTo#) OR(PROF_RBPRSN_ABL_YMD BETWEEN #strYrFrom#||#strMmFrom# AND #strYrTo#||#strMmTo#) OR(PROF_RBPRSN_CRT_YMD #strYrTo#||#strMmTo#)) AND (CASE WHEN ACC.ACNTG_CD = '011' THEN '일반' ELSE '특별' END) = M.ACNTG_CD AND ACC.JRSD_CD = CD.ACNTG_CD AND CD.ACNTG_SECD='02' GROUP BY M.ACNTG_CD, CD.ACNTG_CDNM, CD.ACNTG_CD ) A ORDER BY GUBUN, ACNTG_CD ) SELECT GUBUN AS GUBUN,
    '111' AS SUM_ID,
    ACNTG_CDNM /* 회계코드명 */,
    ACNTG_CD /* 회계코드 */,
    COL11,
    COL12,
    COL13,
    COL14,
    COL15,
    COL16,
    COL17,
    COL18,
    COL19,
    COL19_1,
    COL20,
    COL21,
    COL22,
    COL24,
    COL28,
    COL29,
    COL30,
    COL31,
    COL32,
    COL33,
    COL34,
    COL35,
    COL41,
    COL42,
    COL51,
    COL52,
    COL53,
    COL54,
    COL55,
    COL56,
    COL57,
    TOTAL
FROM DETAIL_SQL UNION ALL SELECT GUBUN AS GUBUN,
    '222' AS SUM_ID,
    DECODE(GUBUN,'111','일반','특별') || '회계합계',
    '',
    SUM(COL11),
    SUM(COL12),
    SUM(COL13),
    SUM(COL14),
    SUM(COL15),
    SUM(COL16),
    SUM(COL17),
    SUM(COL18),
    SUM(COL19),
    SUM(COL19_1),
    SUM(COL20),
    SUM(COL21),
    SUM(COL22),
    SUM(COL24),
    SUM(COL28),
    SUM(COL29),
    SUM(COL30),
    SUM(COL31),
    SUM(COL32),
    SUM(COL33),
    SUM(COL34),
    SUM(COL35),
    SUM(COL41),
    SUM(COL42),
    SUM(COL51),
    SUM(COL52),
    SUM(COL53),
    SUM(COL54),
    SUM(COL55),
    SUM(COL56),
    SUM(COL57),
    SUM(TOTAL)
FROM DETAIL_SQL GROUP BY GUBUN UNION ALL SELECT MAX(GUBUN) AS GUBUN,
    '222' AS SUM_ID,
    '총합계',
    '',
    SUM(COL11),
    SUM(COL12),
    SUM(COL13),
    SUM(COL14),
    SUM(COL15),
    SUM(COL16),
    SUM(COL17),
    SUM(COL18),
    SUM(COL19),
    SUM(COL19_1),
    SUM(COL20),
    SUM(COL21),
    SUM(COL22),
    SUM(COL24),
    SUM(COL28),
    SUM(COL29),
    SUM(COL30),
    SUM(COL31),
    SUM(COL32),
    SUM(COL33),
    SUM(COL34),
    SUM(COL35),
    SUM(COL41),
    SUM(COL42),
    SUM(COL51),
    SUM(COL52),
    SUM(COL53),
    SUM(COL54),
    SUM(COL55),
    SUM(COL56),
    SUM(COL57),
    SUM(TOTAL)
FROM DETAIL_SQL ORDER BY GUBUN, ACNTG_CD