/* faa/cav/032/FAACAV032ERSelect_2 */ WITH DETAIL_SQL AS ( SELECT A.*,
    A.COL11+A.COL12+A.COL13+A.COL14+A.COL15+A.COL16+A.COL17+A.COL18+A.COL19+A.COL20+A.COL21+A.COL22+A.COL24+A.COL28+A.COL29+A.COL30+A.COL31+A.COL32+A.COL33+A.COL34+A.COL35+A.COL41+A.COL42+A.COL51+A.COL52+A.COL53+A.COL54+A.COL55+A.COL56+A.COL57 AS COL11
FROM ( SELECT LPAD(ACC.PROF_RBPRSN_RB_SECD,3,'0')||LPAD(ACC.PROF_RBPRSN_CPD_SECD,3,'0')||DECODE(M.ACNTG_CD,'일반','011','111') AS LPAD,
    ACC.PROF_RBPRSN_RB_SECD /* 증명책임자소관국구분코드 */,
    ACC.PROF_RBPRSN_CPD_SECD /* 증명책임자소관과구분코드 */,
    M.ACNTG_CD /* 회계코드 */,
    CD.ACNTG_CDNM /* 회계코드명 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '11' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '12' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '13' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '14' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '15' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '16' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN (ACC.BLL_KDCD = '17' OR ACC.BLL_KDCD = '18') AND ACC.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO ='000' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN (ACC.BLL_KDCD = '17' OR ACC.BLL_KDCD = '18') AND ACC.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO <> '000' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '19' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '20' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '21' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '22' OR ACC.BLL_KDCD = '23' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '24' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '28' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '29' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '30' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '31' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '32' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '33' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '34' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '35' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '41' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '42' OR ACC.BLL_KDCD = '43' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '51' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '52' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '53' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '54' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '55' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '56' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */,
    SUM(CASE WHEN ACC.BLL_KDCD = '57' THEN 1 ELSE 0 END) AS BLL_KDCD /* 계산서종류코드 */
FROM TWFAACAV003M ACC , TWFAACAV024C CD , (SELECT DISTINCT RB_CD AS RB_CD /* 소관국코드 */,
    PROF_RBPRSN_CPD_SECD AS PROF_RBPRSN_CPD_SECD /* 증명책임자소관과구분코드 */,
    (CASE WHEN ACNTG_CD = '011' THEN '일반' ELSE '특별' END) AS ACNTG_CD /* 회계코드 */
FROM TWFAACAV003M WHERE ((PROF_RBPRSN_CRT_YMD BETWEEN #strYrFrom#||#strMmFrom# AND #strYrTo#||#strMmTo#) OR(PROF_RBPRSN_ABL_YMD BETWEEN #strYrFrom#||#strMmFrom# AND #strYrTo#||#strMmTo#) OR(PROF_RBPRSN_CRT_YMD #strYrTo#||#strMmTo#))) M WHERE ACC.RB_CD= M.RB_CD AND ACC.PROF_RBPRSN_CPD_SECD= M.PROF_RBPRSN_CPD_SECD AND ((ACC.PROF_RBPRSN_CRT_YMD BETWEEN #strYrFrom#||#strMmFrom# AND #strYrTo#||#strMmTo#) OR (ACC.PROF_RBPRSN_ABL_YMD BETWEEN #strYrFrom#||#strMmFrom# AND #strYrTo#||#strMmTo#) OR (ACC.PROF_RBPRSN_CRT_YMD #strYrTo#||#strMmTo#)) AND (CASE WHEN ACC.ACNTG_CD = '011' THEN '일반' ELSE '특별' END) = M.ACNTG_CD AND ACC.JRSD_CD = CD.ACNTG_CD AND CD.ACNTG_SECD='02' GROUP BY ACC.RB_CD, ACC.PROF_RBPRSN_CPD_SECD, M.ACNTG_CD, CD.ACNTG_CDNM ) A ) SELECT GUBUN,
    RB_CD /* 소관국코드 */,
    PROF_RBPRSN_CPD_SECD /* 증명책임자소관과구분코드 */,
    ACNTG_CD /* 회계코드 */,
    '111' AS SUM_ID,
    SOCK_NM,
    COL11,
    COL12,
    COL13,
    COL14,
    COL15,
    COL16,
    COL17,
    COL18,
    COL19,
    COL20,
    COL21,
    COL22,
    COL24,
    COL28,
    COL29,
    COL30,
    COL31,
    COL32,
    COL33,
    COL34,
    COL35,
    COL41,
    COL42,
    COL51,
    COL52,
    COL53,
    COL54,
    COL55,
    COL56,
    COL57,
    TOTAL
FROM DETAIL_SQL UNION ALL SELECT GUBUN AS GUBUN,
    RB_CD /* 소관국코드 */,
    PROF_RBPRSN_CPD_SECD /* 증명책임자소관과구분코드 */,
    ACNTG_CD /* 회계코드 */,
    '222' AS SUM_ID,
    '관계 합계' AS SOCK_NM,
    SUM(COL11),
    SUM(COL12),
    SUM(COL13),
    SUM(COL14),
    SUM(COL15),
    SUM(COL16),
    SUM(COL17),
    SUM(COL18),
    SUM(COL19),
    SUM(COL20),
    SUM(COL21),
    SUM(COL22),
    SUM(COL24),
    SUM(COL28),
    SUM(COL29),
    SUM(COL30),
    SUM(COL31),
    SUM(COL32),
    SUM(COL33),
    SUM(COL34),
    SUM(COL35),
    SUM(COL41),
    SUM(COL42),
    SUM(COL51),
    SUM(COL52),
    SUM(COL53),
    SUM(COL54),
    SUM(COL55),
    SUM(COL56),
    SUM(COL57),
    SUM(TOTAL)
FROM DETAIL_SQL GROUP BY GUBUN, RB_CD, PROF_RBPRSN_CPD_SECD, ACNTG_CD UNION ALL SELECT '999999999' AS GUBUN,
    '' AS RB_CD /* 소관국코드 */,
    '' AS PROF_RBPRSN_CPD_SECD /* 증명책임자소관과구분코드 */,
    ACNTG_CD AS ACNTG_CD /* 회계코드 */,
    DECODE(ACNTG_CD,'일반','333','444') AS ACNTG_CD /* 회계코드 */,
    DECODE(ACNTG_CD,'일반','일반회계합계','특별회계합계') AS ACNTG_CD /* 회계코드 */,
    SUM(COL11),
    SUM(COL12),
    SUM(COL13),
    SUM(COL14),
    SUM(COL15),
    SUM(COL16),
    SUM(COL17),
    SUM(COL18),
    SUM(COL19),
    SUM(COL20),
    SUM(COL21),
    SUM(COL22),
    SUM(COL24),
    SUM(COL28),
    SUM(COL29),
    SUM(COL30),
    SUM(COL31),
    SUM(COL32),
    SUM(COL33),
    SUM(COL34),
    SUM(COL35),
    SUM(COL41),
    SUM(COL42),
    SUM(COL51),
    SUM(COL52),
    SUM(COL53),
    SUM(COL54),
    SUM(COL55),
    SUM(COL56),
    SUM(COL57),
    SUM(TOTAL)
FROM DETAIL_SQL GROUP BY ACNTG_CD UNION ALL SELECT '999999999' AS GUBUN,
    '' AS RB_CD /* 소관국코드 */,
    '' AS PROF_RBPRSN_CPD_SECD /* 증명책임자소관과구분코드 */,
    '' AS ACNTG_CD /* 회계코드 */,
    '555' AS SUM_ID,
    '총합계' AS SOCK_NM,
    SUM(COL11),
    SUM(COL12),
    SUM(COL13),
    SUM(COL14),
    SUM(COL15),
    SUM(COL16),
    SUM(COL17),
    SUM(COL18),
    SUM(COL19),
    SUM(COL20),
    SUM(COL21),
    SUM(COL22),
    SUM(COL24),
    SUM(COL28),
    SUM(COL29),
    SUM(COL30),
    SUM(COL31),
    SUM(COL32),
    SUM(COL33),
    SUM(COL34),
    SUM(COL35),
    SUM(COL41),
    SUM(COL42),
    SUM(COL51),
    SUM(COL52),
    SUM(COL53),
    SUM(COL54),
    SUM(COL55),
    SUM(COL56),
    SUM(COL57),
    SUM(TOTAL)
FROM DETAIL_SQL ORDER BY GUBUN, SUM_ID, SOCK_NM