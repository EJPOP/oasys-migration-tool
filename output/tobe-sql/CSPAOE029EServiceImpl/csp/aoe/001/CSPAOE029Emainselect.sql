SELECT D1.EVL_YR /* 평가년도 */,
    D1.HLYR_DVSN_CD /* 반기구분코드 */,
    D1.TASK_KDCD /* 업무종류코드 */,
    F_CODE_NM ('1000272', D1.TASK_KDCD) AS F_CODE_NM /* 업무종류명 */,
    CHR_DPT_CD /* 담당부서코드 */,
    F_DPT_INFO(D1.CHR_DPT_CD, '1') AS TKCG_DEPT_NM /* 담당부서명 */,
    D1.TSK_NO /* 업무번호 */,
    D1.TSK_NM /* 업무명 */,
    D1.JUD_PNSH_CRCT_NOC /* 판정징계시정건수 */,
    D1.IMP_RDA_NTF_NOC /* 개선권고통보건수 */,
    D1.SPCN_MNG_NOC /* 특수관리건수 */,
    D1.TSK_TXT /* 업무내용 */,
    F_CODE_NM('1000279', DECODE(D2.EVL_STEP_CD, '', '600', '600', '700', D2.EVL_STEP_CD)) AS F_CODE_NM /* 평가단계코드-현재 아무도 평가를 안했다면 평가자 단계일꺼고 평가자가 완료했다면 평가자 다음인 확인자 단계 */,
    ( SELECT DECODE(COUNT(*), 0, 'N', 'Y')
FROM TBCSPAOE029M WHERE EVL_YR = D1.EVL_YR AND HLYR_DVSN_CD = D1.HLYR_DVSN_CD AND CVLCPT_TASK_SECD = '10001' /*감사외업무*/ AND AUD_TSK_KND_CD = D1.TASK_KDCD AND NVL(EVL_STA_CD, '100') != '100' /*미평가가 아닌것*/ ) AS EVL_YN , ( SELECT DECODE(COUNT(*), 0, 'N', 'Y')
FROM TBCSPAOE029M WHERE EVL_YR = D1.EVL_YR AND HLYR_DVSN_CD = D1.HLYR_DVSN_CD AND CVLCPT_TASK_SECD = '10001' /*감사외업무*/ AND AUD_TSK_KND_CD = D1.TASK_KDCD AND EVL_DTM_YN = 'Y' /*미평가가 아닌것*/ ) AS A_EVL_DTM_YN , CASE WHEN D2.EVL_DTM_YN IS NULL THEN '미평가' WHEN D2.EVL_STEP_CD = '700' AND D2.EVL_DTM_YN = 'Y' THEN '평가완료' ELSE '평가중' END AS EVL_DTM_STA /*평가진행단계*/ FROM TBCSPAOE024M D1 , ( SELECT EVL_YR,
    HLYR_DVSN_CD,
    AUD_TSK_KND_CD,
    MAX(EVL_STEP_CD) AS EVL_STEP_CD,
    EVL_DTM_YN,
    CVLCPT_ADT_YR /* 민원감사년도 */,
    TSK_NO
FROM TBCSPAOE029M WHERE 1 = 1 AND EVL_YR || HLYR_DVSN_CD BETWEEN #strFromEvlYr# || #strFromHlyrDvsnCd# AND #strToEvlYr# || #strToHlyrDvsnCd# AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND CVLCPT_TASK_SECD = '10001' /*감사외업무*/ GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_TSK_KND_CD, EVL_DTM_YN, CVLCPT_ADT_YR, TSK_NO ) D2 , ( SELECT CD,
    CD_NM,
    OTPT_SEQ,
    CMM_CD_DVSN_CD
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000272' AND CD NOT IN ('000000000', '10000') AND USE_YN = 'Y' ) D3 /*정렬때문에 조인 2015.02.03 최원형 감사관 요청*/ WHERE 1=1 AND D1.EVL_YR = D2.EVL_YR (+) AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD (+) AND D1.TASK_KDCD = D2.AUD_TSK_KND_CD (+) AND D1.TSK_NO = D2.TSK_NO (+) AND D1.EVL_YR = D2.CVLCPT_ADT_YR (+) AND D1.TASK_KDCD = D3.CD AND CHR_DPT_CD = #DPT_CD# AND D1.EVL_YR || D1.HLYR_DVSN_CD BETWEEN #strFromEvlYr# || #strFromHlyrDvsnCd# AND #strToEvlYr# || #strToHlyrDvsnCd# AND D1.EVL_YR = #strEvlYr# AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D1.TASK_KDCD = #TASK_KDCD# AND D1.TSK_NM LIKE '%' || #strTskTxt# || '%' ORDER BY SUBSTR(D3.CD_NM, 0, 4), D3.OTPT_SEQ, TSK_KND_NM, D1.CHR_DPT_CD, D1.TSK_NO