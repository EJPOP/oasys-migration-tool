SELECT /* CSPSAE503ESelectMain */ A.TRGT_NOP_ENO AS TRGT_NOP_ENO /* 대상인원직원전산번호 */,
    D.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    C.USER_NM /* 사용자명 */,
    (SELECT AS CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000173' AND CD = C.JBGD_SECD) AS JBGD_NM , E.USR_DFN_TXT_1 , E.USR_DFN_TXT_2 , COUNT(B.FRS_MDM_SQNO) AS BOKG_RM_CNT , B.DMT_DVSN_CD , A.UE_NOP_CNT , SUBSTR(A.APL_DT, 5, 2) || '-' || SUBSTR(A.APL_DT, 7, 2) AS APL_DT , A.APL_DT AS HAPL_DT , SUBSTR(B.USE_STR_DT, 5, 2) || '-' || SUBSTR(B.USE_STR_DT, 7, 2) AS USE_DT , B.USE_STR_DT , B.USE_FEE , A.USE_YN AS COK_USE_YN , B.PD_YN , B.USE_YN , B.COFM_STA_CD , SUBSTR(F.DDL_DT, 5, 2) || '-' || SUBSTR(F.DDL_DT, 7, 2) AS DDL_DT , B.RMN_NM , B.SEAT_NM , B.BSC_SRNO , B.FRS_MDM_SQNO , SUBSTR(F.ROM_ALC_OPEN_DT, 5, 2) || '-' || SUBSTR(F.ROM_ALC_OPEN_DT, 7, 2) AS ROM_ALC_OPEN_DT , F.WEK , (SELECT CASE WHEN COUNT(*) > 0 THEN 'Y' ELSE 'N' AS 0
FROM TBCSPSAE501D T1 WHERE T1.TRGT_NOP_ENO = A.TRGT_NOP_ENO AND T1.USE_STR_DT BETWEEN TO_CHAR(TO_DATE(B.USE_STR_DT), 'YYYYMM') || '01' AND TO_CHAR(LAST_DAY(TO_DATE(B.USE_STR_DT)), 'YYYYMMDD') AND T1.COFM_STA_CD = '30') AS RES_YN , DECODE(MAX(G.LTD_STR_DT), NULL, '', SUBSTR(G.LTD_STR_DT, 5, 2) || '-' || SUBSTR(G.LTD_STR_DT, 7, 2) || ' ~ ' || SUBSTR(G.LTD_END_DT, 5, 2) || '-' || SUBSTR(G.LTD_END_DT, 7, 2) ) AS LTD_DT FROM TBCSPSAE501M A , TBCSPSAE501D B , TBDCMACM001M C , TBDCMACM002M D , (SELECT *
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000140') E , TBCSPSAE134B F , TBCSPSAE502D G WHERE B.TRGT_NOP_ENO = A.TRGT_NOP_ENO AND B.APL_DT = A.APL_DT AND B.BSC_SRNO = A.BSC_SRNO AND D.SRECS_DEPT_CD = C.SRECS_DEPT_CD AND C.TRGT_NOP_ENO = A.TRGT_NOP_ENO AND E.CD = B.DMT_DVSN_CD AND B.USE_STR_DT = TO_CHAR(TO_DATE(F.END_DDL_DT)-1,'YYYYMMDD') AND G.TRGT_NOP_ENO(+) = A.TRGT_NOP_ENO AND G.APL_DT(+) = A.APL_DT AND G.BSC_SRNO(+) = A.BSC_SRNO AND A.APL_DT BETWEEN #strFromDt# AND #strToDt# AND B.USE_STR_DT BETWEEN #strFromDt# AND #strToDt# AND C.USER_NM LIKE '%' || #strUSR_NAM# || '%' AND B.PD_YN = #strPD_YN# AND B.USE_YN = #USE_YN# AND B.COFM_STA_CD = #strCOFM_STA_CD# AND B.DMT_DVSN_CD = #strDMT_DVSN_CD# GROUP BY A.TRGT_NOP_ENO , D.CNSTN_MBCMT_DEPT_NM , C.USER_NM , C.JBGD_SECD , E.USR_DFN_TXT_1 , E.USR_DFN_TXT_2 , B.DMT_DVSN_CD , A.APL_DT , A.UE_NOP_CNT , B.USE_STR_DT , B.USE_END_DT , B.USE_FEE , A.USE_YN , B.PD_YN , B.USE_YN , B.COFM_STA_CD , F.DDL_DT , B.RMN_NM , B.SEAT_NM , B.BSC_SRNO , B.FRS_MDM_SQNO , F.ROM_ALC_OPEN_DT , F.WEK , G.LTD_STR_DT , G.LTD_END_DT , A.FRST_REG_DT ORDER BY A.FRST_REG_DT, B.USE_STR_DT, D.CNSTN_MBCMT_DEPT_NM, A.TRGT_NOP_ENO, E.USR_DFN_TXT_1, E.USR_DFN_TXT_2