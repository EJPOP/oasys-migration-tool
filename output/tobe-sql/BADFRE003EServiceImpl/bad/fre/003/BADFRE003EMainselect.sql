SELECT T.ADT_MTTR_NM /* 감사사항명 */,
    T.ADT_KDCD /* 감사종류코드 */,
    F_CODE_NM('1000007', T.ADT_KDCD) AS F_CODE_NM,
    T1.ADT_YR /* 감사년도 */,
    T1.ADT_NO /* 감사번호 */,
    T.ADT_GRNT_NO /* 감사부여번호 */,
    T1.DSPS_RQT_SQNO /* 처분요구순번 */,
    T1.DSPS_RQT_KDCD /* 처분요구종류코드 */,
    F_CODE_NM('1000002', T1.DSPS_RQT_KDCD) AS DSPS_RQT_KND_CVN /* 처분요구종류코드값명 */,
    F_MNG_KND_AUDYRNO(T1.ADT_YR, T1.ADT_NO, T.ADT_KDCD, '-') ||'-'|| T1.DSPS_RQT_SQNO AS F_MNG_KND_AUDYRNO,
    T2.ENFC_YMD /* 시행일자 */,
    T1.DSPS_RQT_NM /* 처분요구명 */,
    T2.PRCS_TERM_YMD /* 처리기한일자 */,
    ( SELECT SUM(S1.PNRT_PRSRV_AMT) AS PNRT_PRSRV_AMT /* 추징회수보전금액 */
FROM TB_BADEAR003M S1 WHERE 1 = 1 AND S1.ADT_YR = T2.ADT_YR AND S1.ADT_NO = T2.ADT_NO AND S1.DSPS_RQT_SQNO = T2.DSPS_RQT_SQNO ) AS PNRT_PRSRV_AMT, ( SELECT SUM(S1.RMBR_AMT) AS RMBR_AMT /* 환급금액 */
FROM TB_BADEAR003M S1 WHERE 1 = 1 AND S1.ADT_YR = T2.ADT_YR AND S1.ADT_NO = T2.ADT_NO AND S1.DSPS_RQT_SQNO = T2.DSPS_RQT_SQNO ) AS RMBR_AMT, T2.SPLP_AMT, T2.BGT_RTRC_AMT, T2.INCM_INCRS_AMT, T2.PPL_BRDN_RDT_AMT, T2.PRPT_INCRS_AMT, T2.EXPND_RATI_AMT, T2.IJS_AMT, T2.SELF_PRCS_RQT_AMT, T2.ATRZ_DOC_NO, T2.ATRZ_DOC_GROUP_NO, T2.CMO_INST_CD, (SELECT PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBDCMACM015M WHERE INST_CD = T2.CMO_INST_CD AND ROWNUM = 1) AS COPT_OFI_NM, T2.ENFC_DEPT_CD, (SELECT CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = T2.ENFC_DEPT_CD AND ROWNUM = 1) AS ENF_BRDV_NM, T2.IMPL_MNG_JRSD_DEPT_CD, (SELECT CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = T2.IMPL_MNG_JRSD_DEPT_CD AND ROWNUM = 1) AS ENFM_MNG_BRDV_NM, T2.DSPS_RQT_ATRZ_STTS_SECD, F_CODE_NM('1000333', T2.DSPS_RQT_ATRZ_STTS_SECD) AS DSP_RQ_APV_STA_NM, T2.CFMTN_YN, DECODE(T2.CFMTN_YN,'Y','완결','미결') AS DTM_YN_NM, T2.IMPL_WHLS_ATRZ_KDCD, F_CODE_NM('1000529', T2.IMPL_WHLS_ATRZ_KDCD) AS ENFM_WHLS_APV_KND_NM, T2.REL_INST_CD AS REP_RLTN_ORG_CD, (SELECT PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBDCMACM015M WHERE INST_CD = T2.REL_INST_CD AND ROWNUM = 1) AS REP_RLTN_ORG_NM, T3.REL_INST_CD, (SELECT PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBDCMACM015M WHERE INST_CD = T3.REL_INST_CD AND ROWNUM = 1) AS REL_INST_NM, T4.TRGT_INST_PIC_NM, T4.TRGT_INST_TELNO, DECODE(T3.CPLT_YN, 'Y', 'Y', 'N') AS CPLT_YN, DECODE(T3.CPLT_YN, 'Y', '완결', '미결') AS CPLT_YN_NM, (SELECT ST1.DSPS_RQT_ACTN_MTTR_CN /* 처분요구조치사항내용 */
FROM TB_BADEAR005M ST1 WHERE ST1.CVLCPT_ADT_YR = T2.ADT_YR AND ST1.ADT_NO = T2.ADT_NO AND ST1.DSPS_RQT_SQNO = T2.DSPS_RQT_SQNO ) AS ACTN_MTTR_CN, T2.PIC_NM, T2.IMPL_CPLT_INPT_YMD, T2.IMPL_CPLT_KBRDR_ID, (SELECT USER_NM /* 사용자명 */
FROM TBDCMACM001M WHERE TRGT_NOP_ENO = T2.IMPL_CPLT_KBRDR_ID AND ROWNUM = 1) AS ENFM_CPLT_IPT_PEN_NM, T2.CPLT_YMD, T2.CMPT_ID, F_USR_INFO(T2.CMPT_ID, '2') AS CPLT_PEN_NM, T2.IMPL_WHLS_CFMTN_YMD, T2.IMPL_WHLS_PIC_ID, F_USR_INFO(T2.IMPL_WHLS_PIC_ID, '2') AS ENFM_WHLS_DTM_PEN_NM, /* T2.APV_DOC_GRP_NO를 사용하는 부분 주석처리 - 2015.04.30 yyh NVL(( SELECT DECODE(APV_STA_CD,3,TO_CHAR(FNL_APV_DH, 'YYYYMMDD'),'') AS FNL_APV_DT FROM TBDCMACM022L WHERE APV_DOC_NO = T2.APV_DOC_GRP_NO AND ROWNUM = 1 ),( SELECT DECODE(APV_STA_CD,3,TO_CHAR(FNL_APV_DH, 'YYYYMMDD'),'') AS FNL_APV_DT FROM TBDCMACM022L WHERE APV_DOC_NO = T2.APV_DOC_NO AND ROWNUM = 1 )) AS FNL_APV_DT, NVL(( SELECT DECODE(APV_STA_CD,3,FNL_APV_CNB,'') AS FNL_APV_CNB FROM TBDCMACM022L WHERE APV_DOC_NO = T2.APV_DOC_GRP_NO AND ROWNUM = 1 ),( SELECT DECODE(APV_STA_CD,3,FNL_APV_CNB,'') AS FNL_APV_CNB FROM TBDCMACM022L WHERE APV_DOC_NO = T2.APV_DOC_NO AND ROWNUM = 1 )) AS FNL_APV_CNB, NVL(( SELECT DECODE(APV_STA_CD,3,F_USR_INFO(FNL_APV_CNB,'2'),'') AS FNL_APV_NM FROM TBDCMACM022L WHERE APV_DOC_NO = T2.APV_DOC_GRP_NO AND ROWNUM = 1 ),( SELECT DECODE(APV_STA_CD,3,F_USR_INFO(FNL_APV_CNB,'2'),'') AS FNL_APV_NM FROM TBDCMACM022L WHERE APV_DOC_NO = T2.APV_DOC_NO AND ROWNUM = 1 )) AS FNL_APV_NM, */ ( SELECT DECODE(ATRZ_STTS_SECD,3,TO_CHAR(CRU_LAST_ATRZ_DT, 'YYYYMMDD'),'') AS ATRZ_STTS_SECD /* 결재상태구분코드 */
FROM TBDCMACM022L WHERE ATRZ_DOC_NO = T2.ATRZ_DOC_NO AND ROWNUM = 1 ) AS FNL_APV_DT, ( SELECT DECODE(ATRZ_STTS_SECD,3,FNL_APV_CNB,'') AS ATRZ_STTS_SECD /* 결재상태구분코드 */
FROM TBDCMACM022L WHERE ATRZ_DOC_NO = T2.ATRZ_DOC_NO AND ROWNUM = 1 ) AS FNL_APV_CNB, ( SELECT DECODE(ATRZ_STTS_SECD,3,F_USR_INFO(FNL_APV_CNB,'2'),'') AS ATRZ_STTS_SECD /* 결재상태구분코드 */
FROM TBDCMACM022L WHERE ATRZ_DOC_NO = T2.ATRZ_DOC_NO AND ROWNUM = 1 ) AS FNL_APV_NM, ( CASE WHEN T2.CFMTN_STTS_SECD = '2' THEN '확정' WHEN T2.CFMTN_STTS_SECD = '1' AND T2.CFMTN_YN = 'Y' AND T2.DSPS_RQT_ATRZ_STTS_SECD = '3' THEN '완결(결재완료)' WHEN T2.CFMTN_STTS_SECD = '1' AND T2.CFMTN_YN = 'Y' AND T2.DSPS_RQT_ATRZ_STTS_SECD = '2' THEN '미결(결재중)' WHEN T2.CFMTN_STTS_SECD = '1' AND T2.CFMTN_YN = 'Y' AND T2.DSPS_RQT_ATRZ_STTS_SECD = '5' THEN '미결(상신취소)' WHEN T2.CFMTN_STTS_SECD = '1' AND T2.CFMTN_YN = 'Y' AND T2.DSPS_RQT_ATRZ_STTS_SECD = '4' THEN '미결(반려)' WHEN T2.CFMTN_STTS_SECD = '1' AND T2.CFMTN_YN = 'Y' AND (T2.DSPS_RQT_ATRZ_STTS_SECD = '1' OR T2.DSPS_RQT_ATRZ_STTS_SECD IS NULL) THEN '미결(미상신)' WHEN T2.CFMTN_STTS_SECD = '1' AND (T2.CFMTN_YN <> 'Y' OR T2.CFMTN_YN IS NULL) THEN '미결' ELSE '처분요구 미확정' END ) AS ENFM_STA_NM, T2.RVW_RPTP_DSPS_RQT_CN, T2.RVW_RPTP_UNEX_RTWR_CN, T2.RVW_RPTP_UNEX_RSN_RVW_CN, ( SELECT NVL(MAX(ST1.MNG_SQNO), 0) AS MNG_SQNO /* 관리순번 */
FROM TB_BADFRE011M ST1 WHERE ST1.CVLCPT_ADT_YR = T2.ADT_YR AND ST1.ADT_NO = T2.ADT_NO AND ST1.DSPS_RQT_SQNO = T2.DSPS_RQT_SQNO AND ST1.SRECS_REL_INST_CD = T2.REL_INST_CD ) AS MNG_SNO_MAX, ( SELECT DECODE(NVL(COUNT(1), 0), 0, '', '특수관리') AS 1
FROM TB_BADFRE011M ST1 WHERE ST1.CVLCPT_ADT_YR = T2.ADT_YR AND ST1.ADT_NO = T2.ADT_NO AND ST1.DSPS_RQT_SQNO = T2.DSPS_RQT_SQNO ) AS SPCN_MNG, ( SELECT DECODE(NVL(COUNT(1), 0), 0, '', DECODE(T1.DSPS_RQT_KDCD,'610','이행계획제출요구', '611','이행계획제출요구', '620','이행계획제출요구', '621','이행계획제출요구', '623','이행계획제출요구', '630','이행계획제출요구', '510','이행계획제출요구', '520','이행계획제출요구','이행독촉')) AS 1
FROM TB_BADFRE009M ST1 WHERE ST1.CVLCPT_ADT_YR = T2.ADT_YR AND ST1.ADT_NO = T2.ADT_NO AND ST1.DSPS_RQT_SQNO = T2.DSPS_RQT_SQNO ) AS PRSU_CNT, ( SELECT DECODE(NVL(COUNT(1), 0), 0, '', '재심의') AS 1
FROM TB_BADFRE012M ST1 WHERE ST1.CVLCPT_ADT_YR = T2.ADT_YR AND ST1.ADT_NO = T2.ADT_NO AND ST1.DSPS_RQT_SQNO = T2.DSPS_RQT_SQNO ) AS JESIM_CNT, ( SELECT DECODE(NVL(COUNT(1), 0), 0, '', '감사자보기') AS 1
FROM TB_BADEAR004M ST1 WHERE ST1.CVLCPT_ADT_YR = T2.ADT_YR AND ST1.ADT_NO = T2.ADT_NO AND ST1.DSPS_RQT_SQNO = T2.DSPS_RQT_SQNO ) AS GAMSAP_CNT, NVL(T2.HRK_MNG_DSGN_YN, 'N') AS HRK_MNG_DSGN_YN, T2.HRK_MNG_DSGN_RSN_CN /* 확정관련 추가 - 2016.05.17 yyh */ ,T2.CFMTN_ATRZ_STTS_SECD /* 확정결재상태코드 */ ,T2.CFMTN_ATRZ_STTS_YMD /* 확정결재상태일 */ ,T2.CFMTN_ATRZ_DOC_NO /* 확정결재문서번호 */ ,T2.CFMTN_RJCT_RSN_CN /* 확정반려사유 */ ,T2.PND_CPLT_STTS_SECD /* 미결상태구분코드 */ ,T2.CPLT_STTS_SECD /* 완결상태구분코드 */ /* 확정검토 결재상신정보 추가 - 2016.05.24 yyh */ ,(SELECT TO_CHAR(APV_DH, 'YYYYMMDD')
FROM TBDCMACM023L WHERE ATRZ_DOC_NO = T2.CFMTN_ATRZ_DOC_NO AND APV_SNO = 1 AND ROWNUM = 1) AS DTM_FRT_APV_DT ,(SELECT F_USR_INFO(APRVR_ENO,'2') AS APRVR_ENO /* 결재자직원전산번호 */
FROM TBDCMACM023L WHERE ATRZ_DOC_NO = T2.CFMTN_ATRZ_DOC_NO AND APV_SNO = 1 AND ROWNUM = 1) AS DTM_FRT_APV_NM ,T2.BFR_IMPL_MNG_DEPT_CD AS BFR_IMPL_MNG_DEPT_CD /* 2017.01.31 yyh */ ,F_DPT_INFO(T2.BFR_IMPL_MNG_DEPT_CD,'1') AS OD_ENFM_MNG_BRDV_NM ,NVL(T2.MAIN_IMPLT_MNG_TRGT_YN, 'N') AS MAIN_IMPLT_MNG_TRGT_YN ,CASE WHEN T2.MAIN_IMPLT_MNG_TRGT_YN = 'Y' THEN '주요이행관리대상' ELSE '' END AS MAIN_ENFM_MNG_TG_YN_NM ,T3.IMPL_MNG_INST_CD AS IMPL_MNG_INST_CD /* 이행관리기관 추가 - 2017.02.15 yyh */ ,(SELECT PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBDCMACM015M WHERE INST_CD = T3.IMPL_MNG_INST_CD) AS ENFM_MNG_ORG_NM ,(SELECT Z2.CVLCPT_DOC_ID /* 문서아이디 */
FROM TB_BADEAR001M Z1 INNER JOIN TB_BADDED103M Z2 ON Z1.CVLCPT_ADT_YR = Z2.CVLCPT_ADT_YR AND Z1.ADT_NO = Z2.ADT_NO AND TO_CHAR(Z1.ADT_DSPS_RQT_SQNO) = Z2.TPOF_RFRNC_ID WHERE Z1.CVLCPT_ADT_YR = T1.ADT_YR AND Z1.ADT_NO = T1.ADT_NO AND Z1.DSPS_RQT_SQNO = T1.DSPS_RQT_SQNO AND Z2.ADT_STP_SECD = 'A1080' AND Z2.SLCT_RPTP_KDCD = 'A10800500') AS ELCT_AUD_OPEN_DOC_ID /* 전자감사 공개문 DOC_ID 추가 - 2017.07.04 EUNOK */ ,(SELECT CVLCPT_DOC_ID /* 민원문서아이디 */
FROM TB_BADDED103M Z3 WHERE 1=1 AND T1.ADT_YR = Z3.CVLCPT_ADT_YR AND T1.ADT_NO = Z3.ADT_NO AND T2.DSPS_RQT_SQNO = Z3.TPOF_RFRNC_ID AND ADT_STP_SECD = 'A1090' AND SLCT_RPTP_KDCD = 'A10900400' AND FRST_REG_DT = ( SELECT MAX(FRST_REG_DT) AS FRST_REG_DT /* 최초등록일시 */
FROM TB_BADDED103M WHERE CVLCPT_ADT_YR = Z3.CVLCPT_ADT_YR AND ADT_NO = Z3.ADT_NO AND TPOF_RFRNC_ID = Z3.TPOF_RFRNC_ID AND ADT_STP_SECD = 'A1090' AND SLCT_RPTP_KDCD = 'A10900400' ) ) AS CVLCPT_DOC_ID ,(SELECT F_OPEN_EDIT(SRECS_LNKG_URL_ADDR) AS F_OPEN_EDIT
FROM TB_BADDED103M Z3 WHERE 1=1 AND T1.ADT_YR = Z3.CVLCPT_ADT_YR AND T1.ADT_NO = Z3.ADT_NO AND T2.DSPS_RQT_SQNO = Z3.TPOF_RFRNC_ID AND ADT_STP_SECD = 'A1090' AND SLCT_RPTP_KDCD = 'A10900400' AND FRST_REG_DT = ( SELECT MAX(FRST_REG_DT) AS FRST_REG_DT /* 최초등록일시 */
FROM TB_BADDED103M WHERE CVLCPT_ADT_YR = Z3.CVLCPT_ADT_YR AND ADT_NO = Z3.ADT_NO AND TPOF_RFRNC_ID = Z3.TPOF_RFRNC_ID AND ADT_STP_SECD = 'A1090' AND SLCT_RPTP_KDCD = 'A10900400' ) ) AS DOC_TYPE FROM TB_BADDED001M T, TB_BADEAR001M T1, TB_BADEAR002D T2, TB_BADEAR006M T3, TB_BADFRE001M T4 WHERE 1 = 1 AND T.ADT_YR = T1.ADT_YR AND T.ADT_NO = T1.ADT_NO AND T1.ADT_YR = T2.ADT_YR AND T1.ADT_NO = T2.ADT_NO AND T1.DSPS_RQT_SQNO = T2.DSPS_RQT_SQNO AND T2.ADT_YR = T3.ADT_YR(+) AND T2.ADT_NO = T3.ADT_NO(+) AND T2.DSPS_RQT_SQNO = T3.DSPS_RQT_SQNO(+) AND T3.ADT_YR = T4.ADT_YR(+) AND T3.ADT_NO = T4.ADT_NO(+) AND T3.DSPS_RQT_SQNO = T4.DSPS_RQT_SQNO(+) AND T3.REL_INST_CD = T4.REL_INST_CD(+) AND T1.ADT_YR = #CVLCPT_ADT_YR# AND T1.ADT_NO = #ADT_NO# AND T2.DSPS_RQT_SQNO = #DSPS_RQT_SQNO# ORDER BY T2.ADT_YR, T1.ADT_NO, T2.DSPS_RQT_SQNO, T3.REL_INST_CD