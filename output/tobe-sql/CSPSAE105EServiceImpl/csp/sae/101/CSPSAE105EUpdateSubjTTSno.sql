UPDATE TBCSPSAE202D D2 SET D2.ASG_SNO = ( SELECT ORD
FROM ( SELECT D1.LINK_YR /* 연계년도 */,
    D1.CRS_CD,
    D1.CRS_CDN /* 과정기수 */,
    D1.SUBJ_CD,
    D1.ASG_SNO,
    D1.HUC_TXT,
    D1.LCT_DT,
    RANK () OVER (PARTITION BY D1.LINK_YR, D1.CRS_CD, D1.CRS_CDN, D1.SUBJ_CD ORDER BY D1.HUC_TXT, D1.LCT_DT) AS RANK
FROM TBCSPSAE202D D1 WHERE D1.LINK_YR = #LINK_YR# AND D1.CRS_CD = #CRS_CD# AND D1.CRS_CDN = #CRS_CDN# AND D1.SUBJ_CD = #SUBJ_CD# ) D3 WHERE D3.LINK_YR = D2.LINK_YR AND D3.CRS_CD = D2.CRS_CD AND D3.CRS_CDN = D2.CRS_CDN AND D3.SUBJ_CD = D2.SUBJ_CD AND D3.LCT_DT = D2.LCT_DT AND D3.HUC_TXT = D2.HUC_TXT ) WHERE D2.LINK_YR = #LINK_YR# AND D2.CRS_CD = #CRS_CD# AND D2.CRS_CDN = #CRS_CDN# AND D2.SUBJ_CD = #SUBJ_CD#