select AA.LINK_YR /* 연계년도 */,
    AA.CRS_CD,
    AA.CRS_CDN /* 과정기수 */,
    AA.SUBJ_SNO,
    AA.SUBJ_CD,
    AA.BLL_SBJCT_NM /* 계산서과목명 */,
    AA.LCT_TM_HM,
    AA.JON_TM_HM,
    AA.ETC_TM_HM,
    AA.TOT_TM_HM,
    AA.PFSR_ID,
    AA.INFO_RLPR_NM /* 정보관계자명 */,
    AA.PFSR_DVSN_CD,
    AA.PFSR_RK_CD,
    AA.SUBJ_YN,
    AA.#N/A /* 문서아이디2 */,
    AA.KEYW1_TXT,
    AA.KEYW2_TXT,
    AA.KEYW3_TXT,
    BB.ENAIS_ATCH_FILE_NM /* ENAIS첨부파일명 */
from( SELECT B.LINK_YR /* 연계년도 */,
    B.CRS_CD,
    B.CRS_CDN /* 과정기수 */,
    B.SUBJ_SNO,
    B.SUBJ_CD,
    A.BLL_SBJCT_NM /* 계산서과목명 */,
    B.LCT_TM_HM,
    B.JON_TM_HM,
    B.ETC_TM_HM,
    SUM(B.LCT_TM_HM + B.JON_TM_HM + B.ETC_TM_HM) AS LCT_TM_HM,
    B.PFSR_ID,
    D.INFO_RLPR_NM /* 정보관계자명 */,
    D.PFSR_DVSN_CD,
    D.PFSR_RK_CD,
    B.SUBJ_YN,
    B.#N/A /* 문서아이디2 */,
    B.KEYW1_TXT,
    B.KEYW2_TXT,
    B.KEYW3_TXT
FROM TBCSPSAE101M A , TBCSPSAE101D B , TBCSPSAE109M D WHERE A.SUBJ_CD = B.SUBJ_CD AND D.PFSR_ID(+) = B.PFSR_ID AND A.USE_YN = 'Y' AND B.SUBJ_YN = 'Y' AND B.LINK_YR = #LINK_YR# AND B.CRS_CD = #strEDU_CRS_CD# AND B.CRS_CDN = #CRS_CDN# GROUP BY B.LINK_YR , B.CRS_CD , B.CRS_CDN , B.SUBJ_SNO , B.SUBJ_CD , A.BLL_SBJCT_NM , B.LCT_TM_HM , B.JON_TM_HM , B.ETC_TM_HM , B.PFSR_ID , D.INFO_RLPR_NM , D.PFSR_DVSN_CD , D.PFSR_RK_CD , B.SUBJ_YN, B.#N/A, B.KEYW1_TXT, B.KEYW2_TXT, B.KEYW3_TXT ORDER BY TO_NUMBER(B.SUBJ_SNO) ) AA , ECM_FILE_LIST_VIEW2 BB where 1=1 and AA.#N/A = BB.CVLCPT_DOC_ID(+)