SELECT D2.EVL_YR /* 평가년도 */,
    D2.HLYR_DVSN_CD /* 반기구분코드 */,
    D2.EVL_GP_CD /* 평가군코드 */,
    D2.EVL_STA_CD /* 평가상태코드 */,
    D2.BLT_DPT_CD /* 소속부서코드 */,
    D2.JBGD_SECD /* 직급구분코드 */,
    D2.NEVLT_CNB /* 전산번호 */,
    F_USR_INFO(D2.NEVLT_CNB, '2') AS INFO_RLPR_NM /* 정보관계자명 */,
    TO_CHAR(NVL(ROUND(D2.TSK_ASC, 2), 0), 'FM999.00') AS TO_CHAR /* 실적평가 */,
    TO_CHAR(ROUND(NVL(D1.MNSD_EVL_SC, 0), 2), 'FM999.00') AS TO_CHAR /* 다면평가 */,
    TO_CHAR(NVL(ROUND(((NVL(D2.TSK_ASC, 0)*(D3.ACMP_EVL_ASC_RT/D3.ACMP_EVL_ASC_RT+D3.MNSD_EVL_ASC_RT)) + (NVL(D1.MNSD_EVL_SC, 0)*(D3.MNSD_EVL_ASC_RT/D3.ACMP_EVL_ASC_RT+D3.MNSD_EVL_ASC_RT))), 2), 0), 'FM999.00') AS TO_CHAR /* 개인평점 = 실적평가*(실적평점비율/실적평점비율+다면평점비율) + 다면평가*(다면평점비율/실적평점비율+다면평점비율) */
FROM ( SELECT D1.EVL_YR,
    D1.HLYR_DVSN_CD,
    D1.NEVLT_CNB,
    D1.BLT_DPT_CD,
    D1.JBGD_SECD /* 직급구분코드 */,
    D1.EVL_CMTR_DVSN_CD,
    D1.EVL_STA_CD,
    SUM(D1.TSK_ASC)/D1.EVLT_CNT AS TSK_ASC
FROM ( SELECT D1.EVL_YR,
    D1.HLYR_DVSN_CD,
    D1.NEVLT_CNB,
    D3.BLT_DPT_CD,
    D3.JBGD_SECD /* 직급구분코드 */,
    D1.EVL_CMTR_CNB,
    D1.EVL_CMTR_DVSN_CD,
    SUM(D1.TSK_ASC) AS TSK_ASC,
    D2.CNT,
    D1.EVL_STA_CD
FROM TBCSPAOE032M D1 , (SELECT EVL_YR,
    HLYR_DVSN_CD,
    EVL_GP_CD,
    COUNT(EVLT_CNB) AS EVLT_CNB
FROM TBCSPAOE019D GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_GP_CD ) D2 , TBCSPAOE020D D3 WHERE D1.EVL_YR = D2.EVL_YR AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD AND D1.EVL_CMTR_DVSN_CD = D2.EVL_GP_CD AND D1.EVL_YR = D3.EVL_YR AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD AND D1.EVL_CMTR_DVSN_CD = D3.EVL_GP_CD AND D1.NEVLT_CNB = D3.NEVLT_CNB AND D2.EVL_YR = D3.EVL_YR AND D2.HLYR_DVSN_CD = D3.HLYR_DVSN_CD AND D2.EVL_GP_CD = D3.EVL_GP_CD GROUP BY D1.EVL_YR , D1.HLYR_DVSN_CD , D1.NEVLT_CNB , D3.BLT_DPT_CD , D3.JBGD_SECD , D1.EVL_CMTR_CNB , D1.EVL_CMTR_DVSN_CD , D2.CNT , D1.EVL_STA_CD ) D1 GROUP BY D1.EVL_YR , D1.HLYR_DVSN_CD , D1.NEVLT_CNB , D1.BLT_DPT_CD , D1.JBGD_SECD , D1.EVL_CMTR_DVSN_CD , D1.EVL_STA_CD , D1.EVLT_CNT ) D2 , TBCSPAOE037M D3 LEFT JOIN TBCSPAOE038M D1 ON D1.EVL_YR = D3.EVL_YR AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD WHERE 1=1 AND D2.EVL_YR = D1.EVL_YR (+) AND D2.HLYR_DVSN_CD = D1.HLYR_DVSN_CD (+) AND D2.EVL_GP_CD = D1.EVL_GP_CD (+) AND D2.NEVLT_CNB = D1.NEVLT_CNB (+) AND D2.EVL_YR = #strEvlYr# AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D2.EVL_GP_CD = #strEvlGpCd#