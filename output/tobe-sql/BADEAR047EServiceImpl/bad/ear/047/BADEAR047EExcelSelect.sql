SELECT D1.TASK_SECD /* 업무구분코드 */,
    D1.TASK_SQNO /* 업무순번 */,
    D1.REG_YMD /* 등록일자 */,
    D1.REG_HMS /* 등록시분초 */,
    D1.PRCS_DEPT_CD /* 처리부서코드 */,
    F_DPT_INFO(D1.PRCS_DEPT_CD, '1') AS PRCS_DEPT_NM /* 처리부서명 */,
    D1.ADT_BGNG_YMD /* 감사시작일자 */,
    D1.ADT_END_YMD /* 감사종료일자 */,
    D1.ADT_MTTR_NM /* 감사사항명 */,
    D1.ADT_MTTR_CN /* 감사사항내용 */,
    D1.SRCH_NOCS /* 검색건수 */,
    D1.#N/A /* 문서아이디1 */,
    D1.#N/A /* 문서아이디2 */,
    D1.RLS_YN /* 공개여부 */,
    D1.ADT_SQNO /* 감사순번 */,
    SUBSTR(D1.ADT_SQNO, 0, 4) AS SUBSTR,
    SUBSTR(D1.ADT_SQNO, 5, 3) AS SUBSTR,
    SUBSTR(D1.ADT_FLD_SECD, 0, 3)||'0' AS SUBSTR,
    D1.ADT_FLD_SECD /* 감사분야구분코드 */,
    F_CODE_NM('1000660', D1.ADT_FLD_SECD) AS ADT_FLD_NM /* 감사분야명 */,
    D1.REL_INST_CD /* 관계기관코드 */,
    F_ORG_INFO(D1.REL_INST_CD, '1') AS F_ORG_INFO,
    D1.EML_TRSM_YN /* 이메일전송여부 */,
    (SELECT S1.ENAIS_ATCH_FILE_NM AS ENAIS_ATCH_FILE_NM /* ENAIS첨부파일명 */
FROM ECM_FILE_LIST_VIEW2 S1 WHERE S1.CVLCPT_DOC_ID = D1.#N/A AND ROWNUM = 1 ) AS DOC_1_FILE_NAME /*전문 첨부파일*/ ,(SELECT S2.ENAIS_ATCH_FILE_NM /* ENAIS첨부파일명 */
FROM ECM_FILE_LIST_VIEW2 S2 WHERE S2.CVLCPT_DOC_ID = D1.#N/A AND ROWNUM = 1 ) AS DOC_2_FILE_NAME /*보도자료첨부파일*/ ,(SELECT CASE WHEN S1.ADT_YR >= '2016' THEN S1.ADT_KDCD ELSE '' END AS ADT_YR /* 감사년도 */
FROM TB_BADDED001M S1 WHERE S1.CVLCPT_ADT_YR = SUBSTR(D1.ADT_SQNO, 0, 4) AND S1.ADT_NO = SUBSTR(D1.ADT_SQNO, 5, 3)) AS AUD_YR_NO_KND_CD ,CASE WHEN SUBSTR(D1.ADT_SQNO, 0, 4) >= '2016' THEN F_CODE_NM('1000739',(SELECT CASE WHEN S1.ADT_YR >= '2016' THEN S1.ADT_KDCD ELSE '' END AS ADT_YR /* 감사년도 */
FROM TB_BADDED001M S1 WHERE S1.CVLCPT_ADT_YR = SUBSTR(D1.ADT_SQNO, 0, 4) AND S1.ADT_NO = SUBSTR(D1.ADT_SQNO, 5, 3))) ELSE '' END AS AUD_YR_NO_KND_NM ,(SELECT ADT_GRNT_NO /* 감사부여번호 */
FROM TB_BADDED001M S1 WHERE S1.CVLCPT_ADT_YR = SUBSTR(D1.ADT_SQNO, 0, 4) AND S1.ADT_NO = SUBSTR(D1.ADT_SQNO, 5, 3)) AS ADT_GRNT_NO ,NVL(D1.PBRL_SBMSN_YN,'N') AS PBRL_SBMSN_YN ,TO_CHAR(TO_DATE(D1.PBRL_SBMSN_YMD),'YYYY-MM-DD') AS PBRL_SBMSN_YMD ,D1.RLS_CYCL ,(SELECT TO_CHAR(TO_DATE(MAX(ENFC_YMD)),'YYYY-MM-DD') AS ENFC_YMD /* 시행일자 */
FROM TB_BADEAR002D S1 WHERE S1.CVLCPT_ADT_YR = D2.ADT_YR AND S1.ADT_NO = D2.ADT_NO) AS ENFC_YMD ,TO_CHAR(TO_DATE(D1.PBRL_SBMSN_YMD),'YYYY-MM-DD') AS PBRL_SBMSN_YMD , CASE WHEN D1.REG_YMD IS NOT NULL THEN TO_DATE(D1.REG_YMD) - (SELECT TO_DATE(MAX(ENFC_YMD)) AS ENFC_YMD /* 시행일자 */
FROM TB_BADEAR002D S1 WHERE S1.CVLCPT_ADT_YR = D2.ADT_YR AND S1.ADT_NO = D2.ADT_NO) ELSE TO_DATE(SYSDATE) - (SELECT TO_DATE(MAX(ENFC_YMD)) AS ENFC_YMD /* 시행일자 */
FROM TB_BADEAR002D S1 WHERE S1.CVLCPT_ADT_YR = D2.ADT_YR AND S1.ADT_NO = D2.ADT_NO) END AS DAY_CNT /*시행일 이후 경과일수*/ ,F_MNG_KND_AUDYRNO(D2.ADT_YR, D2.ADT_NO, D2.ADT_KDCD, '-') AS ADT_CLSF_NO ,DECODE(D1.RLS_CYCL,NULL,NULL,'홈페이지 공개문 '||D1.RLS_CYCL||'차') AS DGE_NM ,D1.WRTR_ENO ,F_USR_INFO(D1.WRTR_ENO, '2') AS WRTR_NM ,NVL(D1.UDC_YN,'N') AS UDC_YN , CASE WHEN D1.RLS_YN = 'Y' AND (D1.UDC_YN = 'N' OR D1.UDC_YN IS NULL) THEN '홈페이지공개' WHEN D1.RLS_YN = 'Y' AND D1.UDC_YN = 'Y' THEN '미공개종결' WHEN D1.PRGRS_STTS_SECD = '99' THEN '홍보등록' ELSE '제출완료' END AS OPEN_NM ,D1.RMRK_CN FROM TB_BADEAR028M D1 ,TB_BADDED001M D2 WHERE 1=1 AND D1.TASK_SECD = 'KP1' AND D2.ADT_YR = SUBSTR(D1.ADT_SQNO, 0, 4) AND D2.ADT_NO = SUBSTR(D1.ADT_SQNO, 5, 3) AND D1.PBRL_SBMSN_YN = 'Y' AND ((TO_CHAR(TO_DATE(D1.REG_YMD, 'YYYYMMDD'), 'YYYYMMDD') BETWEEN #STARTDT# AND #ENDDT#) OR (D1.PBRL_SBMSN_YMD BETWEEN #STARTDT# AND #ENDDT#)) AND D1.ADT_FLD_SECD = #ADT_FLD_SECD# AND D1.PRCS_DEPT_CD = #ETC_LBSVC_MNG_DEPT_CD# AND D1.REL_INST_CD = #REL_INST_CD# AND D1.RLS_YN = #RLS_YN# AND D1.RLS_CYCL IS NULL AND D1.RLS_CYCL IS NOT NULL AND D1.ADT_MTTR_NM LIKE '%'||#SEARCHVALUE#||'%' OR D1.ADT_MTTR_CN LIKE '%'||#SEARCHVALUE#||'%' AND D1.ADT_MTTR_NM LIKE '%'||#SEARCHVALUE#||'%' AND D1.ADT_MTTR_CN LIKE '%'||#SEARCHVALUE#||'%' ORDER BY D1.TASK_SQNO DESC