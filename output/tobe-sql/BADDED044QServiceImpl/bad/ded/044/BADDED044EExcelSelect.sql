SELECT F_MNG_KND_AUDYRNO(A.CVLCPT_ADT_YR, A.ADT_NO, A.ADT_KDCD, '-') AS ADT_CLSF_NO /* 감사분류번호 */,
    F_CODE_NM_YEAR('1000007', A.ADT_KDCD, A.CVLCPT_ADT_YR) AS F_CODE_NM_YEAR /* 감사종류 */,
    F_CODE_NM('1000751', A.BZTRP_BGT_SECD) AS F_CODE_NM /* 예산구분명 추가 - 2019.11.12 les */,
    F_DPT_INFO(A.SPRVSN_DEPT_CD,'1') AS F_DPT_INFO /* 주관국과명 */,
    F_DPT_INFO(A.MNG_DEPT_CD, '1') AS F_DPT_INFO /* 관리부서명 */,
    A.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    F_ORG_INFO(A.ADT_RPRS_INST_CD,'1') AS F_ORG_INFO /* 대표기관 */,
    F_CODE_NM('1000119', A.INST_SECD) AS F_CODE_NM /* 기관구분 */,
    CASE WHEN A.ADT_SCL_SECD = '6' THEN '기타' ELSE F_CODE_NM('1000027', A.ADT_SCL_SECD) END AS ADT_SCL_SECD /* 감사규모구분코드 */,
    F_CODE_NM_YEAR('1000005', A.EMPHS_ASMT_SECD, A.CVLCPT_ADT_YR) AS F_CODE_NM_YEAR /* 감사중점 */,
    F_CODE_NM('1000120', A.TASK_SECD) || '(' || A.TASK_SECD || ')' AS F_CODE_NM /* 업무분류 */,
    F_USR_INFO(A.ADT_RBPRSN_ENO,'2') || '(' || F_CODE_NM('1000173', A.WHOL_RBPRSN_JBGD_SECD) || ')' AS F_USR_INFO /* 감사책임자 */,
    F_USR_INFO(A.SPVR_ENO,'2') || '(' || F_CODE_NM('1000173', A.SPVR_JBGD_SECD) || ')' AS F_USR_INFO /* 주관자 */,
    F_USR_INFO(A.ASTN_ENO,'2') || '(' || F_CODE_NM('1000173', A.ASTN_JBGD_SECD) || ')' AS F_USR_INFO /* 보조자 */,
    B.ADT_STP_SQNO || '(' || F_CODE_NM('1000030', B.ADT_BZTRP_KDCD) || ')' AS CVLCPT_ADT_STP_SQNO /* 민원감사단계순번 */,
    B.ADT_BGNG_YMD AS ADT_BGNG_YMD /* 감사시작일자 */,
    B.ADT_END_YMD AS ADT_END_YMD /* 감사종료일자 */,
    B.ADT_DCN AS ADT_DCN /* 감사일수 */,
    ATMA2.IN_PSON_CNT AS IN_PSON_CNT /* 내부인원 */,
    ATMA.IN_PSON_DAYS AS IN_PSON_DAYS /* 내부연인원 */,
    ATMA2.EXT_PSON_CNT AS EXT_PSON_CNT /* 외부인원 */,
    ATMA.EXT_PSON_DAYS AS EXT_PSON_DAYS /* 외부연인원 */,
    F_ORG_CNT_NM_AUD(B.BZTRP_YR,B.BZTRP_SQNO,'BZT') AS F_ORG_CNT_NM_AUD /* 대상기관 */,
    B.BZTRP_YR AS BZTRP_YR /* 출장년도 */,
    B.BZTRP_SQNO AS BZTRP_SQNO /* 출장순번 */
FROM TB_BADDED001M A , TB_BADDED002M B ,(SELECT MEM.BZTRP_YR /* 출장년도 */,
    MEM.BZTRP_SQNO /* 출장순번 */,
    SUM(CASE WHEN MEM.EMP_SECD = '0' THEN APTD.ADT_DCN ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    SUM(CASE WHEN MEM.EMP_SECD = '0' THEN 0 ELSE APTD.ADT_DCN END) AS EMP_SECD /* 직원구분코드 */
FROM TBBADDED005L MEM ,(SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    FT_SQNO /* 출장조순번 */,
    BZTRVR_ALTMNT_SQNO /* 출장자배정순번 */,
    SUM(NVL(ADT_DCN,0)) AS ADT_DCN /* 감사일수 */
FROM TBBADDED006L GROUP BY BZTRP_YR, BZTRP_SQNO, FT_SQNO, BZTRVR_ALTMNT_SQNO) APTD WHERE 1=1 AND MEM.BZTRP_YR = APTD.BZTRP_YR AND MEM.BZTRP_SQNO =APTD.BZTRP_SQNO AND MEM.FT_SQNO = APTD.FT_SQNO AND MEM.BZTRVR_ALTMNT_SQNO = APTD.BZTRVR_ALTMNT_SQNO GROUP BY MEM.BZTRP_YR ,MEM.BZTRP_SQNO) ATMA , (SELECT DISTINCT MEM.BZTRP_YR AS BZTRP_YR /* 출장년도 */,
    MEM.BZTRP_SQNO /* 출장순번 */,
    SUM(CASE WHEN MEM.EMP_SECD = '0' THEN 1 ELSE 0 END) AS EMP_SECD /* 직원구분코드 */,
    SUM(CASE WHEN MEM.EMP_SECD = '0' THEN 0 ELSE 1 END) AS EMP_SECD /* 직원구분코드 */
FROM (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    EMP_SECD /* 직원구분코드 */
FROM TBBADDED005L GROUP BY BZTRP_YR ,BZTRP_SQNO ,BZTRVR_ENO ,EMP_SECD) MEM GROUP BY MEM.BZTRP_YR, MEM.BZTRP_SQNO) ATMA2 WHERE 1=1 AND A.CVLCPT_ADT_YR = B.REL_ADT_YR(+) AND A.ADT_NO = B.REL_ADT_NO(+) AND B.BZTRP_SECD = '1' AND B.BZTRP_YR = ATMA.BZTRP_YR(+) AND B.BZTRP_SQNO = ATMA.BZTRP_SQNO(+) AND B.BZTRP_YR = ATMA2.BZTRP_YR(+) AND B.BZTRP_SQNO = ATMA2.BZTRP_SQNO(+) /* 속도개선으로 변경 - 2016.01.07 yyh */ AND A.CVLCPT_ADT_YR BETWEEN #strAudYrSt# AND #strAudYrEnd# AND A.CVLCPT_ADT_YR||A.ADT_GRNT_NO >= #strAudYrSt#||DECODE(#strAudGrnNoSt#,'','0000', LPAD(#strAudGrnNoSt#,4,'0')) AND A.CVLCPT_ADT_YR||A.ADT_GRNT_NO /* 감사연번종류코드 추가 - 2015.12.22 yyh */ AND SUBSTR(A.ADT_KDCD,3,1) = SUBSTR(#strAudYrNoKndCdSt#,3,1) /* 감찰담당관실은 조회시 제외하며, 로그인 한 담당자가 감찰담당관일때만 포함하여 모두 보임 - 2016.01.04 yyh */ AND A.SPRVSN_DEPT_CD != '100100' AND A.SPRVSN_DEPT_CD >= #strDptStCd# AND A.SPRVSN_DEPT_CD AND A.MNG_DEPT_CD >= #strMngDptStCd# AND A.MNG_DEPT_CD AND A.ADT_MTTR_NM LIKE '%'||#strSbjNm#||'%' AND A.ADT_RBPRSN_ENO = #ADT_RBPRSN_ENO# /*출장책임자*/ AND (A.CVLCPT_ADT_YR, A.ADT_NO) IN (SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */
FROM TB_BADDED031L WHERE ADTR_SECD = '1' AND TRGT_NOP_ENO = #TRGT_NOP_ENO#) /*감사주관자 - 2018.05.03 yyh*/ SUBSTR(A.ADT_KDCD,3) IN #strAudTypeCd[]# A.INST_SECD IN #strOrgDvsnCd[]# AND EXISTS ( SELECT 1
FROM TB_BADDED008L T1 ,TBDCMACM015M T2 WHERE 1=1 AND T1.BZTRP_YR = B.BZTRP_YR AND T1.BZTRP_SQNO = B.BZTRP_SQNO AND T1.INST_CD = T2.INST_CD T2.INST_SECD IN #strOrgDvsnCd[]# ) AND (B.BZTRP_YR, B.BZTRP_SQNO) IN (SELECT TRIPSITU.BZTRP_YR /* 출장년도 */,
    TRIPSITU.BZTRP_SQNO /* 출장순번 */
FROM TB_BADDED002M TRIPSITU , TB_BADDED005L TRIPMEMBER , TB_BADDED008L TRIPORG WHERE 1=1 AND TRIPSITU.REL_ADT_YR BETWEEN #strAudYrSt# AND #strAudYrEnd# AND TRIPSITU.REL_ADT_YR (+)= A.CVLCPT_ADT_YR AND TRIPSITU.REL_ADT_NO (+)= A.ADT_NO TRIPSITU.ADT_BZTRP_KDCD IN #strAudBztKndCd[]# AND TRIPMEMBER.BZTRP_YR (+)= TRIPSITU.BZTRP_YR AND TRIPMEMBER.BZTRP_SQNO (+)= TRIPSITU.BZTRP_SQNO AND( (TRIPMEMBER.BZTRP_BGNG_YMD BETWEEN #strBztStDt# AND '99991231') OR (TRIPMEMBER.BZTRP_END_YMD BETWEEN #strBztStDt# AND '99991231') ) AND( (TRIPMEMBER.BZTRP_BGNG_YMD BETWEEN '19000101' AND #strBztEndDt#) OR (TRIPMEMBER.BZTRP_END_YMD BETWEEN '19000101' AND #strBztEndDt#) ) AND BZTRVR_ENO = #BZTRVR_ENO# /*내부출장자*/ AND BZTRVR_NM LIKE #strOutPctNm#||'%' /*외부출장자*/ AND TRIPORG.BZTRP_YR = TRIPSITU.BZTRP_YR AND TRIPORG.BZTRP_SQNO = TRIPSITU.BZTRP_SQNO AND TRIPORG.INST_CD LIKE SUBSTR(#INST_CD#,0,3) || '%' AND TRIPORG.INST_CD LIKE SUBSTR(#INST_CD#,0,6) || '%' AND TRIPORG.INST_CD LIKE SUBSTR(#INST_CD#,0,9) || '%' AND TRIPORG.INST_CD = #INST_CD# AND TRIPORG.INST_CD = #INST_CD# AND TRIPORG.RGN_CD LIKE SUBSTR(#RGN_CD#,0,2) || '%' AND TRIPORG.RGN_CD = #RGN_CD# ) /* 예산구분코드 추가 - 2019.11.12 les */ AND A.BZTRP_BGT_SECD = #BZTRP_BGT_SECD# ORDER BY A.CVLCPT_ADT_YR DESC ,A.ADT_NO DESC ,B.BZTRP_SQNO