SELECT CASE WHEN MAIN.DSPS_RQT_KDCD LIKE '5%' THEN '개선' /*개선*/ WHEN MAIN.DSPS_RQT_KDCD = '611' THEN '권고' /*권고*/ WHEN MAIN.DSPS_RQT_KDCD IN ('610','620','621','623','630','625') THEN '통보' /*통보, (통보(시정완료):625 추가 - 2016.11.23 yyh) */ END AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM (CASE WHEN DE04.CFMTN_STTS_SECD != '2' OR (DE04.CFMTN_STTS_SECD = '2' AND DE04.IMPL_WHLS_CFMTN_YMD > C.TDATE) THEN 1 ELSE 0 END) AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    /*건수*/ SUM (CASE WHEN DE04.CFMTN_STTS_SECD != '2' OR (DE04.CFMTN_STTS_SECD = '2' AND DE04.IMPL_WHLS_CFMTN_YMD > C.TDATE) THEN DE04.PNRT_PRSRV_AMT ELSE 0 END) AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    /*금액(추징회수보전)*/ SUM (CASE WHEN DE04.CFMTN_STTS_SECD != '2' OR (DE04.CFMTN_STTS_SECD = '2' AND DE04.IMPL_WHLS_CFMTN_YMD > C.TDATE) THEN DE04.RMBR_AMT + DE04.SPLP_AMT ELSE 0 END) AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    /*금액(환추급)*/ SUM (CASE WHEN MAIN.DSPS_RQT_KDCD IN ('210', '620', '621', '623') AND DE04.CFMTN_STTS_SECD != '2' AND DE04.ENFC_YMD C.TDATE) OR MAIN.DSPS_RQT_KDCD LIKE '6%') THEN DE04.NOP_CONT WHEN MAIN.DSPS_RQT_KDCD IN ('210', '620', '621', '623') AND DE04.CFMTN_STTS_SECD = '2' AND DE04.ENFC_YMD C.TDATE AND ((MAIN.DSPS_RQT_KDCD = '210' AND DE04.PRCS_TERM_YMD > C.TDATE) OR MAIN.DSPS_RQT_KDCD LIKE '6%') THEN DE04.NOP_CONT ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */
FROM TB_BADEAR002D DE04, TB_BADEAR001M MAIN, (SELECT TO_CHAR(LAST_DAY(TO_DATE(#strStartFromDt#,'YYYYMM')),'YYYYMMDD') /*해당년월의 마지막일자 산출*/ AS TO_CHAR /* 인자값 화면의 년월 */
FROM DUAL) C WHERE 1=1 AND DE04.ENFC_YMD <= C.TDATE AND DE04.ADT_NO = MAIN.ADT_NO AND DE04.DSPS_RQT_SQNO = MAIN.DSPS_RQT_SQNO AND DE04.ADT_YR = MAIN.ADT_YR AND (SUBSTRB(MAIN.DSPS_RQT_KDCD, 1, 1) LIKE '5' OR MAIN.DSPS_RQT_KDCD LIKE '6%') AND DE04.CFMTN_STTS_SECD != '0' GROUP BY (CASE WHEN MAIN.DSPS_RQT_KDCD LIKE '5%' THEN '개선' WHEN MAIN.DSPS_RQT_KDCD = '611' THEN '권고' WHEN MAIN.DSPS_RQT_KDCD IN ('610','620','621','623','630','625') THEN '통보' END) ORDER BY ENFO_REQ_TYPE