WITH BASE AS ( SELECT SUBSTR(DETAIL.ENFC_YMD, 1, 6) AS SUBSTR,
    MASTER.INST_SECD /* 기관구분코드 */,
    DETAIL.ENFC_DEPT_CD /* 시행부서코드 */,
    MASTER.DSPS_RQT_KDCD /* 처분요구종류코드 */,
    NVL(DETAIL.NOP_CONT, 0) AS NOP_CONT /* 인원개수 */,
    NVL(DETAIL.INST_CONT, 0) AS INST_CONT /* 기관개수 */,
    DETAIL.ENFC_YMD /* 시행일자 */
FROM TB_BADEAR001M MASTER, TB_BADEAR002D DETAIL WHERE MASTER.CVLCPT_ADT_YR = DETAIL.CVLCPT_ADT_YR AND MASTER.ADT_NO = DETAIL.ADT_NO AND MASTER.DSPS_RQT_SQNO = DETAIL.DSPS_RQT_SQNO AND DETAIL.ENFC_YMD IS NOT NULL AND DETAIL.CFMTN_STTS_SECD != '0' AND MASTER.DSPS_RQT_KDCD IN ('800','810', '820','830','840','850') ) SELECT A.GUBUN AS GUBUN,
    A.GUBUN2 AS GUBUN2,
    A.C1 AS C1,
    A.C2 AS C2,
    A.C3 AS C3,
    B.C1,
    B.C2,
    B.C3,
    A.C1 - B.C1 AS C1,
    A.C2 - B.C2 AS C2,
    A.C3 - B.C3 AS C3
FROM ( SELECT '5' AS C0,
    '모범 사례' AS GUBUN,
    'C' AS GUBUN2,
    NVL(SUM(INGUN), 0) + NVL(SUM(KIKGUN), 0) AS INGUN,
    0,
    NVL(SUM(INSU), 0) AS INSU
FROM ( SELECT YYMM AS YYMM,
    KIKGU AS KIKGU,
    SUBSTR(DEPT, 1, 2) AS SUBSTR,
    CHB_CD,
    SUM(CASE WHEN NVL(CHB_SU, 0) > 0 THEN 0 ELSE 1 END) AS CHB_SU,
    SUM(CASE WHEN NVL(CHB_SU, 0) > 0 THEN 0 WHEN NVL(CHB_SU, 0) 0 THEN 1 ELSE 0 END) AS CHB_SU,
    SUM(CASE WHEN NVL(CHB_SU, 0) > 0 THEN NVL(CHB_SU, 0) ELSE 0 END) AS CHB_SU
FROM BASE WHERE 1=1 AND SUBSTR(ENFC_YMD,1,6) BETWEEN #strStartFromDt# AND #strStartToDt# GROUP BY YYMM, KIKGU, SUBSTR(DEPT, 1, 2) , CHB_CD ) ) A, ( SELECT NVL(SUM(INGUN), 0) + NVL(SUM(KIKGUN), 0) AS INGUN,
    0,
    NVL(SUM(INSU), 0) AS INSU
FROM ( SELECT YYMM AS YYMM,
    KIKGU AS KIKGU,
    SUBSTR(DEPT, 1, 2) AS SUBSTR,
    CHB_CD,
    SUM(CASE WHEN NVL(CHB_SU, 0) > 0 THEN 0 ELSE 1 END) AS CHB_SU,
    SUM(CASE WHEN NVL(CHB_SU, 0) > 0 THEN 0 WHEN NVL(CHB_SU, 0) 0 THEN 1 ELSE 0 END) AS CHB_SU,
    SUM(CASE WHEN NVL(CHB_SU, 0) > 0 THEN NVL(CHB_SU, 0) ELSE 0 END) AS CHB_SU
FROM BASE WHERE 1=1 AND SUBSTR(ENFC_YMD,1,6) BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#strStartFromDt#||'01') ,-12),'YYYYMM') /*1년전*/ AND TO_CHAR(ADD_MONTHS(TO_DATE(#strStartToDt#||'01') , -12),'YYYYMM') /*1년전*/ GROUP BY YYMM, KIKGU, SUBSTR(DEPT, 1, 2) , CHB_CD ) ) B