SELECT CASE WHEN MAIN.DSPS_RQT_KDCD = '110' THEN '변상' /*변상*/ WHEN MAIN.DSPS_RQT_KDCD LIKE '2%' THEN '징계_문책' /*징계_문책*/ WHEN MAIN.DSPS_RQT_KDCD IN ('310','320','391') THEN '시정' /*시정*/ END AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    CASE WHEN MAIN.DSPS_RQT_KDCD = '110' THEN 1 WHEN MAIN.DSPS_RQT_KDCD LIKE '2%' THEN 2 WHEN MAIN.DSPS_RQT_KDCD IN('310','320','391') THEN 3 END AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    SUM(CASE WHEN DE04.CFMTN_STTS_SECD != '2' OR (DE04.CFMTN_STTS_SECD = '2' AND DE04.IMPL_WHLS_CFMTN_YMD > C.TDATE) THEN 1 ELSE 0 END ) AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    /*계_건수*/ SUM(CASE WHEN DE04.CFMTN_STTS_SECD != '2' OR (DE04.CFMTN_STTS_SECD = '2' AND DE04.IMPL_WHLS_CFMTN_YMD > C.TDATE) THEN DE04.PNRT_PRSRV_AMT ELSE 0 END ) AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    /*계_금액(추징회수보전)*/ SUM(CASE WHEN DE04.CFMTN_STTS_SECD != '2' OR (DE04.CFMTN_STTS_SECD = '2' AND DE04.IMPL_WHLS_CFMTN_YMD > C.TDATE) THEN DE04.RMBR_AMT + DE04.SPLP_AMT ELSE 0 END ) AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    /*계_금액(환추급)*/ SUM(CASE WHEN MAIN.DSPS_RQT_KDCD IN ('210', '620', '621', '623') AND (DE04.CFMTN_STTS_SECD != '2' OR (DE04.CFMTN_STTS_SECD = '2' AND DE04.IMPL_WHLS_CFMTN_YMD > C.TDATE)) THEN DE04.NOP_CONT ELSE 0 END ) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    /*계_인원*/ SUM(CASE WHEN (DE04.CFMTN_STTS_SECD != '2' AND DE04.PRCS_TERM_YMD C.TDATE AND DE04.PRCS_TERM_YMD C.TDATE AND DE04.PRCS_TERM_YMD C.TDATE AND DE04.PRCS_TERM_YMD C.TDATE AND MAIN.DSPS_RQT_KDCD = '210' AND DE04.PRCS_TERM_YMD C.TDATE) OR (DE04.CFMTN_STTS_SECD = '2' AND DE04.IMPL_WHLS_CFMTN_YMD > C.TDATE AND DE04.PRCS_TERM_YMD > C.TDATE) THEN 1 ELSE 0 END ) AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    /*미도래_건수*/ SUM(CASE WHEN (DE04.CFMTN_STTS_SECD != '2' AND DE04.PRCS_TERM_YMD > C.TDATE AND MAIN.DSPS_RQT_KDCD IN ('110', '310', '320', '391') ) OR (DE04.CFMTN_STTS_SECD = '2' AND DE04.IMPL_WHLS_CFMTN_YMD > C.TDATE AND DE04.PRCS_TERM_YMD > C.TDATE AND MAIN.DSPS_RQT_KDCD IN('110','310', '320', '391') ) THEN DE04.PNRT_PRSRV_AMT ELSE 0 END ) AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    /*미도래_금액(추징회수보전)*/ SUM(CASE WHEN (DE04.CFMTN_STTS_SECD != '2' AND DE04.PRCS_TERM_YMD > C.TDATE AND MAIN.DSPS_RQT_KDCD IN ('110', '310', '320', '391') ) OR (DE04.CFMTN_STTS_SECD = '2' AND DE04.IMPL_WHLS_CFMTN_YMD > C.TDATE AND DE04.PRCS_TERM_YMD > C.TDATE AND MAIN.DSPS_RQT_KDCD IN('110','310', '320', '391') ) THEN DE04.RMBR_AMT + DE04.SPLP_AMT ELSE 0 END ) AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    /*미도래_금액(환추급)*/ SUM(CASE WHEN MAIN.DSPS_RQT_KDCD IN ('210', '620', '621', '623') AND DE04.CFMTN_STTS_SECD != '2' AND DE04.ENFC_YMD C.TDATE) OR MAIN.DSPS_RQT_KDCD LIKE '6%') THEN DE04.NOP_CONT WHEN MAIN.DSPS_RQT_KDCD IN ('210', '620', '621', '623') AND DE04.CFMTN_STTS_SECD = '2' AND DE04.ENFC_YMD C.TDATE AND ((MAIN.DSPS_RQT_KDCD = '210' AND DE04.PRCS_TERM_YMD > C.TDATE) OR MAIN.DSPS_RQT_KDCD LIKE '6%') THEN DE04.NOP_CONT ELSE 0 END) AS DSPS_RQT_KDCD /* 처분요구종류코드 */
FROM TB_BADEAR002D DE04, TB_BADEAR001M MAIN, (SELECT TO_CHAR(LAST_DAY(TO_DATE(#strStartFromDt#, 'YYYYMM') ) , 'YYYYMMDD') /*해당년월의 마지막일자 산출*/ AS TO_CHAR /* 인자값 화면의 년월 */
FROM DUAL) C WHERE 1=1 AND DE04.ENFC_YMD <= C.TDATE AND DE04.ADT_NO = MAIN.ADT_NO AND DE04.DSPS_RQT_SQNO = MAIN.DSPS_RQT_SQNO AND DE04.ADT_YR = MAIN.ADT_YR AND MAIN.DSPS_RQT_KDCD IN ('110', '210', '310', '320', '391') AND DE04.CFMTN_STTS_SECD != '0' GROUP BY (CASE WHEN MAIN.DSPS_RQT_KDCD = '110' THEN '변상' WHEN MAIN.DSPS_RQT_KDCD LIKE '2%' THEN '징계_문책' WHEN MAIN.DSPS_RQT_KDCD IN ('310','320', '391') THEN '시정' END ), (CASE WHEN MAIN.DSPS_RQT_KDCD = '110' THEN 1 WHEN MAIN.DSPS_RQT_KDCD LIKE '2%' THEN 2 WHEN MAIN.DSPS_RQT_KDCD IN('310','320','391') THEN 3 END) ORDER BY SORTER