WITH BASE AS ( SELECT SUM(CASE WHEN DE04.CFMTN_STTS_SECD != '2' AND DE04.ENFC_YMD = C.FDATE THEN DE04.RMBR_AMT + DE04.SPLP_AMT ELSE 0 END ) AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    SUM(CASE WHEN DE04.ENFC_YMD BETWEEN C.FDATE AND C.TDATE THEN DE04.RMBR_AMT + DE04.SPLP_AMT ELSE 0 END ) AS ENFC_YMD /* 시행일자 */,
    SUM(CASE WHEN DE04.CFMTN_STTS_SECD = '2' AND DE04.IMPL_WHLS_CFMTN_YMD BETWEEN C.FDATE AND C.TDATE THEN DE04.RMBR_AMT + DE04.SPLP_AMT ELSE 0 END ) AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    SUM(CASE WHEN DE04.CFMTN_STTS_SECD != '2' AND DE04.ENFC_YMD C.TDATE AND DE04.PRCS_TERM_YMD C.TDATE THEN DE04.RMBR_AMT + DE04.SPLP_AMT WHEN DE04.CFMTN_STTS_SECD = '2' AND DE04.ENFC_YMD C.TDATE AND DE04.PRCS_TERM_YMD > C.TDATE THEN DE04.RMBR_AMT + DE04.SPLP_AMT ELSE 0 END ) AS CFMTN_STTS_SECD /* 확정상태구분코드 */
FROM TB_BADEAR002D DE04, TB_BADEAR001M MAIN, (SELECT #strYear# || '0101' /*월일 0101고정*/ FDATE,
    TO_CHAR(LAST_DAY(TO_DATE(#strStartFromDt#,'YYYYMM')),'YYYYMMDD') /*해당년월의 마지막일자 산출*/ AS TO_CHAR
FROM DUAL) C WHERE 1=1 AND DE04.ADT_NO = MAIN.ADT_NO AND DE04.DSPS_RQT_SQNO = MAIN.DSPS_RQT_SQNO AND DE04.ADT_YR = MAIN.ADT_YR AND MAIN.DSPS_RQT_KDCD IN ('110', '310', '320', '391') AND DE04.CFMTN_STTS_SECD != '0' ) SELECT OVER_YEAR_AM + NEW_OPER_AM AS OVER_YEAR_AM /* 금액(환추급) 계 */,
    OVER_YEAR_AM /* 금액(환추급) 전년이월 */,
    NEW_OPER_AM /* 금액(환추급) 신규발생 */,
    ENFO_AM /* 금액(환추급) ****년 **월 집행 */,
    NENFO_INDLINE_AM + NENFO_OUTDLINE_AM AS NENFO_INDLINE_AM /* 금액(환추급) 기한도래 + 기한미도래 */,
    NENFO_INDLINE_AM /* 금액(환추급) 기한도래 */,
    NENFO_OUTDLINE_AM /* 금액(환추급) 기한미도래 */
FROM BASE