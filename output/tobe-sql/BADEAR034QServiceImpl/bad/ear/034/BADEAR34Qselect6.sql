WITH TMP_DEPT_TIT_TXT AS ( SELECT DISTINCT DE04.IMPL_MNG_JRSD_DEPT_CD AS IMPL_MNG_JRSD_DEPT_CD /* 집행관리소관부서코드 */,
    DEPT.CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */
FROM TB_BADEAR002D DE04, TB_BADEAR001M MAIN, TBDCMACM002M DEPT WHERE 1=1 AND DE04.ADT_NO = MAIN.ADT_NO AND DE04.DSPS_RQT_SQNO = MAIN.DSPS_RQT_SQNO AND DE04.ADT_YR = MAIN.ADT_YR AND DE04.IMPL_MNG_JRSD_DEPT_CD = DEPT.SRECS_DEPT_CD AND (SUBSTRB(MAIN.DSPS_RQT_KDCD,1,1) LIKE '5' OR SUBSTRB(MAIN.DSPS_RQT_KDCD,1,1) LIKE '6' OR MAIN.DSPS_RQT_KDCD IN ('110','210','310','320','391')) AND DE04.CFMTN_STTS_SECD != '0' /* 2015.07.28 yyh 주석처리 AND DE04.ENF_DT >= '20060101' */ ) SELECT DEPT.ENFO_DPT_NM /* 구분 */,
    DEPT.ENFM_DPT_CD,
    SUM(ENFO.ENFO_OBJ_CNT) AS ENFO_OBJ_CNT /* 집행대상 건수 */,
    SUM(ENFO.ENFO_OBJ_AM) AS ENFO_OBJ_AM /* 집행대상 금액(추징회수보전) */,
    SUM(ENFO.ENFO_OBJ_AM2) AS ENFO_OBJ_AM2 /* 집행대상 금액(환추급) */,
    SUM(ENFO.ENFO_OBJ_PSON) AS ENFO_OBJ_PSON /* 집행대상 인원 */,
    SUM(ENFO.ENFO_CNT) AS ENFO_CNT /* ****년 **월 집행 건수 */,
    SUM(ENFO.ENFO_AM) AS ENFO_AM /* ****년 **월 집행 금액(금액회수보전) */,
    SUM(ENFO.ENFO_AM2) AS ENFO_AM2 /* ****년 **월 집행 금액(환추급) */,
    SUM(ENFO.ENFO_PSON) AS ENFO_PSON /* ****년 **월 집행 인원 */,
    SUM(ENFO.NENFO_OUTDLINE_CNT) AS NENFO_OUTDLINE_CNT /* 미집행 건수 */,
    SUM(ENFO.NENFO_OUTDLINE_AM) AS NENFO_OUTDLINE_AM /* 미집행 금액(추징회수보전) */,
    SUM(ENFO.NENFO_OUTDLINE_AM2) AS NENFO_OUTDLINE_AM2 /* 미집행 금액(환추급) */,
    SUM(ENFO.NENFO_OUTDLINE_PSON) AS NENFO_OUTDLINE_PSON /* 미집행 인원 */,
    SUM(ENFO.NENFO_INDLINE_CNT) AS NENFO_INDLINE_CNT /* 미집행 건수 */
FROM TMP_DEPT_TIT_TXT DEPT ,( SELECT DE04.IMPL_MNG_JRSD_DEPT_CD , COUNT(*) AS ENFO_OBJ_CNT , SUM (CASE WHEN MAIN.DSPS_RQT_KDCD IN ('110', '310', '320', '391') THEN DE04.PNRT_PRSRV_AMT ELSE 0 END) AS ENFO_OBJ_AM , SUM (CASE WHEN MAIN.DSPS_RQT_KDCD IN ('110', '310', '320', '391') THEN DE04.RMBR_AMT + DE04.SPLP_AMT ELSE 0 END) AS ENFO_OBJ_AM2 , SUM (CASE WHEN MAIN.DSPS_RQT_KDCD IN ('210', '620', '621', '623') THEN DE04.NOP_CONT ELSE 0 END) AS ENFO_OBJ_PSON , 0 AS ENFO_CNT , 0 AS ENFO_AM , 0 AS ENFO_AM2 , 0 AS ENFO_PSON , SUM (CASE WHEN MAIN.DSPS_RQT_KDCD IN ('110', '210', '310', '320', '391') AND DE04.PRCS_TERM_YMD C.TDATE) OR MAIN.DSPS_RQT_KDCD LIKE '5%' OR MAIN.DSPS_RQT_KDCD LIKE '6%' THEN 1 ELSE 0 END) AS NENFO_INDLINE_CNT FROM TB_BADEAR002D DE04 , TB_BADEAR001M MAIN ,(SELECT #strYear# || '0101' /*월일 0101고정*/ FDATE,
    TO_CHAR(LAST_DAY(TO_DATE(#strStartFromDt#,'YYYYMM')),'YYYYMMDD') /*해당년월의 마지막일자 산출*/ AS TO_CHAR
FROM DUAL) C WHERE DE04.CFMTN_STTS_SECD != '2' AND DE04.ENFC_YMD C.TDATE THEN 1 ELSE 0 END) AS NENFO_OUTDLINE_CNT , SUM (CASE WHEN MAIN.DSPS_RQT_KDCD IN ('110','310','320','391')AND DE04.PRCS_TERM_YMD C.TDATE THEN DE04.PNRT_PRSRV_AMT ELSE 0 END) AS NENFO_OUTDLINE_AM , SUM (CASE WHEN MAIN.DSPS_RQT_KDCD IN ('110','310','320','391') AND DE04.PRCS_TERM_YMD C.TDATE THEN DE04.RMBR_AMT + DE04.SPLP_AMT ELSE 0 END) AS NENFO_OUTDLINE_AM2 , SUM (CASE WHEN MAIN.DSPS_RQT_KDCD IN ('210') AND DE04.PRCS_TERM_YMD C.TDATE THEN DE04.NOP_CONT ELSE 0 END) AS NENFO_OUTDLINE_PSON , SUM (CASE WHEN ((MAIN.DSPS_RQT_KDCD IN ('110','210', '310','320','391') AND DE04.PRCS_TERM_YMD > C.TDATE) OR MAIN.DSPS_RQT_KDCD LIKE '5%' OR MAIN.DSPS_RQT_KDCD LIKE '6%') AND DE04.IMPL_WHLS_CFMTN_YMD > C.TDATE THEN 1 ELSE 0 END) AS NENFO_INDLINE_CNT FROM TB_BADEAR002D DE04, TB_BADEAR001M MAIN, (SELECT #strYear# || '0101' /*월일 0101고정*/ FDATE,
    TO_CHAR(LAST_DAY(TO_DATE(#strStartFromDt#,'YYYYMM')),'YYYYMMDD') /*해당년월의 마지막일자 산출*/ AS TO_CHAR
FROM DUAL) C WHERE DE04.CFMTN_STTS_SECD = '2' AND DE04.ENFC_YMD = C.FDATE AND DE04.ADT_NO = MAIN.ADT_NO AND DE04.DSPS_RQT_SQNO = MAIN.DSPS_RQT_SQNO AND DE04.ADT_YR = MAIN.ADT_YR AND (SUBSTRB(MAIN.DSPS_RQT_KDCD,1,1) LIKE '5' OR SUBSTRB(MAIN.DSPS_RQT_KDCD,1,1) LIKE '6' OR MAIN.DSPS_RQT_KDCD IN ('110','210','310','320','391')) GROUP BY DE04.IMPL_MNG_JRSD_DEPT_CD ) ENFO WHERE ENFO.IMPL_MNG_JRSD_DEPT_CD(+) = DEPT.ENFM_DPT_CD GROUP BY DEPT.ENFO_DPT_NM ,DEPT.ENFM_DPT_CD ORDER BY DEPT.ENFM_DPT_CD