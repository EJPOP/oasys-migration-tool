WITH BASE AS ( SELECT SUM(CASE WHEN DE04.CFMTN_STTS_SECD != '2' AND DE04.ENFC_YMD = C.FDATE THEN 1 ELSE 0 END) AS OVER_YEAR_CNT , SUM(CASE WHEN DE04.ENFC_YMD BETWEEN C.FDATE AND C.TDATE THEN 1 ELSE 0 END) AS NEW_OPER_CNT , SUM(CASE WHEN DE04.CFMTN_STTS_SECD = '2' AND DE04.IMPL_WHLS_CFMTN_YMD BETWEEN C.FDATE AND C.TDATE THEN 1 ELSE 0 END) AS ENFO_CNT , SUM(CASE WHEN DE04.CFMTN_STTS_SECD != '2' AND DE04.ENFC_YMD C.TDATE AND DE04.PRCS_TERM_YMD C.TDATE) OR MAIN.DSPS_RQT_KDCD LIKE '5%' OR MAIN.DSPS_RQT_KDCD LIKE '6%') THEN 1 WHEN DE04.CFMTN_STTS_SECD = '2' AND DE04.ENFC_YMD C.TDATE AND ((MAIN.DSPS_RQT_KDCD IN ('110','210','310','320','391') AND DE04.PRCS_TERM_YMD > C.TDATE) OR MAIN.DSPS_RQT_KDCD LIKE '5%' OR MAIN.DSPS_RQT_KDCD LIKE '6%') THEN 1 ELSE 0 END) AS NENFO_OUTDLINE_CNT FROM TB_BADEAR002D DE04, TB_BADEAR001M MAIN, (SELECT #strYear# || '0101' /*월일 0101고정*/ FDATE,
    TO_CHAR(LAST_DAY(TO_DATE(#strStartFromDt#,'YYYYMM')),'YYYYMMDD') /*해당년월의 마지막일자 산출*/ AS TO_CHAR
FROM DUAL) C WHERE 1=1 AND DE04.ADT_NO = MAIN.ADT_NO AND DE04.DSPS_RQT_SQNO = MAIN.DSPS_RQT_SQNO AND DE04.ADT_YR = MAIN.ADT_YR AND (SUBSTRB(MAIN.DSPS_RQT_KDCD, 1, 1) LIKE '5' OR SUBSTRB(MAIN.DSPS_RQT_KDCD, 1, 1) LIKE '6' OR MAIN.DSPS_RQT_KDCD IN ('110', '210', '310', '320', '391')) AND DE04.CFMTN_STTS_SECD != '0' ) SELECT OVER_YEAR_CNT + NEW_OPER_CNT AS OVER_YEAR_CNT /* 건수 계 */,
    OVER_YEAR_CNT /* 건수 전년이월 */,
    NEW_OPER_CNT /* 건수 신규발생 */,
    ENFO_CNT /* 건수 ****년 **월 집행 */,
    NENFO_INDLINE_CNT + NENFO_OUTDLINE_CNT AS NENFO_INDLINE_CNT /* 건수 기한도래 + 기한미도래 */,
    NENFO_INDLINE_CNT /* 건수 기한도래 */,
    NENFO_OUTDLINE_CNT /* 건수 기한미도래 */
FROM BASE