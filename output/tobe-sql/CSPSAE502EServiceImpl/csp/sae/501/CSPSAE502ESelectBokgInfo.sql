WITH APL_DATE AS /* CSPSAE502ESelectBokgInfo */ (SELECT T2.DT,
    CASE WHEN T2.DT > T5.END_YMD THEN 'X' ELSE NVL(T4.DDLN_YN, 'N') END AS DDLN_YN /* 마감여부 */,
    ROWNUM
FROM ( SELECT TO_CHAR(TO_DATE(T1.BGNG_YMD, 'YYYYMMDD') + (LEVEL-1), 'YYYYMMDD') AS TO_CHAR,
    T1.END_YMD /* 종료일자 */
FROM ( SELECT #strDATE# AS BGNG_YMD /* 시작일자 */,
    TO_CHAR(LAST_DAY(#strDATE#), 'YYYYMMDD') AS END_YMD /* 종료일자 */
FROM DUAL ) T1 CONNECT BY LEVEL = A.NOW_JUCHA GROUP BY A.JUCHA, A.YY_JUCHA ) T5 WHERE T2.DT = T3.APL_DT AND T2.DT BETWEEN TO_CHAR(TRUNC(TO_DATE(T4.END_DDL_DT(+))-1, 'IW'), 'YYYYMMDD') AND TO_CHAR(TRUNC(TO_DATE(T4.END_DDL_DT(+))-1, 'IW')+6, 'YYYYMMDD') ) SELECT DISTINCT A.USR_DFN_TXT_1,
    A.USR_DFN_TXT_2,
    A.USR_DFN_TXT_3,
    0,
    (CASE WHEN B.DMT_DVSN_CNT > 0 THEN B.DMT_DVSN_CNT ELSE 0 END) AS DMT_DVSN_CNT,
    (CASE WHEN B.DMT_DVSN_CNT 0) B WHERE A.DMT_DVSN_CD(+) = B.DMT_DVSN_CD AND B.DT BETWEEN TO_CHAR(TRUNC(TO_DATE(A.END_DDL_DT(+))-1, 'IW'), 'YYYYMMDD') AND TO_CHAR(TRUNC(TO_DATE(A.END_DDL_DT(+))-1, 'IW')+6, 'YYYYMMDD') ) AS DMT_DVSN_CNT,
    (SELECT DMT_DVSN_CD , COUNT(DMT_DVSN_CD) AS DMT_DVSN_CD
FROM TBCSPSAE115B WHERE USE_YN = 'Y' GROUP BY DMT_DVSN_CD ORDER BY DMT_DVSN_CD) C , TBCSPSAE131B D WHERE A.CMM_CD_DVSN_CD = '1000140' AND A.USE_YN = 'Y' AND B.DMT_DVSN_CD(+) = A.CD AND B.DDT = #strDATE# AND C.DMT_DVSN_CD(+) = A.CD AND D.DMT_DVSN_CD(+) = A.CD ORDER BY A.USR_DFN_TXT_1 DESC