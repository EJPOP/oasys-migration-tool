SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    ADT_MTTR_NM /* 감사사항명 */,
    SPRVSN_DEPT_CD /* 주관부서코드 */,
    SPV_BRDV_NM,
    RSRV_EXMN_OTST_YMD /* 예비조사착수일자 */,
    PRCS_TERM_YMD /* 처리기한일자 */,
    ACADT_BGNG_YMD /* 실지감사시작일자 */,
    ACADT_END_YMD /* 실지감사종료일자 */,
    ACADT_ENFRC_DCN /* 실지감사실시일수 */,
    DAG_YMD /* 귀청일자 */,
    RPT_TERM_YMD /* 보고기한일자 */,
    LDRV_ENO /* 주심위원직원전산번호 */,
    LDRV_NM /* 주심위원명 */,
    SBCN_YMD /* 부의일자 */,
    ACADT_PRCS_STTS_SECD /* 실지감사처리상태구분코드 */,
    ACADT_PRLG_BGNG_YMD /* 실지감사연장시작일자 */,
    ACADT_PRLG_END_YMD /* 실지감사연장종료일자 */,
    DTL_AUD_NO,
    ADT_KDCD /* 감사종류코드 */,
    AUD_KND_NM,
    PRLG_PRD_APRV_YMD /* 연장기간승인일자 */,
    SNTHS_DPP_YN /* 종합처리안여부 */,
    PRCS_PRST_DSCTN /* 처리현황내역 */,
    STUT_RMRK_CN /* 상황비고내용 */,
    MDFCN_YN /* 수정여부 */,
    PTOUT_NOCS /* 지적건수 */,
    DELAY_CNT,
    HNDL_STATUS,
    DAG_RPT_YMD /* 귀청보고일자 */,
    DIFF_REPORT,
    CASE WHEN DIFF_REPORT = '-' THEN '-' WHEN DIFF_REPORT > 0 THEN '경고' ELSE '' END AS DIFF_REPORT,
    RB_PRCS_TERM_YMD /* 소관국처리기한일자 */,
    AB_ATRZ_YMD /* 감사국결재일자 */,
    DIFF_BRDV,
    CASE WHEN DIFF_BRDV = '-' THEN '-' WHEN DIFF_BRDV > 0 THEN '경고' ELSE '' END AS DIFF_BRDV,
    AJMT_PIC_ATRZ_TERM_YMD /* 조정담당자결재기한일자 */,
    AJMT_OFER_ATRZ_YMD /* 조정담당관결재일자 */,
    DIFF_MDT_CHGR,
    CASE WHEN DIFF_MDT_CHGR = '-' THEN '-' WHEN DIFF_MDT_CHGR > 0 THEN '경고' ELSE '' END AS DIFF_MDT_CHGR,
    AJMT_OFER_ATRZ_TERM_YMD /* 조정담당관결재기한일자 */,
    AJMT_DDG_ATRZ_YMD /* 조정심의관결재일자 */,
    DIFF_MDT_OFER,
    CASE WHEN DIFF_MDT_OFER = '-' THEN '-' WHEN DIFF_MDT_OFER > 0 THEN '경고' ELSE '' END AS DIFF_MDT_OFER,
    DLRM_ATRZ_TERM_YMD /* 심의실결재기한일자 */,
    JDAF_SRNG_OFER_ATRZ_YMD /* 법무심사담당관결재일자 */,
    DIFF_RVW_RM,
    CASE WHEN DIFF_RVW_RM = '-' THEN '-' WHEN DIFF_RVW_RM > 0 THEN '경고' ELSE '' END AS DIFF_RVW_RM,
    PSD_DHD_ATRZ_TERM_YMD /* 총장차장결재기한일자 */,
    OW_DHD_ATRZ_YMD /* 사무차장결재일자 */,
    DIFF_TOT_DHD,
    CASE WHEN DIFF_TOT_DHD = '-' THEN '-' WHEN DIFF_TOT_DHD > 0 THEN '경고' ELSE '' END AS DIFF_TOT_DHD,
    LDRV_MBCMT_ATRZ_TERM_YMD /* 주심위원위원결재기한일자 */,
    LDRV_MBCMT_ATRZ_YMD /* 주심위원위원결재일자 */,
    DIFF_CHF_CMTR,
    CASE WHEN DIFF_CHF_CMTR = '-' THEN '-' WHEN DIFF_CHF_CMTR > 0 THEN '경고' ELSE '' END AS DIFF_CHF_CMTR,
    ENFC_ATRZ_TERM_YMD /* 시행결재기한일자 */,
    ENFC_ATRZ_YMD /* 시행결재일자 */,
    DIFF_ENF,
    CASE WHEN DIFF_ENF = '-' THEN '-' WHEN DIFF_ENF > 0 THEN '경고' ELSE '' END AS DIFF_ENF,
    DIFF_HNDL,
    FLD_AUD_DT,
    ADT_CLSF_NO /* 감사분류번호 */,
    DECODE(DIFF_REPORT,'-',0,DIFF_REPORT) +DECODE(DIFF_BRDV,'-',0,DIFF_REPORT) +DECODE(DIFF_MDT_CHGR,'-',0,DIFF_REPORT) +DECODE(DIFF_MDT_OFER,'-',0,DIFF_MDT_OFER) +DECODE(DIFF_TOT_DHD,'-',0,DIFF_TOT_DHD) +DECODE(DIFF_CHF_CMTR,'-',0,DIFF_CHF_CMTR) +DECODE(DIFF_ENF,'-',0,DIFF_ENF) AS DIFF_REPORT
FROM ( SELECT B.CVLCPT_ADT_YR AS CVLCPT_ADT_YR /* 민원감사년도 */,
    B.ADT_NO AS ADT_NO /* 감사번호 */,
    B.CVLCPT_ADT_YR ||'-'|| B.ADT_NO AS ADT_CLSF_NO /* 감사분류번호 */,
    B.CVLCPT_ADT_YR ||'-'|| B.ADT_NO ||' ('|| F_CODE_NM('1000007',B.ADT_KDCD) ||')' ||B.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    B.SPRVSN_DEPT_CD AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    F_DPT_INFO(B.SPRVSN_DEPT_CD,'1') AS F_DPT_INFO /* 주관부서명 */,
    A.RSRV_EXMN_OTST_YMD AS RSRV_EXMN_OTST_YMD /* 예비조사착수일자 */,
    A.PRCS_TERM_YMD AS PRCS_TERM_YMD /* 처리기한일자 */,
    A.ACADT_BGNG_YMD AS ACADT_BGNG_YMD /* 실지감사시작일자 */,
    A.ACADT_END_YMD AS ACADT_END_YMD /* 실지감사종료일자 */,
    A.ACADT_ENFRC_DCN AS ACADT_ENFRC_DCN /* 실지감사실시일수 */,
    CASE WHEN A.ACADT_BGNG_YMD IS NOT NULL THEN TO_CHAR(TO_DATE(A.ACADT_BGNG_YMD),'YYYY-MM-DD')||'-'||TO_CHAR(TO_DATE(A.ACADT_END_YMD),'YYYY-MM-DD') ||'('||A.ACADT_ENFRC_DCN ||')' ELSE '' END AS ACADT_BGNG_YMD /* 실지감사시작일자 */,
    A.DAG_YMD AS DAG_YMD /* 귀청일자 */,
    A.RPT_TERM_YMD AS RPT_TERM_YMD /* 보고기한일자 */,
    A.LDRV_ENO AS LDRV_ENO /* 주심위원직원전산번호 */,
    F_USR_INFO(A.LDRV_ENO,'2') AS LDRV_NM /* 주심위원명 */,
    A.SBCN_YMD AS SBCN_YMD /* 부의일자 */,
    A.ACADT_PRCS_STTS_SECD AS ACADT_PRCS_STTS_SECD /* 실지감사처리상태구분코드 */,
    ACADT_PRLG_BGNG_YMD AS ACADT_PRLG_BGNG_YMD /* 실지감사연장시작일자 */,
    ACADT_PRLG_END_YMD AS ACADT_PRLG_END_YMD /* 실지감사연장종료일자 */,
    SUBSTR(B.CVLCPT_ADT_YR, 3, 2) || '-' || SUBSTR(B.ADT_ASMT_SECD,-1) ||'-'|| B.INST_SECD || '-' || SUBSTR(B.ADT_KDCD, 3, 1) ||B.SPRVSN_DEPT_CD || '-' || SUBSTR(B.ADT_MTHD_SECD,-1)||'-' || B.ADT_NO ||'-' ||(SELECT MAX(C.ADT_STP_SQNO) AS CVLCPT_ADT_YR /* 민원감사년도 */
FROM TBBADDED002M C WHERE B.CVLCPT_ADT_YR = C.REL_ADT_YR AND B.ADT_NO = C.REL_ADT_NO) AS DTL_AUD_NO /*세부연번호*/ , B.ADT_KDCD AS ADT_KDCD /*감사종류코드*/ , F_CODE_NM('1000007',B.ADT_KDCD) AS AUD_KND_NM /*감사종류명*/ , PRLG_PRD_APRV_YMD AS PRLG_PRD_APRV_YMD /*연장기간승인일*/ , SNTHS_DPP_YN AS SNTHS_DPP_YN /*종합처리안여부*/ , PRCS_PRST_DSCTN AS PRCS_PRST_DSCTN /*처리현황내역*/ , STUT_RMRK_CN AS STUT_RMRK_CN /*상황비고*/ , MDFCN_YN AS MDFCN_YN /*수정여부*/ , PTOUT_NOCS AS PTOUT_NOCS /*지적건수*/ , CASE WHEN A.ENFC_ATRZ_YMD IS NOT NULL THEN '-' /* 시행결재일자가 있으면 지연일수 없음*/ WHEN A.OW_DHD_ATRZ_YMD IS NOT NULL THEN TO_CHAR(TO_DATE(SYSDATE)-TO_DATE(A.ENFC_ATRZ_TERM_YMD)) WHEN A.JDAF_SRNG_OFER_ATRZ_YMD IS NOT NULL THEN TO_CHAR(TO_DATE(SYSDATE)-TO_DATE(A.PSD_DHD_ATRZ_TERM_YMD)) WHEN A.AJMT_DDG_ATRZ_YMD IS NOT NULL THEN TO_CHAR(TO_DATE(SYSDATE)-TO_DATE(A.DLRM_ATRZ_TERM_YMD)) WHEN A.AJMT_OFER_ATRZ_YMD IS NOT NULL THEN TO_CHAR(TO_DATE(SYSDATE)-TO_DATE(A.AJMT_OFER_ATRZ_TERM_YMD)) WHEN A.AB_ATRZ_YMD IS NOT NULL THEN TO_CHAR(TO_DATE(SYSDATE)-TO_DATE(A.AJMT_PIC_ATRZ_TERM_YMD)) WHEN A.DAG_RPT_YMD IS NOT NULL THEN TO_CHAR(TO_DATE(SYSDATE)-TO_DATE(A.RB_PRCS_TERM_YMD)) ELSE '-' END DELAY_CNT /*현단계지연일수*/ /*성과평가 지연일수 구하기 ,CASE WHEN A.ENF_APV_DT IS NOT NULL THEN TO_CHAR(TO_DATE(A.ENF_APV_DT) - TO_DATE(A.CHF_CMTR_APV_DT) - 0) 성과평가에서 시행의 기준일수는 0으로 셋팅 WHEN A.CHF_CMTR_APV_DT IS NOT NULL THEN TO_CHAR(TO_DATE(A.CHF_CMTR_APV_DT) - TO_DATE(A.OW_DHD_APV_DT) - 0) 성과평가에서 주심위원의 기준일수는 0으로 셋팅 WHEN A.OW_DHD_APV_DT IS NOT NULL THEN TO_CHAR(TO_DATE(A.OW_DHD_APV_DT) - TO_DATE(A.JA_JDG_SSEC_APV_DT) - F_DDLN_DCN(AUD.AUD_YR, AUD.AUD_NO,'08')) WHEN A.JA_JDG_SSEC_APV_DT IS NOT NULL THEN TO_CHAR(TO_DATE(A.JA_JDG_SSEC_APV_DT) - TO_DATE(A.MDT_DDG_APV_DT) - F_DDLN_DCN(AUD.AUD_YR, AUD.AUD_NO,'07')) WHEN A.MDT_DDG_APV_DT IS NOT NULL THEN TO_CHAR(TO_DATE(A.MDT_DDG_APV_DT) - TO_DATE(A.MDT_OFER_APV_DT) - F_DDLN_DCN(AUD.AUD_YR, AUD.AUD_NO,'06')) WHEN A.MDT_OFER_APV_DT IS NOT NULL THEN TO_CHAR(TO_DATE(A.MDT_OFER_APV_DT) - TO_DATE(A.AUD_BRDV_APV_DT) - F_DDLN_DCN(AUD.AUD_YR, AUD.AUD_NO,'05')) WHEN A.AUD_BRDV_APV_DT IS NOT NULL THEN TO_CHAR(TO_DATE(A.AUD_BRDV_APV_DT) - TO_DATE(A.RTN_RPT_DT) - F_DDLN_DCN(AUD.AUD_YR, AUD.AUD_NO,'04')) WHEN A.RTN_RPT_DT IS NOT NULL THEN TO_CHAR(TO_DATE(A.RTN_RPT_DT) - TO_DATE(A.FLD_AUD_END_DT) - F_DDLN_DCN(AUD.AUD_YR, AUD.AUD_NO,'03')) ELSE NULL END DELAY_CNT 현단계지연일수*/ , CASE WHEN A.ACADT_PRCS_STTS_SECD = '1' AND TO_DATE(A.DAG_YMD) > TO_DATE(SYSDATE) THEN '감사중' WHEN (A.ACADT_PRCS_STTS_SECD = '1' AND TRIM(A.PRCS_TERM_YMD) IS NULL) OR A.ACADT_PRCS_STTS_SECD = '3' THEN '처리중' WHEN A.ACADT_PRCS_STTS_SECD = '1'AND NVL(TO_DATE(A.PRCS_TERM_YMD),'99991231') /*특정(종합분석) 클릭시*/ AND substr(B.ADT_KDCD,-1) ='0' /*재무감사 클릭시*/ AND substr(B.ADT_KDCD,-1) ='1' /*특정감사 클릭시*/ AND substr(B.ADT_KDCD,-1) ='2' /*성과감사 클릭시*/ AND substr(B.ADT_KDCD,-1) ='3' /*기관운영감사 클릭시*/ AND substr(B.ADT_KDCD,-1) ='4' /*확인출장 클릭시*/ AND substr(B.ADT_KDCD,-1) ='5' /*재무감사(결산) 클릭시*/ AND substr(B.ADT_KDCD,-1) ='6' /*민원/손망실등 클릭시*/ AND substr(B.ADT_KDCD,-1) ='7' /*기타 클릭시*/ AND substr(B.ADT_KDCD,-1) ='8' /*서면/모니터링 클릭시*/ AND substr(B.ADT_KDCD,-1) ='9' /*귀청보고결재건수 클릭시*/ AND trim(DAG_RPT_YMD) is not null AND trim(AB_ATRZ_YMD) is null AND trim(AJMT_OFER_ATRZ_YMD) is null and trim(AJMT_DDG_ATRZ_YMD) is null and trim(JDAF_SRNG_OFER_ATRZ_YMD) is null and trim(OW_DHD_ATRZ_YMD) is null and trim(ENFC_ATRZ_YMD) is null /*감사국과결재건수 클릭시*/ AND trim(DAG_RPT_YMD) is not null and trim(AB_ATRZ_YMD) is not null and trim(AJMT_OFER_ATRZ_YMD) is null and trim(AJMT_DDG_ATRZ_YMD) is null and trim(JDAF_SRNG_OFER_ATRZ_YMD) is null and trim(OW_DHD_ATRZ_YMD) is null and trim(ENFC_ATRZ_YMD) is null /*조정담당자결재건수 클릭시 */ AND trim(DAG_RPT_YMD) is not null and trim(AB_ATRZ_YMD) is not null and trim(AJMT_OFER_ATRZ_YMD) is not null and trim(AJMT_DDG_ATRZ_YMD) is null and trim(JDAF_SRNG_OFER_ATRZ_YMD) is null and trim(OW_DHD_ATRZ_YMD) is null and trim(ENFC_ATRZ_YMD) is null /*조정담당관결재건수 클릭시*/ AND trim(DAG_RPT_YMD) is not null and trim(AB_ATRZ_YMD) is not null and trim(AJMT_OFER_ATRZ_YMD) is not null and trim(AJMT_DDG_ATRZ_YMD) is not null and trim(JDAF_SRNG_OFER_ATRZ_YMD) is null and trim(OW_DHD_ATRZ_YMD) is null and trim(ENFC_ATRZ_YMD) is null /*심의실장결재건수 클릭시*/ AND trim(DAG_RPT_YMD) is not null and trim(AB_ATRZ_YMD) is not null and trim(AJMT_OFER_ATRZ_YMD) is not null and trim(AJMT_DDG_ATRZ_YMD) is not null and trim(JDAF_SRNG_OFER_ATRZ_YMD) is not null and trim(OW_DHD_ATRZ_YMD) is null and trim(ENFC_ATRZ_YMD) is null /*총차장결재건수 클릭시*/ AND trim(DAG_RPT_YMD) is not null and trim(AB_ATRZ_YMD) is not null and trim(AJMT_OFER_ATRZ_YMD) is not null and trim(AJMT_DDG_ATRZ_YMD) is not null and trim(JDAF_SRNG_OFER_ATRZ_YMD) is not null and trim(OW_DHD_ATRZ_YMD) is not null and trim(ENFC_ATRZ_YMD) is null /*시행결재건수 클릭시*/ AND trim(DAG_RPT_YMD) is not null and trim(AB_ATRZ_YMD) is not null and trim(AJMT_OFER_ATRZ_YMD) is not null and trim(AJMT_DDG_ATRZ_YMD) is not null and trim(JDAF_SRNG_OFER_ATRZ_YMD) is not null and trim(OW_DHD_ATRZ_YMD) is not null and trim(ENFC_ATRZ_YMD) is not null ) ORDER BY ADT_NO