WITH BASE AS ( SELECT '1' AS USER_HSTRY_SECD /* 사용자이력구분코드 */,
    '예산액' AS SE_NM /* 구분명 */,
    NVL((SELECT AS SPRT_AM
FROM TBDCMACM067M WHERE LINK_YR = #LINK_YR# AND USER_HSTRY_SECD = '1'),0) AS COL1, NVL((SELECT SPRT_AM
FROM TBDCMACM067M WHERE LINK_YR = #LINK_YR# AND USER_HSTRY_SECD = '2'),0) AS COL2 FROM DUAL UNION ALL SELECT '2' AS USER_HSTRY_SECD /* 사용자이력구분코드 */,
    '누적 신청액' AS SE_NM /* 구분명 */,
    (SELECT NVL(SUM(PMT_AM),0)
FROM TBDCMACM065M WHERE LINK_YR = #LINK_YR# AND HNDL_STEP IN ('2','3','6','7')) AS COL1, (SELECT NVL(SUM(PMT_AM),0)
FROM TBFAACAV074M WHERE LINK_YR = #LINK_YR# AND HNDL_STEP IN ('2','3','6','7')) AS COL2 FROM DUAL UNION ALL SELECT '3' AS USER_HSTRY_SECD /* 사용자이력구분코드 */,
    '누적 확정액' AS SE_NM /* 구분명 */,
    (SELECT NVL(SUM(PMT_AM),0)
FROM TBDCMACM065M WHERE LINK_YR = #LINK_YR# AND HNDL_STEP = '7') AS COL1, (SELECT NVL(SUM(PMT_AM),0)
FROM TBFAACAV074M WHERE LINK_YR = #LINK_YR# AND HNDL_STEP = '7') AS COL2 FROM DUAL ) SELECT SE_NM /* 구분명 */,
    COL1,
    COL2
FROM BASE UNION ALL SELECT '집행률(확정액/예산액)' AS SE_NM /* 구분명 */,
    DECODE((SELECT AS COL1
FROM BASE WHERE USER_HSTRY_SECD = '1'),0,0,ROUND((SELECT COL1
FROM BASE WHERE USER_HSTRY_SECD = '3') / (SELECT COL1
FROM BASE WHERE USER_HSTRY_SECD = '1'),2) * 100) AS COL1, DECODE((SELECT COL2
FROM BASE WHERE USER_HSTRY_SECD = '1'),0,0,ROUND((SELECT COL2
FROM BASE WHERE USER_HSTRY_SECD = '3') / (SELECT COL2
FROM BASE WHERE USER_HSTRY_SECD = '1'),2) * 100) AS COL2 FROM DUAL UNION ALL SELECT '잔액(예산액-누적 신청액)' AS SE_NM /* 구분명 */,
    (SELECT AS COL1
FROM BASE WHERE USER_HSTRY_SECD = '1') - (SELECT COL1
FROM BASE WHERE USER_HSTRY_SECD = '2') AS COL1, (SELECT COL2
FROM BASE WHERE USER_HSTRY_SECD = '1') - (SELECT COL2
FROM BASE WHERE USER_HSTRY_SECD = '2') AS COL2 FROM DUAL UNION ALL SELECT '잔액(예산액-누적 확정액)' AS SE_NM /* 구분명 */,
    (SELECT AS COL1
FROM BASE WHERE USER_HSTRY_SECD = '1') - (SELECT COL1
FROM BASE WHERE USER_HSTRY_SECD = '3') AS COL1, (SELECT COL2
FROM BASE WHERE USER_HSTRY_SECD = '1') - (SELECT COL2
FROM BASE WHERE USER_HSTRY_SECD = '3') AS COL2 FROM DUAL