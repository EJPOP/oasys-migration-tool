SELECT T1.CVLCPT_ADT_YR AS CVLCPT_ADT_YR /* 민원감사년도 */,
    T1.ADT_NO AS ADT_NO /* 감사번호 */,
    T1.ADT_GRNT_NO AS ADT_GRNT_NO /* 감사부여번호 */,
    T1.ADT_CLSF_NO AS ADT_CLSF_NO /* 감사분류번호 */,
    T1.AUD_YR_NO_KND_CD AS AUD_YR_NO_KND_CD /* 감사연번호종류코드 */,
    T1.AUD_YR_NO_KND_NM AS AUD_YR_NO_KND_NM /* 감사연번호종류코드명 */,
    T1.AUD_DTL_NO AS AUD_DTL_NO /* 세부연번호 */,
    T1.ADT_ASMT_SECD AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    T1.AUD_TASK_NM AS AUD_TASK_NM,
    T1.INST_SECD AS INST_SECD /* 기관구분코드 */,
    T1.ADT_KDCD AS ADT_KDCD /* 감사종류코드 */,
    T1.AUD_KND_NM AS AUD_KND_NM,
    T1.SPRVSN_DEPT_CD AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    T1.SPV_BRDV_NM AS SPV_BRDV_NM /* 주관국과명 */,
    T1.ADT_MTHD_SECD AS ADT_MTHD_SECD /* 감사방법구분코드 */,
    T1.AUD_WAY_NM AS AUD_WAY_NM,
    T1.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    T1.ADT_SCL_SECD AS ADT_SCL_SECD /* 감사규모구분코드 */,
    T1.TASK_SECD AS TASK_SECD /* 업무구분코드 */,
    T1.TSK_CAT_NM AS TSK_CAT_NM,
    T1.EMPHS_ASMT_SECD AS EMPHS_ASMT_SECD /* 중점과제구분코드 */,
    T1.EPS_TASK_NM AS EPS_TASK_NM,
    T1.ADT_RBPRSN_ENO AS ADT_RBPRSN_ENO /* 감사책임자직원전산번호 */,
    T1.WHOL_RBPRSN_JBGD_SECD AS WHOL_RBPRSN_JBGD_SECD /* 전체책임자직급구분코드 */,
    T1.WHOL_RBPRSN_DEPT_CD AS WHOL_RBPRSN_DEPT_CD /* 전체책임자부서코드 */,
    T1.ADT_RPRS_INST_CD AS ADT_RPRS_INST_CD /* 감사대표기관코드 */,
    T1.AUD_RPST_ORG_NM AS AUD_RPST_ORG_NM,
    T1.SPVR_ENO AS SPVR_ENO /* 감리원직원전산번호 */,
    T1.SPVR_DEPT_CD AS SPVR_DEPT_CD /* 감리원부서코드 */,
    T1.SPVR_JBGD_SECD AS SPVR_JBGD_SECD /* 감리원직급구분코드 */,
    T1.ASTN_ENO AS ASTN_ENO /* 보조자직원전산번호 */,
    T1.ASTN_DEPT_CD AS ASTN_DEPT_CD /* 보조자부서코드 */,
    T1.ASTN_JBGD_SECD AS ASTN_JBGD_SECD /* 보조자직급구분코드 */,
    T1.MNG_DEPT_CD AS MNG_DEPT_CD /* 관리부서코드 */,
    T1.MNG_DPT_NM AS MNG_DPT_NM,
    T1.CVLCPT_RCPT_YR AS CVLCPT_RCPT_YR /* 민원접수년도 */,
    T1.CVLCPT_RCPT_RCPT AS CVLCPT_RCPT_RCPT /* 민원접수번호 */,
    T1.CLM_SECD AS CLM_SECD /* 청구구분코드 */,
    T1.RSCH_ASMT_TTL AS RSCH_ASMT_TTL /* 연구과제제목 */,
    T1.AUD_TOT_DRTR_NM AS AUD_TOT_DRTR_NM,
    T1.AUD_TOT_DRTR_BRDV_NM AS AUD_TOT_DRTR_BRDV_NM,
    T1.AUD_TOT_DRTR_RANK_NM AS AUD_TOT_DRTR_RANK_NM,
    T1.BZTRP_BGT_SECD AS BZTRP_BGT_SECD /* 출장예산구분코드 */,
    T1.BZT_BGT_DVSN_NM AS BZT_BGT_DVSN_NM /* 주석처리 - 2016.04.14 yyh , T1.SPVR_NM AS SPVR_NM , T1.SPVR_BRDV_NM AS SPVR_BRDV_NM , T1.SPVR_RANK_NM AS SPVR_RANK_NM , T1.AST_NM AS AST_NM , T1.AST_BRDV_NM AS AST_BRDV_NM , T1.AST_RANK_NM AS AST_RANK_NM */,
    T1.PRGRS_STP_SECD AS PRGRS_STP_SECD /* 진행단계구분코드 */,
    F_CODE_NM('1000785',T1.PRGRS_STP_SECD) || (CASE WHEN T1.BZTRP_BGT_SECD = '1' AND T1.PRGRS_STP_SECD = '02' THEN (SELECT '/'|| F_CODE_NM('1000030',ADT_BZTRP_KDCD) AS PRGRS_STP_SECD /* 진행단계구분코드 */
FROM TB_BADDED002M WHERE BZTRP_YR || BZTRP_SQNO = (SELECT MAX(BZTRP_YR || BZTRP_SQNO) AS BZTRP_YR /* 출장년도 */
FROM TB_BADDED002M WHERE REL_ADT_YR = T1.CVLCPT_ADT_YR AND REL_ADT_NO = T1.ADT_NO ) ) END) AS PRSS_STEP_NM /*진행단계코드명*/ , T1.GKM_CNT AS GKM_CNT /*감사지식갯수*/ , T1.BZT_CNT AS BZT_CNT /*출장수*/ , T1.PRTTN_ADT_YR AS PRTTN_ADT_YR /*분할감사년도 - 2015.07.13 yyh*/ , T1.PRTTN_ADT_NO AS PRTTN_ADT_NO /*분할감사번호 - 2015.07.13 yyh*/ , (SELECT ADT_GRNT_NO /* 감사부여번호 */
FROM TB_BADDED001M WHERE CVLCPT_ADT_YR = T1.PRTTN_ADT_YR AND ADT_NO = T1.PRTTN_ADT_NO) AS DVS_AUD_GRN_NO /*분할감사부여번호 - 2016.05.26 yyh*/ , T1.DVS_AUD_SBJ_NM AS DVS_AUD_SBJ_NM /*분할감사사항명 - 2015.07.13 yyh*/ , T1.REF_AUD_INFO AS REF_AUD_INFO /*해당건을 분리전 감사사항으로 사용하는 건 - 2015.07.13 yyh */ , T1.INTG_ADT_YR AS INTG_ADT_YR /*통합감사년도 - 2015.09.15 yyh*/ , T1.INTG_ADT_NO AS INTG_ADT_NO /*통합감사번호 - 2015.09.15 yyh*/ , (SELECT ADT_GRNT_NO /* 감사부여번호 */
FROM TB_BADDED001M WHERE CVLCPT_ADT_YR = T1.INTG_ADT_YR AND ADT_NO = T1.INTG_ADT_NO) AS ITGT_AUD_GRN_NO /*통합감사부여번호 - 2016.05.26 yyh*/ , T1.ITGT_AUD_SBJ_NM AS ITGT_AUD_SBJ_NM /*통합감사사항명 - 2015.09.15 yyh*/ , T1.ITGT_AUD_INFO AS ITGT_AUD_INFO /*해당건을 통합 감사사항으로 사용하는 건 - 2015.09.15 yyh*/ , T1.DVS_AUD_YR_NO_KND_CD AS DVS_AUD_YR_NO_KND_CD , T1.ITGT_AUD_YR_NO_KND_CD AS ITGT_AUD_YR_NO_KND_CD , T1.ADT_CNTRL_SECD AS ADT_CNTRL_SECD /*감사통제코드 - 2016.06.03 yyh */ , T1.AUD_CTRL_NM AS AUD_CTRL_NM /*감사통제코드명 - 2016.06.03 yyh */ , T1.ACADT_END_YMD AS ACADT_END_YMD /* 종료보고일- 2017.10.31 EUNOK */ , T1.DOC_LIST , T1.SLCT_RPTP_NM FROM ( SELECT D1.ADT_YR AS ADT_YR /* 감사년도 */,
    D1.ADT_NO AS ADT_NO /* 감사번호 */,
    D1.ADT_GRNT_NO AS ADT_GRNT_NO /* 감사부여번호 */,
    F_MNG_KND_AUDYRNO(D1.ADT_YR, D1.ADT_NO, D1.ADT_KDCD, '-') AS ADT_CLSF_NO /* 감사분류번호 */,
    CASE WHEN D1.ADT_YR >= '2016' THEN D1.ADT_KDCD ELSE '' END AS ADT_YR /* 감사년도 */,
    CASE WHEN D1.ADT_YR >= '2016' THEN F_CODE_NM('1000739',D1.ADT_KDCD) ELSE '-' END AS ADT_YR /* 감사년도 */,
    D1.ADT_YR||'-'||SUBSTR(D1.ADT_ASMT_SECD,-1)||'-'||D1.INST_SECD||'-'||SUBSTR(D1.ADT_KDCD,-1) ||'-'||SUBSTR(D1.SPRVSN_DEPT_CD,1,2)||SUBSTR(D1.SPRVSN_DEPT_CD,4,2)||'-'||SUBSTR(D1.ADT_MTHD_SECD,-1)||'-'||D1.ADT_NO AS ADT_YR /* 감사년도 */,
    D1.ADT_ASMT_SECD AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    F_CODE_NM_YEAR('1000008', D1.ADT_ASMT_SECD, D1.ADT_YR) AS F_CODE_NM_YEAR,
    D1.INST_SECD AS INST_SECD /* 기관구분코드 */,
    D1.ADT_KDCD AS ADT_KDCD /* 감사종류코드 */,
    F_CODE_NM_YEAR('1000007', D1.ADT_KDCD, D1.ADT_YR) AS F_CODE_NM_YEAR,
    D1.SPRVSN_DEPT_CD AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    F_DPT_INFO(D1.SPRVSN_DEPT_CD,'1') AS F_DPT_INFO /* 주관국과명 */,
    D1.ADT_MTHD_SECD AS ADT_MTHD_SECD /* 감사방법구분코드 */,
    F_CODE_NM_YEAR('1000009', D1.ADT_MTHD_SECD, D1.ADT_YR) AS F_CODE_NM_YEAR,
    D1.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    D1.ADT_SCL_SECD AS ADT_SCL_SECD /* 감사규모구분코드 */,
    D1.TASK_SECD AS TASK_SECD /* 업무구분코드 */,
    F_CODE_NM('1000120',D1.TASK_SECD) AS F_CODE_NM,
    D1.EMPHS_ASMT_SECD AS EMPHS_ASMT_SECD /* 중점과제구분코드 */,
    F_CODE_NM_YEAR('1000005', D1.EMPHS_ASMT_SECD, D1.ADT_YR) AS F_CODE_NM_YEAR,
    D1.ADT_WHOL_RBPRSN_ENO AS ADT_WHOL_RBPRSN_ENO /* 감사전체책임자직원전산번호 */,
    D1.WHOL_RBPRSN_JBGD_SECD AS WHOL_RBPRSN_JBGD_SECD /* 전체책임자직급구분코드 */,
    D1.WHOL_RBPRSN_DEPT_CD AS WHOL_RBPRSN_DEPT_CD /* 전체책임자부서코드 */,
    D1.ADT_RPRS_INST_CD AS ADT_RPRS_INST_CD /* 감사대표기관코드 */,
    F_ORG_INFO(D1.ADT_RPRS_INST_CD,'1') AS F_ORG_INFO,
    D1.SPVR_ENO AS SPVR_ENO /* 감리원직원전산번호 */,
    D1.SPVR_DEPT_CD AS SPVR_DEPT_CD /* 감리원부서코드 */,
    D1.SPVR_JBGD_SECD AS SPVR_JBGD_SECD /* 감리원직급구분코드 */,
    D1.ASTN_ENO AS ASTN_ENO /* 보조자직원전산번호 */,
    D1.ASTN_DEPT_CD AS ASTN_DEPT_CD /* 보조자부서코드 */,
    D1.ASTN_JBGD_SECD AS ASTN_JBGD_SECD /* 보조자직급구분코드 */,
    D1.MNG_DEPT_CD AS MNG_DEPT_CD /* 관리부서코드 */,
    F_DPT_INFO(D1.MNG_DEPT_CD,'1') AS F_DPT_INFO,
    D1.INFO_RCPT_YR AS INFO_RCPT_YR /* 정보접수년도 */,
    D1.CVLCPT_NO AS CVLCPT_NO /* 민원번호 */,
    D1.CLM_SECD AS CLM_SECD /* 청구구분코드 */,
    D2.TPOF_NM AS TPOF_NM /* 제보명 */,
    F_USR_INFO(D1.ADT_WHOL_RBPRSN_ENO,'2') AS F_USR_INFO,
    F_DPT_INFO(D1.WHOL_RBPRSN_DEPT_CD,'1') AS F_DPT_INFO,
    F_CODE_NM('1000173',D1.WHOL_RBPRSN_JBGD_SECD) AS F_CODE_NM /* 주석처리 - 2016.04.14 yyh , F_USR_INFO(D1.SPVR_CNB,'2') AS SPVR_NM , F_DPT_INFO(D1.SPVR_BRDV_CD,'1') AS SPVR_BRDV_NM , F_CODE_NM('1000173',D1.SPVR_RANK_CD) AS SPVR_RANK_NM , F_USR_INFO(D1.AST_CNB,'2') AS AST_NM , F_DPT_INFO(D1.AST_BRDV_CD,'1') AS AST_BRDV_NM , F_CODE_NM('1000173',D1.AST_RANK_CD) AS AST_RANK_NM */,
    D1.PRGRS_STP_SECD AS PRGRS_STP_SECD /* 진행단계구분코드 */,
    (SELECT COUNT(1) AS 1
FROM TBAEPGKM001M WHERE 1=1 AND CVLCPT_ADT_YR = D1.CVLCPT_ADT_YR AND ADT_NO = D1.ADT_NO ) AS GKM_CNT /*감사지식갯수*/ , (SELECT COUNT(1)
FROM TBBADDED002M WHERE REL_ADT_YR = D1.CVLCPT_ADT_YR AND REL_ADT_NO = D1.ADT_NO ) AS BZT_CNT , D1.PRTTN_ADT_YR AS PRTTN_ADT_YR /* 분할감사년도 - 2015.07.13 yyh */ , D1.PRTTN_ADT_NO AS PRTTN_ADT_NO /* 분할감사번호 - 2015.07.13 yyh */ , (SELECT CASE WHEN MAX(CVLCPT_ADT_YR) >= '2016' THEN SUBSTR(MAX(ADT_KDCD),3,1) ELSE '' AS CVLCPT_ADT_YR /* 민원감사년도 */
FROM TBBADDED001M WHERE CVLCPT_ADT_YR = D1.PRTTN_ADT_YR AND ADT_NO = D1.PRTTN_ADT_NO) AS DVS_AUD_YR_NO_KND_CD /* 분리전 감사사항 감사연번호종류코드 - 2015.12.28 yyh */ , (SELECT MAX(ADT_MTTR_NM) AS ADT_MTTR_NM /* 감사사항명 */
FROM TBBADDED001M WHERE CVLCPT_ADT_YR = D1.PRTTN_ADT_YR AND ADT_NO = D1.PRTTN_ADT_NO) AS DVS_AUD_SBJ_NM /* 분할감사사항명 - 2015.07.13 yyh */ , (SELECT MAX('(' || CVLCPT_ADT_YR || '-' || ADT_NO || ')' || ADT_MTTR_NM) AS CVLCPT_ADT_YR /* 민원감사년도 */
FROM TBBADDED001M WHERE PRTTN_ADT_YR = D1.CVLCPT_ADT_YR AND PRTTN_ADT_NO = D1.ADT_NO) AS REF_AUD_INFO /* 해당건을 분리전 감사사항으로 사용하는 건 - 2015.07.13 yyh */ , D1.INTG_ADT_YR AS INTG_ADT_YR /* 통합감사년도 - 2015.09.15 yyh */ , D1.INTG_ADT_NO AS INTG_ADT_NO /* 통합감사번호 - 2015.09.15 yyh */ , (SELECT CASE WHEN MAX(CVLCPT_ADT_YR) >= '2016' THEN SUBSTR(MAX(ADT_KDCD),3,1) ELSE '' AS CVLCPT_ADT_YR /* 민원감사년도 */
FROM TBBADDED001M WHERE CVLCPT_ADT_YR = D1.INTG_ADT_YR AND ADT_NO = D1.INTG_ADT_NO) AS ITGT_AUD_YR_NO_KND_CD /* 통합처리 감사사항 감사연번호종류코드 - 2015.12.28 yyh */ , (SELECT MAX(ADT_MTTR_NM) AS ADT_MTTR_NM /* 감사사항명 */
FROM TBBADDED001M WHERE CVLCPT_ADT_YR = D1.INTG_ADT_YR AND ADT_NO = D1.INTG_ADT_NO) AS ITGT_AUD_SBJ_NM /* 통합감사사항명 - 2015.09.15 yyh */ , (SELECT MAX('(' || CVLCPT_ADT_YR || '-' || ADT_NO || ')' || ADT_MTTR_NM) AS CVLCPT_ADT_YR /* 민원감사년도 */
FROM TBBADDED001M WHERE INTG_ADT_YR = D1.CVLCPT_ADT_YR AND INTG_ADT_NO = D1.ADT_NO) AS ITGT_AUD_INFO /* 해당건을 통합전 감사사항으로 사용하는 건 - 2015.09.15 yyh */ , D1.ADT_CNTRL_SECD AS ADT_CNTRL_SECD , F_CODE_NM('1000753',D1.ADT_CNTRL_SECD) AS AUD_CTRL_NM /*감사통제코드명 - 2016.06.03 yyh */ /* 예산구분 추가 - 2016.06.16 yyh */ , D1.BZTRP_BGT_SECD AS BZTRP_BGT_SECD , F_CODE_NM('1000751',D1.BZTRP_BGT_SECD) AS BZT_BGT_DVSN_NM , D3.ACADT_END_YMD /* 종료보고일 - 2017.10.31 EUNOK */ , D4.DOC_LIST , D4.SLCT_RPTP_NM FROM TBBADDED001M D1 , TBCSPDCP101M D2 , TBBADDED003M D3 ,(SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    SUBSTR(XMLAGG(XMLELEMENT(X,'||',CVLCPT_DOC_ID) ORDER BY CVLCPT_ADT_YR,ADT_NO,ADT_STP_SECD,CVLCPT_DOC_ID).EXTRACT('//text()'),3) AS SUBSTR,
    SUBSTR(XMLAGG(XMLELEMENT(X,'||',SLCT_RPTP_NM) ORDER BY CVLCPT_ADT_YR,ADT_NO,ADT_STP_SECD,CVLCPT_DOC_ID).EXTRACT('//text()'),3) AS SLCT_RPTP_NM /* 청탁보고서명 */
FROM TBBADDED103M WHERE ADT_STP_SECD = 'A1050' AND SLCT_RPTP_KDCD = 'A10500500' /*정보보고서 1: 보고 , 2:미보고 */ AND ATRZ_STTS_SECD IS NOT NULL AND ATRZ_STTS_SECD > '10' AND ATRZ_STTS_SECD IS NULL OR ATRZ_STTS_SECD ='10' GROUP BY CVLCPT_ADT_YR ,ADT_NO) D4 WHERE 1=1 AND D1.CVLCPT_RCPT_YR = D2.CVLCPT_RCPT_YR(+) AND D1.CVLCPT_RCPT_RCPT = D2.CVLCPT_RCPT_RCPT(+) AND D1.CLM_SECD = D2.CLM_SECD(+) AND D1.CVLCPT_ADT_YR = D3.CVLCPT_ADT_YR(+) AND D1.ADT_NO = D3.ADT_NO(+) AND D1.CVLCPT_ADT_YR = D4.CVLCPT_ADT_YR(+) AND D1.ADT_NO = D4.ADT_NO(+) /*AND D1.AUD_NO NOT LIKE '9%' 서면모니터링을 걸러내야하므로*/ AND D1.ADT_KDCD NOT LIKE '175' /* 확인출장 제외 */ AND D3.ACADT_BGNG_YMD >= '20170908' /* AND D3.FLD_AUD_STR_DT AND D1.AUD_YR = #strAudYr# /* 감사연번종류코드 - 2015.12.17 yyh */ AND SUBSTR(D1.ADT_KDCD,3,1) = SUBSTR(#strAudYrNoKndCd#,3,1) AND D1.ADT_GRNT_NO = #ADT_GRNT_NO# AND D1.ADT_MTTR_NM LIKE '%'||#strAudSbjNm#||'%' AND D1.PRGRS_STP_SECD = #PRGRS_STP_SECD# AND D1.ADT_KDCD = #ADT_KDCD# AND D1.MNG_DEPT_CD = #MNG_DEPT_CD# AND D1.CLM_SECD = #CLM_SECD# /*종료보고일 1: 도래 , 2: 미도래 */ AND D3.ACADT_END_YMD AND D3.ACADT_END_YMD > TO_CHAR(SYSDATE, 'YYYYMMDD') ) T1