SELECT XX.AUDT_INST_CD /* 수감기관코드 */,
    F_ORG_INFO(XX.AUDT_INST_CD,'1') AS F_ORG_INFO,
    YY.AD_CNT,
    YY.ADT_DCN /* 감사일수 */,
    NVL(ZZ.JIJUKCNT , 0) AS JIJUKCNT,
    NVL(ZZ.DISPREQCNT, 0) AS DISPREQCNT,
    NVL(ZZ.DISPREQPSONCNT, 0) AS DISPREQPSONCNT,
    NVL(ZZ.DISPREQAMT , 0) AS DISPREQAMT,
    NVL(ZZ.FUFILCNT , 0) AS FUFILCNT,
    NVL(ZZ.ALLCNT , 0) AS ALLCNT,
    NVL(ZZ.FUFILCNT , 0) || ' / ' || NVL(ZZ.ALLCNT , 0) AS FUFILCNT
FROM TBFAAAEA022M XX LEFT OUTER JOIN ( SELECT B.AUDT_INST_CD /* 수감기관코드 */,
    NVL(COUNT(*), 0) AS 0,
    NVL(SUM(NVL(B.ADT_DCN, 0)), 0) AS ADT_DCN /* 감사일수 */
FROM TBFAAAEA019M A INNER JOIN TBFAAAEA022M B ON A.INST_CD = B.INST_CD AND A.CVLCPT_ADT_YR = B.CVLCPT_ADT_YR AND A.ADT_SQNO = B.ADT_SQNO WHERE (B.INST_CD = #AUDT_INST_CD# OR B.INST_CD IN (SELECT BFR_INST_CD /* 이전기관코드 */
FROM TBFAAAEA023C WHERE INST_CD = #AUDT_INST_CD# ) ) WHERE (B.INST_CD LIKE REPLACE(#AUDT_INST_CD#,'000','') || '%' OR B.INST_CD IN (SELECT BFR_INST_CD /* 이전기관코드 */
FROM TBFAAAEA023C WHERE INST_CD LIKE REPLACE(#AUDT_INST_CD#,'000','') || '%' ) ) AND B.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND A.ACADT_SECD = '1' AND A.DEL_YN = 'N' AND B.DEL_YN = 'N' GROUP BY B.AUDT_INST_CD ) YY ON XX.AUDT_INST_CD = YY.AUDT_INST_CD LEFT OUTER JOIN ( SELECT REL_INST_CD /* 관계기관코드 */,
    SUM(CASE WHEN EPFC_MNG_SQNO LIKE '10%' THEN 1 ELSE 0 END) AS EPFC_MNG_SQNO /* 사후관리순번 */,
    COUNT(NVL(REL_INST_CD , 0)) AS REL_INST_CD /* 관계기관코드 */,
    SUM(NVL(DISPREQPSONCNT , 0)) AS DISPREQPSONCNT,
    SUM(NVL(DISPREQAMT , 0)) AS DISPREQAMT,
    SUM(EXECNT) AS EXECNT,
    SUM(TOTCNT) AS TOTCNT
FROM ( SELECT #AUDT_INST_CD# AS INST_CD /* 기관코드 */,
    REPLACE(#AUDT_INST_CD#,'000','') ||'000000' AS INST_CD /* 기관코드 */,
    CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_SQNO /* 감사순번 */,
    EPFC_MNG_SQNO /* 사후관리순번 */,
    DSPS_RQT_KDCD /* 처분요구종류코드 */,
    REL_INST_CD /* 관계기관코드 */,
    SUM(CASE WHEN RLPR_NM IS NOT NULL THEN 1 ELSE 0 END) AS RLPR_NM /* 관계자명 */,
    SUM(DSPS_RQT_AMT) AS DSPS_RQT_AMT /* 처분요구금액 */,
    SUM(CASE WHEN BAI_RPT_MNG_NO IS NOT NULL THEN 1 ELSE 0 END) AS BAI_RPT_MNG_NO /* 감사원보고관리번호 */,
    COUNT(*) AS TOTCNT
FROM TBFAAAEA021M WHERE (INST_CD = #AUDT_INST_CD# OR INST_CD IN (SELECT BFR_INST_CD /* 이전기관코드 */
FROM TBFAAAEA023C WHERE INST_CD = #AUDT_INST_CD# ) ) WHERE (INST_CD LIKE REPLACE(#AUDT_INST_CD#,'000','') || '%' OR INST_CD IN (SELECT BFR_INST_CD /* 이전기관코드 */
FROM TBFAAAEA023C WHERE INST_CD LIKE REPLACE(#AUDT_INST_CD#,'000','') || '%' ) ) AND CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND DEL_YN = 'N' GROUP BY INST_CD , CVLCPT_ADT_YR , ADT_SQNO , DSPS_RQT_KDCD , EPFC_MNG_SQNO , REL_INST_CD ) GROUP BY REL_INST_CD ) ZZ ON XX.AUDT_INST_CD = ZZ.REL_INST_CD WHERE XX.AUDT_INST_CD = #AUDT_INST_CD# WHERE XX.AUDT_INST_CD LIKE REPLACE(#AUDT_INST_CD#,'000','') || '%'