SELECT CASE WHEN LENGTH(D1.JRSD_INST_CD) = '12' THEN F_ORG_INFO (D1.JRSD_INST_CD,1) ELSE D1.COPT_ORG_NM END AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    D1.SYS_NM,
    D2.UNT_SYS_NM,
    D3.TBL_NM,
    CASE WHEN D5.COLS IS NOT NULL THEN D5.COLS||'...' ELSE D5.COLS END AS COLS
FROM TBFAAAEA001M D1 LEFT OUTER JOIN TBFAAAEA002M D2 ON D1.SYS_NM = D2.SYS_NM AND D1.JRSD_INST_CD = D2.JRSD_INST_CD LEFT OUTER JOIN TBFAAAEA003M D3 ON D2.UNT_SYS_NM = D3.UNT_SYS_NM AND D2.SYS_NM = D3.SYS_NM AND D2.JRSD_INST_CD = D3.JRSD_INST_CD LEFT OUTER JOIN TBFAAAEA004M D4 ON D3.UNT_SYS_NM = D4.UNT_SYS_NM AND D3.TBL_ID = D4.TBL_ID AND D3.SYS_NM = D4.SYS_NM AND D3.JRSD_INST_CD = D4.JRSD_INST_CD LEFT OUTER JOIN ( SELECT AGGR_CONCAT(COL_NM,', ') AS AGGR_CONCAT,
    TBL_ID /* 테이블아이디 */,
    UNT_SYS_NM,
    SYS_NM,
    JRSD_INST_CD /* 소관기관코드 */
FROM ( SELECT ROW_NUMBER() OVER (PARTITION BY TBL_ID ORDER BY COL_NM DESC) AS ROW_NUMBER,
    TRIM(COL_NM) AS TRIM,
    TBL_ID /* 테이블아이디 */,
    UNT_SYS_NM,
    SYS_NM,
    JRSD_INST_CD /* 소관기관코드 */
FROM TBFAAAEA004M ORDER BY COL_NM DESC ) M WHERE M.RN AND D1.BAI_ORG_CD = #strCoptSgCd# AND D1.BAI_ORG_CD LIKE REPLACE(#strCoptSgCd#,'000','') || '%' AND D1.BAI_ORG_CD = #strCoptSgCd# AND D1.BAI_ORG_CD LIKE REPLACE(#strCoptSgCd#,'000','') || '%' GROUP BY D1.JRSD_INST_CD, D1.COPT_ORG_NM, D1.SYS_NM, D2.UNT_SYS_NM, D3.TBL_NM, D5.COLS ORDER BY D1.JRSD_INST_CD, D1.SYS_NM, D2.UNT_SYS_NM, D3.TBL_NM