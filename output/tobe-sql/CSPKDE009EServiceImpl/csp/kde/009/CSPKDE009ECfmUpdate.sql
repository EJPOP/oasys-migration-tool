DECLARE BEGIN UPDATE TBCSPKDE006L SET /* 과장확인 전산번호 */ CFM_CNB_1 = CASE WHEN CFM_CNB_1 IS NULL AND '30' = #S_INN_RANK_CD# THEN #S_CNB# ELSE CFM_CNB_1 END /* 과장확인 일자 */ , CFM_DT_1 = CASE WHEN CFM_DT_1 IS NULL AND '30' = #S_INN_RANK_CD# THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE CFM_DT_1 END /* 담당확인 전산번호 */ , CFM_CNB_2 = CASE WHEN CFM_CNB_2 IS NULL AND ('30' != #S_INN_RANK_CD# OR #S_INN_RANK_CD# IS NULL) THEN #S_CNB# ELSE CFM_CNB_2 END /* 담당확인 일자 */ , CFM_DT_2 = CASE WHEN CFM_DT_2 IS NULL AND ('30' != #S_INN_RANK_CD# OR #S_INN_RANK_CD# IS NULL) THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE CFM_DT_2 END , LAST_USER_ID = #LAST_USER_ID# /* 최종사용자ID */ , LAST_PRCS_DEPT_CD = #LAST_PRCS_DEPT_CD# /* 최종거래부서코드 */ , LAST_MENU_ID = #LAST_MENU_ID# /* 최종메뉴ID */ , LAST_MDFCN_DT = SYSDATE /* 최종수정일시 */ WHERE 1=1 AND REGI_SRNO = #REGI_SRNO# AND CFM_DPT_CD = #CFM_DPT_CD# ; UPDATE TBCSPKDE005M SET IDNTY_YN = (SELECT CASE WHEN SUM(CASE WHEN (CFM_DT_1 IS NOT NULL AND CFM_DT_2 IS NOT NULL) THEN 1 ELSE 0 END) = COUNT(1) THEN 'Y' ELSE 'N' AS CFM_DT_1
FROM TBCSPKDE006L WHERE REGI_SRNO = #REGI_SRNO#) /* 확인여부 */WHERE REGI_SRNO = #REGI_SRNO# ; END;