SELECT RSTRNT_CD,
    ORD,
    MEAL_DVSN_CD,
    NM,
    NM_1,
    NM_2,
    NM_3,
    NM_4,
    NM_5
FROM ( SELECT *
FROM (WITH DATA AS ( SELECT DDT,
    ROWNUM+1 AS ROWNUM,
    RSTRNT_CD,
    MEAL_DVSN_CD,
    D1.SD_NM_1,
    D1.COO_INF_NM_1,
    D1.COO_INF_NM_2,
    D1.COO_INF_NM_3,
    D1.COO_INF_NM_4,
    D1.COO_INF_NM_5
FROM ( SELECT B.DDT,
    #RSTRNT_CD# AS #RSTRNT_CD#,
    #MEAL_DVSN_CD# AS #MEAL_DVSN_CD#,
    ROWNUM+1 AS ROWNUM,
    D1.SD_NM_1,
    D1.COO_INF_NM_1,
    D1.COO_INF_NM_2,
    D1.COO_INF_NM_3,
    D1.COO_INF_NM_4,
    D1.COO_INF_NM_5
FROM TBCSPMWF002M D1, ( SELECT DDT,
    DY
FROM ( SELECT DDT,
    TO_CHAR(TO_DATE(DDT, 'YYYYMMDD'), 'D') AS TO_CHAR
FROM ( SELECT TO_CHAR( (TO_DATE(#toYmd#, 'YYYYMMDD') - (#currPage# - 1) *7) - LEVEL+1, 'YYYYMMDD') AS TO_CHAR
FROM DUAL CONNECT BY LEVEL <= TO_DATE(#toYmd#, 'YYYYMMDD') - TO_DATE(#fromYmd#, 'YYYYMMDD') - (#currPage# - 1) *7 +1) ) WHERE DY IN('2', '3', '4', '5', '6') ) B WHERE 1=1 AND D1.MNU_DT(+) = B.DDT AND D1.RSTRNT_CD(+) = #RSTRNT_CD# AND D1.MEAL_DVSN_CD(+) = #MEAL_DVSN_CD# ORDER BY DDT DESC) D1) SELECT D2.RSTRNT_CD,
    TO_NUMBER('3') AS TO_NUMBER,
    D2.MEAL_DVSN_CD,
    '주메뉴' AS NM,
    MAX(DECODE(D2.D, 2, D2.SD_NM_1, NULL ) ) AS D,
    MAX(DECODE(D2.D, 3, D2.SD_NM_1, NULL ) ) AS D,
    MAX(DECODE(D2.D, 4, D2.SD_NM_1, NULL ) ) AS D,
    MAX(DECODE(D2.D, 5, D2.SD_NM_1, NULL ) ) AS D,
    MAX(DECODE(D2.D, 6, D2.SD_NM_1, NULL ) ) AS D
FROM DATA D2 WHERE D2.SD_NM_1 IS NOT NULL GROUP BY D2.RSTRNT_CD, D2.MEAL_DVSN_CD UNION ALL SELECT D2.RSTRNT_CD,
    TO_NUMBER('4') AS TO_NUMBER,
    D2.MEAL_DVSN_CD,
    '원산지' AS NM,
    MAX(DECODE(D2.D, 2, D2.COO_INF_NM_1, NULL ) ) AS D,
    MAX(DECODE(D2.D, 3, D2.COO_INF_NM_1, NULL ) ) AS D,
    MAX(DECODE(D2.D, 4, D2.COO_INF_NM_1, NULL ) ) AS D,
    MAX(DECODE(D2.D, 5, D2.COO_INF_NM_1, NULL ) ) AS D,
    MAX(DECODE(D2.D, 6, D2.COO_INF_NM_1, NULL ) ) AS D
FROM DATA D2 WHERE D2.COO_INF_NM_1 IS NOT NULL GROUP BY D2.RSTRNT_CD, D2.MEAL_DVSN_CD UNION ALL SELECT D2.RSTRNT_CD,
    TO_NUMBER('5') AS TO_NUMBER,
    D2.MEAL_DVSN_CD,
    '원산지' AS NM,
    MAX(DECODE(D2.D, 2, D2.COO_INF_NM_2, NULL ) ) AS D,
    MAX(DECODE(D2.D, 3, D2.COO_INF_NM_2, NULL ) ) AS D,
    MAX(DECODE(D2.D, 4, D2.COO_INF_NM_2, NULL ) ) AS D,
    MAX(DECODE(D2.D, 5, D2.COO_INF_NM_2, NULL ) ) AS D,
    MAX(DECODE(D2.D, 6, D2.COO_INF_NM_2, NULL ) ) AS D
FROM DATA D2 WHERE D2.COO_INF_NM_2 IS NOT NULL GROUP BY D2.RSTRNT_CD, D2.MEAL_DVSN_CD UNION ALL SELECT D2.RSTRNT_CD,
    TO_NUMBER('6') AS TO_NUMBER,
    D2.MEAL_DVSN_CD,
    '원산지' AS NM,
    MAX(DECODE(D2.D, 2, D2.COO_INF_NM_3, NULL ) ) AS D,
    MAX(DECODE(D2.D, 3, D2.COO_INF_NM_3, NULL ) ) AS D,
    MAX(DECODE(D2.D, 4, D2.COO_INF_NM_3, NULL ) ) AS D,
    MAX(DECODE(D2.D, 5, D2.COO_INF_NM_3, NULL ) ) AS D,
    MAX(DECODE(D2.D, 6, D2.COO_INF_NM_3, NULL ) ) AS D
FROM DATA D2 WHERE D2.COO_INF_NM_3 IS NOT NULL GROUP BY D2.RSTRNT_CD, D2.MEAL_DVSN_CD UNION ALL SELECT D2.RSTRNT_CD,
    TO_NUMBER('7') AS TO_NUMBER,
    D2.MEAL_DVSN_CD,
    '원산지' AS NM,
    MAX(DECODE(D2.D, 2, D2.COO_INF_NM_4, NULL ) ) AS D,
    MAX(DECODE(D2.D, 3, D2.COO_INF_NM_4, NULL ) ) AS D,
    MAX(DECODE(D2.D, 4, D2.COO_INF_NM_4, NULL ) ) AS D,
    MAX(DECODE(D2.D, 5, D2.COO_INF_NM_4, NULL ) ) AS D,
    MAX(DECODE(D2.D, 6, D2.COO_INF_NM_4, NULL ) ) AS D
FROM DATA D2 WHERE D2.COO_INF_NM_4 IS NOT NULL GROUP BY D2.RSTRNT_CD, D2.MEAL_DVSN_CD UNION ALL SELECT D2.RSTRNT_CD,
    TO_NUMBER('8') AS TO_NUMBER,
    D2.MEAL_DVSN_CD,
    '원산지' AS NM,
    MAX(DECODE(D2.D, 2, D2.COO_INF_NM_5, NULL ) ) AS D,
    MAX(DECODE(D2.D, 3, D2.COO_INF_NM_5, NULL ) ) AS D,
    MAX(DECODE(D2.D, 4, D2.COO_INF_NM_5, NULL ) ) AS D,
    MAX(DECODE(D2.D, 5, D2.COO_INF_NM_5, NULL ) ) AS D,
    MAX(DECODE(D2.D, 6, D2.COO_INF_NM_5, NULL ) ) AS D
FROM DATA D2 WHERE D2.COO_INF_NM_5 IS NOT NULL GROUP BY D2.RSTRNT_CD, D2.MEAL_DVSN_CD ) ORDER BY ORD) A WHERE A.NM IS NOT NULL