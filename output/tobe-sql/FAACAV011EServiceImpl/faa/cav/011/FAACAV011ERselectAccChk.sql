/* faa/cav/011/FAACAV011ERselectAccChk */ SELECT AA.PROF_DRTR_CD,
    AA.EANSUBJCD,
    AA.PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    AA.COPTCDNM,
    AA.ACNTCDNM
FROM (SELECT A.ACNTG_YR /* 회계년도 */,
    A.JRSD_CD||'-'||A.ACNTG_CD||'-'||A.BLL_KDCD||'-'||A.PROF_RBPRSN_SQNO||'-'|| A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO AS JRSD_CD /* 소관코드 */,
    A.EANSUBJCD,
    B.PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    F_AV_BLL_COPT_CD_NM(A.JRSD_CD) AS F_AV_BLL_COPT_CD_NM,
    F_AV_ACNT_CD_NM(A.ACNTG_CD) AS F_AV_ACNT_CD_NM
FROM (SELECT ACNTG_YR /* 회계년도 */,
    JRSD_CD /* 소관코드 */,
    ACNTG_CD /* 회계코드 */,
    BLL_KDCD /* 계산서종류코드 */,
    PROF_RBPRSN_SQNO /* 증명책임자순번 */,
    GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO /* 관서운영경비출납공무원순번 */,
    dguard.decrypt('TB_ENC','EAN',ACTNO_SCRTY)||'-'||ACNT_SBJCT_SECD AS DECRYPT
FROM TWFAACAV062L WHERE ACNTG_YR = #ACNTG_YR# GROUP BY ACNTG_YR,JRSD_CD,ACNTG_CD,BLL_KDCD,PROF_RBPRSN_SQNO,GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO,dguard.decrypt('TB_ENC','EAN',ACTNO_SCRTY)||'-'||ACNT_SBJCT_SECD ) A ,TWFAACAV003M B WHERE A.JRSD_CD = B.JRSD_CD AND A.ACNTG_CD = B.ACNTG_CD AND A.BLL_KDCD = B.BLL_KDCD AND A.PROF_RBPRSN_SQNO = B.PROF_RBPRSN_SQNO AND A.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO = B.GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO ) AA , (SELECT ACNTG_YR /* 회계년도 */,
    dguard.decrypt('TB_ENC','EAN',ACTNO_SCRTY)||'-'||ACNT_SBJCT_SECD AS DECRYPT
FROM TWFAACAV062L WHERE ACNTG_YR = #ACNTG_YR# GROUP BY ACNTG_YR,dguard.decrypt('TB_ENC','EAN',ACTNO_SCRTY),ACNT_SBJCT_SECD HAVING COUNT(DISTINCT ACNTG_YR||JRSD_CD||ACNTG_CD||BLL_KDCD||PROF_RBPRSN_SQNO||GVMNFC_OPER_EPS_RCDB_PBOFC_SQNO) > 1 ) BB WHERE AA.EANSUBJCD = BB.EANSUBJCD