SELECT D1.ADT_YR AS ADT_YR /* 감사년도 */,
    D1.ADT_NO AS ADT_NO /* 감사번호 */,
    F_MNG_KND_AUDYRNO(D4.ADT_YR, D4.ADT_NO, D4.ADT_KDCD, '-') AS ADT_CLSF_NO /* 감사분류번호 */,
    D1.DSPS_RQT_SQNO AS DSPS_RQT_SQNO /* 처분요구순번 */,
    F_MNG_KND_AUDYRNO(D4.ADT_YR, D4.ADT_NO, D4.ADT_KDCD, '-') ||'-'|| D1.DSPS_RQT_SQNO AS ADT_DSPS_RQT_SQNO /* 감사처분요구순번 */,
    D4.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    D3.ADT_MTTR_NM /* 감사사항명 */,
    D1.DSPS_RQT_NM AS DSPS_RQT_NM /* 처분요구명 */,
    D4.SPRVSN_DEPT_CD AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    F_DPT_INFO(D4.SPRVSN_DEPT_CD,'1') AS F_DPT_INFO /* 주관국과명 */,
    F_CODE_NM('1000002',D1.DSPS_RQT_KDCD ) AS DSPS_RQT_KND_CVN /* 처분요구종류코드값명 */,
    CASE WHEN D3.HMPG_RLS_YN = 'N' THEN '비공개' ELSE '공개' END AS HMPG_RLS_YN /* 누리집공개여부 */,
    D3.HMPG_RLS_YN /* 누리집공개여부 */,
    D3.REL_INST_CD /* 관계기관코드 */,
    D3.REL_INST_NM /* 관계기관명 */,
    F_CODE_NM('1000120',D2.TASK_SECD) AS F_CODE_NM /* 업무분류명 */,
    D3.RLS_TTL_CN /* 공개제목내용 */,
    D3.RLS_CN /* 공개내용 */,
    CASE WHEN D3.RPRS_INST_CD IS NOT NULL THEN D3.RPRS_INST_CD WHEN ( SELECT COUNT(*) AS RPRS_INST_CD /* 대표기관코드 */
FROM TBBADEAR032M S1 WHERE D3.REL_INST_CD = S1.INST_CD ) = 1 THEN ( SELECT S1.RPRS_INST_CD /* 대표기관코드 */
FROM TBBADEAR032M S1 WHERE D3.REL_INST_CD = S1.INST_CD ) ELSE NULL END AS RPRS_INST_CD , CASE WHEN D2.CFMTN_STTS_SECD = '1' THEN '처분확정' WHEN D2.CFMTN_STTS_SECD = '2' THEN '집행확정' ELSE '미확정' END AS DTM_STA_NM /*처분확정여부*/ , NVL(D2.CFMTN_STTS_SECD,0) AS CFMTN_STTS_SECD ,TO_CHAR(D3.LAST_MDFCN_DT, 'YYYY-MM-DD HH24:MI') AS FNL_MDF_DT ,D3.DOC_ID ,CASE WHEN D3.DOC_ID IS NULL AND CSD_TRSF_SCS_YN IS NULL THEN '공개문 미생성' WHEN D3.DOC_ID IS NULL AND CSD_TRSF_SCS_YN = 'Z' THEN '공개문 미존재' WHEN D3.DOC_ID IS NOT NULL AND CSD_TRSF_SCS_YN IS NULL THEN '공개문 생성중' WHEN D3.DOC_ID IS NOT NULL AND CSD_TRSF_SCS_YN = 'Y' THEN '공개문 생성 성공' WHEN D3.DOC_ID IS NOT NULL AND CSD_TRSF_SCS_YN = 'N' THEN '공개문 생성 실패' ELSE '' END AS CSD_YN_NM ,D3.CSD_TRSF_SCS_YN AS CSD_TRSF_SCS_YN ,D5.RPST_ORG_NM ,NVL(NVL(D3.REG_YMD, D6.REG_YMD),D2.ENFC_YMD) AS REG_YMD ,F_USR_INFO_BY_ID(D3.FRST_USER_ID, '2') AS PRL_SMT_USR_NM ,F_CODE_NM('1000756',NVL(PRGRS_STTS_SECD,'10')) AS PRSS_STA_NM FROM TB_BADEAR001M D1 /*처분요구사항기본*/ ,TB_BADEAR002D D2 /*처분요구사항상세*/ ,TB_BADEAR030M D3 /*홍보제출기본*/ ,TB_BADDED001M D4 /*감사사항기본*/ ,TBBADEAR033M D5 ,( SELECT ADT_SQNO /* 감사순번 */,
    MIN(REG_YMD) AS REG_YMD /* 등록일자 */
FROM TBBADEAR028M WHERE REG_YMD IS NOT NULL AND NVL(UDC_YN,'N') = 'N' GROUP BY ADT_SQNO) D6 ,(SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    MIN(SRECS_REL_INST_CD) AS SRECS_REL_INST_CD /* 심사재심의관계기관코드 */,
    MIN(IMPL_MNG_INST_CD) AS IMPL_MNG_INST_CD /* 집행관리기관코드 */
FROM TBBADEAR006M WHERE 1=1 GROUP BY CVLCPT_ADT_YR ,ADT_NO ,DSPS_RQT_SQNO ) REL WHERE D4.ADT_YR = D1.ADT_YR AND D4.ADT_NO = D1.ADT_NO AND D1.ADT_YR = D2.ADT_YR AND D1.ADT_NO = D2.ADT_NO AND D1.DSPS_RQT_SQNO = D2.DSPS_RQT_SQNO AND D1.ADT_YR = D3.ADT_YR AND D1.ADT_NO = D3.ADT_NO AND D1.DSPS_RQT_SQNO = D3.DSPS_RQT_SQNO AND D1.ADT_YR = REL.CVLCPT_ADT_YR(+) AND D1.ADT_NO = REL.ADT_NO(+) AND D1.DSPS_RQT_SQNO = REL.DSPS_RQT_SQNO(+) AND D1.ADT_YR = #CVLCPT_ADT_YR# AND D1.ADT_NO = #ADT_NO# AND D3.RPRS_INST_CD = D5.RPRS_INST_CD(+) AND D3.ADT_YR||D3.ADT_NO = D6.ADT_SQNO(+) AND D1.DSPS_RQT_KDCD NOT IN ('710','720') /*화면의 관계기관 FROM 만 입력 했을때*/ AND REL.SRECS_REL_INST_CD = #SRECS_REL_INST_CD# /*화면의 관계기관 FROM - TO를 다 입력 했을때*/ AND REL.SRECS_REL_INST_CD BETWEEN #SRECS_REL_INST_CD# AND #strRltnOrgCdEnd# /*화면의 관계기관 TO만 다 입력 했을때*/ AND REL.SRECS_REL_INST_CD BETWEEN '000000000000' AND #strRltnOrgCdEnd# AND REL.SRECS_REL_INST_CD IN #strSelectOrgCds[]# ORDER BY D1.DSPS_RQT_SQNO