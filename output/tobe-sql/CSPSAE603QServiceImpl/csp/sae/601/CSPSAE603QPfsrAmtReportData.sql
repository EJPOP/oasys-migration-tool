SELECT A.LINK_YR /* 연계년도 */,
    A.EDU_DVSN_NM,
    A.CRS_NM /* 과정명 */,
    A.CRS_CD,
    A.CNT_SUBJ_CD_01,
    A.CNT_PFSR_ID_01,
    A.PMT_AMT_01,
    A.CNT_SUBJ_CD_03,
    A.CNT_PFSR_ID_03,
    A.PMT_AMT_03,
    A.GIVE_AMT /* 지급금액 */
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    D.EDU_DVSN_NM,
    D.EDU_DVSN_CD,
    C.EDU_CAT_CD,
    A.CRS_CD,
    B.CRS_NM /* 과정명 */,
    A.CNT_SUBJ_CD_01,
    A.CNT_PFSR_ID_01,
    A.PMT_AMT_01,
    A.CNT_SUBJ_CD_03,
    A.CNT_PFSR_ID_03,
    A.PMT_AMT_03,
    (A.PMT_AMT_01 + A.PMT_AMT_03) AS GIVE_AMT /* 지급금액 */
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    SUM(A.CNT_SUBJ_CD_01) AS CNT_SUBJ_CD_01,
    SUM(A.CNT_PFSR_ID_01) AS CNT_PFSR_ID_01,
    SUM(A.PMT_AMT_01) AS PMT_AMT_01,
    SUM(A.CNT_SUBJ_CD_03) AS CNT_SUBJ_CD_03,
    SUM(A.CNT_PFSR_ID_03) AS CNT_PFSR_ID_03,
    SUM(A.PMT_AMT_03) AS PMT_AMT_03
FROM ( SELECT B.LINK_YR /* 연계년도 */,
    B.CRS_CD,
    B.CRS_CDN /* 과정기수 */,
    NVL(A.CNT_SUBJ_CD_01, 0) AS CNT_SUBJ_CD_01,
    NVL(A.CNT_PFSR_ID_01, 0) AS CNT_PFSR_ID_01,
    NVL(A.PMT_AMT_01, 0) AS PMT_AMT_01,
    NVL(A.CNT_SUBJ_CD_03, 0) AS CNT_SUBJ_CD_03,
    NVL(A.CNT_PFSR_ID_03, 0) AS CNT_PFSR_ID_03,
    NVL(A.PMT_AMT_03, 0) AS PMT_AMT_03
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_CDN /* 과정기수 */,
    ( CASE A.PFSR_DVSN_CD WHEN '1' THEN SUM(A.GIVE_AMT) END ) AS PFSR_DVSN_CD,
    ( CASE A.PFSR_DVSN_CD WHEN '3' THEN SUM(A.GIVE_AMT) END ) AS PFSR_DVSN_CD,
    0,
    0,
    0,
    0
FROM ( SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_CDN /* 과정기수 */,
    A.SUBJ_CD,
    A.PFSR_ID,
    B.PFSR_DVSN_CD,
    A.GIVE_AMT /* 지급금액 */
FROM TBCSPSAE305D A, TBCSPSAE109M B WHERE B.PFSR_ID = A.PFSR_ID AND A.LINK_YR BETWEEN #strFromY# AND #strToY# ) A GROUP BY A.LINK_YR, A.CRS_CD, A.CRS_CDN, A.PFSR_DVSN_CD UNION ALL SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_CDN /* 과정기수 */,
    0,
    0,
    ( CASE A.PFSR_DVSN_CD WHEN '1' THEN COUNT(A.SUBJ_CD) END ) AS PFSR_DVSN_CD,
    ( CASE A.PFSR_DVSN_CD WHEN '3' THEN COUNT(A.SUBJ_CD) END ) AS PFSR_DVSN_CD,
    0,
    0
FROM ( SELECT DISTINCT A.LINK_YR AS LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_CDN /* 과정기수 */,
    A.SUBJ_CD,
    B.PFSR_DVSN_CD
FROM TBCSPSAE305D A, TBCSPSAE109M B WHERE B.PFSR_ID = A.PFSR_ID AND A.LINK_YR BETWEEN #strFromY# AND #strToY# ) A GROUP BY A.LINK_YR, A.CRS_CD, A.CRS_CDN, A.PFSR_DVSN_CD, A.SUBJ_CD UNION ALL SELECT A.LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_CDN /* 과정기수 */,
    0,
    0,
    0,
    0,
    ( CASE A.PFSR_DVSN_CD WHEN '1' THEN COUNT(A.PFSR_ID) END ) AS PFSR_DVSN_CD,
    ( CASE A.PFSR_DVSN_CD WHEN '3' THEN COUNT(A.PFSR_ID) END ) AS PFSR_DVSN_CD
FROM ( SELECT DISTINCT A.LINK_YR AS LINK_YR /* 연계년도 */,
    A.CRS_CD,
    A.CRS_CDN /* 과정기수 */,
    A.PFSR_ID,
    B.PFSR_DVSN_CD
FROM TBCSPSAE305D A, TBCSPSAE109M B WHERE B.PFSR_ID = A.PFSR_ID AND A.LINK_YR BETWEEN #strFromY# AND #strToY# ) A GROUP BY A.LINK_YR, A.CRS_CD, A.CRS_CDN, A.PFSR_DVSN_CD, A.PFSR_ID ) A, ( SELECT LINK_YR /* 연계년도 */,
    CRS_CD,
    CRS_CDN /* 과정기수 */
FROM TBCSPSAE201D WHERE LINK_YR BETWEEN #strFromY# AND #strToY# AND SUBSTR(EDU_BGNG_YMD, 0, 6) BETWEEN #strFromY# || #strFromM# AND #strToY# || #strToM# ) B WHERE B.LINK_YR = A.LINK_YR(+) AND B.CRS_CD = A.CRS_CD(+) AND B.CRS_CDN = A.CRS_CDN(+) ) A GROUP BY A.LINK_YR, A.CRS_CD ) A , TBCSPSAE103C B , TBCSPSAE102C C , TBCSPSAE101C D WHERE B.CRS_CD = A.CRS_CD AND C.EDU_CAT_CD = B.EDU_CAT_CD AND C.EDU_DVSN_CD = B.EDU_DVSN_CD AND D.EDU_DVSN_CD = B.EDU_DVSN_CD ) A WHERE 1=1 AND A.EDU_DVSN_CD = #strEDU_DVSN_CD# AND A.EDU_CAT_CD = #strEDU_CAT_CD# AND A.CRS_CD = #strEDU_CRS_CD# ORDER BY A.LINK_YR, A.EDU_DVSN_CD ASC, A.CRS_CD ASC