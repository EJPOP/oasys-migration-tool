SELECT T22.ATRZ_DOC_NO /* 결재문서번호 */,
    T22.TPOF_ATRZ_SECD /* 제보결재구분코드 */,
    T22.TSK_KY_TXT,
    T22.ATRZ_STTS_SECD /* 결재상태구분코드 */,
    F_CODE_NM('1000333',T22.ATRZ_STTS_SECD) AS F_CODE_NM,
    T22.APV_TIT_NM,
    T22.SBM_CNB,
    F_USR_INFO(SBM_CNB,'2') AS F_USR_INFO,
    T22.SBM_DH,
    T22.FNL_APV_CNB,
    T22.CRU_LAST_ATRZ_DT /* 부패최종결재일시 */,
    CASE WHEN T22.TPOF_ATRZ_SECD IN ('requestAudit1','requestAudit2','requestAudit3') THEN (SELECT T2.TPOF_RCPT_YR||'-'||F_CODE_NM('1000740',T2.CVLCPT_CLM_SECD)||'-'||T2.TPOF_ACTL_RCPT_NO AS TPOF_ATRZ_SECD /* 제보결재구분코드 */
FROM TB_CSPDCP603M T1, TB_CSPDCP101M T2 WHERE T1.ATRZ_DMND_ID = T22.ATRZ_DOC_NO AND T1.CLM_SECD = T2.CVLCPT_CLM_SECD AND T1.CVLCPT_RCPT_YR = T2.TPOF_RCPT_YR AND T1.CVLCPT_RCPT_RCPT = T2.TPOF_RCPT_NO ) WHEN T22.TPOF_ATRZ_SECD = 'fieldAudit' THEN F_MNG_KND_AUDYRNO(AD.CVLCPT_ADT_YR, AD.ADT_NO, AD.ADT_KDCD, '-') WHEN T22.TPOF_ATRZ_SECD IN ('AudInfoSend','AudInfoHndl') THEN (SELECT INFO_YR||'-'||FRS_MDM_SQNO AS INFO_YR /* 정보년도 */
FROM TB_CSPBII100M S1 WHERE T22.ATRZ_DOC_NO = S1.ATRZ_DOC_NO ) WHEN T22.TPOF_ATRZ_SECD = 'AudInfoHndl2' THEN (SELECT INFO_YR||'-'||FRS_MDM_SQNO AS INFO_YR /* 정보년도 */
FROM TB_CSPBII170M S1 WHERE T22.ATRZ_DOC_NO = S1.ATRZ_DOC_NO ) /* 이행상황결재 추가 - 2018.03.28 yyh */ WHEN T22.TPOF_ATRZ_SECD = 'DspRqApv' THEN (SELECT F_MNG_KND_AUDYRNO(CVLCPT_ADT_YR, ADT_NO, '', '-') || '-' || AS DSPS_RQT_SQNO /* 처분요구순번 */
FROM TB_BADEAR002D WHERE ATRZ_DOC_NO = T22.ATRZ_DOC_NO) ELSE NULL END AS ADT_CLSF_NO , '' AS AUD_KND_NM ,CASE WHEN T22.TPOF_ATRZ_SECD IN ('requestAudit1','requestAudit2','requestAudit3') THEN (SELECT T2.TPOF_NM /* 제보명 */
FROM TB_CSPDCP603M T1, TB_CSPDCP101M T2 WHERE T1.ATRZ_DMND_ID = T22.ATRZ_DOC_NO AND T1.CLM_SECD = T2.CVLCPT_CLM_SECD AND T1.CVLCPT_RCPT_YR = T2.TPOF_RCPT_YR AND T1.CVLCPT_RCPT_RCPT = T2.TPOF_RCPT_NO ) WHEN T22.TPOF_ATRZ_SECD = 'fieldAudit' THEN AD.ADT_MTTR_NM||'('||F_DPT_INFO(AD.MNG_DEPT_CD, '4')||')' WHEN T22.TPOF_ATRZ_SECD IN ('AudInfoSend','AudInfoHndl') THEN (SELECT DSPS_RQT_NM /* 처분요구명 */
FROM TB_CSPBII100M S1 WHERE T22.ATRZ_DOC_NO = S1.ATRZ_DOC_NO ) WHEN T22.TPOF_ATRZ_SECD = 'AudInfoHndl2' THEN (SELECT DSPS_RQT_NM /* 처분요구명 */
FROM TB_CSPBII170M S1 WHERE T22.ATRZ_DOC_NO = S1.ATRZ_DOC_NO ) WHEN T22.TPOF_ATRZ_SECD = 'portalNotiApv' THEN (SELECT S1.TITLE
FROM CTT_IMSI S1 WHERE T22.ATRZ_DOC_NO = S1.ATRZ_DOC_NO ) /* 이행상황결재시에 처분종류 추가 - 2018.03.28 yyh */ WHEN T22.TPOF_ATRZ_SECD = 'DspRqApv' THEN (SELECT F_CODE_NM('1000002', D1.DSPS_RQT_KDCD) AS DSPS_RQT_KDCD /* 처분요구종류코드 */
FROM TB_BADEAR001M D1 ,TB_BADEAR002D D2 WHERE D1.CVLCPT_ADT_YR = D2.ADT_YR AND D1.ADT_NO = D2.ADT_NO AND D1.DSPS_RQT_SQNO = D2.DSPS_RQT_SQNO AND D2.ATRZ_DOC_NO = T22.ATRZ_DOC_NO) ELSE NULL END AS ADT_MTTR_NM , AD.AUD_DOC_NM , '' AS MNG_DPT_NM , F_DPT_INFO(T22.APV_DPT_CD,'4') AS APV_DPT_NM FROM ( SELECT D3.ATRZ_DOC_NO /* 결재문서번호 */,
    D3.TPOF_ATRZ_SECD /* 제보결재구분코드 */
FROM ( SELECT ATRZ_DOC_NO /* 결재문서번호 */,
    TPOF_ATRZ_SECD /* 제보결재구분코드 */
FROM TBDCMACM023L WHERE APRVR_ENO = #APRVR_ENO# AND APVR_SEQ = 1 ) D3 , (SELECT D1.ATRZ_DOC_NO /* 결재문서번호 */,
    D1.TPOF_ATRZ_SECD /* 제보결재구분코드 */
FROM TBDCMACM023L D1 , TBDCMACM001M D2 WHERE D1.APRVR_ENO = D2.TRGT_NOP_ENO AND D2.USER_NM LIKE '%'||#strUsrNam#||'%' ) D4 WHERE D3.ATRZ_DOC_NO = D4.ATRZ_DOC_NO AND D3.TPOF_ATRZ_SECD = D4.TPOF_ATRZ_SECD ) T23 , TBDCMACM022L T22 , ( SELECT A.ADT_YR /* 감사년도 */,
    A.ADT_NO /* 감사번호 */,
    C.ADT_KDCD /* 감사종류코드 */,
    C.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    AGGR_CONCAT (CASE WHEN SLCT_RPTP_KDCD = 'A10600100' THEN '개별처분요구안' WHEN SLCT_RPTP_KDCD = 'A10951200' THEN '조사개시통보' WHEN SLCT_RPTP_KDCD = 'A10951300' THEN '조사종료통보' WHEN SLCT_RPTP_KDCD = 'A10600200' THEN '감사보고서' WHEN SLCT_RPTP_KDCD = 'A10920100' THEN '검토의견/보고서' ELSE ( SELECT AGGR_CONCAT (DTL_ADT_DOC_NM,',') AS DTL_ADT_DOC_NM /* 상세감사문서명 */
FROM TBFDMADM002M WHERE ADT_DOC_SECD = A.SLCT_RPTP_KDCD GROUP BY ADT_DOC_SECD) END,',') AS AUD_DOC_NM, C.MNG_DEPT_CD, A.ATRZ_DMND_ID FROM TBBADDED103M A LEFT OUTER JOIN TBBADDED001M C ON (A.CVLCPT_ADT_YR = C.CVLCPT_ADT_YR AND A.ADT_NO = C.ADT_NO) WHERE A.ATRZ_DMND_ID IS NOT NULL GROUP BY A.CVLCPT_ADT_YR, A.ADT_NO, C.ADT_KDCD, C.ADT_MTTR_NM, C.MNG_DEPT_CD, A.ATRZ_DMND_ID) OTSD_EXPRT_ADDR WHERE T22.ATRZ_DOC_NO =T23.ATRZ_DOC_NO(+) AND T22.TPOF_ATRZ_SECD = T23.TPOF_ATRZ_SECD(+) AND T22.SBM_CNB = #APRVR_ENO# AND T22.SBM_DH BETWEEN #strSbmDyFrom#||'000000' AND #strSbmDyTo#||'235959' /* AND T22.APV_STA_CD = '3' 승인된 문서만 조회하도록 추가*/ AND T22.ATRZ_DOC_NO = AD.ATRZ_DMND_ID(+) T22.APV_TIT_NM LIKE '%'||#strApvTit#||'%' T22.ATRZ_STTS_SECD = #ATRZ_STTS_SECD# T22.TPOF_ATRZ_SECD IN ('fieldAudit','fieldAuditMain') T22.TPOF_ATRZ_SECD = #TPOF_ATRZ_SECD# ORDER BY T22.ATRZ_STTS_SECD, T22.SBM_DH DESC