SELECT T22.ATRZ_DOC_NO /* 결재문서번호 */,
    T22.TPOF_ATRZ_SECD /* 제보결재구분코드 */,
    T22.TSK_KY_TXT,
    T22.ATRZ_STTS_SECD /* 결재상태구분코드 */,
    F_CODE_NM('1000333',T22.ATRZ_STTS_SECD) AS F_CODE_NM,
    T22.APV_TIT_NM,
    T22.SBM_CNB,
    F_USR_INFO(T22.SBM_CNB,'2') AS F_USR_INFO,
    T23.APRVR_ENO /* 결재자직원전산번호 */,
    F_USR_INFO(T23.APRVR_ENO,'2') AS F_USR_INFO,
    T22.SBM_DH,
    T22.FNL_APV_CNB,
    T22.CRU_LAST_ATRZ_DT /* 부패최종결재일시 */,
    T23.APV_SNO,
    T23.APVR_STA_CD,
    T23.APRVR_KDCD /* 결재자종류코드 */,
    T21.APV_DVSN_NM,
    T23.APVR_SEQ,
    CASE WHEN T22.TPOF_ATRZ_SECD IN ('requestAudit1','requestAudit2','requestAudit3') THEN (SELECT T2.TPOF_RCPT_YR||'-'||F_CODE_NM('1000740',T2.CVLCPT_CLM_SECD)||'-'||T2.TPOF_ACTL_RCPT_NO AS TPOF_ATRZ_SECD /* 제보결재구분코드 */
FROM TB_CSPDCP603M T1, TB_CSPDCP101M T2 WHERE T1.ATRZ_DMND_ID = T22.ATRZ_DOC_NO AND T1.CLM_SECD = T2.CVLCPT_CLM_SECD AND T1.CVLCPT_RCPT_YR = T2.TPOF_RCPT_YR AND T1.CVLCPT_RCPT_RCPT = T2.TPOF_RCPT_NO ) WHEN T22.TPOF_ATRZ_SECD = 'fieldAudit' THEN F_MNG_KND_AUDYRNO(AD.CVLCPT_ADT_YR, AD.ADT_NO, AD.ADT_KDCD, '-') WHEN T22.TPOF_ATRZ_SECD IN ('AudInfoSend','AudInfoHndl') THEN (SELECT INFO_YR||'-'||FRS_MDM_SQNO AS INFO_YR /* 정보년도 */
FROM TB_CSPBII100M S1 WHERE T22.ATRZ_DOC_NO = S1.ATRZ_DOC_NO ) ELSE NULL END AS ADT_CLSF_NO , '' AS AUD_KND_NM ,CASE WHEN T22.TPOF_ATRZ_SECD IN ('requestAudit1','requestAudit2','requestAudit3') THEN (SELECT T2.TPOF_NM /* 제보명 */
FROM TB_CSPDCP603M T1, TB_CSPDCP101M T2 WHERE T1.ATRZ_DMND_ID = T22.ATRZ_DOC_NO AND T1.CLM_SECD = T2.CVLCPT_CLM_SECD AND T1.CVLCPT_RCPT_YR = T2.TPOF_RCPT_YR AND T1.CVLCPT_RCPT_RCPT = T2.TPOF_RCPT_NO ) WHEN T22.TPOF_ATRZ_SECD = 'fieldAudit' THEN AD.ADT_MTTR_NM||'('||F_DPT_INFO(AD.MNG_DEPT_CD, '4')||')' WHEN T22.TPOF_ATRZ_SECD IN ('AudInfoSend','AudInfoHndl') THEN (SELECT DSPS_RQT_NM /* 처분요구명 */
FROM TB_CSPBII100M S1 WHERE T22.ATRZ_DOC_NO = S1.ATRZ_DOC_NO ) ELSE NULL END AS ADT_MTTR_NM , AD.AUD_DOC_NM , '' AS MNG_DPT_NM , F_DPT_INFO(T22.APV_DPT_CD,'4') AS APV_DPT_NM FROM TBDCMACM022L T22, TBDCMACM023L T23, TBDCMACM021M T21 , ( SELECT A.ADT_YR /* 감사년도 */,
    A.ADT_NO /* 감사번호 */,
    C.ADT_KDCD /* 감사종류코드 */,
    C.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    AGGR_CONCAT (CASE WHEN SLCT_RPTP_KDCD = 'A10600100' THEN '개별처분요구안' WHEN SLCT_RPTP_KDCD = 'A10951200' THEN '조사개시통보' WHEN SLCT_RPTP_KDCD = 'A10951300' THEN '조사종료통보' WHEN SLCT_RPTP_KDCD = 'A10600200' THEN '감사보고서' WHEN SLCT_RPTP_KDCD = 'A10920100' THEN '검토의견/보고서' ELSE ( SELECT AGGR_CONCAT (DTL_ADT_DOC_NM,',') AS DTL_ADT_DOC_NM /* 상세감사문서명 */
FROM TBFDMADM002M WHERE ADT_DOC_SECD = A.SLCT_RPTP_KDCD GROUP BY ADT_DOC_SECD) END,',') AS AUD_DOC_NM, C.MNG_DEPT_CD, A.ATRZ_DMND_ID FROM TBBADDED103M A LEFT OUTER JOIN TBBADDED001M C ON (A.CVLCPT_ADT_YR = C.CVLCPT_ADT_YR AND A.ADT_NO = C.ADT_NO) WHERE A.ATRZ_DMND_ID IS NOT NULL GROUP BY A.CVLCPT_ADT_YR, A.ADT_NO, C.ADT_KDCD, C.ADT_MTTR_NM, C.MNG_DEPT_CD, A.ATRZ_DMND_ID) OTSD_EXPRT_ADDR WHERE 1=1 AND T22.ATRZ_DOC_NO = T23.ATRZ_DOC_NO AND T22.TPOF_ATRZ_SECD = T23.TPOF_ATRZ_SECD AND T23.APVR_STA_CD IN ('102','103','104','105','106','107') AND T23.APRVR_ENO = #APRVR_ENO# AND T22.TPOF_ATRZ_SECD = T21.TPOF_ATRZ_SECD AND T22.ATRZ_DOC_NO = AD.ATRZ_DMND_ID(+) AND T22.TPOF_ATRZ_SECD IN ('fieldAudit','requestAudit1','requestAudit2','requestAudit3','requestAudit4','requestAudit5','requestAudit6','requestAudit7','requestAudit8','badear001','DspRqClosingSend') AND T22.TPOF_ATRZ_SECD NOT IN ('fieldAudit','requestAudit1','requestAudit2','requestAudit3','requestAudit4','requestAudit5','requestAudit6','requestAudit7','requestAudit8','DspRqClosingSend') AND T23.APRVR_ENO IN (SELECT TRGT_NOP_ENO /* 대상인원직원전산번호 */
FROM TBDCMACM001M WHERE USER_NM LIKE '%' || #strUsrNam# || '%') AND T22.SBM_DH BETWEEN #strSbmDyFrom#||'000000' AND #strSbmDyTo#||'235959' T22.APV_TIT_NM LIKE '%'||#strApvTit#||'%' T22.ATRZ_STTS_SECD = #ATRZ_STTS_SECD# T22.TPOF_ATRZ_SECD IN ('fieldAudit','badear001') T22.TPOF_ATRZ_SECD = #TPOF_ATRZ_SECD# ORDER BY T22.ATRZ_STTS_SECD, T22.SBM_DH DESC