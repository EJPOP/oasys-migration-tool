SELECT D1.CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.TSK_NO /* 감사번호 */,
    D1.CVLCPT_ADT_YR||'-'||D1.TSK_NO AS CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.ADT_MTTR_NM /* 감사사항명 */,
    D1.HNDL_DIV_DPT_CD /* 처리과부서코드 */,
    F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS F_DPT_INFO /* 처리과명 */,
    D1.TRGT_INST_NM /* 대상기관명 */,
    D1.ADT_KDCD /* 감사종류코드 */,
    D6.ADT_STP_SECD /* 감사단계구분코드 */,
    D1.AUD_LDR_CNB /* 감사단장 전산번호 */,
    D1.AUD_LDR_BLT_DPT_CD /* 감사단장소속부서코드 */,
    D1.AUD_LDR_RANK_CD /* 감사단장직급코드 */,
    D3.USER_NM /* 사용자명 */,
    D1.SPVR_ENO /* 감리원직원전산번호 */,
    D1.SPVR_BLT_DPT_CD /* 주관자소속부서코드 */,
    D1.SPVR_JBGD_SECD /* 감리원직급구분코드 */,
    D4.USER_NM /* 사용자명 */,
    D1.ASTN_ENO /* 보조자직원전산번호 */,
    D1.AST_BLT_DPT_CD /* 보조자소속부서코드 */,
    D1.ASTN_JBGD_SECD /* 보조자직급구분코드 */,
    D5.USER_NM /* 사용자명 */,
    NVL(D1.BZT_AM,0) AS BZT_AM /* 출장금액 */,
    CASE WHEN (SELECT AS LUNH_DT
FROM TBCSPAOE022M WHERE CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND TSK_NO = #strTskNo# AND ADT_STP_SECD = '10000') IS NULL THEN '' ELSE SUBSTR((SELECT LUNH_DT
FROM TBCSPAOE022M WHERE CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND TSK_NO = #strTskNo# AND ADT_STP_SECD = '10000'),1,4)||'-'||SUBSTR((SELECT LUNH_DT
FROM TBCSPAOE022M WHERE CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND TSK_NO = #strTskNo# AND ADT_STP_SECD = '10000'),5,2)||'-'||SUBSTR((SELECT LUNH_DT
FROM TBCSPAOE022M WHERE CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND TSK_NO = #strTskNo# AND ADT_STP_SECD = '10000'),7,2) END AS RSRV_EXMN_OTST_YMD /*예비조사착수일*/ , CASE WHEN (SELECT CMPTN_YMD /* 완료일자 */
FROM TBCSPAOE022M WHERE CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND TSK_NO = #strTskNo# AND ADT_STP_SECD = '10010') IS NULL THEN '' ELSE SUBSTR((SELECT CMPTN_YMD /* 완료일자 */
FROM TBCSPAOE022M WHERE CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND TSK_NO = #strTskNo# AND ADT_STP_SECD = '10010'),1,4)||'-'||SUBSTR((SELECT CMPTN_YMD /* 완료일자 */
FROM TBCSPAOE022M WHERE CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND TSK_NO = #strTskNo# AND ADT_STP_SECD = '10010'),5,2)||'-'||SUBSTR((SELECT CMPTN_YMD /* 완료일자 */
FROM TBCSPAOE022M WHERE CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND TSK_NO = #strTskNo# AND ADT_STP_SECD = '10010'),7,2) END AS ENFC_YMD /*시행일*/ , '' AS TOT_AUD_OP_PRD_DCN /*총감사운영기간일수*/ , NVL(D1.MNDY_CNT, 9) AS MNDY_CNT /*연인원수*/ , CASE WHEN D2.DLAY_DT_NM IS NULL THEN '0' ELSE D2.DLAY_DT_NM END AS DLAY_DT_NM /*지연일명*/ , CASE WHEN D2.EXET_DCN IS NULL THEN 0 ELSE D2.EXET_DCN END AS EXET_DCN /*면책일수*/ , '' AS STUT_NOP_CNT /*단계별인원수*/ , '' AS STUT_PRD_DCN /*단계별기간일수*/ , D1.MAIN_INDC_SBJ_PRB_TXT /*주요지적사항문제점내용*/ , D1.MAIN_AUD_RSLT_EPT_EFCT_TXT /*주요감사결과기대효과내용*/ , D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /*특기사항계획대비기여율변경사유내용*/ FROM TBCSPAOE021M D1 LEFT JOIN TBCSPAOE022M D2 ON D1.CVLCPT_ADT_YR = D2.CVLCPT_ADT_YR AND D1.TSK_NO = D2.TSK_NO , TBDCMACM001M D3 , TBDCMACM001M D4 , TBDCMACM001M D5 , ( SELECT NVL(MAX(ADT_STP_SECD),'') AS ADT_STP_SECD /* 감사단계구분코드 */
FROM TBCSPAOE022M WHERE CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND TSK_NO = #strTskNo# AND CMPTN_YMD IS NOT NULL ) D6 WHERE ROWNUM = 1 AND D1.AUD_LDR_CNB = D3.TRGT_NOP_ENO (+) AND D1.SPVR_ENO = D4.TRGT_NOP_ENO (+) AND D1.ASTN_ENO = D5.TRGT_NOP_ENO (+) AND D1.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND D1.TSK_NO = #strTskNo# D1.ADT_MTTR_NM = #ADT_MTTR_NM#