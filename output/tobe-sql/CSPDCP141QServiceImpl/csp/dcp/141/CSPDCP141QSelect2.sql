WITH DATA AS ( SELECT D1.TPOF_KDCD /* 제보종류코드 */,
    D1.TPOF_RCPT_PATH_SECD /* 제보접수경로구분코드 */
FROM TB_CSPDCP101M D1 , TB_CSPDCP201M D2 WHERE 1=1 AND D1.CLM_SECD = D2.CVLCPT_CLM_SECD(+) AND D1.CVLCPT_RCPT_RCPT = D2.TPOF_RCPT_NO(+) AND D1.CVLCPT_RCPT_YR = D2.TPOF_RCPT_YR(+) AND D1.CLM_SECD = '1' /* AND D1.CVPT_HNDL_STA_CD = '60'*/ AND TO_CHAR(D1.CRU_RCPT_DT, 'YYYYMMDD') BETWEEN TO_CHAR(TO_DATE(#STARTDT#, 'YYYYMMDD'), 'YYYYMMDD') AND TO_CHAR(TO_DATE(#ENDDT#, 'YYYYMMDD'), 'YYYYMMDD') AND TO_CHAR(D2.TPOF_LAST_PRCS_DT, 'YYYYMMDD') BETWEEN TO_CHAR(TO_DATE(#STARTDT#, 'YYYYMMDD'), 'YYYYMMDD') AND TO_CHAR(TO_DATE(#ENDDT#, 'YYYYMMDD'), 'YYYYMMDD') ), PRE_DATA AS ( SELECT D1.TPOF_KDCD /* 제보종류코드 */,
    D1.TPOF_RCPT_PATH_SECD /* 제보접수경로구분코드 */
FROM TB_CSPDCP101M D1 , TB_CSPDCP201M D2 WHERE 1=1 AND D1.CLM_SECD = D2.CVLCPT_CLM_SECD(+) AND D1.CVLCPT_RCPT_RCPT = D2.TPOF_RCPT_NO(+) AND D1.CVLCPT_RCPT_YR = D2.TPOF_RCPT_YR(+) AND D1.CLM_SECD = '1' /*AND D1.CVPT_HNDL_STA_CD = '60'*/ AND D1.CRU_RCPT_DT BETWEEN TO_CHAR(TRUNC(ADD_MONTHS(TO_DATE(#STARTDT#, 'YYYYMMDD'), -12),'dd'), 'YYYYMMDD') AND TO_CHAR(TRUNC(ADD_MONTHS(TO_DATE(#ENDDT#, 'YYYYMMDD'), -12),'dd'), 'YYYYMMDD') AND D2.TPOF_LAST_PRCS_DT BETWEEN TO_CHAR(TRUNC(ADD_MONTHS(TO_DATE(#STARTDT#, 'YYYYMMDD'), -12),'dd'), 'YYYYMMDD') AND TO_CHAR(TRUNC(ADD_MONTHS(TO_DATE(#ENDDT#, 'YYYYMMDD'), -12),'dd'), 'YYYYMMDD') ) SELECT NULL,
    '합계' AS CD_NM,
    COUNT(1) AS 1,
    CASE WHEN COUNT(1) = 0 THEN 0 ELSE (COUNT(1)/COUNT(1)) * 100 END AS 1,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '1', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '2', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '3', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '4', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '5', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '7', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '8', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */
FROM DATA UNION ALL SELECT NULL,
    '감사민원' AS CD_NM,
    COUNT(1) AS 1,
    CASE WHEN COUNT(1) = 0 THEN 0 ELSE (COUNT(1)/(SELECT COUNT(1)
FROM DATA)) * 100 END AS PER , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '1', 1, 0 )), 0) AS ACP_RUT_CD_1 /*서신*/, NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '2', 1, 0 )), 0) AS ACP_RUT_CD_2 /*방문*/, NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '3', 1, 0 )), 0) AS ACP_RUT_CD_3 /*이첩*/, NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '4', 1, 0 )), 0) AS ACP_RUT_CD_4 /*전화*/, NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '5', 1, 0 )), 0) AS ACP_RUT_CD_5 /*Fax*/, NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '7', 1, 0 )), 0) AS ACP_RUT_CD_7 /*홈페이지*/, NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '8', 1, 0 )), 0) AS ACP_RUT_CD_8 /*신문고*/ FROM DATA WHERE CRU_KDCD != '카' UNION ALL SELECT D3.CD,
    D3.CD_NM,
    NVL(D4.CNT, 0) AS CNT,
    CASE WHEN NVL(D4.CNTALL, 0) = 0 THEN 0 ELSE ROUND((D4.CNT/D4.CNTALL) * 100, 2) END AS CNTALL,
    NVL(D4.ACP_RUT_CD_1, 0 ) AS ACP_RUT_CD_1,
    NVL(D4.ACP_RUT_CD_2, 0 ) AS ACP_RUT_CD_2,
    NVL(D4.ACP_RUT_CD_3, 0 ) AS ACP_RUT_CD_3,
    NVL(D4.ACP_RUT_CD_4, 0 ) AS ACP_RUT_CD_4,
    NVL(D4.ACP_RUT_CD_5, 0 ) AS ACP_RUT_CD_5,
    NVL(D4.ACP_RUT_CD_7, 0 ) AS ACP_RUT_CD_7,
    NVL(D4.ACP_RUT_CD_8, 0 ) AS ACP_RUT_CD_8
FROM (SELECT CD,
    CD_NM
FROM TBDCMACM013C D2 WHERE D2.CMM_CD_DVSN_CD = '1000047' AND D2.CD != '000000000' AND D2.CD != '카' ORDER BY OTPT_SEQ ) D3, (SELECT D1.CRU_KDCD /* 부패종류코드 */,
    COUNT(1) AS 1,
    (SELECT COUNT(1)
FROM DATA S1 WHERE 1=1) AS CNTALL , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '1', 1, 0 )), 0) AS ACP_RUT_CD_1 , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '2', 1, 0 )), 0) AS ACP_RUT_CD_2 , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '3', 1, 0 )), 0) AS ACP_RUT_CD_3 , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '4', 1, 0 )), 0) AS ACP_RUT_CD_4 , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '5', 1, 0 )), 0) AS ACP_RUT_CD_5 , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '7', 1, 0 )), 0) AS ACP_RUT_CD_7 , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '8', 1, 0 )), 0) AS ACP_RUT_CD_8 FROM DATA D1 GROUP BY D1.CRU_KDCD ) D4 WHERE D3.CD = D4.CRU_KDCD(+) UNION ALL SELECT NULL,
    '일반민원' AS CD_NM,
    NVL(D4.CNT, 0) AS CNT,
    CASE WHEN NVL(D4.CNTALL, 0) = 0 THEN 0 ELSE ROUND((D4.CNT/D4.CNTALL) * 100, 2) END AS CNTALL,
    NVL(D4.ACP_RUT_CD_1, 0 ) AS ACP_RUT_CD_1,
    NVL(D4.ACP_RUT_CD_2, 0 ) AS ACP_RUT_CD_2,
    NVL(D4.ACP_RUT_CD_3, 0 ) AS ACP_RUT_CD_3,
    NVL(D4.ACP_RUT_CD_4, 0 ) AS ACP_RUT_CD_4,
    NVL(D4.ACP_RUT_CD_5, 0 ) AS ACP_RUT_CD_5,
    NVL(D4.ACP_RUT_CD_7, 0 ) AS ACP_RUT_CD_7,
    NVL(D4.ACP_RUT_CD_8, 0 ) AS ACP_RUT_CD_8
FROM (SELECT CD,
    CD_NM
FROM TBDCMACM013C D2 WHERE D2.CMM_CD_DVSN_CD = '1000047' AND D2.CD != '000000000' AND D2.CD = '카' ORDER BY OTPT_SEQ ) D3, (SELECT D1.CRU_KDCD /* 부패종류코드 */,
    COUNT(1) AS 1,
    (SELECT COUNT(1)
FROM DATA S1 WHERE 1=1) AS CNTALL , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '1', 1, 0 )), 0) AS ACP_RUT_CD_1 , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '2', 1, 0 )), 0) AS ACP_RUT_CD_2 , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '3', 1, 0 )), 0) AS ACP_RUT_CD_3 , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '4', 1, 0 )), 0) AS ACP_RUT_CD_4 , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '5', 1, 0 )), 0) AS ACP_RUT_CD_5 , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '7', 1, 0 )), 0) AS ACP_RUT_CD_7 , NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '8', 1, 0 )), 0) AS ACP_RUT_CD_8 FROM DATA D1 WHERE D1.CRU_KDCD = '카' GROUP BY D1.CRU_KDCD ) D4 WHERE D3.CD = D4.CRU_KDCD(+) UNION ALL SELECT NULL,
    '전년 동기간 증감' AS CD_NM,
    D5.CNT-D6.CNT AS CNT,
    NVL(D5.PER-D6.PER, 0) AS PER,
    D5.ACP_RUT_CD_1 - D6.ACP_RUT_CD_1 AS ACP_RUT_CD_1,
    D5.ACP_RUT_CD_2 - D6.ACP_RUT_CD_2 AS ACP_RUT_CD_2,
    D5.ACP_RUT_CD_3 - D6.ACP_RUT_CD_3 AS ACP_RUT_CD_3,
    D5.ACP_RUT_CD_4 - D6.ACP_RUT_CD_4 AS ACP_RUT_CD_4,
    D5.ACP_RUT_CD_5 - D6.ACP_RUT_CD_5 AS ACP_RUT_CD_5,
    D5.ACP_RUT_CD_7 - D6.ACP_RUT_CD_7 AS ACP_RUT_CD_7,
    D5.ACP_RUT_CD_8 - D6.ACP_RUT_CD_8 AS ACP_RUT_CD_8
FROM (SELECT 'A' AS PK,
    COUNT(1) AS 1,
    CASE WHEN COUNT(1) = 0 THEN 0 ELSE (COUNT(1) / COUNT(1)) * 100 END AS 1,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '1', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '2', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '3', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '4', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '5', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '7', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '8', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */
FROM DATA ) D5 , (SELECT 'A' AS PK,
    COUNT(1) AS 1,
    CASE WHEN COUNT(1) = 0 THEN 0 ELSE (COUNT(1) / COUNT(1)) * 100 END AS 1,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '1', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '2', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '3', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '4', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '5', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '7', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */,
    NVL(SUM(DECODE(CRU_RCPT_PATH_SECD, '8', 1, 0 )), 0) AS CRU_RCPT_PATH_SECD /* 부패접수경로구분코드 */
FROM PRE_DATA ) D6 WHERE D5.PK = D6.PK(+)