WITH /* CSPDCP411ReportCSPDCP1417RCmplTotalSelect */ RCP_DATA AS ( SELECT D1.CVLCPT_CLM_SECD /* 민원청구구분코드 */,
    D1.TPOF_RCPT_YR /* 제보접수년도 */,
    D1.TPOF_RCPT_NO /* 제보접수번호 */,
    D1.TPOF_STTS_SECD /* 제보상태구분코드 */,
    ( SELECT AS USR_DFN_TXT_1
FROM TBDCMACM013C D3 WHERE D3.CMM_CD_DVSN_CD = '1000047' AND D3.CD = D1.CRU_KDCD ) AS TPOF_KND_SECD , D2.PRCS_PIC_ID FROM TB_CSPDCP101M D1 , TB_CSPDCP201M D2 WHERE D1.CLM_SECD = D2.CLM_SECD(+) AND D1.CVLCPT_RCPT_YR = D2.CVLCPT_RCPT_YR(+) AND D1.CVLCPT_RCPT_RCPT = D2.CVLCPT_RCPT_RCPT(+) AND D1.CLM_SECD = '1' AND D1.CRU_PRCS_PRCS_STTS IN ( '30', '40', '41', '50', '60', '70' ) /* 처리중, 시행문작성중, 조사결과, 처리완료 중 담당자가 있는 것만 계산 */ AND D2.PRCS_PIC_ID IS NOT NULL AND D1.CRU_RCPT_DT BETWEEN TO_DATE(#STARTDT# || '000000', 'YYYYMMDDHH24MISS') AND TO_DATE(#ENDDT# || '235959', 'YYYYMMDDHH24MISS') AND D2.TPOF_LAST_PRCS_DT BETWEEN TO_DATE(#STARTDT# || '000000', 'YYYYMMDDHH24MISS') AND TO_DATE(#ENDDT# || '235959', 'YYYYMMDDHH24MISS') ) SELECT NULL AS PRCS_PIC_ID,
    '합계' AS SRECS_PRCS_PIC_NM /* 심사재심의처리담당자명 */,
    COUNT(D5.CVLCPT_RCPT_RCPT) AS CVLCPT_RCPT_RCPT /* 민원접수번호 */,
    NVL(SUM(DECODE(D5.TPOF_KND_SECD, '1', 1, 0)),0) AS TPOF_KND_SECD /* 제보종류구분코드 */,
    NVL(SUM(DECODE(D5.TPOF_KND_SECD, '2', 1, 0)),0) AS TPOF_KND_SECD /* 제보종류구분코드 */,
    NVL(SUM(CASE WHEN D5.CRU_PRCS_PRCS_STTS NOT IN ('60','70') THEN 1 ELSE 0 END),0) AS CRU_PRCS_PRCS_STTS /* 부패처리상태구분코드 */,
    NVL(SUM(CASE WHEN D5.CRU_PRCS_PRCS_STTS NOT IN ('60','70') AND D5.TPOF_KND_SECD = 1 THEN 1 ELSE 0 END),0) AS CRU_PRCS_PRCS_STTS /* 부패처리상태구분코드 */,
    NVL(SUM(CASE WHEN D5.CRU_PRCS_PRCS_STTS NOT IN ('60','70') AND D5.TPOF_KND_SECD = 2 THEN 1 ELSE 0 END),0) AS CRU_PRCS_PRCS_STTS /* 부패처리상태구분코드 */,
    NVL(SUM(CASE WHEN D5.CRU_PRCS_PRCS_STTS IN ('60','70') THEN 1 ELSE 0 END),0) AS CRU_PRCS_PRCS_STTS /* 부패처리상태구분코드 */,
    NVL(SUM(CASE WHEN D5.CRU_PRCS_PRCS_STTS IN ('60','70') AND D5.TPOF_KND_SECD = 1 THEN 1 ELSE 0 END),0) AS CRU_PRCS_PRCS_STTS /* 부패처리상태구분코드 */,
    NVL(SUM(CASE WHEN D5.CRU_PRCS_PRCS_STTS IN ('60','70') AND D5.TPOF_KND_SECD = 2 THEN 1 ELSE 0 END),0) AS CRU_PRCS_PRCS_STTS /* 부패처리상태구분코드 */,
    1
FROM RCP_DATA D5 UNION ALL SELECT D6.PRCS_PIC_ID /* 처리담당자아이디 */,
    D7.USER_NM AS USER_NM /* 사용자명 */,
    D6.TOT_CNT,
    D6.TOT_AUD_CNT,
    D6.TOT_GE_CNT,
    D6.TOT_ING_CNT,
    D6.TOT_ING_1_CNT,
    D6.TOT_ING_2_CNT,
    D6.TOT_CMP_CNT,
    D6.TOT_CMP_1_CNT,
    D6.TOT_CMP_2_CNT,
    D6.ORD
FROM ( SELECT D5.PRCS_PIC_ID /* 처리담당자아이디 */,
    COUNT(D5.CVLCPT_RCPT_RCPT) AS CVLCPT_RCPT_RCPT /* 민원접수번호 */,
    NVL(SUM(DECODE(D5.TPOF_KND_SECD, '1', 1, 0)),0) AS TPOF_KND_SECD /* 제보종류구분코드 */,
    NVL(SUM(DECODE(D5.TPOF_KND_SECD, '2', 1, 0)),0) AS TPOF_KND_SECD /* 제보종류구분코드 */,
    NVL(SUM(CASE WHEN D5.CRU_PRCS_PRCS_STTS NOT IN ('60','70') THEN 1 ELSE 0 END),0) AS CRU_PRCS_PRCS_STTS /* 부패처리상태구분코드 */,
    NVL(SUM(CASE WHEN D5.CRU_PRCS_PRCS_STTS NOT IN ('60','70') AND D5.TPOF_KND_SECD = 1 THEN 1 ELSE 0 END),0) AS CRU_PRCS_PRCS_STTS /* 부패처리상태구분코드 */,
    NVL(SUM(CASE WHEN D5.CRU_PRCS_PRCS_STTS NOT IN ('60','70') AND D5.TPOF_KND_SECD = 2 THEN 1 ELSE 0 END),0) AS CRU_PRCS_PRCS_STTS /* 부패처리상태구분코드 */,
    NVL(SUM(CASE WHEN D5.CRU_PRCS_PRCS_STTS IN ('60','70') THEN 1 ELSE 0 END),0) AS CRU_PRCS_PRCS_STTS /* 부패처리상태구분코드 */,
    NVL(SUM(CASE WHEN D5.CRU_PRCS_PRCS_STTS IN ('60','70') AND D5.TPOF_KND_SECD = 1 THEN 1 ELSE 0 END),0) AS CRU_PRCS_PRCS_STTS /* 부패처리상태구분코드 */,
    NVL(SUM(CASE WHEN D5.CRU_PRCS_PRCS_STTS IN ('60','70') AND D5.TPOF_KND_SECD = 2 THEN 1 ELSE 0 END),0) AS CRU_PRCS_PRCS_STTS /* 부패처리상태구분코드 */,
    2
FROM RCP_DATA D5 GROUP BY D5.PRCS_PIC_ID ) D6 , TBDCMACM001M D7 WHERE D6.PRCS_PIC_ID = D7.USER_ID ORDER BY ORD, SRECS_PRCS_PIC_NM