SELECT T.*,
    ROW_NUMBER() OVER( ORDER BY CVLCPT_ADT_YR ASC, ADT_NO ASC, DSPS_RQT_SQNO ASC ) AS ROW_NUMBER
FROM (SELECT DT.*,
    COUNT(1) OVER() AS 1
FROM (SELECT MASTER.CVLCPT_ADT_YR AS CVLCPT_ADT_YR /* 민원감사년도 */,
    /*감사년도*/MASTER.ADT_NO AS ADT_NO /* 감사번호 */,
    /*감사순번*/F_MNG_KND_AUDYRNO(MASTER.CVLCPT_ADT_YR, MASTER.ADT_NO, AUD.ADT_KDCD, '-') ||'-'|| MASTER.DSPS_RQT_SQNO AS ADT_CLSF_NO /* 감사분류번호 */,
    /*화면에 보여주는 관리번호 수정 - 2015.12.22 yyh*/ MASTER.DSPS_RQT_SQNO AS DSPS_RQT_SQNO /* 처분요구순번 */,
    /*처분요구순번*/ (SELECT MIN(ADT_BGNG_YMD) AS ADT_BGNG_YMD /* 감사시작일자 */
FROM TBBADDED002M WHERE REL_ADT_YR = MASTER.CVLCPT_ADT_YR AND REL_ADT_NO = MASTER.ADT_NO ) AS ADT_BGNG_YMD ,/*감사시작일자*/ (SELECT CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = AUD.SPRVSN_DEPT_CD) AS EXEC_DPT_NM,/*감사부서명*/ AUD.ADT_MTTR_NM AS ADT_MTTR_NM , /*감사사항명*/ RTRIM(DETAIL.ENFC_YMD) AS ENFC_YMD ,/*시행일*/ MASTER.DSPS_RQT_NM AS DISP_TIT_TXT , /*처분요구제목*/ (SELECT CD_NM
FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000002' AND CD = MASTER.DSPS_RQT_KDCD) AS DSPS_RQT_KND_CVN , /*처분종류명*/ (SELECT PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBDCMACM015M WHERE INST_CD = (SELECT MIN(SRECS_REL_INST_CD) AS SRECS_REL_INST_CD /* 심사재심의관계기관코드 */
FROM TBBADEAR006M WHERE CVLCPT_ADT_YR = MASTER.CVLCPT_ADT_YR AND ADT_NO = MASTER.ADT_NO AND DSPS_RQT_SQNO = MASTER.DSPS_RQT_SQNO)) AS REL_INST_NM ,/*소관기관명*/ DETAIL.TPOF_NOPE AS TPOF_NOPE ,/*인원수*/ DETAIL.PNRT_PRSRV_AMT AS PNRT_PRSRV_AMT /*추징회수보전금액*/ FROM TBBADEAR001M MASTER , TBBADEAR002D DETAIL , TBBADDED001M AUD , (SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    ADT_NO /* 감사번호 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    MIN(SRECS_REL_INST_CD) AS SRECS_REL_INST_CD /* 심사재심의관계기관코드 */,
    MIN(IMPL_MNG_INST_CD) AS IMPL_MNG_INST_CD /* 집행관리기관코드 */
FROM TBBADEAR006M WHERE 1=1 GROUP BY CVLCPT_ADT_YR , ADT_NO , DSPS_RQT_SQNO ) REL WHERE 1=1 AND MASTER.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND MASTER.ADT_NO = #ADT_NO# AND MASTER.CVLCPT_ADT_YR = DETAIL.CVLCPT_ADT_YR AND MASTER.ADT_NO = DETAIL.ADT_NO AND MASTER.DSPS_RQT_SQNO = DETAIL.DSPS_RQT_SQNO AND MASTER.CVLCPT_ADT_YR = AUD.CVLCPT_ADT_YR AND MASTER.ADT_NO = AUD.ADT_NO AND MASTER.CVLCPT_ADT_YR = REL.CVLCPT_ADT_YR(+) AND MASTER.ADT_NO = REL.ADT_NO(+) AND MASTER.DSPS_RQT_SQNO = REL.DSPS_RQT_SQNO(+) /*검색일자가 시행일자일때*/ AND DETAIL.ENFC_YMD BETWEEN NVL('20190101', '19000101') AND NVL('20200915', '99991231') /* 제목,내용 검색 수정 - 2018.08.07 yyh */ /* 제목+키워드를 제목, 키워드로 분리함 - 2018.10.11 yyh */ /* 감사연번종류코드 추가 - 2015.12.22 yyh */) DT ORDER BY CVLCPT_ADT_YR ASC, ADT_NO ASC, DSPS_RQT_SQNO ASC ) T