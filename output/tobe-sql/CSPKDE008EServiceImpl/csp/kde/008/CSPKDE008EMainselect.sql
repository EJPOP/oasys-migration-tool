SELECT D1.REGI_SRNO AS REGI_SRNO /* 일련번호 */,
    D1.REG_YMD AS REG_YMD /* 등록일자 */,
    D1.REG_DEPT_CD AS REG_DEPT_CD /* 등록부서코드 */,
    F_DPT_INFO(D1.REG_DEPT_CD,'1') AS F_DPT_INFO /* 등록부서명 */,
    F_DPT_INFO(D1.REG_DEPT_CD,'4') AS F_DPT_INFO /* 약칭 등록부서명 */,
    D1.OTSD_EXPRT_RGTR_ENO AS OTSD_EXPRT_RGTR_ENO /* 외부전문가등록자직원전산번호 */,
    F_USR_INFO(D1.OTSD_EXPRT_RGTR_ENO,'2') AS F_USR_INFO /* 등록자전산번호 성명 */,
    D1.OGDP_INST_CD AS OGDP_INST_CD /* 소속기관코드 */,
    D1.TPOF_OGDP_INST_NM AS TPOF_OGDP_INST_NM /* 제보소속기관명 */,
    D1.CRU_OGDP_DEPT_NM AS CRU_OGDP_DEPT_NM /* 부패소속부서명 */,
    D1.TPOF_OGDP_INST_NM || '(' || D1.CRU_OGDP_DEPT_NM || ')' AS TPOF_OGDP_INST_NM /* 제보소속기관명 */,
    D1.TPOF_OGDP_INST_NM /* 제보소속기관명 */,
    D1.JBGD_NM AS JBGD_NM /* 직급명 */,
    D1.INFO_RLPR_NM AS INFO_RLPR_NM /* 정보관계자명 */,
    D1.CRU_RRNO_SCRTY AS CRU_RRNO_SCRTY /* 부패주민등록번호보안 */,
    CASE WHEN D1.CVLCPT_DOC_ID IS NOT NULL THEN '파일첨부' ELSE D1.CRU_RRNO_SCRTY END AS CVLCPT_DOC_ID /* 민원문서아이디 */,
    D1.CFM_DDLN_DT AS CFM_DDLN_DT /* 확인기한일 */,
    D1.IDNTY_YN AS IDNTY_YN /* 확인여부 */,
    D1.CVLCPT_DOC_ID AS CVLCPT_DOC_ID /* 민원문서아이디 */,
    (SELECT MAX( F_DPT_INFO(REG_DEPT_CD,'4') || '(' || F_USR_INFO(OTSD_EXPRT_RGTR_ENO,'2') || ')' ) AS REG_DEPT_CD /* 등록부서코드 */
FROM TBCSPKDE007M WHERE INFO_RLPR_NM = D1.INFO_RLPR_NM AND SUBSTR(CRU_RRNO_SCRTY,0,6) = SUBSTR(D1.CRU_RRNO_SCRTY,0,6) AND NVL(PRGRS_STTS_SECD,'07') NOT IN ('01','02')) AS REL_SVY_NTF /* 관련조사개시통보 */ /*,(SELECT CASE WHEN MAX(SVY_FACT_NTF_CNB) IS NOT NULL THEN MAX( (SELECT Y2.ABR_DPT_NM_1 || '(' || USR_NAM || ')' FROM TBDCMACM001M Y1 ,TBDCMACM002M Y2 WHERE Y1.DPT_CD = Y2.DPT_CD AND Y1.CNB = SVY_FACT_NTF_CNB) ) ELSE '' END FROM TBCSPKDE006L WHERE REGI_SRNO = D1.REGI_SRNO) AS SVY_FACT_NTF_INFO */ /* 조사사실통보정보 - 속도개선 2016.12.05 yyh*/ /*,(SELECT SUM(CASE WHEN CFM_DT_1 IS NOT NULL OR CFM_DT_2 IS NOT NULL THEN 1 ELSE 0 END) FROM TBCSPKDE006L WHERE REGI_SRNO = D1.REGI_SRNO) AS CFM_YN_CNT */ /* 확인건수 */ /*,(SELECT SUM(CASE WHEN CFM_DT_1 IS NOT NULL AND CFM_DT_2 IS NOT NULL THEN 1 ELSE 0 END) || '/' || COUNT(1) FROM TBCSPKDE006L WHERE REGI_SRNO = D1.REGI_SRNO) AS CFM_YN_CNT_INFO */ /* 확인건수 정보 */ FROM TBCSPKDE005M D1 WHERE (D1.REG_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#))) OR (SUBSTR(D1.REG_DEPT_CD,0,3) = (CASE WHEN SUBSTR(#strDptCd#,0,3) IN (SELECT SUBSTR(SRECS_DEPT_CD,0,3) AS SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TBDCMACM002M WHERE MANPOWER_POOL_SYE_YN = 'Y') AND #strDptCd# NOT IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TBDCMACM002M WHERE MANPOWER_POOL_SYE_YN = 'N') THEN SUBSTR(#strDptCd#,0,3) ELSE '' END))) AND D1.REG_DEPT_CD = #REG_DEPT_CD# AND D1.REG_YMD BETWEEN #strDtStr# AND #strDtEnd# AND D1.TPOF_OGDP_INST_NM LIKE '%' || #strOrgNm# || '%' AND D1.INFO_RLPR_NM LIKE '%' || #strNam# || '%'