SELECT T1.ADT_KDCD /* 감사종류코드 */,
    T1.SPRVSN_DEPT_CD /* 주관부서코드 */,
    T1.ADT_MTTR_NM /* 감사사항명 */,
    T1.SPVR_ENO /* 감리원직원전산번호 */,
    T1.SPVR_DEPT_CD /* 감리원부서코드 */,
    T1.PRGRS_STP_SECD /* 진행단계구분코드 */,
    T1.MNG_DEPT_CD /* 관리부서코드 */,
    F_MNG_KND_AUDYRNO(T1.ADT_YR, T1.ADT_NO, T1.ADT_KDCD, '-') ||'-'||T2.DSPS_RQT_SQNO AS F_MNG_KND_AUDYRNO,
    T2.DSPS_RQT_NM /* 처분요구명 */,
    T2.ACTN_MTTR_CN /* 조치사항내용 */,
    T2.DSPS_RQT_KDCD AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    F_CODE_NM('1000002',T2.DSPS_RQT_KDCD ) AS DSPS_RQT_KND_CVN /* 처분요구종류코드값명 */,
    T3.CVLCPT_ADT_YR /* 민원감사년도 */,
    T3.ADT_NO /* 감사번호 */,
    T1.ADT_GRNT_NO /* 감사부여번호 */,
    T3.DSPS_RQT_SQNO /* 처분요구순번 */,
    T3.DSPS_RQT_IDNO /* 처분요구식별번호 */,
    T3.ENFC_YMD /* 시행일자 */,
    TO_CHAR(ADD_MONTHS(T3.ENFC_YMD, T6.MONTH_DDLN), 'YYYYMMDD') AS PRCS_TERM_YMD /* 처리기한일자 */,
    T7.SELF_SNDNG_YMD /* 자체발송일자 */,
    T3.ENFC_DEPT_CD /* 시행부서코드 */,
    T3.PIC_NM /* 담당자명 */,
    T3.DOC_SNDNG_NO /* 문서발송번호 */,
    T3.DSPS_RQT_INPT_YMD /* 처분요구입력일자 */,
    T3.ACSTN_RQST_NOP_CONT /* 고발의뢰인원개수 */,
    T3.VIOL_CS_SECD /* 비위원인구분코드 */,
    T3.IMPL_MNG_JRSD_DEPT_CD /* 집행관리소관부서코드 */,
    (SELECT AS ABR_DPT_NM_1
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = T3.IMPL_MNG_JRSD_DEPT_CD) AS ENFM_MNG_BRDV_NM /* 약칭부서명으로 변경 - 2017.04.05 yyh */ ,(SELECT ABR_DPT_NM_1
FROM TBDCMACM002M WHERE SRECS_DEPT_CD = T3.BFR_IMPL_MNG_DEPT_CD) AS OD_ENFM_MNG_BRDV_NM /* 구이행관리국과코드 - 2017.04.05 yyh */ ,T3.CFMTN_YN ,T3.CFMTN_STTS_SECD ,T3.VIOL_TPCD ,T3.IMPL_CPLT_INPT_YMD ,T3.IMPL_WHLS_CFMTN_YMD ,T3.CMO_INST_CD ,T3.DSPS_RQT_CFMTN_YMD ,T3.DSPS_RQT_PIC_ID ,T3.IMPL_CPLT_KBRDR_ID ,T3.IMPL_WHLS_PIC_ID ,T3.DSPS_RQT_ATRZ_STTS_SECD ,F_CODE_NM('1000333', T3.DSPS_RQT_ATRZ_STTS_SECD) AS DSP_RQ_APV_STA_NM ,T3.ATRZ_DOC_NO ,T3.DSPS_RQT_ATRZ_STTS_YMD ,T3.IMPL_WHLS_ATRZ_KDCD ,T3.SOA_PRGRS_STTS_SECD ,T4.REL_INST_CD ,F_ORG_INFO(T4.REL_INST_CD, '1') AS REL_INST_NM ,T4.REL_INST_CD ,T4.DSPS_RQT_TRGT_KDCD ,T4.IMPL_MNG_INST_CD AS IMPL_MNG_INST_CD ,(SELECT PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TBDCMACM015M WHERE INST_CD = T4.IMPL_MNG_INST_CD) AS ENFM_MNG_ORG_NM ,T5.IMPL_URG_SQNO ,T5.IMPL_URG_DSCTN ,T5.IMPL_URG_YMD ,T5.IMPL_PIC_ID ,T5.NYD_IMPL_RSN_CN ,T5.IMPL_MSRS_CN ,T5.IMPL_URG_RSPS_YMD ,T5.IMPL_URG_PIC_ID ,T5.IMPL_URG_RCPT_YMD ,T5.IMPL_URG_CLR_ID ,T5.URG_SECD ,T5.ONR_SNDNG_YMD ,T5.ONR_SNDNG_PIC_ID ,T5.CVLCPT_DOC_ID ,T5.ADT_PLAN_DOC_TPCD ,CASE WHEN T7.CVLCPT_ADT_YR IS NULL THEN TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD')) - ADD_MONTHS(T3.ENFC_YMD, T6.MONTH_DDLN) ELSE TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD')) - TO_DATE(T7.SELF_SNDNG_YMD) END AS DELAY_DAY ,DECODE(T3.CFMTN_STTS_SECD, 2, '확정', 1, DECODE(T3.CFMTN_YN, 'Y', '미확정', '미집행'), '처분미확정') AS ENFM_STA_NM ,F_CODE_NM('1000016',T7.IMPL_STP_SECD) AS ENFM_STEP_NM /* 이행단계 추가 - 2017.06.13 yyh*/ ,F_CODE_NM('1000390',T7.RVW_STTS_SECD) AS EXAM_STA_NM /* 검토결과 추가 - 2017.06.26 yyh*/ FROM TB_BADDED001M T1 ,TB_BADEAR001M T2 ,TB_BADEAR002D T3 ,TB_BADEAR006M T4 ,TB_BADFRE009M T5 ,( SELECT '110' AS CD,
    3
FROM DUAL /* 변상판정 */ UNION ALL SELECT '210' AS CD,
    1
FROM DUAL /* 징계문책 */ UNION ALL SELECT '310' AS CD,
    2
FROM DUAL /* 시정(금액) */ UNION ALL SELECT '320' AS CD,
    2
FROM DUAL /* 시정(기타) */ UNION ALL SELECT '391' AS CD,
    2
FROM DUAL /* 현지시정회 */ UNION ALL SELECT '510' AS CD,
    2
FROM DUAL /* 법령상개선 */ UNION ALL SELECT '520' AS CD,
    2
FROM DUAL /* 제도상개선 */ UNION ALL SELECT '530' AS CD,
    2
FROM DUAL /* 행정상개선 */ UNION ALL SELECT '610' AS CD,
    2
FROM DUAL /* 통보 */ UNION ALL SELECT '611' AS CD,
    2
FROM DUAL /* 권고 */ UNION ALL SELECT '620' AS CD,
    2
FROM DUAL /* 통보(인사) */ UNION ALL SELECT '621' AS CD,
    2
FROM DUAL /* 통보(징계) */ UNION ALL SELECT '623' AS CD,
    2
FROM DUAL /* 통보(비위) */ UNION ALL SELECT '630' AS CD,
    2
FROM DUAL /* 통보개선 */ UNION ALL SELECT '810' AS CD,
    2
FROM DUAL /* 모범(예산절감) */ UNION ALL SELECT '820' AS CD,
    2
FROM DUAL /* 모범(업무개선) */ UNION ALL SELECT '830' AS CD,
    2
FROM DUAL /* 모범(성실근무) */ UNION ALL SELECT '840' AS CD,
    2
FROM DUAL /* 모범(민원해소) */ UNION ALL SELECT '850' AS CD,
    2
FROM DUAL /* 모범(기타) */ ) T6 ,(SELECT Z1.ADT_YR /* 감사년도 */,
    Z1.ADT_NO /* 감사번호 */,
    Z1.DSPS_RQT_SQNO /* 처분요구순번 */,
    Z1.REL_INST_CD /* 관계기관코드 */,
    Z1.HSTRY_SQNO /* 이력순번 */,
    Z1.SELF_SNDNG_YMD /* 자체발송일자 */,
    Z1.IMPL_STP_SECD /* 집행단계구분코드 */,
    Z1.RVW_STTS_SECD /* 검토상태구분코드 */
FROM TBBADFRE001H Z1 WHERE 1=1 AND Z1.HSTRY_SQNO = (SELECT MAX(HSTRY_SQNO) AS HSTRY_SQNO /* 이력순번 */
FROM TBBADFRE001H Z2 WHERE Z2.CVLCPT_ADT_YR = Z1.CVLCPT_ADT_YR AND Z2.ADT_NO = Z1.ADT_NO AND Z2.DSPS_RQT_SQNO = Z1.DSPS_RQT_SQNO AND Z2.SRECS_REL_INST_CD = Z1.SRECS_REL_INST_CD ) ) T7 WHERE 1 = 1 AND T1.ADT_YR = T2.CVLCPT_ADT_YR AND T1.ADT_NO = T2.ADT_NO AND T2.CVLCPT_ADT_YR = T3.CVLCPT_ADT_YR AND T2.ADT_NO = T3.ADT_NO AND T2.DSPS_RQT_SQNO = T3.DSPS_RQT_SQNO AND T2.CVLCPT_ADT_YR = T4.ADT_YR AND T2.ADT_NO = T4.ADT_NO AND T2.DSPS_RQT_SQNO = T4.DSPS_RQT_SQNO AND T4.ADT_YR = T5.CVLCPT_ADT_YR(+) AND T4.ADT_NO = T5.ADT_NO(+) AND T4.DSPS_RQT_SQNO = T5.DSPS_RQT_SQNO(+) AND T4.REL_INST_CD = T5.SRECS_REL_INST_CD(+) AND T2.DSPS_RQT_KDCD = T6.CD AND T4.ADT_YR = T7.CVLCPT_ADT_YR(+) AND T4.ADT_NO = T7.ADT_NO(+) AND T4.DSPS_RQT_SQNO = T7.DSPS_RQT_SQNO(+) AND T4.REL_INST_CD = T7.SRECS_REL_INST_CD(+) /* AND NVL(T3.DTM_YN, 'N') <> 'Y' */ AND NVL(T3.CFMTN_STTS_SECD,'0') <> '2' AND T2.DSPS_RQT_KDCD IN ('110','210','310','320','391','620','621','623','630','510','520','530','610','611','810','820','830','840','850') AND T1.ADT_YR = #CVLCPT_ADT_YR# AND T1.ADT_GRNT_NO = #ADT_GRNT_NO# AND T2.DSPS_RQT_SQNO = #DSPS_RQT_SQNO# /* 감사연번종류코드 - 2015.12.22 yyh */ AND SUBSTR(T1.ADT_KDCD,3,1) = #strAudYrNoKndCd# /* 권한이 없는 일선 과 */ AND T3.BFR_IMPL_MNG_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#S_CNB#, #strDptAuth#, '', #strOdUpSpvBrdvCd#))) AND T3.BFR_IMPL_MNG_DEPT_CD = #BFR_IMPL_MNG_DEPT_CD# AND T3.IMPL_MNG_JRSD_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#S_CNB#, #strDptAuth#, '', #strUpSpvBrdvCd#))) AND T3.IMPL_MNG_JRSD_DEPT_CD = #IMPL_MNG_JRSD_DEPT_CD# /* 이행관리과 등 권한이 있는 과*/ AND T3.BFR_IMPL_MNG_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#S_CNB#, #strDptAuth#, '', #strOdUpSpvBrdvCd#))) AND T3.BFR_IMPL_MNG_DEPT_CD = #BFR_IMPL_MNG_DEPT_CD# AND T3.IMPL_MNG_JRSD_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#S_CNB#, #strDptAuth#, '', #strUpSpvBrdvCd#))) AND T3.IMPL_MNG_JRSD_DEPT_CD = #IMPL_MNG_JRSD_DEPT_CD# AND T2.DSPS_RQT_NM LIKE '%'||#strTitTxt#||'%' AND T3.CMO_INST_CD = #CMO_INST_CD# AND T3.SRECS_REL_INST_CD = #SRECS_REL_INST_CD# AND T4.IMPL_MNG_INST_CD = #IMPL_MNG_INST_CD# AND T3.ENFC_YMD >= #strEnfDtFrom# AND #strEnfDtTo# >= T3.ENFC_YMD AND T2.DSPS_RQT_KDCD = #DSPS_RQT_KDCD# AND T2.DSPS_RQT_KDCD IN ('310','320','391') AND T2.DSPS_RQT_KDCD IN ('510','520','530') AND T2.DSPS_RQT_KDCD IN ('810','820','830','840','850') /* 110 변상판정 210 징계문책 310 시정(금액) 320 시정(기타) 391 현지시정회 810 모범(예산절감) 820 모범(업무개선) 830 모범(성실근무) 840 모범(민원해소) 850 모범(기타) */ AND T2.DSPS_RQT_KDCD IN ('110','210','310','320','391','810', '820', '830', '840', '850') /* 610 통보 611 권고 620 통보(인사) 621 통보(징계) 623 통보(비위) 630 통보개선 */ AND T2.DSPS_RQT_KDCD IN ('610','611','620','621','623','630') /* 510 법령상개선 520 제도상개선 530 행정상개선 */ AND T2.DSPS_RQT_KDCD IN ('510','520','530') /* 독촉할사항 */ /* 속도개선으로 주석처리 후 아래 코드로 대체 - 2015.05.12 yyh AND T5.ENFM_PRSU_DT IS NULL */ /* 주석처리 - 2017.04.07 AND NVL(T5.ENFM_PRSU_DT,'N') = 'N' AND TO_CHAR(SYSDATE, 'YYYYMMDD') > T3.HNDL_DDLN_DT */ /* 독촉한사항 */ /* 주석처리 - 2017.04.07 AND T5.ENFM_PRSU_DT IS NOT NULL */ /* 미집행 */ AND NVL(T3.CFMTN_STTS_SECD,'0') = '1' AND NVL(T3.CFMTN_YN,'N') <> 'Y' /* 미확정 */ AND NVL(T3.CFMTN_STTS_SECD,'0') = '1' AND NVL(T3.CFMTN_YN,'N') = 'Y' /* 전체 */ AND ( (T7.CVLCPT_ADT_YR IS NULL AND TO_CHAR(ADD_MONTHS(T3.ENFC_YMD, T6.MONTH_DDLN), 'YYYYMMDD') /* 미회보 */ AND T7.CVLCPT_ADT_YR IS NULL AND TO_CHAR(ADD_MONTHS(T3.ENFC_YMD, T6.MONTH_DDLN), 'YYYYMMDD') /* 회보 */ AND T7.CVLCPT_ADT_YR IS NOT NULL AND T7.IMPL_STP_SECD != '30' /* 이행완료 */ AND TO_CHAR(ADD_MONTHS(T7.SELF_SNDNG_YMD, #strOverDue#), 'YYYYMMDD') AND T7.IMPL_STP_SECD = #IMPL_STP_SECD#