SELECT KNB /* 지식번호 */,
    KLD_NM /* 지식명 */,
    KLD_SMM_TXT /* 지식요약내용 */,
    CRU_KYWD_NM || (CASE WHEN TRIM(CRU_KYWD_NM) IS NOT NULL AND TRIM(CRU_KYWD_NM) IS NOT NULL THEN ' / ' || CRU_KYWD_NM END) || (CASE WHEN (TRIM(CRU_KYWD_NM) IS NOT NULL OR TRIM(CRU_KYWD_NM) IS NOT NULL) AND TRIM(CRU_KYWD_NM) IS NOT NULL THEN ' / ' || CRU_KYWD_NM END) AS CRU_KYWD_NM /* 부패키워드명 */,
    CRU_KYWD_NM /* 부패키워드명 */,
    CRU_KYWD_NM /* 부패키워드명 */,
    CRU_KYWD_NM /* 부패키워드명 */,
    REG_DMND_YMD /* 등록요청일자 */,
    TO_CHAR(TO_DATE(REG_DMND_YMD), 'YYYY-MM-DD') AS TO_CHAR /* 등록요청일 상세 */,
    PRSV_WAY_CD /* 보존방법코드 */,
    F_CODE_NM('1000352', PRSV_WAY_CD) AS F_CODE_NM /* 보존방법명 */,
    (CASE WHEN PRSV_WAY_CD = '0' THEN NULL ELSE PRSV_DDLN_DH END) AS PRSV_WAY_CD /* 보존기한일시 */,
    F_CODE_NM('1000352', PRSV_WAY_CD) || ' ' || (CASE WHEN PRSV_WAY_CD = '0' THEN NULL ELSE TO_CHAR(PRSV_DDLN_DH, 'YYYY-MM-DD') END) AS F_CODE_NM /* 보존방법명/일시 */,
    KLD_CAT_CD /* 지식분류코드 */,
    (SELECT AS TG_CAT_NM
FROM TBAEPGKM017M /* 대상분류기본T */ WHERE TG_CAT_ID = KLD_CAT_CD) AS KLD_CAT_NM /* 지식분류명 */ ,KLD_TXT /* 지식내용 */ ,KLD_TXT AS KLD_TXT_REVOKE /* 지식내용 - 초기화때 쓸 꺼 */ ,TRGT_INST_CD /* 대상기관코드 */ ,F_ORG_INFO(TRGT_INST_CD, '1') AS TRGT_INST_NM /* 대상기관명 */ ,CVLCPT_ADT_YR /* 감사년도 */ ,ADT_NO /* 감사번호 */ ,DSPS_RQT_SQNO /* 처분요구순번 */ ,FUNC_SPH_CD /* 기능분야코드 */ ,CAT_SPH_CD /* 분류분야코드 */ ,F_CODE_NM('1000466', CAT_SPH_CD) || (CASE WHEN F_CODE_NM('1000466', CAT_SPH_CD) IS NOT NULL AND F_CODE_NM('1000467', FUNC_SPH_CD) IS NOT NULL THEN ' / ' END ) || F_CODE_NM('1000467', FUNC_SPH_CD) AS SPH_NM /* 분야명조합 */ ,F_CODE_NM('1000466', CAT_SPH_CD) AS CAT_SPH_NM /* 기능분야명 */ ,F_CODE_NM('1000467', FUNC_SPH_CD) AS FUNC_SPH_NM /* 분류분야명 */ ,A.CVLCPT_DOC_ID /* 문서ID */ ,REGN_OPEN_YN /* 등록자공개여부 */ ,(CASE WHEN REGN_OPEN_YN = 'Y' THEN '공개' ELSE '비공개' END) AS REGN_OPEN_NM /* 등록자공개여부명 */ ,KLD_STA_CD /* 지식상태코드 */ ,(CASE WHEN KLD_STA_CD = '7' THEN F_CODE_NM('1000351', KLD_STA_CD) || ' (' || TO_CHAR(EXPR_DH, 'YYYY-MM-DD') || ')' WHEN KLD_STA_CD = '8' THEN F_CODE_NM('1000351', KLD_STA_CD) || ' (' || TO_CHAR(ABRG_DH, 'YYYY-MM-DD') || ')' ELSE F_CODE_NM('1000351', KLD_STA_CD) END) AS KLD_STA_NM /* 지식상태명 */ ,ENAIS_PST_INQ_NMTM /* 조회수 */ ,ADT_MTTR_NM /* 감사사항명 */ ,DSPS_RQT_NM /* 처분요구명 */ ,KLD_SRC_NM /* 지식출처명 */ ,KLD_REGI_YR /* 지식등록년도 */ ,KLD_REGI_YR || ' 년도' AS KLD_REGI_YR_Q /* 지식등록년도[텍스트] */ ,( SELECT COUNT(*)
FROM ( SELECT KNB
FROM TBAEPGKM002L WHERE KNB = #KNB# UNION ALL SELECT KNB
FROM TBAEPGKM004L WHERE KNB = #KNB# ) ) AS COUNT ,NVL(( SELECT MAX(APRV_YN) AS APRV_YN /* 승인여부 */
FROM TBAEPGKM016L WHERE KNB = A.KNB ), 'N') AS APRV_YN , CASE WHEN A.CVLCPT_DOC_ID IS NOT NULL THEN (SELECT DECODE(COUNT(*), 0, 'N', 'Y')
FROM UBKERAPP.XR_PAGE WHERE CVLCPT_DOC_ID = A.CVLCPT_DOC_ID ) ELSE 'N' END AS FILE_YN , CASE WHEN A.CVLCPT_DOC_ID IS NOT NULL THEN (SELECT DECODE(COUNT(*), 0, 'N', 'Y')
FROM UBKERAPP.XR_PAGE WHERE CVLCPT_DOC_ID = A.CVLCPT_DOC_ID AND PAGE_TITLE IS NOT NULL AND SUBSTR(PAGE_TITLE, CASE WHEN INSTR(PAGE_TITLE, '.',-1) > 0 THEN INSTR(PAGE_TITLE, '.',-1)+1 ELSE 1 END) != 'hwp') ELSE 'N' END AS NOT_HWP_DOC_YN , OTSD_EXPRT_RGTR_ENO /*등록자 전산번호*/ , F_USR_INFO(OTSD_EXPRT_RGTR_ENO, '2') AS RGTR_NM /*등록자명*/ , B.CRU_TELNO /*내선번호*/ , B.EML_ADDR /*이메일*/ , A.REGN_DPT_NM /*등록자 소속명*/ , F_CODE_NM('1000836', NEW_KLD_CAT_CD ) AS NEW_KLD_CAT_NM , F_CODE_NM('1000837', NEW_CAT_SPH_CD ) AS NEW_CAT_SPH_NM FROM TBAEPGKM001M A , TBDCMACM001M B WHERE A.OTSD_EXPRT_RGTR_ENO = B.TRGT_NOP_ENO (+) AND A.KNB = #KNB# AND A.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND A.ADT_NO = #ADT_NO# AND A.DSPS_RQT_SQNO = #DSPS_RQT_SQNO#