SELECT D1.EVL_STEP_CD /* 평가단계코드 */,
    D1.EVL_CMTR_DVSN_CD /* 평가위원구분코드 */,
    D1.EVL_CMTR_CNB /* 평가자 전산번호 */,
    D1.EVL_YR /* 평가년도 */,
    D1.HLYR_DVSN_CD /* 반기구분코드 */,
    D1.CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    D1.AUD_TSK_KND_CD /* 감사업무종류코드 */,
    D1.CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.TSK_NO /* 업무번호 */,
    NVL(F_MNG_KND_AUDYRNO(D1.CVLCPT_ADT_YR, D1.TSK_NO, D2.ADT_KDCD, '-'),D1.TSK_YR_NO) AS F_MNG_KND_AUDYRNO /* 감사연번호 */,
    D1.ADT_MTTR_NM /* 감사사항명 */,
    D1.ADT_STP_SECD /* 감사단계구분코드 */,
    D1.EVL_STA_CD /* 평가상태코드 */,
    D1.EVL_RK_CD /* 평가등급코드 */,
    D1.IDVT_INDEX_VAL /* 개별지표값 */,
    D1.TSK_ASC /* 업무평점 */,
    D1.DRIVE_RTE_ASC /* 추진율조정평점 */,
    D1.MAIN_INDC_SBJ_PRB_TXT /* 주요지적사항문제점내용 */,
    D1.MAIN_AUD_RSLT_EPT_EFCT_TXT /* 주요감사결과기대효과내용 */,
    D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /* 특기사항계획대비기여율변경사유내용 */,
    D1.EVL_OPIN /* 평가의견 */,
    F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS F_DPT_INFO /* 처리과 : 2015.02.04 최원형감사관 요청 */
FROM ( SELECT NVL(D5.EVL_STEP_CD, '100') AS EVL_STEP_CD /* 평가단계코드 */,
    NVL(D5.EVL_CMTR_DVSN_CD, 'CD33') AS EVL_CMTR_DVSN_CD /* 귀청보고평가자구분코드 */,
    NVL(D5.EVL_CMTR_CNB, #strEvlCmtrCnb#) AS EVL_CMTR_CNB /* 평가자 전산번호 */,
    NVL(D5.EVL_YR, #strEvlYr#) AS EVL_YR /* 평가년도 */,
    NVL(D5.HLYR_DVSN_CD, #strHlyrDvsnCd#) AS HLYR_DVSN_CD /* 반기구분코드 */,
    NVL(D5.CVLCPT_TASK_SECD, '10000') AS CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    D4.ADT_KDCD /* 감사종류코드 */,
    D4.CVLCPT_ADT_YR /* 민원감사년도 */,
    D4.TSK_NO /* 업무번호 */,
    D4.CVLCPT_ADT_YR||'-'||D4.TSK_NO AS CVLCPT_ADT_YR /* 민원감사년도 */,
    D4.ADT_MTTR_NM /* 감사사항명 */,
    D3.ADT_STP_SECD /* 감사단계구분코드 */,
    NVL(D5.EVL_STA_CD,'100') AS EVL_STA_CD /* 평가상태코드 */,
    D5.EVL_RK_CD /* 평가등급코드 */,
    NULL /* 개별지표값 */,
    D5.TSK_ASC /* 업무평점 */,
    D5.DRIVE_RTE_ASC /* 추진율조정평점 */,
    D4.MAIN_INDC_SBJ_PRB_TXT /* 주요지적사항문제점내용 */,
    D4.MAIN_AUD_RSLT_EPT_EFCT_TXT /* 주요감사결과기대효과내용 */,
    D4.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /* 특기사항계획대비기여율변경사유내용 */,
    D5.EVL_OPIN /* 평가의견 */,
    D4.HNDL_DIV_DPT_CD /* 처리과부서코드 */
FROM ( SELECT D2.CVLCPT_ADT_YR /* 민원감사년도 */,
    D2.TSK_NO,
    D2.ADT_STP_SECD /* 감사단계구분코드 */
FROM ( SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    TSK_NO,
    AUD_STEP_CD_MAX,
    AUD_STEP_CD_MIN
FROM ( SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    TSK_NO,
    MAX(ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */,
    MIN(ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */
FROM TBCSPAOE022M /* 감사업무처리단계관리기본 */ WHERE 1 = 1 AND CMPTN_YMD IS NOT NULL AND CMPTN_YMD BETWEEN (SELECT EVL_STR_DT
FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (SELECT EVL_END_DT
FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) GROUP BY CVLCPT_ADT_YR, TSK_NO ) WHERE (TO_NUMBER(AUD_STEP_CD_MAX) BETWEEN 10004 AND 10009 OR TO_NUMBER(AUD_STEP_CD_MAX) = '10011') /* 흐속조치 추가 */ AND TO_NUMBER(AUD_STEP_CD_MIN) D1.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# D1.ADT_MTTR_NM LIKE '%'||#strAudSbjNm#||'%' D1.AUD_TSK_KND_CD LIKE '%'||#strAudKndCd#||'%' CASE WHEN LENGTH(#ADT_GRNT_NO#) = 3 AND D2.ADT_GRNT_NO = #ADT_GRNT_NO# THEN '1' WHEN LENGTH(#ADT_GRNT_NO#) <> 3 AND D1.tsk_no = #ADT_GRNT_NO# THEN '1' ELSE '' END = '1' D2.ADT_KDCD like '%'||SUBSTR(#strAudYrNoKndCd#,3,1) NVL(D1.EVL_STA_CD, '100') = #strEvlStaCd# ORDER BY D1.AUD_TSK_KND_CD, D1.HNDL_DIV_DPT_CD