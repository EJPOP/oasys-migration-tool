SELECT DISTINCT D1.EVL_STEP_CD /* 평가단계코드 */,
    D1.EVL_CMTR_DVSN_CD /* 평가자구분코드 */,
    D1.EVL_CMTR_CNB /* 평가자 전산번호 */,
    D1.EVL_YR /* 평가년도 */,
    D1.HLYR_DVSN_CD /* 반기구분코드 */,
    D1.CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    D1.AUD_TSK_KND_CD /* 감사업무종류코드 */,
    D1.CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.TSK_NO /* 업무번호 */,
    NVL(F_MNG_KND_AUDYRNO(D1.CVLCPT_ADT_YR, D1.TSK_NO, D3.ADT_KDCD, '-'),D1.TSK_YR_NO) AS F_MNG_KND_AUDYRNO /* 감사연번호 */,
    D1.ADT_MTTR_NM /* 감사사항명 */,
    D1.ADT_STP_SECD /* 감사단계구분코드 */,
    D1.EVL_STA_CD /* 평가상태코드 */,
    D1.EVL_INDEX_CD1 /* 감사준비 평가등급 */,
    D1.EVL_INDEX_RTE1 /* 감사준비 비중 */,
    D1.EVL_INDEX_CD2 /* 감사투입인력비용적정성 평가등급 */,
    D1.EVL_INDEX_RTE2 /* 감사투입인력비용적정성 비중 */,
    D1.EVL_INDEX_CD3 /* 감사난이도 평가등급 */,
    D1.EVL_INDEX_RTE3 /* 감사난이도 비중 */,
    D1.EVL_INDEX_CD4 /* 지적사항변경불문정도 평가등급 */,
    D1.EVL_INDEX_RTE4 /* 지적사항변경불문정도 비중 */,
    D1.EVL_INDEX_CD5 /* 처리안작성적정성 평가등급 */,
    D1.EVL_INDEX_RTE5 /* 처리안작성적정성 비중 */,
    D1.EVL_INDEX_CD6 /* 감사성과정도 평가등급 */,
    D1.EVL_INDEX_RTE6 /* 감사성과정도 비중 */,
    D1.RK_CD_100 /* 탁월 개별지표값 */,
    D1.RK_CD_200 /* 매우우수 개별지표값 */,
    D1.RK_CD_300 /* 우수+ 개별지표값 */,
    D1.RK_CD_400 /* 우수- 개별지표값 */,
    D1.RK_CD_500 /* 양호 개별지표값 */,
    D1.RK_CD_600 /* 보통 개별지표값 */,
    D1.RK_CD_700 /* 미흡 개별지표값 */,
    D1.RK_CD_800 /* 우수 개별지표값 */,
    D1.CAL_IDVT_INDEX_VAL1 /* 감사준비 비중*개별지표 */,
    D1.CAL_IDVT_INDEX_VAL2 /* 감사투입인력비용적정성 비중*개별지표 */,
    D1.CAL_IDVT_INDEX_VAL3 /* 감사난이도 비중*개별지표 */,
    D1.CAL_IDVT_INDEX_VAL4 /* 지적사항변경불문정도 비중*개별지표 */,
    D1.CAL_IDVT_INDEX_VAL5 /* 처리안작성적정성 비중*개별지표 */,
    D1.CAL_IDVT_INDEX_VAL6 /* 감사성과정도 비중*개별지표 */,
    D1.DRIVE_RTE_ASC /* 추진율조정평점 */,
    D1.TSK_ASC /* 업무평점 */,
    D1.SYT_EVL_RK_CD /* 종합평가등급코드 */,
    D1.SYT_EVL_ADVL_VAL /* 종합가중치 합계지표 */,
    D1.SPE_ADP_CLU_CD /* 특별가산점항목코드 */,
    D1.SPE_ADD_SC /* 특별가산점 */,
    D1.MDT_ASC /* 평점조정 */,
    D1.EVL_OPIN /* 위원평가의견 */,
    D1.MAIN_INDC_SBJ_PRB_TXT /* 주요지적사항문제점내용 */,
    D1.MAIN_AUD_RSLT_EPT_EFCT_TXT /* 주요감사결과기대효과내용 */,
    D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /* 특기사항계획대비기여율변경사유내용 */,
    D2.EVL_RK_CD /* 귀청보고평가등급 */,
    D2.EVL_STEP_NM /* 평가단계명 */,
    D2.EVL_CMTR_NM /* 귀청보고 평가자명 */,
    D2.EVL_RK_NM /* 귀청보고 평가등급 */,
    D2.EVL_STA_NM /* 귀청보고 평가상태 */,
    D2.EVL_OPIN /* 귀청보고평가의견 */,
    F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS F_DPT_INFO /* 처리과 추가요구 2015.02.04 최원형감사관 요청 */,
    D1.HNDL_DIV_DPT_CD
FROM ( select a.EVL_STEP_CD /* 평가단계코드 */,
    a.EVL_CMTR_DVSN_CD /* 평가자구분코드 */,
    a.EVL_CMTR_CNB /* 평가자 전산번호 */,
    a.EVL_YR /* 평가년도 */,
    a.HLYR_DVSN_CD /* 반기구분코드 */,
    A.CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    a.AUD_TSK_KND_CD /* 감사업무종류코드 */,
    A.CVLCPT_ADT_YR /* 민원감사년도 */,
    a.TSK_NO /* 업무번호 */,
    A.CVLCPT_ADT_YR||'-'||a.TSK_NO AS CVLCPT_ADT_YR /* 민원감사년도 */,
    A.ADT_MTTR_NM /* 감사사항명 */,
    A.ADT_STP_SECD /* 감사단계구분코드 */,
    a.EVL_STA_CD /* 평가상태코드 */,
    A.EVL_INDEX_CD1 /* 감사준비 평가등급 */,
    D4.EVL_INDEX_RTE1 /* 감사준비 비중 */,
    A.EVL_INDEX_CD2 /* 감사투입인력비용적정성 평가등급 */,
    D4.EVL_INDEX_RTE2 /* 감사투입인력비용적정성 비중 */,
    A.EVL_INDEX_CD3 /* 감사난이도 평가등급 */,
    D4.EVL_INDEX_RTE3 /* 감사난이도 비중 */,
    A.EVL_INDEX_CD4 /* 지적사항변경불문정도 평가등급 */,
    D4.EVL_INDEX_RTE4 /* 지적사항변경불문정도 비중 */,
    A.EVL_INDEX_CD5 /* 처리안작성적정성 평가등급 */,
    D4.EVL_INDEX_RTE5 /* 처리안작성적정성 비중 */,
    A.EVL_INDEX_CD6 /* 감사성과정도 평가등급 */,
    D4.EVL_INDEX_RTE6 /* 감사성과정도 비중 */,
    D5.RK_CD_100 /* 탁월 개별지표값 */,
    D5.RK_CD_200 /* 매우우수 개별지표값 */,
    D5.RK_CD_300 /* 우수+ 개별지표값 */,
    D5.RK_CD_400 /* 우수- 개별지표값 */,
    D5.RK_CD_500 /* 양호 개별지표값 */,
    D5.RK_CD_600 /* 보통 개별지표값 */,
    D5.RK_CD_700 /* 미흡 개별지표값 */,
    D5.RK_CD_800 /* 우수 개별지표값 */,
    CASE WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '100' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_100)/100 WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '200' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_200)/100 WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '300' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_300)/100 WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '400' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_400)/100 WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '500' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_500)/100 WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '600' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_600)/100 WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '700' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_700)/100 WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '800' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_800)/100 ELSE 0 END AS EVL_INDEX_CD1 /* 감사준비 비중*개별지표 */,
    CASE WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '100' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_100)/100 WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '200' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_200)/100 WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '300' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_300)/100 WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '400' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_400)/100 WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '500' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_500)/100 WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '600' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_600)/100 WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '700' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_700)/100 WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '800' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_800)/100 ELSE 0 END AS EVL_INDEX_CD2 /* 감사투입인력비용적정성 비중*개별지표 */,
    CASE WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '100' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_100)/100 WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '200' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_200)/100 WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '300' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_300)/100 WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '400' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_400)/100 WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '500' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_500)/100 WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '600' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_600)/100 WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '700' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_700)/100 WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '800' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_800)/100 ELSE 0 END AS EVL_INDEX_CD3 /* 감사난이도 비중*개별지표 */,
    CASE WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '100' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_100)/100 WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '200' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_200)/100 WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '300' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_300)/100 WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '400' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_400)/100 WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '500' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_500)/100 WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '600' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_600)/100 WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '700' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_700)/100 WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '800' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_800)/100 ELSE 0 END AS EVL_INDEX_CD4 /* 지적사항변경불문정도 비중*개별지표 */,
    CASE WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '100' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_100)/100 WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '200' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_200)/100 WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '300' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_300)/100 WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '400' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_400)/100 WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '500' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_500)/100 WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '600' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_600)/100 WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '700' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_700)/100 WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '800' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_800)/100 ELSE 0 END AS EVL_INDEX_CD5 /* 처리안작성적정성 비중*개별지표 */,
    CASE WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '100' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_100)/100 WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '200' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_200)/100 WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '300' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_300)/100 WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '400' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_400)/100 WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '500' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_500)/100 WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '600' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_600)/100 WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '700' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_700)/100 WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '800' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_800)/100 ELSE 0 END AS EVL_INDEX_CD6 /* 감사성과정도 비중*개별지표 */,
    a.DRIVE_RTE_ASC /* 추진율조정평점 */,
    a.TSK_ASC /* 업무평점 */,
    a.SYT_EVL_RK_CD /* 종합평가등급코드 */,
    a.SYT_EVL_ADVL_VAL /* 종합가중치 합계지표 */,
    a.SPE_ADP_CLU_CD /* 특별가산점항목코드 */,
    a.SPE_ADD_SC /* 특별가산점 */,
    a.MDT_ASC /* 평점조정 */,
    a.MAIN_INDC_SBJ_PRB_TXT /* 주요지적사항문제점내용 */,
    a.MAIN_AUD_RSLT_EPT_EFCT_TXT /* 주요감사결과기대효과내용 */,
    a.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /* 특기사항계획대비기여율변경사유내용 */,
    a.EVL_OPIN /* 위원평가의견 */,
    A.HNDL_DIV_DPT_CD
from ( SELECT A.EVL_STEP_CD,
    A.EVL_CMTR_DVSN_CD,
    A.EVL_CMTR_CNB,
    A.EVL_YR,
    A.HLYR_DVSN_CD,
    A.CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    A.AUD_TSK_KND_CD,
    A.CVLCPT_ADT_YR /* 민원감사년도 */,
    A.TSK_NO,
    A.TSK_YR_NO,
    A.ADT_MTTR_NM /* 감사사항명 */,
    A.ADT_STP_SECD /* 감사단계구분코드 */,
    A.EVL_STA_CD,
    NVL(B.EVL_INDEX_CD1,0) AS EVL_INDEX_CD1 /* 감사준비 평가등급 */,
    NVL(B.EVL_INDEX_CD2,0) AS EVL_INDEX_CD2 /* 감사투입인력비용적정성 평가등급 */,
    NVL(B.EVL_INDEX_CD3,0) AS EVL_INDEX_CD3 /* 감사난이도 평가등급 */,
    NVL(B.EVL_INDEX_CD4,0) AS EVL_INDEX_CD4 /* 지적사항변경불문정도 평가등급 */,
    NVL(B.EVL_INDEX_CD5,0) AS EVL_INDEX_CD5 /* 처리안작성적정성 평가등급 */,
    NVL(B.EVL_INDEX_CD6,0) AS EVL_INDEX_CD6 /* 감사성과정도 평가등급 */,
    A.DRIVE_RTE_ASC,
    A.TSK_ASC,
    A.SYT_EVL_RK_CD,
    A.SYT_EVL_ADVL_VAL,
    A.SPE_ADP_CLU_CD,
    A.SPE_ADD_SC,
    A.MDT_ASC,
    A.MAIN_INDC_SBJ_PRB_TXT,
    A.MAIN_AUD_RSLT_EPT_EFCT_TXT,
    A.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT,
    A.EVL_OPIN,
    A.HNDL_DIV_DPT_CD
FROM( SELECT NVL(D3.EVL_STEP_CD, '200') AS EVL_STEP_CD /* 평가단계코드 */,
    NVL(D3.EVL_CMTR_DVSN_CD, 'CD34') AS EVL_CMTR_DVSN_CD /* 평가자구분코드 */,
    NVL(D3.EVL_CMTR_CNB, #strEvlCmtrCnb#) AS EVL_CMTR_CNB /* 평가자 전산번호 */,
    NVL(D3.EVL_YR, #strEvlYr#) AS EVL_YR /* 평가년도 */,
    NVL(D3.HLYR_DVSN_CD, #strHlyrDvsnCd#) AS HLYR_DVSN_CD /* 반기구분코드 */,
    NVL(D3.CVLCPT_TASK_SECD, '10000') AS CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    D2.ADT_KDCD /* 감사종류코드 */,
    D1.CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.TSK_NO /* 업무번호 */,
    D1.CVLCPT_ADT_YR||'-'||D1.TSK_NO AS CVLCPT_ADT_YR /* 민원감사년도 */,
    D2.ADT_MTTR_NM /* 감사사항명 */,
    D1.ADT_STP_SECD /* 감사단계구분코드 */,
    NVL(D3.EVL_STA_CD, '100') AS EVL_STA_CD /* 평가상태코드 */,
    D3.DRIVE_RTE_ASC /* 추진율조정평점 */,
    D3.TSK_ASC /* 업무평점 */,
    D3.SYT_EVL_RK_CD /* 종합평가등급코드 */,
    D3.SYT_EVL_ADVL_VAL /* 종합가중치 합계지표 */,
    D3.SPE_ADP_CLU_CD /* 특별가산점항목코드 */,
    D3.SPE_ADD_SC /* 특별가산점 */,
    D3.MDT_ASC /* 평점조정 */,
    D2.MAIN_INDC_SBJ_PRB_TXT /* 주요지적사항문제점내용 */,
    D2.MAIN_AUD_RSLT_EPT_EFCT_TXT /* 주요감사결과기대효과내용 */,
    D2.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /* 특기사항계획대비기여율변경사유내용 */,
    D3.EVL_OPIN /* 위원평가의견 */,
    D2.HNDL_DIV_DPT_CD
FROM TBCSPAOE022M D1 , TBCSPAOE021M D2 , TBCSPAOE029M D3 WHERE D1.CVLCPT_ADT_YR = D2.CVLCPT_ADT_YR AND D1.TSK_NO = D2.TSK_NO AND D2.CVLCPT_ADT_YR = D3.CVLCPT_ADT_YR (+) AND D2.TSK_NO = D3.TSK_NO (+) AND D2.ADT_KDCD = D3.AUD_TSK_KND_CD (+) and d3.evl_yr (+) = #strEvlYr# and d3.HLYR_DVSN_CD (+) = #strHlyrDvsnCd# AND D1.ADT_STP_SECD = '10010' AND D3.EVL_STEP_CD (+) = '200' AND D1.LUNH_DT IS NOT NULL AND D1.CMPTN_YMD IS NOT NULL AND (D1.CMPTN_YMD BETWEEN (select EVL_STR_DT
from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)) AND D1.CTB_RTE_CFM_YN = 'Y' /*기여율 확인을 했고 감사단계가 회의시행단계인 감사사항 목록*/ UNION SELECT NVL(D3.EVL_STEP_CD, '200') AS EVL_STEP_CD /* 평가단계코드 */,
    NVL(D3.EVL_CMTR_DVSN_CD, 'CD34') AS EVL_CMTR_DVSN_CD /* 평가자구분코드 */,
    NVL(D3.EVL_CMTR_CNB, #strEvlCmtrCnb#) AS EVL_CMTR_CNB /* 평가자 전산번호 */,
    NVL(D3.EVL_YR, #strEvlYr#) AS EVL_YR /* 평가년도 */,
    NVL(D3.HLYR_DVSN_CD, #strHlyrDvsnCd#) AS HLYR_DVSN_CD /* 반기구분코드 */,
    NVL(D3.CVLCPT_TASK_SECD, '10000') AS CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    D1.ADT_KDCD /* 감사종류코드 */,
    D1.CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.TSK_NO /* 업무번호 */,
    D1.CVLCPT_ADT_YR||'-'||D1.TSK_NO AS CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.ADT_MTTR_NM /* 감사사항명 */,
    D2.ADT_STP_SECD /* 감사단계구분코드 */,
    NVL(D3.EVL_STA_CD, '100') AS EVL_STA_CD /* 평가상태코드 */,
    D3.DRIVE_RTE_ASC /* 추진율조정평점 */,
    D3.TSK_ASC /* 업무평점 */,
    D3.SYT_EVL_RK_CD /* 종합평가등급코드 */,
    D3.SYT_EVL_ADVL_VAL /* 종합가중치 합계지표 */,
    D3.SPE_ADP_CLU_CD /* 특별가산점항목코드 */,
    D3.SPE_ADD_SC /* 특별가산점 */,
    D3.MDT_ASC /* 평점조정 */,
    D1.MAIN_INDC_SBJ_PRB_TXT /* 주요지적사항문제점내용 */,
    D1.MAIN_AUD_RSLT_EPT_EFCT_TXT /* 주요감사결과기대효과내용 */,
    D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /* 특기사항계획대비기여율변경사유내용 */,
    D3.EVL_OPIN /* 위원평가의견 */,
    D1.HNDL_DIV_DPT_CD
FROM TBCSPAOE021M D1 , TBCSPAOE029M D3 , (SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    TSK_NO,
    MAX(ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */
FROM TBCSPAOE022M WHERE LUNH_DT IS NOT NULL and CMPTN_YMD IS NOT NULL AND (CMPTN_YMD BETWEEN (select EVL_STR_DT
from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)) AND CTB_RTE_CFM_YN = 'Y' GROUP BY CVLCPT_ADT_YR, TSK_NO ) D2 WHERE D1.CVLCPT_ADT_YR = D3.CVLCPT_ADT_YR (+) AND D1.TSK_NO = D3.TSK_NO (+) AND D1.ADT_KDCD = D3.AUD_TSK_KND_CD (+) AND D1.TSK_NO = D3.TSK_NO (+) AND D3.EVL_STEP_CD (+) = '200' AND D3.EVL_STA_CD IS NULL AND D1.EVL_RQS_YN = 'Y' AND D1.CVLCPT_ADT_YR = D2.CVLCPT_ADT_YR AND D1.TSK_NO = D2.TSK_NO /*평가요청(평가기준>업무별기준관리>감사업무평가요청화면)을 했고 미평가상태인 감사사항 목록*/ UNION SELECT D1.EVL_STEP_CD /* 평가단계코드 */,
    D1.EVL_CMTR_DVSN_CD /* 평가위원구분코드 */,
    D1.EVL_CMTR_CNB /* 평가자 전산번호 */,
    D1.EVL_YR /* 평가년도 */,
    D1.HLYR_DVSN_CD /* 반기구분코드 */,
    D1.CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    D1.AUD_TSK_KND_CD AS AUD_TSK_KND_CD /* 감사업무종류코드 */,
    D2.CVLCPT_ADT_YR /* 민원감사년도 */,
    TO_CHAR(D2.TSK_NO) AS TO_CHAR /* 업무번호 */,
    D2.CVLCPT_ADT_YR||'-'||D2.TSK_NO AS CVLCPT_ADT_YR /* 민원감사년도 */,
    D2.ADT_MTTR_NM /* 감사사항명 */,
    D3.ADT_STP_SECD /* 감사단계구분코드 */,
    D1.EVL_STA_CD /* 평가상태코드 */,
    D1.DRIVE_RTE_ASC /* 추진율조정평점 */,
    D1.TSK_ASC /* 업무평점 */,
    D1.SYT_EVL_RK_CD /* 종합평가등급코드 */,
    D1.SYT_EVL_ADVL_VAL /* 종합가중치 합계지표 */,
    D1.SPE_ADP_CLU_CD /* 특별가산점항목코드 */,
    D1.SPE_ADD_SC /* 특별가산점 */,
    D1.MDT_ASC /* 평점조정 */,
    D2.MAIN_INDC_SBJ_PRB_TXT /* 주요지적사항문제점내용 */,
    D2.MAIN_AUD_RSLT_EPT_EFCT_TXT /* 주요감사결과기대효과내용 */,
    D2.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /* 특기사항계획대비기여율변경사유내용 */,
    D1.EVL_OPIN /* 위원평가의견 */,
    D2.HNDL_DIV_DPT_CD
FROM TBCSPAOE029M D1 , TBCSPAOE021M D2 , (SELECT CVLCPT_ADT_YR /* 민원감사년도 */,
    TSK_NO,
    MAX(ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */
FROM TBCSPAOE022M WHERE LUNH_DT IS NOT NULL AND CMPTN_YMD IS NOT NULL AND (CMPTN_YMD BETWEEN (select EVL_STR_DT
from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)) AND CTB_RTE_CFM_YN = 'Y' GROUP BY CVLCPT_ADT_YR, TSK_NO ) D3 WHERE D1.CVLCPT_ADT_YR = D2.CVLCPT_ADT_YR AND D1.TSK_NO = D2.TSK_NO AND D2.CVLCPT_ADT_YR = D3.CVLCPT_ADT_YR AND D2.TSK_NO = D3.TSK_NO AND D1.CVLCPT_TASK_SECD = '10000' AND D1.EVL_STEP_CD = '200' AND D1.EVL_CMTR_DVSN_CD = 'CD34' AND D1.EVL_STA_CD IS NOT NULL /*평가중, 평가완료상태인 감사사항 목록*/ ) A , ( SELECT DISTINCT C.EVL_YR,
    C.HLYR_DVSN_CD,
    C.CVLCPT_ADT_YR /* 민원감사년도 */,
    C.TSK_NO,
    MAX(C.EVL_INDEX_CD1) OVER(PARTITION BY C.EVL_YR, C.HLYR_DVSN_CD, C.CVLCPT_ADT_YR, C.TSK_NO) AS EVL_INDEX_CD1 /* 감사준비 */,
    MAX(C.EVL_INDEX_CD2) OVER(PARTITION BY C.EVL_YR, C.HLYR_DVSN_CD, C.CVLCPT_ADT_YR, C.TSK_NO) AS EVL_INDEX_CD2 /* 감사투입인력비용적정성 */,
    MAX(C.EVL_INDEX_CD3) OVER(PARTITION BY C.EVL_YR, C.HLYR_DVSN_CD, C.CVLCPT_ADT_YR, C.TSK_NO) AS EVL_INDEX_CD3 /* 감사난이도 */,
    MAX(C.EVL_INDEX_CD4) OVER(PARTITION BY C.EVL_YR, C.HLYR_DVSN_CD, C.CVLCPT_ADT_YR, C.TSK_NO) AS EVL_INDEX_CD4 /* 지적사항변경불문정도 */,
    MAX(C.EVL_INDEX_CD5) OVER(PARTITION BY C.EVL_YR, C.HLYR_DVSN_CD, C.CVLCPT_ADT_YR, C.TSK_NO) AS EVL_INDEX_CD5 /* 처리안작성적정성 */,
    MAX(C.EVL_INDEX_CD6) OVER(PARTITION BY C.EVL_YR, C.HLYR_DVSN_CD, C.CVLCPT_ADT_YR, C.TSK_NO) AS EVL_INDEX_CD6 /* 감사성과정도 */
FROM ( SELECT B.EVL_YR,
    B.HLYR_DVSN_CD,
    B.CVLCPT_ADT_YR /* 민원감사년도 */,
    B.TSK_NO,
    CASE WHEN B.EVL_INDEX_CD = 'PJCD02' THEN NVL(B.EVL_RK_CD, 0) END AS EVL_INDEX_CD /* 감사준비 등급 */,
    CASE WHEN B.EVL_INDEX_CD = 'PJCD01' THEN NVL(B.EVL_RK_CD, 0) END AS EVL_INDEX_CD /* 감사투입인력비용적정성 등급 */,
    CASE WHEN B.EVL_INDEX_CD = 'PJCD05' THEN NVL(B.EVL_RK_CD, 0) END AS EVL_INDEX_CD /* 감사난이도 등급 */,
    CASE WHEN B.EVL_INDEX_CD = 'PJCD03' THEN NVL(B.EVL_RK_CD, 0) END AS EVL_INDEX_CD /* 지적사항변경불문정도 등급 */,
    CASE WHEN B.EVL_INDEX_CD = 'PJCD04' THEN NVL(B.EVL_RK_CD, 0) END AS EVL_INDEX_CD /* 처리안작성적정성 등급 */,
    CASE WHEN B.EVL_INDEX_CD = 'PJCD06' THEN NVL(B.EVL_RK_CD, 0) END AS EVL_INDEX_CD /* 감사성과정도 등급 */
FROM TBCSPAOE030M B WHERE B.EVL_YR = #strEvlYr# AND B.HLYR_DVSN_CD = #strHlyrDvsnCd# ) C ) B WHERE A.EVL_YR = B.EVL_YR (+) AND A.HLYR_DVSN_CD = B.HLYR_DVSN_CD (+) AND A.CVLCPT_ADT_YR = B.CVLCPT_ADT_YR (+) AND A.TSK_NO = B.TSK_NO (+) ) A , (SELECT DISTINCT A.EVL_YR,
    A.HLYR_DVSN_CD,
    MAX(A.EVL_INDEX_RTE1) OVER(PARTITION BY A.EVL_YR, A.HLYR_DVSN_CD) AS EVL_INDEX_RTE1 /* 감사준비 비중 */,
    MAX(A.EVL_INDEX_RTE2) OVER(PARTITION BY A.EVL_YR, A.HLYR_DVSN_CD) AS EVL_INDEX_RTE2 /* 감사투입인력비용적정성 비중 */,
    MAX(A.EVL_INDEX_RTE3) OVER(PARTITION BY A.EVL_YR, A.HLYR_DVSN_CD) AS EVL_INDEX_RTE3 /* 감사난이도 비중 */,
    MAX(A.EVL_INDEX_RTE4) OVER(PARTITION BY A.EVL_YR, A.HLYR_DVSN_CD) AS EVL_INDEX_RTE4 /* 지적사항변경불문정도 비중 */,
    MAX(A.EVL_INDEX_RTE5) OVER(PARTITION BY A.EVL_YR, A.HLYR_DVSN_CD) AS EVL_INDEX_RTE5 /* 처리안작성적정성 비중 */,
    MAX(A.EVL_INDEX_RTE6) OVER(PARTITION BY A.EVL_YR, A.HLYR_DVSN_CD) AS EVL_INDEX_RTE6 /* 감사성과정도 비중 */
FROM (SELECT E.EVL_YR,
    E.HLYR_DVSN_CD,
    CASE WHEN E.EVL_INDEX_CD = 'PJCD02' THEN NVL(E.WGT_RTE, 0) END AS EVL_INDEX_CD /* 감사준비 */,
    CASE WHEN E.EVL_INDEX_CD = 'PJCD01' THEN NVL(E.WGT_RTE, 0) END AS EVL_INDEX_CD /* 감사투입인력비용적정성 */,
    CASE WHEN E.EVL_INDEX_CD = 'PJCD05' THEN NVL(E.WGT_RTE, 0) END AS EVL_INDEX_CD /* 감사난이도 */,
    CASE WHEN E.EVL_INDEX_CD = 'PJCD03' THEN NVL(E.WGT_RTE, 0) END AS EVL_INDEX_CD /* 지적사항변경불문정도 */,
    CASE WHEN E.EVL_INDEX_CD = 'PJCD04' THEN NVL(E.WGT_RTE, 0) END AS EVL_INDEX_CD /* 처리안작성적정성 */,
    CASE WHEN E.EVL_INDEX_CD = 'PJCD06' THEN NVL(E.WGT_RTE, 0) END AS EVL_INDEX_CD /* 감사성과정도 */
FROM TBCSPAOE002M E , TBCSPAOE030M D WHERE 1=1 AND E.EVL_YR = D.EVL_YR (+) AND E.HLYR_DVSN_CD = D.HLYR_DVSN_CD (+) AND E.EVL_INDEX_CD = D.EVL_INDEX_CD (+) AND E.EVL_YR = #strEvlYr# AND E.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D.CVLCPT_TASK_SECD (+) = '10000' AND D.EVL_STEP_CD (+) = '200' ) A ) D4 , ( SELECT NVL(SUM(CASE WHEN A.RK_CD = '100' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD /* 탁월 */,
    NVL(SUM(CASE WHEN A.RK_CD = '200' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD /* 매우우수 */,
    NVL(SUM(CASE WHEN A.RK_CD = '300' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD /* 우수+ */,
    NVL(SUM(CASE WHEN A.RK_CD = '400' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD /* 우수- */,
    NVL(SUM(CASE WHEN A.RK_CD = '500' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD /* 양호 */,
    NVL(SUM(CASE WHEN A.RK_CD = '600' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD /* 보통 */,
    NVL(SUM(CASE WHEN A.RK_CD = '700' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD /* 미흡 */,
    NVL(SUM(CASE WHEN A.RK_CD = '800' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD /* 우수 */,
    A.EVL_YR,
    A.HLYR_DVSN_CD,
    A.CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    A.AUD_TSK_KND_CD
FROM TBCSPAOE010D A WHERE 1=1 AND A.IDCT_YN = 'Y' AND A.EVL_YR = #strEvlYr# AND A.HLYR_DVSN_CD = #strHlyrDvsnCd# AND A.CVLCPT_TASK_SECD = '10000' GROUP BY A.EVL_YR, A.HLYR_DVSN_CD, A.CVLCPT_TASK_SECD, A.AUD_TSK_KND_CD ) D5 /*2015.02.26 수정 쿼리가...이상했다. 종류별 등급별 점수가 다다른데 그냥 등급별 점수를 맥스로 해서 계산오류가 있었음*/ where a.evl_yr = d4.EVL_YR and a.HLYR_DVSN_CD = d4.HLYR_DVSN_CD AND A.evl_yr = D5.EVL_YR AND A.HLYR_DVSN_CD = D5.HLYR_DVSN_CD AND A.AUD_TSK_KND_CD = D5.AUD_TSK_KND_CD ) D1 LEFT JOIN (SELECT D1.EVL_YR /* 평가년도 */,
    D1.HLYR_DVSN_CD /* 반기구분 */,
    D1.CVLCPT_TASK_SECD /* 민원업무구분코드 */,
    D1.AUD_TSK_KND_CD /* 감사종류코드 */,
    D1.EVL_CMTR_CNB /* 평가자 전산번호 */,
    D1.CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.TSK_NO /* 업무번호 */,
    D1.ADT_STP_SECD /* 감사단계구분코드 */,
    D1.EVL_RK_CD /* 귀청보고평가등급 */,
    F_CODE_NM('1000279', D1.EVL_STEP_CD) AS F_CODE_NM,
    F_USR_INFO(D1.EVL_CMTR_CNB, '2') AS F_USR_INFO,
    F_CODE_NM('1000274', D1.EVL_RK_CD) AS F_CODE_NM,
    F_CODE_NM('1000280', D1.EVL_STA_CD) AS F_CODE_NM,
    D1.EVL_OPIN /* 귀청보고평가의견 */
FROM TBCSPAOE029M D1 WHERE D1.EVL_YR = #strEvlYr# AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D1.CVLCPT_TASK_SECD = '10000' AND D1.EVL_STEP_CD = '100' AND D1.EVL_CMTR_DVSN_CD = 'CD33' ) D2 /*귀청보고단계 평가등급 및 평가의견*/ ON D1.EVL_YR = D2.EVL_YR AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD AND D1.CVLCPT_TASK_SECD = D2.CVLCPT_TASK_SECD AND D1.AUD_TSK_KND_CD = D2.AUD_TSK_KND_CD AND D1.CVLCPT_ADT_YR = D2.CVLCPT_ADT_YR AND D1.TSK_NO = D2.TSK_NO ,TB_BADDED001M D3 WHERE 1 = 1 AND D1.EVL_YR = #strEvlYr# AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D1.CVLCPT_ADT_YR = D3.CVLCPT_ADT_YR(+) AND D1.TSK_NO = D3.ADT_NO(+) D1.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# D1.ADT_MTTR_NM LIKE '%'||#strAudSbjNm#||'%' D1.AUD_TSK_KND_CD LIKE '%'||#strAudKndCd#||'%' CASE WHEN LENGTH(#ADT_GRNT_NO#) = 3 AND D3.ADT_GRNT_NO = #ADT_GRNT_NO# THEN '1' WHEN LENGTH(#ADT_GRNT_NO#) <> 3 AND D1.tsk_no = #ADT_GRNT_NO# THEN '1' ELSE '' END = '1' SUBSTR(D3.ADT_KDCD,3,1) = #strAudYrNoKndCd# NVL(D1.EVL_STA_CD, '100') = #strEvlStaCd# ORDER BY D1.AUD_TSK_KND_CD, D1.HNDL_DIV_DPT_CD