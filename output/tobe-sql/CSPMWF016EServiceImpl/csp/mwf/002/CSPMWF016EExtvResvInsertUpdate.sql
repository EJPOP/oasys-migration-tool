MERGE INTO TBCSPMWF003M USING DUAL ON (MEAL_DT = REPLACE(#MEAL_DT#, '-') AND MEAL_PEN_CNB = #TRGT_NOP_ENO#) WHEN MATCHED THEN UPDATE SET MEAL_YN = 'N' MEAL_YN = #MEAL_YN# WHEN NOT MATCHED THEN INSERT INSERT VALUES ( REPLACE(#MEAL_DT#, '-'), #TRGT_NOP_ENO#, (SELECT 'RS'|| TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHHMMSSFF4')
FROM DUAL), #S_CNB#, (SELECT TO_CHAR(SYSDATE, 'YYYYMMDD')
FROM DUAL), #BOKG_YN#, #MEAL_YN#, #BOKG_CNL_YN#, DECODE( (SELECT COUNT(*)
FROM TBCSPMWF005M WHERE TRGT_NOP_ENO = #TRGT_NOP_ENO#), 0, (SELECT BOKG_M
FROM TBCSPMWF004M WHERE EXTV_DVSN_CD ='2' AND USE_YN='Y' AND SLCT_CRTR_DT = (SELECT MAX(SLCT_CRTR_DT) AS SLCT_CRTR_DT /* 청탁기준일시 */
FROM TBCSPMWF004M WHERE 1=1 AND EXTV_DVSN_CD ='2' AND USE_YN='Y') ), 1, (SELECT UN_BOKG_M
FROM TBCSPMWF004M WHERE EXTV_DVSN_CD ='1' AND USE_YN='Y' AND SLCT_CRTR_DT = (SELECT MAX(SLCT_CRTR_DT) AS SLCT_CRTR_DT /* 청탁기준일시 */
FROM TBCSPMWF004M WHERE 1=1 AND EXTV_DVSN_CD ='1' AND USE_YN='Y') ) ), (SELECT TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI')
FROM DUAL), #FNL_USR_ID#, #FNL_USR_ID#, #FNL_DEAL_DPT_CD#, #FNL_MNU_ID#, SYSDATE, SYSDATE )