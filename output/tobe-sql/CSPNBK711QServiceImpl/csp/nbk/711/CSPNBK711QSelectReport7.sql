WITH /* CSPNBK711QSelectReport7 현금전표 */ DATA AS ( SELECT CASE DS_MNST_CLU_CD WHEN '110102' THEN 0 ELSE DSPS_RQT_AMT END AS DS_MNST_CLU_CD,
    CASE DS_MNST_CLU_CD WHEN '110102' THEN 0 ELSE 1 END AS DS_MNST_CLU_CD,
    CASE DS_MNST_CLU_CD WHEN '110102' THEN CRDT_MNST_CLU_CD ELSE DS_MNST_CLU_CD END AS DS_MNST_CLU_CD,
    CASE CRDT_MNST_CLU_CD WHEN '110102' THEN 0 ELSE DSPS_RQT_AMT END AS CRDT_MNST_CLU_CD,
    CASE CRDT_MNST_CLU_CD WHEN '110102' THEN 0 ELSE 1 END AS CRDT_MNST_CLU_CD
FROM TBCSPNBK301M WHERE SMB_DEAL_DT = #closingDt# AND CNL_YN = 'N' ) SELECT '' AS NM1,
    SUM(D1.DSPS_RQT_AMT) AS DSPS_RQT_AMT /* 처분요구금액 */,
    NULL,
    '000000' AS MNST_CLU_CD,
    '전일현금' AS ACCT_NM,
    NULL,
    NULL,
    '' AS NM2,
    1
FROM TBCSPNBK502M D1 WHERE D1.DEAL_DT = ( SELECT MAX(DEAL_DT)
FROM TBCSPNBK502M WHERE DEAL_DT < #closingDt# AND SUBSTRING(DEAL_DT, 5, 2) != '13' /* 연말정산용 데이터 제외 */ AND MNST_CLU_CD = '110102' ) AND D1.MNST_CLU_CD = '110102' UNION ALL SELECT '' AS NM1,
    SUM(A.DR_AMOUNT) AS DR_AMOUNT,
    SUM(A.DR_CNT) AS DR_CNT,
    A.MNST_CLU_CD,
    B.ACCT_NM,
    SUM(A.CR_AMOUNT) AS CR_AMOUNT,
    SUM(A.CR_CNT) AS CR_CNT,
    '' AS NM2,
    2
FROM ( SELECT CR_AMOUNT,
    CR_CNT,
    MNST_CLU_CD,
    DR_AMOUNT,
    DR_CNT
FROM DATA ) A , TBCSPNBK501M B WHERE A.MNST_CLU_CD = B.MNST_CLU_CD AND A.MNST_CLU_CD NOT IN ( '110702', '110402' ) /* 정기성예금, 단기예금 제외 */ GROUP BY A.MNST_CLU_CD, B.ACCT_NM UNION ALL SELECT '해약' AS NM1,
    NVL(SUM(A.DR_AMOUNT), 0) AS DR_AMOUNT,
    NVL(SUM(A.DR_CNT), 0) AS DR_CNT,
    '110702' AS MNST_CLU_CD,
    '장기예금' AS ACCT_NM,
    NVL(SUM(A.CR_AMOUNT), 0) AS CR_AMOUNT,
    NVL(SUM(A.CR_CNT), 0) AS CR_CNT,
    '예탁' AS NM2,
    3
FROM ( SELECT CR_AMOUNT,
    CR_CNT,
    MNST_CLU_CD,
    DR_AMOUNT,
    DR_CNT
FROM DATA ) A WHERE A.MNST_CLU_CD = '110702' /* 장기예금 */ UNION ALL SELECT '인출' AS NM1,
    SUM(A.DR_AMOUNT) AS DR_AMOUNT,
    SUM(A.DR_CNT) AS DR_CNT,
    A.MNST_CLU_CD,
    B.ACCT_NM,
    SUM(A.CR_AMOUNT) AS CR_AMOUNT,
    SUM(A.CR_CNT) AS CR_CNT,
    '예탁' AS NM2,
    4
FROM ( SELECT CR_AMOUNT,
    CR_CNT,
    MNST_CLU_CD,
    DR_AMOUNT,
    DR_CNT
FROM DATA ) A , TBCSPNBK501M B WHERE A.MNST_CLU_CD = B.MNST_CLU_CD AND A.MNST_CLU_CD = '110402' /* 단기예금 */ GROUP BY A.MNST_CLU_CD, B.ACCT_NM UNION ALL SELECT '' AS NM1,
    NULL,
    NULL,
    '000000' AS MNST_CLU_CD,
    '금일현금' AS ACCT_NM,
    SUM(D1.DSPS_RQT_AMT) AS DSPS_RQT_AMT /* 처분요구금액 */,
    NULL,
    '' AS NM2,
    5
FROM TBCSPNBK502M D1 WHERE D1.DEAL_DT = #closingDt# AND D1.MNST_CLU_CD = '110102' ORDER BY ORD, MNST_CLU_CD