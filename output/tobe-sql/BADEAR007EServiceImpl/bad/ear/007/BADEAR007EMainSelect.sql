select D1.CVLCPT_ADT_YR AS CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.ADT_NO AS ADT_NO /* 감사번호 */,
    F_MNG_KND_AUDYRNO(T1.CVLCPT_ADT_YR, T1.ADT_NO, T1.ADT_KDCD, '-') AS F_MNG_KND_AUDYRNO,
    F_MNG_KND_AUDYRNO(T1.CVLCPT_ADT_YR, T1.ADT_NO, T1.ADT_KDCD, '-') || '-' || D1.DSPS_RQT_SQNO AS F_MNG_KND_AUDYRNO,
    D1.DSPS_RQT_SQNO AS DSPS_RQT_SQNO /* 처분요구순번 */,
    D1.DSPS_RQT_NM AS DSPS_RQT_NM /* 처분요구명 */,
    F_CODE_NM ('1000125', D1.INST_SECD) AS INST_SECD /* 기관구분코드 */,
    F_CODE_NM ('1000002', D1.DSPS_RQT_KDCD) AS DSPS_RQT_KDCD /* 처분요구종류코드 */,
    T1.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    decode(D2.SVW_INPT_YN, 'Y', '등록', null, '미등록', D2.SVW_INPT_YN) AS SVW_INPT_YN /* 요약전입력여부 */,
    D2.SVW_CN /* 요약전내용 */,
    D2.DSPS_RQT_ACTN_MTTR_CN /* 처분요구조치사항내용 */,
    (CASE WHEN NVL(DBMS_LOB.GETLENGTH(D2.DSPS_RQT_ACTN_MTTR_CN),0) = 0 THEN D2.DSPS_RQT_ACTN_MTTR_CN ELSE D2.DSPS_RQT_ACTN_MTTR_CN END) AS DSPS_RQT_ACTN_MTTR_CN /* 처분요구조치사항내용 */,
    D2.SVW_WHOL_CN /* 요약전전체내용 */,
    ( select D3.#N/A AS CVLCPT_DOC_ID /* 민원문서아이디 */
FROM TB_BADEAR028M D3 where 1=1 and D3.ADT_SQNO = T1.CVLCPT_ADT_YR||T1.ADT_NO and D3.RLS_CYCL IN (SELECT MIN(TPOF_CYCL) AS TPOF_CYCL /* 제보차수 */
FROM TB_BADEAR028M S1 WHERE S1.ADT_SQNO = T1.CVLCPT_ADT_YR||T1.ADT_NO)) as CVLCPT_DOC_ID, REL_INST_NM as REL_INST_NM from TB_BADEAR001M d1, TB_BADEAR005M D2, TB_BADDED001M T1, ( SELECT A.ADT_YR /* 감사년도 */,
    A.ADT_NO /* 감사번호 */,
    A.DSPS_RQT_SQNO /* 처분요구순번 */,
    (CASE WHEN B.CNT = 1 THEN F_ORG_INFO (B.SRECS_REL_INST_CD, '1') WHEN B.CNT > 1 THEN F_ORG_INFO (B.SRECS_REL_INST_CD, '1') || ' 외 ' || (CNT-1) || ' 건' ELSE ' ' END ) AS REL_INST_NM /* 관계기관명 */
FROM TBBADEAR006M A, ( SELECT A.ADT_YR /* 감사년도 */,
    A.ADT_NO /* 감사번호 */,
    DSPS_RQT_SQNO /* 처분요구순번 */,
    COUNT(*) AS CNT,
    MIN(SRECS_REL_INST_CD) AS SRECS_REL_INST_CD /* 심사재심의관계기관코드 */
FROM TBBADEAR006M A GROUP BY A.CVLCPT_ADT_YR, A.ADT_NO, DSPS_RQT_SQNO) B WHERE A.CVLCPT_ADT_YR = B.CVLCPT_ADT_YR AND A.ADT_NO = B.ADT_NO AND A.DSPS_RQT_SQNO = B.DSPS_RQT_SQNO AND A.SRECS_REL_INST_CD = B.SRECS_REL_INST_CD) D4 where 1=1 AND D1.CVLCPT_ADT_YR = D2.CVLCPT_ADT_YR(+) AND D1.ADT_NO = D2.ADT_NO(+) AND D1.DSPS_RQT_SQNO = D2.DSPS_RQT_SQNO(+) AND D1.DSPS_RQT_SQNO = D4.DSPS_RQT_SQNO (+ ) AND D1.CVLCPT_ADT_YR = D4.CVLCPT_ADT_YR (+ ) AND D1.ADT_NO = D4.ADT_NO (+ ) AND D1.CVLCPT_ADT_YR = T1.CVLCPT_ADT_YR AND D1.ADT_NO = T1.ADT_NO AND T1.MNG_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#strCnb#, #dptAuth#, '', #strUpSpvBrdvCd#))) /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/ D1.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# SUBSTR(T1.ADT_KDCD,3,1) = #strAudYrNoKndCd# T1.ADT_GRNT_NO = #ADT_GRNT_NO# D1.DSPS_RQT_KDCD = #DSPS_RQT_KDCD# D2.SVW_INPT_YN = #SVW_INPT_YN# D2.SVW_INPT_YN IS NULL /* 주관국과에서 관리국과로 변경 - 2016.07.05 yyh */ AND T1.MNG_DEPT_CD = #MNG_DEPT_CD# /* ORDER BY d1.DSP_RQ_SNO ASC */