MERGE INTO TBAEPGKM016L USING DUAL ON ( EVL_YR = #EVL_YR# AND EVL_DVSN_CD = #EVL_DVSN_CD# AND SC_GRN_TG_CD = #SC_GRN_TG_CD# AND BRD_NO = #SET_ID# AND BRD_BKNO = #POST_SEQ# CMNT_NO = TO_NUMBER(#CMMT_SEQ#) AND SC_CAT_CD = '3' ) WHEN MATCHED THEN UPDATE SET SC = #EVL_ADD_SC# , LAST_USER_ID = #LAST_USER_ID# /* 최종사용자아이디 */, LAST_PRCS_DEPT_CD = #LAST_PRCS_DEPT_CD# /* 최종처리부서코드 */, LAST_MENU_ID = #LAST_MENU_ID# /* 최종메뉴아이디 */, LAST_MDFCN_DT = SYSDATE WHEN NOT MATCHED THEN INSERT INSERT ( EVL_YR /* 평가년도 */ ,EVL_DVSN_CD /* 평가구분코드 */ ,SC_GRN_TG_CD /* 점수부여대상코드 */ ,GRNDS_EXMN_AEX_SQNO /* 순번 */ ,BRD_NO /* 게시판번호 */ ,BRD_BKNO /* 게시판행번 */ ,CMNT_NO /* 댓글번호 */ ,SC_CAT_CD /* 점수분류코드 */ ,SC /* 점수 */ ,TRGT_NOP_ENO /* 전산번호 */ ,APRV_YN /* 승인여부 */ ,FRST_USER_ID /* 최초사용자ID */ ,LAST_USER_ID /* 최종사용자ID */ ,LAST_PRCS_DEPT_CD /* 최종거래부서코드 */ ,LAST_MENU_ID /* 최종메뉴ID */ ,FRST_REG_DT /* 최초등록일시 */ ,LAST_MDFCN_DT /* 최종수정일시 */ ) VALUES ( #EVL_YR# , #EVL_DVSN_CD# , #SC_GRN_TG_CD# , (SELECT NVL(MAX(TO_NUMBER(GRNDS_EXMN_AEX_SQNO)), '0') + 1 AS GRNDS_EXMN_AEX_SQNO /* 현장조사수용비순번 */
FROM TBAEPGKM016L WHERE EVL_YR = #EVL_YR# AND EVL_DVSN_CD = #EVL_DVSN_CD# AND SC_GRN_TG_CD = #SC_GRN_TG_CD#) , #SET_ID# , #POST_SEQ# , #CMMT_SEQ# , '' , '3' , #EVL_ADD_SC# , #CNB# , 'Y' , #FRT_USR_ID# , #LAST_USER_ID# , #LAST_PRCS_DEPT_CD# , #LAST_MENU_ID# , SYSDATE , SYSDATE );