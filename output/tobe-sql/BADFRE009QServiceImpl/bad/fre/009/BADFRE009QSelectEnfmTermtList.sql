SELECT (SELECT '('|| F_MNG_KND_AUDYRNO(ST1.CVLCPT_ADT_YR, ST1.ADT_NO, ST1.ADT_KDCD, '-') ||')'|| AS ADT_MTTR_NM /* 감사사항명 */
FROM TB_BADDED001M ST1 WHERE ST1.CVLCPT_ADT_YR||ST1.ADT_NO = TA.AUD_INFO) AS ADT_MTTR_NM , TA.SRECS_REL_INST_CD , F_ORG_INFO(TA.SRECS_REL_INST_CD, '1') AS REL_DEPT_NM , (SELECT '('||F_CODE_NM('1000002', ST1.DSPS_RQT_KDCD)||')'||ST1.DSPS_RQT_NM AS DSPS_RQT_KDCD /* 처분요구종류코드 */
FROM TB_BADEAR001M ST1 WHERE ST1.CVLCPT_ADT_YR||ST1.ADT_NO = TA.AUD_INFO AND ST1.DSPS_RQT_SQNO = TA.DSPS_RQT_SQNO ) AS DSP_RQ_TG_KND_NM , TB.ENFC_YMD , TB.PRCS_TERM_YMD , TB.IMPL_WHLS_CFMTN_YMD AS DSPS_RQT_CFMTN_YMD , CASE WHEN TB.CFMTN_STTS_SECD = '1' AND NVL(TB.CFMTN_YN,'N') <> 'Y' AND TO_CHAR(SYSDATE,'YYYYMMDD') 'Y' AND TO_CHAR(SYSDATE,'YYYYMMDD') > TB.PRCS_TERM_YMD THEN TO_CHAR(TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD')) - TO_DATE(TB.PRCS_TERM_YMD))||'일 지남' ELSE '-' END AS OVER_TERM , CASE WHEN TB.CFMTN_STTS_SECD = '1' AND NVL(TB.CFMTN_YN,'N') <> 'Y' THEN '미결' WHEN TB.CFMTN_STTS_SECD = '1' AND TB.CFMTN_YN = 'Y' THEN '완결' WHEN TB.CFMTN_STTS_SECD = '2' THEN '확정' END AS STATUS_FLAG , CASE WHEN TB.DSPS_RQT_ATRZ_STTS_SECD = '2' THEN '결재중' WHEN TB.DSPS_RQT_ATRZ_STTS_SECD = '3' THEN '승인' WHEN TB.DSPS_RQT_ATRZ_STTS_SECD = '4' THEN '반려' ELSE '미상신' END AS PLAY_FLAG FROM ( SELECT T1.CVLCPT_ADT_YR||T1.ADT_NO AS CVLCPT_ADT_YR /* 민원감사년도 */,
    T2.REL_INST_CD /* 관계기관코드 */,
    T1.DSPS_RQT_SQNO /* 처분요구순번 */
FROM TBBADEAR002D T1 , TBBADEAR006M T2 , TBBADDED001M T3 WHERE 1 = 1 AND T1.CVLCPT_ADT_YR = T2.CVLCPT_ADT_YR AND T1.ADT_NO = T2.ADT_NO AND T1.DSPS_RQT_SQNO = T2.DSPS_RQT_SQNO AND T1.CVLCPT_ADT_YR = T3.CVLCPT_ADT_YR AND T1.ADT_NO = T3.ADT_NO /* 속도개선으로 쿼리로 변경 2015.05.13 yyh */ AND 'Y' = (CASE WHEN (#strAudYr# = '' AND #strAudGrnNo# = '' AND #strAudYrTo# = '' AND #strAudGrnNoTo# = '') THEN 'Y' ELSE (CASE WHEN LPAD(T1.CVLCPT_ADT_YR, 4, '0') || LPAD(T3.ADT_GRNT_NO, 3, '0') BETWEEN LPAD(NVL(#strAudYr#, '1700'), 4, '0') || LPAD(NVL(#strAudGrnNo#, '000'), 3, '0') AND LPAD(NVL(#strAudYrTo#, '9999'), 4, '0') || LPAD(NVL(#strAudGrnNoTo#, '999'), 3, '0') THEN 'Y' ELSE 'N' END) END) AND NVL(T1.ENFC_YMD, '19000101') BETWEEN NVL(#strEnfDtFrom#, '17000101') AND NVL(#strEnfDtTo#, '99991231') AND NVL(T1.IMPL_WHLS_CFMTN_YMD, '19000101') BETWEEN NVL(#strConfirmDtFrom#, '17000101') AND NVL(#strConfirmDtTo#, '99991231') AND T1.IMPL_MNG_JRSD_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#S_CNB#, #strDptAuth#, '', #strUpSpvBrdvCd#))) AND T1.CMO_INST_CD = #CMO_INST_CD# AND T1.IMPL_MNG_JRSD_DEPT_CD = #IMPL_MNG_JRSD_DEPT_CD# /* 감사연번종류코드 추가 - 2015.12.24 yyh 감사연번종류코드 from ~ to 에서 한개로 변경 - 2016.06.02 yyh */ AND SUBSTR(T3.ADT_KDCD,3,1) = NVL(#strAudYrNoKndCdSt#,'0') GROUP BY T1.CVLCPT_ADT_YR||T1.ADT_NO, T2.SRECS_REL_INST_CD, T1.DSPS_RQT_SQNO ) TA, TB_BADEAR002D TB WHERE 1 = 1 AND TA.AUD_INFO = TB.ADT_YR||TB.ADT_NO AND TA.DSPS_RQT_SQNO = TB.DSPS_RQT_SQNO AND TB.CFMTN_STTS_SECD IN ('1','2') ORDER BY TB.ADT_YR, TB.ADT_NO