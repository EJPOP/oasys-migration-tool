SELECT CASE WHEN D1.TMP_ID = '1' THEN '집행률' WHEN D1.TMP_ID = '2' THEN '총관리대상' WHEN D1.TMP_ID = '3' THEN '집행건수' WHEN D1.TMP_ID = '4' THEN '미집행사항' WHEN D1.TMP_ID = '5' THEN '(기한도래 미집행사항)' END AS TMP_ID,
    CASE WHEN D1.TMP_ID = '1' THEN TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.ENFORCE_RATE ELSE 0 END)) WHEN D1.TMP_ID = '2' THEN TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.TOT_CNT ELSE 0 END)) WHEN D1.TMP_ID = '3' THEN TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.ENFORCE_CNT ELSE 0 END)) WHEN D1.TMP_ID = '4' THEN TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.INENFORCE_CNT ELSE 0 END)) WHEN D1.TMP_ID = '5' THEN '('||TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.INENFORCE_DLINE_CNT ELSE 0 END))||')' END AS TMP_ID,
    CASE WHEN D1.TMP_ID = '1' THEN TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.ENFORCE_RATE ELSE 0 END) ) WHEN D1.TMP_ID = '2' THEN TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.TOT_CNT ELSE 0 END) ) WHEN D1.TMP_ID = '3' THEN TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.ENFORCE_CNT ELSE 0 END) ) WHEN D1.TMP_ID = '4' THEN TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.INENFORCE_CNT ELSE 0 END) ) WHEN D1.TMP_ID = '5' THEN '('||TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.INENFORCE_DLINE_CNT ELSE 0 END))||')' END AS TMP_ID,
    CASE WHEN D1.TMP_ID = '1' THEN TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.ENFORCE_RATE ELSE 0 END) - MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.ENFORCE_RATE ELSE 0 END) ) WHEN D1.TMP_ID = '2' THEN TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.TOT_CNT ELSE 0 END) - MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.TOT_CNT ELSE 0 END) ) WHEN D1.TMP_ID = '3' THEN TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.ENFORCE_CNT ELSE 0 END) - MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.ENFORCE_CNT ELSE 0 END) ) WHEN D1.TMP_ID = '4' THEN TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.INENFORCE_CNT ELSE 0 END) - MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.INENFORCE_CNT ELSE 0 END) ) WHEN D1.TMP_ID = '5' THEN '('||TO_CHAR(MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.INENFORCE_DLINE_CNT ELSE 0 END) - MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.INENFORCE_DLINE_CNT ELSE 0 END))||')' END AS TMP_ID,
    CASE WHEN D1.TMP_ID = '1' THEN DECODE(MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.ENFORCE_RATE ELSE 0 END),0,'0',TO_CHAR(TRUNC((MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.ENFORCE_RATE ELSE 0 END) / MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.ENFORCE_RATE ELSE 0 END) * 100 ), 1) - 100, 'FM9990D99')) WHEN D1.TMP_ID = '2' THEN DECODE(MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.TOT_CNT ELSE 0 END),0,'0',TO_CHAR(TRUNC( (MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.TOT_CNT ELSE 0 END) / MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.TOT_CNT ELSE 0 END) * 100 ), 1)-100, 'FM9990D99')) WHEN D1.TMP_ID = '3' THEN DECODE(MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.ENFORCE_CNT ELSE 0 END),0,'0',TO_CHAR(TRUNC( (MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.ENFORCE_CNT ELSE 0 END) / MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.ENFORCE_CNT ELSE 0 END) * 100 ), 1)-100, 'FM9990D99')) WHEN D1.TMP_ID = '4' THEN DECODE(MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.INENFORCE_CNT ELSE 0 END),0,'0',TO_CHAR(TRUNC( (MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.INENFORCE_CNT ELSE 0 END) / MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.INENFORCE_CNT ELSE 0 END) * 100 ), 1)-100, 'FM9990D99')) WHEN D1.TMP_ID = '5' THEN '('||DECODE(MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.INENFORCE_DLINE_CNT ELSE 0 END),0,'0',TO_CHAR(TRUNC( (MAX(CASE WHEN D2.YEAR_GUBUN = #strNowYear# THEN D2.INENFORCE_DLINE_CNT ELSE 0 END) / MAX(CASE WHEN D2.YEAR_GUBUN = #strBeforeYear# THEN D2.INENFORCE_DLINE_CNT ELSE 0 END) * 100 ), 1)-100, 'FM9990D99'))||')' END AS TMP_ID
FROM ( SELECT LEVEL
FROM DUAL CONNECT BY LEVEL 'Y' OR T1.CFMTN_YN IS NULL) THEN 1 ELSE 0 END) AS INENFORCE_CNT, SUM(CASE WHEN T1.CFMTN_STTS_SECD = 1 AND (T1.CFMTN_YN <> 'Y' OR T1.CFMTN_YN IS NULL) AND TO_CHAR(SYSDATE, 'YYYYMMDD') >= PRCS_TERM_YMD THEN 1 ELSE 0 END) AS INENFORCE_DLINE_CNT FROM TB_BADEAR001M T0 ,TB_BADEAR002D T1 ,TB_BADDED001M J1 WHERE 1 = 1 AND T0.ADT_YR = T1.CVLCPT_ADT_YR AND T0.ADT_NO = T1.ADT_NO AND T0.DSPS_RQT_SQNO = T1.DSPS_RQT_SQNO AND T0.ADT_YR = J1.ADT_YR AND T0.ADT_NO = J1.ADT_NO AND T1.CVLCPT_ADT_YR IN (#strBeforeYear#) /* 감사년도 */ AND T1.CFMTN_STTS_SECD IN (1, 2) AND T0.DSPS_RQT_KDCD IN ('110','210','310','320','391','620','621','623','630','510','520','530','610','611','810','820','830','840','850') AND T1.IMPL_MNG_JRSD_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#S_CNB#, #strDptAuth#, '', #strUpSpvBrdvCd#))) AND T1.CMO_INST_CD = #CMO_INST_CD# AND T1.IMPL_MNG_JRSD_DEPT_CD = #IMPL_MNG_JRSD_DEPT_CD# /* 감사연번종류코드 추가 - 2015.12.24 yyh 감사연번종류코드 from ~ to 에서 한개로 변경 - 2016.06.02 yyh */ AND SUBSTR(J1.ADT_KDCD,3,1) = NVL(#strAudYrNoKndCdSt#,'0') GROUP BY T1.CVLCPT_ADT_YR, T1.ADT_NO, T1.DSPS_RQT_SQNO ) UNION ALL SELECT DECODE(SUM(TOT_CNT),0,0,ROUND((SUM(TOT_CNT) - SUM(INENFORCE_CNT)) / SUM(TOT_CNT) * 100,1)) AS TOT_CNT /* 집행률 */,
    SUM(TOT_CNT) AS TOT_CNT /* 전체 */,
    SUM(TOT_CNT) - SUM(INENFORCE_CNT) AS TOT_CNT /* 집행 */,
    SUM(INENFORCE_CNT) AS INENFORCE_CNT /* 미집행 */,
    SUM(INENFORCE_DLINE_CNT) AS INENFORCE_DLINE_CNT /* 처리기한지난 미집행 */,
    #strNowYear# AS #STRNOWYEAR#
FROM ( SELECT SUM(1) AS 1,
    SUM(CASE WHEN T1.CFMTN_STTS_SECD = 1 AND (T1.CFMTN_YN <> 'Y' OR T1.CFMTN_YN IS NULL) THEN 1 ELSE 0 END) AS CFMTN_STTS_SECD /* 확정상태구분코드 */,
    SUM(CASE WHEN T1.CFMTN_STTS_SECD = 1 AND (T1.CFMTN_YN <> 'Y' OR T1.CFMTN_YN IS NULL) AND TO_CHAR(SYSDATE, 'YYYYMMDD') >= PRCS_TERM_YMD THEN 1 ELSE 0 END) AS CFMTN_STTS_SECD /* 확정상태구분코드 */
FROM TBBADEAR001M T0 ,TBBADEAR002D T1 ,TBBADDED001M J1 WHERE 1 = 1 AND T0.ADT_YR = T1.CVLCPT_ADT_YR AND T0.ADT_NO = T1.ADT_NO AND T0.DSPS_RQT_SQNO = T1.DSPS_RQT_SQNO AND T0.ADT_YR = J1.ADT_YR AND T0.ADT_NO = J1.ADT_NO AND T1.CVLCPT_ADT_YR IN (#strNowYear#) /* 감사년도 */ AND T1.CFMTN_STTS_SECD IN (1, 2) AND T0.DSPS_RQT_KDCD IN ('110','210','310','320','391','620','621','623','630','510','520','530','610','611','810','820','830','840','850') AND T1.IMPL_MNG_JRSD_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#S_CNB#, #strDptAuth#, '', #strUpSpvBrdvCd#))) AND T1.CMO_INST_CD = #CMO_INST_CD# AND T1.IMPL_MNG_JRSD_DEPT_CD = #IMPL_MNG_JRSD_DEPT_CD# /* 감사연번종류코드 추가 - 2015.12.24 yyh 감사연번종류코드 from ~ to 에서 한개로 변경 - 2016.06.02 yyh */ AND SUBSTR(J1.ADT_KDCD,3,1) = NVL(#strAudYrNoKndCdSt#,'0') GROUP BY T1.CVLCPT_ADT_YR, T1.ADT_NO, T1.DSPS_RQT_SQNO ) ) D2 GROUP BY D1.TMP_ID ORDER BY D1.TMP_ID