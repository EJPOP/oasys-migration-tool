SELECT D3.TOT_CNT,
    D3.RNUM,
    D3.CVLCPT_PET_KDCD /* 민원조작종류코드 */,
    D3.CVLCPT_RCPT_YR /* 민원접수년도 */,
    D3.CVLCPT_RCPT_NO /* 민원접수번호 */,
    D3.YEAR_CV_PET_CATE_CD_ACCT_NO,
    D3.TITLE,
    D3.ACCT_DATE,
    D3.CV_PETER_NM,
    D3.CV_PET_HNDL_DIRC_CD,
    D3.OPER_DATE,
    D3.CV_PETER_TEL,
    D3.CV_PETER_TEL2,
    F_DPT_INFO(D3.HNDL_DEPT_CD, '1') AS F_DPT_INFO,
    ( SELECT S5.USER_NM AS USER_NM /* 사용자명 */
FROM TBDCMACM001M S5 WHERE 1=1 AND S5.TRGT_NOP_ENO = D3.SUMM_PSON_EMPLNUM ) AS USER_NM , (SELECT S1.CD_NM
FROM CM_ETCCD S1 WHERE S1.CD_TYPE = 'AS09' /*민원종류코드*/ AND S1.CD = D3.CVLCPT_PET_KDCD) AS CV_PET_CATE_NM , (SELECT S2.CD_NM
FROM CM_ETCCD S2 WHERE S2.CD_TYPE = 'AS13' /*처리지시구분코드*/ AND S2.CD = D3.CV_PET_HNDL_DIRC_CD) AS CV_PET_HNDL_DIRC_NM FROM ( SELECT D4.*,
    ROWNUM
FROM ( SELECT D2.*,
    COUNT(1) OVER() AS 1
FROM ( SELECT D1.CVLCPT_PET_KDCD /* 민원조작종류코드 */,
    D1.CVLCPT_RCPT_YR /* 민원접수년도 */,
    D1.CVLCPT_RCPT_NO /* 민원접수번호 */,
    D1.CVLCPT_RCPT_YR||'-'||D1.CVLCPT_PET_KDCD||'-'||D1.CVLCPT_RCPT_NO AS CVLCPT_RCPT_YR /* 민원접수년도 */,
    D1.TITLE,
    D1.ACCT_DATE,
    D1.CV_PETER_NM,
    D1.CV_PET_HNDL_DIRC_CD,
    D1.OPER_DATE,
    D1.CV_PETER_TEL,
    D1.CV_PETER_TEL2,
    ( CASE WHEN D1.HNDL_DEPT_CD IS NOT NULL THEN SUBSTR(TRIM(D1.HNDL_DEPT_CD), 1, 2) || '0' || SUBSTR(TRIM(D1.HNDL_DEPT_CD), 3) || '0' ELSE NULL END ) AS HNDL_DEPT_CD,
    D1.SUMM_PSON_EMPLNUM
FROM AM_CV_PET_HNDL_DOC D1 WHERE 1=1 AND ACCT_DATE BETWEEN #ACP_DH_START# AND #ACP_DH_END# AND CVLCPT_RCPT_YR = #CVLCPT_RCPT_YR# AND CVLCPT_RCPT_NO = #CVLCPT_RCPT_NO# AND (D1.CV_PETER_TEL LIKE '%'||NVL(#TEL1#, '')||NVL2(#TEL1#, '-', '')||NVL(#TEL2#, '')||NVL2(#TEL2#, '-', '')||NVL(#TEL3#, '')||NVL2(#TEL3#, '-', '')||'%' OR D1.CV_PETER_TEL2 LIKE '%'||NVL(#TEL1#, '')||NVL2(#TEL1#, '-', '')||NVL(#TEL2#, '')||NVL2(#TEL2#, '-', '')||NVL(#TEL3#, '')||NVL2(#TEL3#, '-', '')||'%') AND TITLE LIKE '%'||#TITLE#||'%' AND CV_PETER_NM LIKE '%'||#CV_PETER_NM#||'%' AND (HNDL_ORG_CD_1 = #HNDL_ORG_CD# OR HNDL_ORG_CD_2 = #HNDL_ORG_CD# OR HNDL_ORG_CD_3 = #HNDL_ORG_CD#) ORDER BY D1.CVLCPT_RCPT_YR DESC ,D1.CVLCPT_RCPT_NO DESC ) D2 )D4 ) D3 WHERE RNUM BETWEEN (((#currPage#- 1) * #pageSize#) + 1) AND (#currPage# * #pageSize#)