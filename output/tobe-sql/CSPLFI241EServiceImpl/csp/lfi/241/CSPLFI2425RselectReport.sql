SELECT JBGD_NM /* 직급명 */,
    CNT,
    TOTAL,
    CNT2,
    TOTAL2,
    CNT3,
    TOTAL3,
    CNT4,
    TOTAL4,
    CNT+CNT2+CNT3+CNT4 AS CNT,
    TOTAL+TOTAL2+TOTAL3+TOTAL4 AS TOTAL,
    #toYm# AS #TOYM#
FROM ( SELECT NVL2(JBGD_NM, JBGD_NM,'합계') AS JBGD_NM /* 직급명 */,
    SUM(CNT) AS CNT,
    SUM(TOTAL) AS TOTAL,
    SUM(CNT2) AS CNT2,
    SUM(TOTAL2) AS TOTAL2,
    SUM(CNT3) AS CNT3,
    SUM(TOTAL3) AS TOTAL3,
    SUM(CNT4) AS CNT4,
    SUM(TOTAL4) AS TOTAL4,
    MAX(ALW_RANK_CD) AS ALW_RANK_CD,
    MAX(A.ALW_PST_CD) AS ALW_PST_CD
FROM ( SELECT C.CD_NM ||DECODE(F_CODE_NM ('1000176', A.ALW_PST_CD), NULL, '','-') || F_CODE_NM ('1000176', A.ALW_PST_CD) AS JBGD_NM /* 직급명 */,
    A.ALW_RANK_CD,
    A.ALW_PST_CD,
    CASE WHEN ALW_DVSN_CD = '9992' THEN 1 ELSE 0 END AS ALW_DVSN_CD,
    CASE WHEN ALW_DVSN_CD = '9992' THEN PMT_AM ELSE 0 END AS ALW_DVSN_CD,
    CASE WHEN ALW_DVSN_CD = '9993' THEN 1 ELSE 0 END AS ALW_DVSN_CD,
    CASE WHEN ALW_DVSN_CD = '9993' THEN PMT_AM ELSE 0 END AS ALW_DVSN_CD,
    CASE WHEN ALW_DVSN_CD = '9994' THEN 1 ELSE 0 END AS ALW_DVSN_CD,
    CASE WHEN ALW_DVSN_CD = '9994' THEN PMT_AM ELSE 0 END AS ALW_DVSN_CD,
    CASE WHEN ALW_DVSN_CD = '9995' THEN 1 ELSE 0 END AS ALW_DVSN_CD,
    CASE WHEN ALW_DVSN_CD = '9995' THEN PMT_AM ELSE 0 END AS ALW_DVSN_CD
FROM TBCSPLFI104L A, TBDCMACM001M B, TBDCMACM013C C WHERE 1=1 AND A.PMT_YM = #toYm# AND A.TRGT_NOP_ENO = B.TRGT_NOP_ENO AND A.ALW_RANK_CD IS NOT NULL AND C.CMM_CD_DVSN_CD = '1000173' AND A.ALW_RANK_CD = C.CD) A GROUP BY ROLLUP (JBGD_NM) ) A ORDER BY DECODE(JBGD_NM, '합계', '9999999999', A.ALW_RANK_CD) ASC, A.ALW_PST_CD DESC