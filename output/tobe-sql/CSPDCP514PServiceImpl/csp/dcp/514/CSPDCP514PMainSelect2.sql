SELECT D1.TPOF_RCPT_NO /* 제보접수번호 */,
    D1.CVLCPT_CLM_SECD /* 민원청구구분코드 */,
    D1.TPOF_RCPT_YR /* 제보접수년도 */,
    DECODE(D1.TPOF_CLMT_KDCD,'1',D1.TPOF_CVLPR_NM,'2',D1.TPOF_CVLPR_RPRSV_NM,'3',D1.TPOF_CVLPR_RPRSV_NM,'4',D1.TPOF_CVLPR_NM) AS TPOF_CVLPR_NM /* 제보민원인명 */,
    DECODE(D1.TPOF_CVLPR_ZIP,NULL,'','(우)'||D1.TPOF_CVLPR_ZIP||' '||D1.TPOF_CVLPR_ADDR||' '||D1.TPOF_CVLPR_DADDR) AS OTSD_EXPRT_ADDR /* 외부전문가주소 */,
    D1.TPOF_RCPT_YR||'-민원-'||D1.TPOF_ACTL_RCPT_NO||CHR(10)||CHR(13)||'('||TO_CHAR(D1.TPOF_RCPT_DT, 'YYYY-MM-DD')||')' AS TPOF_RCPT_YR /* 제보접수년도 */,
    DECODE(D1.TPOF_CVLPR_TELNO,NULL,D1.TPOF_CVLPR_MPNO,D1.TPOF_CVLPR_TELNO) AS CRU_TELNO /* 부패전화번호 */,
    TO_CHAR(D1.TPOF_RCPT_DT, 'YYYY-MM-DD') AS CRU_RCPT_DT /* 부패접수일시 */,
    CASE WHEN H.SUC_CNT > 0 AND H.SUC_CNT 5 THEN D1.TPOF_NM||( SELECT '(합건 : '||AGGR_CONCAT( S3.TPOF_ACTL_RCPT_NO, ', ')||' 외 '||(H.SUC_CNT-5)||'건)' AS RSCH_ASMT_TTL /* 연구과제제목 */
FROM TB_CSPDCP105L S2, TB_CSPDCP101M S3 WHERE D1.CVLCPT_CLM_SECD = S2.CVLCPT_CLM_SECD AND D1.TPOF_RCPT_YR = S2.TPOF_RCPT_YR AND D1.TPOF_RCPT_NO = S2.TPOF_RCPT_NO AND S2.TPOF_MCA_CLM_SECD = S3.CVLCPT_CLM_SECD AND S2.TPOF_MCA_RCPT_YR = S3.TPOF_RCPT_YR AND S2.TPOF_MCA_CVLCPT_RCPT_NO = S3.TPOF_RCPT_NO AND ROWNUM 0 AND H.SUC_CNT 5 THEN F_CODE_NM('1000370','D')||' (제'||D1.TPOF_RCPT_YR||'-민원-'||D1.TPOF_ACTL_RCPT_NO||'호) 조사 위탁'||( SELECT ' (합건 : '||AGGR_CONCAT( S3.TPOF_ACTL_RCPT_NO, ', ')||' 외 '||(H.SUC_CNT-5)||'건)' AS TPOF_ACTL_RCPT_NO /* 제보실제접수번호 */
FROM TB_CSPDCP105L S2, TB_CSPDCP101M S3 WHERE D1.CVLCPT_CLM_SECD = S2.CVLCPT_CLM_SECD AND D1.TPOF_RCPT_YR = S2.TPOF_RCPT_YR AND D1.TPOF_RCPT_NO = S2.TPOF_RCPT_NO AND S2.TPOF_MCA_CLM_SECD = S3.CVLCPT_CLM_SECD AND S2.TPOF_MCA_RCPT_YR = S3.TPOF_RCPT_YR AND S2.TPOF_MCA_CVLCPT_RCPT_NO = S3.TPOF_RCPT_NO AND ROWNUM <= 5 ) ELSE F_CODE_NM('1000370','D')||' (제'||D1.TPOF_RCPT_YR||'-민원-'||D1.TPOF_ACTL_RCPT_NO||'호) 조사 위탁' END AS TITLE , D2.ONR_DOC_MNG_CARD_ID , (SELECT COUNT(*)
FROM TB_CSPDCP203M S4 WHERE S4.TPOF_DOC_SECD = 'B1' AND S4.CVLCPT_RCPT_YR = D1.TPOF_RCPT_YR AND S4.CLM_SECD = D1.CVLCPT_CLM_SECD AND S4.TPOF_CYCL = #TPOF_CYCL# AND S4.CVLCPT_RCPT_RCPT = D1.TPOF_RCPT_NO) AS CNT , D7.TPOF_PRCS_SECD , (SELECT AGGR_CONCAT(DSPS_RQT_KDCD,'|') AS DSPS_RQT_KDCD /* 처분요구종류코드 */
FROM TB_CSPDCP405L S1 WHERE S1.CLM_SECD = D5.CVLCPT_CLM_SECD AND S1.CVLCPT_RCPT_YR = D5.TPOF_RCPT_YR AND S1.CVLCPT_RCPT_RCPT = D5.TPOF_RCPT_NO AND S1.TPOF_CYCL = D5.TPOF_CYCL ) AS DSPS_RQT_KDCD , (SELECT AGGR_CONCAT(F_ORG_INFO(S1.TPOF_INST_CD,'1'),',') AS TPOF_DSPS_INST_NM /* 제보처분기관명 */
FROM TB_CSPDCP206L S1 WHERE S1.CLM_SECD = D1.CVLCPT_CLM_SECD AND S1.CVLCPT_RCPT_YR = D1.TPOF_RCPT_YR AND S1.CVLCPT_RCPT_RCPT = D1.TPOF_RCPT_NO AND S1.CVLCPT_INST_DSCTN_SECD = '2' ) AS TPOF_DSPS_INST_NM , TO_CHAR(D2.ONR_ATRZ_CMPTN_DT,'YYYY-MM-DD') AS ONR_ATRZ_CMPTN_DT FROM TB_CSPDCP101M D1 , TB_CSPDCP301M D2 , TB_CSPDCP302M D3 , TBDCMACM103L D4 , TB_CSPDCP401H D5 , TB_CSPDCP402L D6 , TB_CSPDCP205L D7 ,( SELECT Z.CVLCPT_CLM_SECD /* 민원청구구분코드 */,
    Z.TPOF_RCPT_YR /* 제보접수년도 */,
    Z.TPOF_RCPT_NO /* 제보접수번호 */,
    CASE WHEN Z.TPOF_OCRN_INST_CD = '10' THEN F_ORG_INFO(INST_CD,'1') ELSE Z.TPOF_INST_NM END AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    CASE WHEN Z.TPOF_OCRN_INST_CD = '10' THEN F_ORG_HRK_NM(SLCT_JRSD_SG_SECD) ELSE NULL END AS TPOF_OCRN_INST_CD /* 제보발생기관코드 */
FROM TBCSPDCP206L Z WHERE Z.CLM_SECD = #CLM_SECD# AND Z.CVLCPT_RCPT_YR = #CVLCPT_RCPT_YR# AND Z.CVLCPT_RCPT_RCPT = #CVLCPT_RCPT_RCPT# AND Z.CVLCPT_INST_DSCTN_SECD ='1' AND Z.TPOF_PRCS_INST_SQNO = (SELECT MIN(S1.TPOF_PRCS_INST_SQNO) AS TPOF_PRCS_INST_SQNO /* 제보처리기관순번 */
FROM TBCSPDCP206L S1 WHERE S1.CLM_SECD = #CLM_SECD# AND S1.CVLCPT_RCPT_YR = #CVLCPT_RCPT_YR# AND S1.CVLCPT_RCPT_RCPT = #CVLCPT_RCPT_RCPT# AND S1.CVLCPT_INST_DSCTN_SECD ='1' ) ) Z , (SELECT #CLM_SECD# AS CLM_SECD /* 청구구분코드 */,
    #CVLCPT_RCPT_YR# AS CVLCPT_RCPT_YR /* 민원접수년도 */,
    #CVLCPT_RCPT_RCPT# AS CVLCPT_RCPT_RCPT /* 민원접수번호 */,
    COUNT(*) AS SUC_CNT
FROM TBCSPDCP105L S1 WHERE S1.CLM_SECD = #CLM_SECD# AND S1.CVLCPT_RCPT_YR = #CVLCPT_RCPT_YR# AND S1.CVLCPT_RCPT_RCPT = #CVLCPT_RCPT_RCPT# ) H WHERE 1=1 AND D1.CVLCPT_CLM_SECD = #CLM_SECD# AND D1.TPOF_RCPT_YR = #CVLCPT_RCPT_YR# AND D1.TPOF_RCPT_NO = #CVLCPT_RCPT_RCPT# AND D1.CVLCPT_CLM_SECD = D2.CLM_SECD(+) AND D1.TPOF_RCPT_YR = D2.CVLCPT_RCPT_YR(+) AND D1.TPOF_RCPT_NO = D2.CVLCPT_RCPT_RCPT(+) AND D2.TPOF_CYCL(+) = #TPOF_CYCL# AND D2.SLCT_AVTSMT_AVTSMT(+) = 'D' AND D2.CLM_SECD = D3.CVLCPT_CLM_SECD(+) AND D2.CVLCPT_RCPT_YR = D3.TPOF_RCPT_YR(+) AND D2.CVLCPT_RCPT_RCPT = D3.TPOF_RCPT_NO(+) AND D2.CVLCPT_OPM_OPM = D3.TPOF_OPM_SQNO(+) AND D2.ONR_DOC_MNG_CARD_ID = D4.ONR_DOC_MNG_CARD_ID(+) AND D1.CVLCPT_CLM_SECD = D5.CVLCPT_CLM_SECD(+) AND D1.TPOF_RCPT_YR = D5.TPOF_RCPT_YR(+) AND D1.TPOF_RCPT_NO = D5.TPOF_RCPT_NO(+) AND D5.TPOF_CYCL(+) = #TPOF_CYCL# AND D5.CVLCPT_CLM_SECD = D6.CVLCPT_CLM_SECD(+) AND D5.TPOF_RCPT_YR = D6.TPOF_RCPT_YR(+) AND D5.TPOF_RCPT_NO = D6.TPOF_RCPT_NO(+) AND D5.TPOF_CYCL = D6.TPOF_CYCL(+) AND D1.CVLCPT_CLM_SECD = D7.CVLCPT_CLM_SECD AND D1.TPOF_RCPT_YR = D7.TPOF_RCPT_YR AND D1.TPOF_RCPT_NO = D7.TPOF_RCPT_NO AND D7.TPOF_SQNO = #FRS_MDM_SQNO# AND D1.CVLCPT_CLM_SECD = Z.CLM_SECD(+) AND D1.TPOF_RCPT_YR = Z.CVLCPT_RCPT_YR(+) AND D1.TPOF_RCPT_NO = Z.CVLCPT_RCPT_RCPT(+) AND D1.CVLCPT_CLM_SECD = H.CLM_SECD(+) AND D1.TPOF_RCPT_YR = H.CVLCPT_RCPT_YR(+) AND D1.TPOF_RCPT_NO = H.CVLCPT_RCPT_RCPT(+)