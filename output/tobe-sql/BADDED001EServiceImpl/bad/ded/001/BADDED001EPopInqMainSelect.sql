SELECT T1.CVLCPT_ADT_YR AS CVLCPT_ADT_YR /* 민원감사년도 */,
    T1.ADT_NO AS ADT_NO /* 감사번호 */,
    T1.ADT_GRNT_NO AS ADT_GRNT_NO /* 감사부여번호 */,
    T1.AUD_YR_N0 AS AUD_YR_N0 /* 감사년번호 */,
    T1.AUD_YR_NO_KND_CD AS AUD_YR_NO_KND_CD /* 감사연번호종류코드 */,
    T1.AUD_YR_NO_KND_NM AS AUD_YR_NO_KND_NM /* 감사연번호종류코드명 */,
    T1.ADT_ASMT_SECD AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    T1.AUD_TASK_NM AS AUD_TASK_NM,
    T1.INST_SECD AS INST_SECD /* 기관구분코드 */,
    T1.ADT_KDCD AS ADT_KDCD /* 감사종류코드 */,
    T1.AUD_KND_NM AS AUD_KND_NM,
    T1.SPRVSN_DEPT_CD AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    T1.SPV_BRDV_NM AS SPV_BRDV_NM /* 주관국과명 */,
    T1.ADT_MTHD_SECD AS ADT_MTHD_SECD /* 감사방법구분코드 */,
    T1.AUD_WAY_NM AS AUD_WAY_NM,
    T1.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    T1.ADT_SCL_SECD AS ADT_SCL_SECD /* 감사규모구분코드 */,
    T1.TASK_SECD AS TASK_SECD /* 업무구분코드 */,
    T1.TSK_CAT_NM AS TSK_CAT_NM,
    T1.EMPHS_ASMT_SECD AS EMPHS_ASMT_SECD /* 중점과제구분코드 */,
    T1.EPS_TASK_NM AS EPS_TASK_NM,
    T1.ADT_RBPRSN_ENO AS ADT_RBPRSN_ENO /* 감사책임자직원전산번호 */,
    T1.WHOL_RBPRSN_JBGD_SECD AS WHOL_RBPRSN_JBGD_SECD /* 전체책임자직급구분코드 */,
    T1.WHOL_RBPRSN_DEPT_CD AS WHOL_RBPRSN_DEPT_CD /* 전체책임자부서코드 */,
    T1.ADT_RPRS_INST_CD AS ADT_RPRS_INST_CD /* 감사대표기관코드 */,
    T1.AUD_RPST_ORG_NM AS AUD_RPST_ORG_NM,
    T1.SPVR_ENO AS SPVR_ENO /* 감리원직원전산번호 */,
    T1.SPVR_DEPT_CD AS SPVR_DEPT_CD /* 감리원부서코드 */,
    T1.SPVR_JBGD_SECD AS SPVR_JBGD_SECD /* 감리원직급구분코드 */,
    T1.ASTN_ENO AS ASTN_ENO /* 보조자직원전산번호 */,
    T1.ASTN_DEPT_CD AS ASTN_DEPT_CD /* 보조자부서코드 */,
    T1.ASTN_JBGD_SECD AS ASTN_JBGD_SECD /* 보조자직급구분코드 */,
    T1.MNG_DEPT_CD AS MNG_DEPT_CD /* 관리부서코드 */,
    T1.MNG_DPT_NM AS MNG_DPT_NM,
    T1.CVLCPT_RCPT_YR AS CVLCPT_RCPT_YR /* 민원접수년도 */,
    T1.CVLCPT_RCPT_RCPT AS CVLCPT_RCPT_RCPT /* 민원접수번호 */,
    T1.CLM_SECD AS CLM_SECD /* 청구구분코드 */,
    T1.RSCH_ASMT_TTL AS RSCH_ASMT_TTL /* 연구과제제목 */,
    T1.PRGRS_STP_SECD AS PRGRS_STP_SECD /* 진행단계구분코드 */,
    T1.ADT_CNTRL_SECD AS ADT_CNTRL_SECD /* 감사통제구분코드 */,
    T1.AUD_CTRL_NM AS AUD_CTRL_NM /* 감사통제코드명 */,
    T1.BZTRP_BGT_SECD AS BZTRP_BGT_SECD /* 출장예산구분코드 */,
    T1.BZT_BGT_DVSN_NM AS BZT_BGT_DVSN_NM /* 예산구분명 */
FROM ( SELECT D1.CVLCPT_ADT_YR AS CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.ADT_NO AS ADT_NO /* 감사번호 */,
    D1.ADT_GRNT_NO AS ADT_GRNT_NO /* 감사부여번호 */,
    F_MNG_KND_AUDYRNO(D1.CVLCPT_ADT_YR, D1.ADT_NO, D1.ADT_KDCD, '-') AS F_MNG_KND_AUDYRNO /* 감사년번호 - 수정(2015.12.17-yyh) */,
    CASE WHEN D1.CVLCPT_ADT_YR >= '2016' THEN D1.ADT_KDCD ELSE '' END AS CVLCPT_ADT_YR /* 민원감사년도 */,
    CASE WHEN D1.CVLCPT_ADT_YR >= '2016' THEN F_CODE_NM('1000739',D1.ADT_KDCD) ELSE '-' END AS CVLCPT_ADT_YR /* 민원감사년도 */,
    D1.ADT_ASMT_SECD AS ADT_ASMT_SECD /* 감사과제구분코드 */,
    F_CODE_NM_YEAR('1000008', D1.ADT_ASMT_SECD, D1.CVLCPT_ADT_YR) AS F_CODE_NM_YEAR,
    D1.INST_SECD AS INST_SECD /* 기관구분코드 */,
    D1.ADT_KDCD AS ADT_KDCD /* 감사종류코드 */,
    F_CODE_NM_YEAR('1000007', D1.ADT_KDCD, D1.CVLCPT_ADT_YR) AS F_CODE_NM_YEAR,
    D1.SPRVSN_DEPT_CD AS SPRVSN_DEPT_CD /* 주관부서코드 */,
    F_DPT_INFO(D1.SPRVSN_DEPT_CD,'1') AS F_DPT_INFO /* 주관국과명 */,
    D1.ADT_MTHD_SECD AS ADT_MTHD_SECD /* 감사방법구분코드 */,
    F_CODE_NM_YEAR('1000009', D1.ADT_MTHD_SECD, D1.CVLCPT_ADT_YR) AS F_CODE_NM_YEAR,
    D1.ADT_MTTR_NM AS ADT_MTTR_NM /* 감사사항명 */,
    D1.ADT_SCL_SECD AS ADT_SCL_SECD /* 감사규모구분코드 */,
    D1.TASK_SECD AS TASK_SECD /* 업무구분코드 */,
    F_CODE_NM('1000120',D1.TASK_SECD) AS F_CODE_NM,
    D1.EMPHS_ASMT_SECD AS EMPHS_ASMT_SECD /* 중점과제구분코드 */,
    F_CODE_NM_YEAR('1000005', D1.EMPHS_ASMT_SECD, D1.CVLCPT_ADT_YR) AS F_CODE_NM_YEAR,
    D1.ADT_RBPRSN_ENO AS ADT_RBPRSN_ENO /* 감사책임자직원전산번호 */,
    D1.WHOL_RBPRSN_JBGD_SECD AS WHOL_RBPRSN_JBGD_SECD /* 전체책임자직급구분코드 */,
    D1.WHOL_RBPRSN_DEPT_CD AS WHOL_RBPRSN_DEPT_CD /* 전체책임자부서코드 */,
    D1.ADT_RPRS_INST_CD AS ADT_RPRS_INST_CD /* 감사대표기관코드 */,
    F_ORG_INFO(D1.ADT_RPRS_INST_CD,'1') AS F_ORG_INFO,
    D1.SPVR_ENO AS SPVR_ENO /* 감리원직원전산번호 */,
    D1.SPVR_DEPT_CD AS SPVR_DEPT_CD /* 감리원부서코드 */,
    D1.SPVR_JBGD_SECD AS SPVR_JBGD_SECD /* 감리원직급구분코드 */,
    D1.ASTN_ENO AS ASTN_ENO /* 보조자직원전산번호 */,
    D1.ASTN_DEPT_CD AS ASTN_DEPT_CD /* 보조자부서코드 */,
    D1.ASTN_JBGD_SECD AS ASTN_JBGD_SECD /* 보조자직급구분코드 */,
    D1.MNG_DEPT_CD AS MNG_DEPT_CD /* 관리부서코드 */,
    F_DPT_INFO(D1.MNG_DEPT_CD,'1') AS F_DPT_INFO,
    D1.CVLCPT_RCPT_YR AS CVLCPT_RCPT_YR /* 민원접수년도 */,
    D1.CVLCPT_RCPT_RCPT AS CVLCPT_RCPT_RCPT /* 민원접수번호 */,
    D1.CLM_SECD AS CLM_SECD /* 청구구분코드 */,
    D2.TPOF_NM AS TPOF_NM /* 제보명 */,
    D1.ADT_CNTRL_SECD AS ADT_CNTRL_SECD /* 감사통제구분코드 */,
    F_CODE_NM('1000753',D1.ADT_CNTRL_SECD) AS F_CODE_NM /* 예산구분 추가 - 2016.06.16 yyh */,
    D1.BZTRP_BGT_SECD AS BZTRP_BGT_SECD /* 출장예산구분코드 */,
    F_CODE_NM('1000751',D1.BZTRP_BGT_SECD) AS F_CODE_NM,
    D1.PRGRS_STP_SECD AS PRGRS_STP_SECD /* 진행단계구분코드 */
FROM TBBADDED001M D1 , TBCSPDCP101M D2 , TBBADDED003M D3 WHERE 1=1 AND D1.CVLCPT_RCPT_YR = D2.CVLCPT_RCPT_YR(+) AND D1.CVLCPT_RCPT_RCPT = D2.CVLCPT_RCPT_RCPT(+) AND D1.CLM_SECD = D2.CLM_SECD(+) AND D1.CVLCPT_ADT_YR = D3.CVLCPT_ADT_YR(+) AND D1.ADT_NO = D3.ADT_NO(+) /*AND D1.AUD_NO NOT LIKE '9%' 서면모니터링을 걸러내야하므로*/ AND D1.SPRVSN_DEPT_CD IN (SELECT SRECS_DEPT_CD /* 심사재심의부서코드 */
FROM TABLE(F_AUTH_DEPT(#strCnb#, #dptAuth#, '', #strUpSpvBrdvCd#))) /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/ AND D1.CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND SUBSTR(D1.ADT_KDCD,3,1) = SUBSTR(#strAudYrNoKndCd#,3,1) AND D1.ADT_GRNT_NO = #ADT_GRNT_NO# AND D1.ADT_MTTR_NM LIKE '%'||#strAudSbjNm#||'%' AND D1.ADT_KDCD = #ADT_KDCD# AND D1.SPRVSN_DEPT_CD = #SPRVSN_DEPT_CD# /*감사통제코드가 1:-(해당없음), 2:Y(통제)*/ AND D1.ADT_CNTRL_SECD IN ('1','2') ) T1 ORDER BY DECODE(SUBSTR(T1.ADT_GRNT_NO,1,1),'9',2,1),T1.ADT_GRNT_NO DESC