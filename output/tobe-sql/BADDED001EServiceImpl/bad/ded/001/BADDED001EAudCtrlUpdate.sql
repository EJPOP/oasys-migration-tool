DECLARE BEGIN /* 통제처리 */ UPDATE TB_BADDED001M SET ADT_GRNT_NO = #ADT_GRNT_NO# /* 감사부여번호 */, ADT_CNTRL_SECD = '2' /* 감사통제구분코드 */, LAST_USER_ID = #LAST_USER_ID# /* 최종사용자아이디 */, LAST_PRCS_DEPT_CD = #LAST_PRCS_DEPT_CD# /* 최종처리부서코드 */, LAST_MENU_ID = #LAST_MENU_ID# /* 최종메뉴아이디 */, LAST_MDFCN_DT = SYSDATE /* 최종수정일시 */WHERE CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND ADT_NO = #ADT_NO# ; /* 공공감사연계 저장 */ INSERT INTO TB_BADDED023H (LINK_NO, CVLCPT_ADT_YR, ADT_NO, ADT_ASMT_SECD, INST_SECD, ADT_KDCD, SPRVSN_DEPT_CD, ADT_MTHD_SECD, ADT_MTTR_NM, ADT_SCL_SECD, TASK_SECD, EMPHS_ASMT_SECD, ADT_RBPRSN_ENO, WHOL_RBPRSN_JBGD_SECD, WHOL_RBPRSN_DEPT_CD, ADT_RPRS_INST_CD, SPVR_ENO, SPVR_DEPT_CD, SPVR_JBGD_SECD, ASTN_ENO, ASTN_DEPT_CD, ASTN_JBGD_SECD, PRGRS_STP_SECD, MNG_DEPT_CD, CVLCPT_RCPT_YR, CVLCPT_RCPT_RCPT, CLM_SECD, USE_YN /* 사용여부 */, FRST_USER_ID, LAST_USER_ID, LAST_PRCS_DEPT_CD, LAST_MENU_ID, FRST_REG_DT, LAST_MDFCN_DT) SELECT (SELECT NVL(MAX(LINK_NO),0)+1 AS LINK_NO /* 연계번호 */
FROM TB_BADDED023H), CVLCPT_ADT_YR, ADT_NO, ADT_ASMT_SECD, INST_SECD, ADT_KDCD, SPRVSN_DEPT_CD, ADT_MTHD_SECD, ADT_MTTR_NM, ADT_SCL_SECD, TASK_SECD, EMPHS_ASMT_SECD, ADT_RBPRSN_ENO, WHOL_RBPRSN_JBGD_SECD, WHOL_RBPRSN_DEPT_CD, ADT_RPRS_INST_CD, SPVR_ENO, SPVR_DEPT_CD, SPVR_JBGD_SECD, ASTN_ENO, ASTN_DEPT_CD, ASTN_JBGD_SECD, PRGRS_STP_SECD, MNG_DEPT_CD, CVLCPT_RCPT_YR, CVLCPT_RCPT_RCPT, CLM_SECD, 'N', #LAST_USER_ID#, #LAST_USER_ID#, #LAST_PRCS_DEPT_CD#, #LAST_MENU_ID#, SYSDATE, SYSDATE FROM TB_BADDED001M WHERE 1=1 AND CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND ADT_NO = #ADT_NO# ; END ;