SELECT ECD.CD_NM AS CD_NM /* 구분 */,
    NVL(AFT.MAN_DAY,0) - NVL(BEFORE.MAN_DAY,0) AS MAN_DAY /* 연인원 */,
    NVL(AFT.IN_EXP,0) - NVL(BEFORE.IN_EXP,0) AS IN_EXP /* 여비 */,
    NVL(AFT.RL_FARE_AMT,0) - NVL(BEFORE.RL_FARE_AMT,0) AS RL_FARE_AMT /* 철도운임금액 */,
    NVL(AFT.IN_EXP + AFT.RL_FARE_AMT,0) - NVL(BEFORE.IN_EXP + BEFORE.RL_FARE_AMT,0) AS IN_EXP /* 계 */
FROM TBDCMACM013C ECD, ( SELECT RGN_SECD AS RGN_SECD /* 지역구분코드 */,
    NVL(SUM(BZTRP_DCN),0) AS BZTRP_DCN /* 출장일수 */,
    NVL(SUM(TE.BZTRP_TRVEXP_FDEXP),0) + NVL(SUM(TE.BTEXP_CRTR_AMT),0) + NVL(SUM(TE.LDG_CST),0) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */,
    NVL(SUM( (SELECT SUM(RL_FARE_AMT) AS RL_FARE_AMT /* 철도운임금액 */
FROM TBBADDED020H Z1 WHERE TE.BZTRP_YR = Z1.BZTRP_YR AND TE.BZTRP_SQNO = Z1.BZTRP_SQNO AND TE.BZTRVR_ENO = Z1.BZTRVR_ENO AND TE.BTEXP_SQNO = Z1.BTEXP_SQNO AND TE.BZTRP_CLCLN_SQNO = Z1.BZTRP_CLCLN_SQNO) ),0) + NVL(SUM(TE.CPRG_FARE_CST),0) AS RL_FARE_AMT FROM (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    MAX(BZTRP_CLCLN_SQNO) AS BZTRP_CLCLN_SQNO /* 출장정산순번 */,
    MAX(CLCLN_CHG_RSN_CN) AS CLCLN_CHG_RSN_CN /* 정산변경사유내용 */
FROM TBBADDED019H WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# AND NVL(CLCLN_YN, 'N') = 'N' GROUP BY BZTRP_YR , BZTRP_SQNO , BZTRVR_ENO) D1 , TBBADDED019H TE WHERE 1=1 AND D1.BZTRP_YR = TE.BZTRP_YR AND D1.BZTRP_SQNO = TE.BZTRP_SQNO AND D1.BZTRVR_ENO = TE.BZTRVR_ENO AND D1.MAX_SNO = TE.BZTRP_CLCLN_SQNO AND D1.BZTRP_YR = #BZTRP_YR# AND D1.BZTRP_SQNO = #BZTRP_SQNO# GROUP BY TE.RGN_SECD ) AFT, ( SELECT RGN_SECD AS RGN_SECD /* 지역구분코드 */,
    NVL(SUM(BZTRP_DCN),0) AS BZTRP_DCN /* 출장일수 */,
    NVL(SUM(TE.BZTRP_TRVEXP_FDEXP),0) + NVL(SUM(TE.BTEXP_CRTR_AMT),0) + NVL(SUM(TE.LDG_CST),0) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */,
    NVL(SUM( (SELECT SUM(RL_FARE_AMT) AS RL_FARE_AMT /* 철도운임금액 */
FROM TBBADDED020H Z1 WHERE TE.BZTRP_YR = Z1.BZTRP_YR AND TE.BZTRP_SQNO = Z1.BZTRP_SQNO AND TE.BZTRVR_ENO = Z1.BZTRVR_ENO AND TE.BTEXP_SQNO = Z1.BTEXP_SQNO AND TE.BZTRP_CLCLN_SQNO = Z1.BZTRP_CLCLN_SQNO) ),0) + NVL(SUM(TE.CPRG_FARE_CST),0) AS RL_FARE_AMT FROM (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    MAX(BZTRP_CLCLN_SQNO) AS BZTRP_CLCLN_SQNO /* 출장정산순번 */,
    MAX(CLCLN_CHG_RSN_CN) AS CLCLN_CHG_RSN_CN /* 정산변경사유내용 */
FROM TBBADDED019H WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# AND NVL(CLCLN_YN, 'N') = 'Y' GROUP BY BZTRP_YR , BZTRP_SQNO , BZTRVR_ENO) D1 , TBBADDED019H TE WHERE 1=1 AND D1.BZTRP_YR = TE.BZTRP_YR AND D1.BZTRP_SQNO = TE.BZTRP_SQNO AND D1.BZTRVR_ENO = TE.BZTRVR_ENO AND D1.MAX_SNO = TE.BZTRP_CLCLN_SQNO AND D1.BZTRP_YR = #BZTRP_YR# AND D1.BZTRP_SQNO = #BZTRP_SQNO# GROUP BY TE.RGN_SECD ) BEFORE WHERE ECD.CMM_CD_DVSN_CD='1000023' AND ECD.CD IN ('1', '2', '3', '4', '5', '6') AND BEFORE.RGN_SECD(+) = ECD.CD AND AFT.RGN_SECD(+) = ECD.CD