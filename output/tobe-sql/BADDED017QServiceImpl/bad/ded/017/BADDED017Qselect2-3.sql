SELECT ECD.CD_NM,
    /*구분*/ (NVL(AFT.MAN_DAY, 0 ) - NVL(BEFORE.MAN_DAY, 0)) AS MAN_DAY,
    /*연인원*/ (NVL(AFT.IN_EXP, 0) - NVL(BEFORE.IN_EXP, 0)) AS IN_EXP,
    /*여비*/ (NVL(AFT.RL_FARE_AMT, 0) - NVL(BEFORE.RL_FARE_AMT, 0)) AS RL_FARE_AMT /* 철도운임금액 */,
    /*철도임*/ (NVL(AFT.SUM_ALL, 0) - NVL(BEFORE.SUM_ALL, 0)) AS SUM_ALL /* 계 */
FROM TBDCMACM013C ECD, (SELECT RGN_SECD /* 지역구분코드 */,
    SUM(TE.BZTRP_DCN) AS BZTRP_DCN /* 출장일수 */,
    SUM(TE.BZTRP_TRVEXP_FDEXP)+ SUM(TE.BTEXP_CRTR_AMT) + SUM(TE.LDG_CST) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */,
    NVL(SUM(TFD.RL_FARE_AMT), 0) + NVL(SUM(TE.CPRG_FARE_CST),0) AS RL_FARE_AMT /* 철도운임금액 */,
    /*2015.05.11 - 수도권운임추가 yyh*/ SUM(TE.BZTRP_TRVEXP_FDEXP)+ SUM(TE.BTEXP_CRTR_AMT) + SUM(TE.LDG_CST) + NVL(SUM(TFD.RL_FARE_AMT), 0) + NVL(SUM(TE.CPRG_FARE_CST),0) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */
FROM TBBADDED011L TE, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    BTEXP_SQNO /* 출장비순번 */,
    CAL_YN /* 계산여부 */,
    SUM(RL_FARE_AMT) AS RL_FARE_AMT /* 철도운임금액 */
FROM TBBADDED017L WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# GROUP BY BZTRP_YR, BZTRP_SQNO, BZTRVR_ENO, BTEXP_SQNO, CAL_YN ) TFD WHERE TE.BZTRP_YR = #BZTRP_YR# AND TE.BZTRP_SQNO = #BZTRP_SQNO# AND TE.CAL_YN = 'N' AND TFD.BZTRP_YR(+) = TE.BZTRP_YR AND TFD.BZTRP_SQNO(+) = TE.BZTRP_SQNO AND TFD.BZTRVR_ENO(+) = TE.BZTRVR_ENO AND TFD.BTEXP_SQNO(+) = TE.BTEXP_SQNO AND TFD.CAL_YN(+) = TE.CAL_YN GROUP BY TE.RGN_SECD) BEFORE, (SELECT RGN_SECD /* 지역구분코드 */,
    SUM(TE.BZTRP_DCN) AS BZTRP_DCN /* 출장일수 */,
    SUM(TE.BZTRP_TRVEXP_FDEXP)+ SUM(TE.BTEXP_CRTR_AMT) + SUM(TE.LDG_CST) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */,
    NVL(SUM(TFD.RL_FARE_AMT), 0) + NVL(SUM(TE.CPRG_FARE_CST),0) AS RL_FARE_AMT /* 철도운임금액 */,
    /*2015.05.11 - 수도권운임추가 yyh*/ SUM(TE.BZTRP_TRVEXP_FDEXP)+ SUM(TE.BTEXP_CRTR_AMT) + SUM(TE.LDG_CST) +NVL(SUM(TFD.RL_FARE_AMT), 0) + NVL(SUM(TE.CPRG_FARE_CST),0) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */
FROM TBBADDED011L TE, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    BTEXP_SQNO /* 출장비순번 */,
    CAL_YN /* 계산여부 */,
    SUM(RL_FARE_AMT) AS RL_FARE_AMT /* 철도운임금액 */
FROM TBBADDED017L WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# GROUP BY BZTRP_YR, BZTRP_SQNO, BZTRVR_ENO, BTEXP_SQNO, CAL_YN ) TFD WHERE TE.BZTRP_YR = #BZTRP_YR# AND TE.BZTRP_SQNO = #BZTRP_SQNO# AND TE.CAL_YN = 'Y' AND TFD.BZTRP_YR(+) = TE.BZTRP_YR AND TFD.BZTRP_SQNO(+) = TE.BZTRP_SQNO AND TFD.BZTRVR_ENO(+) = TE.BZTRVR_ENO AND TFD.BTEXP_SQNO(+) = TE.BTEXP_SQNO AND TFD.CAL_YN(+) = TE.CAL_YN GROUP BY TE.RGN_SECD) AFT WHERE ECD.CMM_CD_DVSN_CD ='1000023' AND ECD.CD IN ('1', '2', '3', '4', '5', '6') AND BEFORE.RGN_SECD(+) = ECD.CD AND AFT.RGN_SECD(+) = ECD.CD