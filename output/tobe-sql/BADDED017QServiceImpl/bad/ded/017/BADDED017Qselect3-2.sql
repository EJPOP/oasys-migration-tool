SELECT AGGR.*
FROM (SELECT TER.BZTRP_YR /* 출장년도 */,
    TER.BZTRP_SQNO /* 출장순번 */,
    TER.BZTRVR_ENO /* 출장자직원전산번호 */,
    /*전산번호*/ TER.BZTRVR_NM AS BZTRVR_NM /* 출장자명 */,
    /*성명*/ F_CODE_NM('1000173',TER.BZTRVR_JBGD_SECD) AS F_CODE_NM,
    /*직급*/ F_DPT_INFO(BL.OGDP_DEPT_CD,'4') AS CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    /*소속*/ TE.IN_EXP,
    /*여비*/ TE.BZTRP_DCN AS BZTRP_DCN /* 출장일수 */,
    /*일수*/ NVL(TFD.RL_FARE_AMT, 0) + NVL(TE.CPRG_FARE_CST,0) AS RL_FARE_AMT /* 철도운임금액 */,
    /*철도임 + 수도권운임비*/ NVL(TFD.RL_FARE_AMT, 0) + TE.IN_EXP + NVL(TE.CPRG_FARE_CST,0) AS RL_FARE_AMT /* 철도운임금액 */,
    /*지급액*/ TE.BZTRP_BGNG_YMD AS BZTRP_BGNG_YMD /* 출장시작일자 */,
    /*출장기간FROM*/ TE.BZTRP_END_YMD AS BZTRP_END_YMD /* 출장종료일자 */,
    /*출장기간TO*/ '' AS RECIPIENT /* 영수인 */
FROM TBBADDED010L TER, TBBADDED002M SITU, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    SUM( CASE WHEN TE0.CAL_YN='Y' THEN TE0.BZTRP_TRVEXP_FDEXP + TE0.BTEXP_CRTR_AMT + TE0.LDG_CST ELSE 0 END) - SUM( CASE WHEN TE0.CAL_YN='N' THEN TE0.BZTRP_TRVEXP_FDEXP + TE0.BTEXP_CRTR_AMT + TE0.LDG_CST ELSE 0 END) AS CAL_YN /* 계산여부 */,
    /* 수도권운임 추가 - 2015.05.06 yyh*/ SUM( CASE WHEN TE0.CAL_YN='Y' THEN NVL(TE0.CPRG_FARE_CST,0) ELSE 0 END) - SUM( CASE WHEN TE0.CAL_YN='N' THEN NVL(TE0.CPRG_FARE_CST,0) ELSE 0 END) AS CPRG_FARE_CST /* 수도권운임비용 */,
    SUM( CASE WHEN TE0.CAL_YN='Y' THEN TE0.BZTRP_DCN ELSE 0 END) - SUM( CASE WHEN TE0.CAL_YN='N' THEN TE0.BZTRP_DCN ELSE 0 END) AS BZTRP_DCN /* 출장일수 */,
    MIN(BZTRP_BGNG_YMD) AS BZTRP_BGNG_YMD /* 출장시작일자 */,
    MAX(BZTRP_END_YMD) AS BZTRP_END_YMD /* 출장종료일자 */
FROM TBBADDED011L TE0 WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# GROUP BY BZTRP_YR, BZTRP_SQNO, BZTRVR_ENO) TE, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    SUM( CASE WHEN CAL_YN='Y' THEN RL_FARE_AMT ELSE 0 END) - SUM( CASE WHEN CAL_YN='N' THEN RL_FARE_AMT ELSE 0 END) AS RL_FARE_AMT /* 철도운임금액 */
FROM TBBADDED017L WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# GROUP BY BZTRP_YR, BZTRP_SQNO, BZTRVR_ENO ) TFD, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    MAX(OGDP_DEPT_CD) AS OGDP_DEPT_CD /* 소속부서코드 */
FROM TBBADDED005L WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# GROUP BY BZTRP_YR, BZTRP_SQNO, BZTRVR_ENO) DBO_BLL_BLNC WHERE TER.BZTRP_YR = #BZTRP_YR# AND TER.BZTRP_SQNO = #BZTRP_SQNO# AND TE.BZTRP_YR = TER.BZTRP_YR AND TE.BZTRP_SQNO = TER.BZTRP_SQNO AND TE.BZTRVR_ENO = TER.BZTRVR_ENO AND TFD.BZTRP_YR(+) = TER.BZTRP_YR AND TFD.BZTRP_SQNO(+) = TER.BZTRP_SQNO AND TFD.BZTRVR_ENO(+) = TER.BZTRVR_ENO AND SITU.BZTRP_YR = TER.BZTRP_YR AND SITU.BZTRP_SQNO = TER.BZTRP_SQNO AND BL.BZTRP_YR(+) = TER.BZTRP_YR AND BL.BZTRP_SQNO(+) = TER.BZTRP_SQNO AND BL.BZTRVR_ENO(+) = TER.BZTRVR_ENO) AGGR WHERE AGGR.SUM_ALL != 0