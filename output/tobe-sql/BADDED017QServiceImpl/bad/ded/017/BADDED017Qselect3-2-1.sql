SELECT TER.BZTRP_YR /* 출장년도 */,
    TER.BZTRP_SQNO /* 출장순번 */,
    TER.BZTRVR_ENO /* 출장자직원전산번호 */,
    /*전산번호*/ TER.BZTRVR_NM AS BZTRVR_NM /* 출장자명 */,
    /*성명*/ F_CODE_NM('1000173',TER.BZTRVR_JBGD_SECD) AS F_CODE_NM,
    /*직급*/ F_DPT_INFO(TER.OGDP_DEPT_CD,'4') AS CNSTN_MBCMT_DEPT_NM /* 자문위원부서명 */,
    /*소속*/ NVL(BEF.IN_EXP,0) - NVL(AFT.IN_EXP,0) AS IN_EXP,
    /*여비*/ NVL(BEF.BZTRP_DCN,0) - NVL(AFT.BZTRP_DCN,0) AS BZTRP_DCN /* 출장일수 */,
    /*일수*/ NVL(BEF.RL_FARE_AMT, 0) - NVL(AFT.RL_FARE_AMT, 0) AS RL_FARE_AMT /* 철도운임금액 */,
    /*철도임*/ (NVL(BEF.RL_FARE_AMT, 0) + NVL(BEF.IN_EXP,0)) - ( NVL(AFT.RL_FARE_AMT, 0) + NVL(AFT.IN_EXP,0)) AS RL_FARE_AMT /* 철도운임금액 */,
    /*지급액*/ BEF.BZTRP_BGNG_YMD AS BZTRP_BGNG_YMD /* 출장시작일자 */,
    /*출장기간FROM*/ BEF.BZTRP_END_YMD AS BZTRP_END_YMD /* 출장종료일자 */,
    /*출장기간TO*/ '' AS RECIPIENT /* 영수인 */,
    BEF.MAX_SNO /* 정산안된거 */,
    AFT.MAX_SNO /* 정산된거 */
FROM TB_BADDED010L TER, TB_BADDED002M SITU, ( SELECT D1.BZTRP_YR /* 출장년도 */,
    D1.BZTRP_SQNO /* 출장순번 */,
    D1.BZTRVR_ENO /* 출장자직원전산번호 */,
    MIN(TE.BZTRP_BGNG_YMD) AS BZTRP_BGNG_YMD /* 출장시작일자 */,
    MAX(TE.BZTRP_END_YMD) AS BZTRP_END_YMD /* 출장종료일자 */,
    SUM(NVL(TE.BZTRP_TRVEXP_FDEXP,0) + NVL(TE.BTEXP_CRTR_AMT,0) + NVL(TE.LDG_CST,0)) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */,
    SUM(NVL(TE.BZTRP_DCN,0)) AS BZTRP_DCN /* 출장일수 */,
    SUM(NVL(TE.RL_FARE_AMT,0) + NVL(TE.CPRG_FARE_CST,0)) AS RL_FARE_AMT /* 철도운임금액 */,
    MAX(NVL(D1.MAX_SNO,0)) AS MAX_SNO
FROM (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    MAX(BZTRP_CLCLN_SQNO) AS BZTRP_CLCLN_SQNO /* 출장정산순번 */,
    MAX(CLCLN_CHG_RSN_CN) AS CLCLN_CHG_RSN_CN /* 정산변경사유내용 */
FROM TBBADDED019H WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# AND NVL(CLCLN_YN, 'N') = 'N' GROUP BY BZTRP_YR , BZTRP_SQNO , BZTRVR_ENO) D1 , ( SELECT TE.*,
    TFD.RL_FARE_AMT /* 철도운임금액 */
FROM TBBADDED019H TE , (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    BTEXP_SQNO /* 출장비순번 */,
    BZTRP_CLCLN_SQNO /* 출장정산순번 */,
    SUM( RL_FARE_AMT ) AS RL_FARE_AMT /* 철도운임금액 */
FROM TBBADDED020H GROUP BY BZTRP_YR , BZTRP_SQNO , BZTRVR_ENO , BTEXP_SQNO, BZTRP_CLCLN_SQNO ) TFD WHERE 1=1 AND TE.BZTRP_YR = TFD.BZTRP_YR(+) AND TE.BZTRP_SQNO = TFD.BZTRP_SQNO(+) AND TE.BZTRVR_ENO = TFD.BZTRVR_ENO(+) AND TE.BTEXP_SQNO = TFD.BTEXP_SQNO(+) AND TE.BZTRP_CLCLN_SQNO = TFD.BZTRP_CLCLN_SQNO(+) ) TE WHERE 1=1 AND D1.BZTRP_YR = TE.BZTRP_YR AND D1.BZTRP_SQNO = TE.BZTRP_SQNO AND D1.BZTRVR_ENO = TE.BZTRVR_ENO AND D1.MAX_SNO = TE.BZTRP_CLCLN_SQNO AND D1.BZTRP_YR = #BZTRP_YR# AND D1.BZTRP_SQNO = #BZTRP_SQNO# GROUP BY D1.BZTRP_YR , D1.BZTRP_SQNO , D1.BZTRVR_ENO ) BEF, ( SELECT D1.BZTRP_YR /* 출장년도 */,
    D1.BZTRP_SQNO /* 출장순번 */,
    D1.BZTRVR_ENO /* 출장자직원전산번호 */,
    MIN(TE.BZTRP_BGNG_YMD) AS BZTRP_BGNG_YMD /* 출장시작일자 */,
    MAX(TE.BZTRP_END_YMD) AS BZTRP_END_YMD /* 출장종료일자 */,
    SUM(NVL(TE.BZTRP_TRVEXP_FDEXP,0) + NVL(TE.BTEXP_CRTR_AMT,0) + NVL(TE.LDG_CST,0)) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */,
    SUM(NVL(TE.BZTRP_DCN,0)) AS BZTRP_DCN /* 출장일수 */,
    SUM(NVL(TE.RL_FARE_AMT,0) + NVL(TE.CPRG_FARE_CST,0)) AS RL_FARE_AMT /* 철도운임금액 */,
    MAX(NVL(D1.MAX_SNO,0)) AS MAX_SNO
FROM (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    MAX(BZTRP_CLCLN_SQNO) AS BZTRP_CLCLN_SQNO /* 출장정산순번 */,
    MAX(CLCLN_CHG_RSN_CN) AS CLCLN_CHG_RSN_CN /* 정산변경사유내용 */
FROM TBBADDED019H WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# AND NVL(CLCLN_YN, 'N') = 'Y' GROUP BY BZTRP_YR , BZTRP_SQNO , BZTRVR_ENO) D1 , ( SELECT TE.*,
    TFD.RL_FARE_AMT /* 철도운임금액 */
FROM TBBADDED019H TE , (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    BTEXP_SQNO /* 출장비순번 */,
    BZTRP_CLCLN_SQNO /* 출장정산순번 */,
    SUM( RL_FARE_AMT ) AS RL_FARE_AMT /* 철도운임금액 */
FROM TBBADDED020H GROUP BY BZTRP_YR , BZTRP_SQNO , BZTRVR_ENO , BTEXP_SQNO, BZTRP_CLCLN_SQNO ) TFD WHERE 1=1 AND TE.BZTRP_YR = TFD.BZTRP_YR(+) AND TE.BZTRP_SQNO = TFD.BZTRP_SQNO(+) AND TE.BZTRVR_ENO = TFD.BZTRVR_ENO(+) AND TE.BTEXP_SQNO = TFD.BTEXP_SQNO(+) AND TE.BZTRP_CLCLN_SQNO = TFD.BZTRP_CLCLN_SQNO(+) ) TE WHERE 1=1 AND D1.BZTRP_YR = TE.BZTRP_YR AND D1.BZTRP_SQNO = TE.BZTRP_SQNO AND D1.BZTRVR_ENO = TE.BZTRVR_ENO AND D1.MAX_SNO = TE.BZTRP_CLCLN_SQNO AND D1.BZTRP_YR = #BZTRP_YR# AND D1.BZTRP_SQNO = #BZTRP_SQNO# GROUP BY D1.BZTRP_YR , D1.BZTRP_SQNO , D1.BZTRVR_ENO ) AFT WHERE 1=1 AND TER.BZTRP_YR = SITU.BZTRP_YR AND TER.BZTRP_SQNO = SITU.BZTRP_SQNO AND TER.BZTRP_YR = BEF.BZTRP_YR AND TER.BZTRP_SQNO = BEF.BZTRP_SQNO AND TER.BZTRVR_ENO = BEF.BZTRVR_ENO AND TER.BZTRP_YR = AFT.BZTRP_YR(+) AND TER.BZTRP_SQNO = AFT.BZTRP_SQNO(+) AND TER.BZTRVR_ENO = AFT.BZTRVR_ENO(+) AND TER.BZTRP_YR =#BZTRP_YR# AND TER.BZTRP_SQNO = #BZTRP_SQNO# AND (NVL(BEF.RL_FARE_AMT, 0) + NVL(BEF.IN_EXP,0)) - ( NVL(AFT.RL_FARE_AMT, 0) + NVL(AFT.IN_EXP,0)) <> 0 ORDER BY BZTRVR_ENO