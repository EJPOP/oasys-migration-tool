SELECT TER.BZTRP_YR /* 출장년도 */,
    TER.BZTRP_SQNO /* 출장순번 */,
    TER.BZTRVR_ENO /* 출장자직원전산번호 */,
    /*전산번호*/ TER.BZTRVR_NM AS BZTRVR_NM /* 출장자명 */,
    /*성명*/ F_CODE_NM('1000173',TER.BZTRVR_JBGD_SECD) AS F_CODE_NM,
    /*직급*/ F_DPT_INFO(BL.OGDP_DEPT_CD,'4') AS F_DPT_INFO,
    /*소속*/ NVL(TE.BZTRP_TRVEXP_FDEXP, 0) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */,
    /*식비*/ NVL(TE.BTEXP_CRTR_AMT, 0) AS BTEXP_CRTR_AMT /* 출장비기준금액 */,
    /*일비*/ NVL(TE.LDG_CST, 0) AS LDG_CST /* 숙박비용 */,
    /*숙박비*/ NVL(TE.CPRG_FARE_CST, 0) AS CPRG_FARE_CST /* 수도권운임비용 */,
    /*수도권운임 - 2015.05.06 yyh*/ NVL(TE.IN_EXP, 0) AS IN_EXP,
    /*국내여비*/ NVL(TE.SPM_CST, 0) AS SPM_CST /* 보충비용 */,
    /*현장보충경비*/ NVL(TE.BZTRP_DCN, 0) AS BZTRP_DCN /* 출장일수 */,
    /*출장일수*/ NVL(TFD.RL_FARE_AMT, 0) + NVL(TE.CPRG_FARE_CST, 0) AS RL_FARE_AMT /* 철도운임금액 */,
    /*교통비(철도임) + 수도권운임비*/ ( CASE WHEN SITU.BZTRP_TL_ENO = TER.BZTRVR_ENO THEN TER2.LEAD_CST ELSE 0 END) AS LEAD_CST /* 지휘비용 */,
    /*지휘비*/ ( CASE WHEN SITU.BZTRP_TL_ENO = TER.BZTRVR_ENO THEN TER2.ADT_ACTV_ACTC_AMT ELSE 0 END) AS ADT_ACTV_ACTC_AMT /* 감사활동수용금액 */,
    /*감사활동수용비*/ NVL(TFD.RL_FARE_AMT, 0) + NVL(TE.CPRG_FARE_CST, 0) + NVL(TE.IN_EXP, 0) + NVL(TE.SPM_CST, 0) + ( CASE WHEN SITU.BZTRP_TL_ENO = TER.BZTRVR_ENO THEN TER2.LEAD_CST + TER2.ADT_ACTV_ACTC_AMT ELSE 0 END) AS RL_FARE_AMT /* 철도운임금액 */,
    /*합계*/ ( CASE WHEN SITU.BZTRP_TL_ENO = TER.BZTRVR_ENO THEN '0' + TER.BZTRVR_ENO ELSE '1'+TER.BZTRVR_ENO END) AS BZTRP_TL_ENO /* 출장반장직원전산번호 */,
    NVL(TE.BZTRP_TRVEXP_FDEXP, 0) + NVL(TE.BTEXP_CRTR_AMT, 0) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */,
    NVL(TE.BZTRP_TRVEXP_FDEXP, 0) + NVL(TE.BTEXP_CRTR_AMT, 0) + NVL(TE.LDG_CST, 0) + NVL(TFD.RL_FARE_AMT, 0) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */
FROM TB_BADDED010L TER, TB_BADDED002M SITU, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    NVL(SUM(TE0.BZTRP_TRVEXP_FDEXP), 0) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */,
    NVL(SUM(TE0.BTEXP_CRTR_AMT), 0) AS BTEXP_CRTR_AMT /* 출장비기준금액 */,
    NVL(SUM(TE0.LDG_CST), 0) AS LDG_CST /* 숙박비용 */,
    NVL(SUM(TE0.CPRG_FARE_CST), 0) AS CPRG_FARE_CST /* 수도권운임비용 */,
    /*수도권운임 - 2015.05.06 yyh*/ SUM(TE0.SPM_CST) AS SPM_CST /* 보충비용 */,
    NVL(SUM(TE0.BZTRP_TRVEXP_FDEXP), 0) + NVL(SUM(TE0.BTEXP_CRTR_AMT), 0) + NVL(SUM(TE0.LDG_CST), 0) AS BZTRP_TRVEXP_FDEXP /* 출장여비식비 */,
    NVL(SUM(TE0.BZTRP_DCN), 0) AS BZTRP_DCN /* 출장일수 */
FROM TBBADDED011L TE0 WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# AND CAL_YN = 'Y' GROUP BY BZTRP_YR, BZTRP_SQNO, BZTRVR_ENO) TE, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    SUM(NVL(LEAD_CST, 0)) AS LEAD_CST /* 지휘비용 */,
    SUM(NVL(ADT_ACTV_ACTC_AMT, 0)) AS ADT_ACTV_ACTC_AMT /* 감사활동수용금액 */
FROM TBBADDED011L WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# AND CAL_YN = 'Y' GROUP BY BZTRP_YR, BZTRP_SQNO) TER2, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    SUM(RL_FARE_AMT) AS RL_FARE_AMT /* 철도운임금액 */
FROM TBBADDED017L WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# AND CAL_YN = 'Y' GROUP BY BZTRP_YR, BZTRP_SQNO, BZTRVR_ENO ) TFD, (SELECT BZTRP_YR /* 출장년도 */,
    BZTRP_SQNO /* 출장순번 */,
    BZTRVR_ENO /* 출장자직원전산번호 */,
    MAX(OGDP_DEPT_CD) AS OGDP_DEPT_CD /* 소속부서코드 */
FROM TBBADDED005L WHERE BZTRP_YR = #BZTRP_YR# AND BZTRP_SQNO = #BZTRP_SQNO# GROUP BY BZTRP_YR, BZTRP_SQNO, BZTRVR_ENO) DBO_BLL_BLNC WHERE TER.BZTRP_YR = #BZTRP_YR# AND TER.BZTRP_SQNO = #BZTRP_SQNO# AND TE.BZTRP_YR(+) = TER.BZTRP_YR AND TE.BZTRP_SQNO(+) = TER.BZTRP_SQNO AND TE.BZTRVR_ENO(+) = TER.BZTRVR_ENO AND TFD.BZTRP_YR(+) = TER.BZTRP_YR AND TFD.BZTRP_SQNO(+) = TER.BZTRP_SQNO AND TFD.BZTRVR_ENO(+) = TER.BZTRVR_ENO AND TER2.BZTRP_YR = TER.BZTRP_YR AND TER2.BZTRP_SQNO = TER.BZTRP_SQNO AND SITU.BZTRP_YR = TER.BZTRP_YR AND SITU.BZTRP_SQNO = TER.BZTRP_SQNO AND BL.BZTRP_YR(+) = TER.BZTRP_YR AND BL.BZTRP_SQNO(+) = TER.BZTRP_SQNO AND BL.BZTRVR_ENO(+) = TER.BZTRVR_ENO ORDER BY SORTER