SELECT *
FROM( SELECT ROW_NUMBER() OVER(ORDER BY TO_NUMBER(SUBSTR(CNSL_APL_NO,1,4)) DESC, TO_NUMBER(SUBSTR(CNSL_APL_NO, INSTR(CNSL_APL_NO,'-')+1)) DESC) AS GRNDS_EXMN_AEX_SQNO /* 현장조사수용비순번 */,
    A.CNSL_APL_NO AS CNSL_APL_NO,
    F_CODE_NM('1001018',A.CNSL_DVSN_CD) AS F_CODE_NM,
    A.ANO_YN AS ANO_YN,
    DECODE(A.FTF_APL_YN,'Y','신청','N','불필요') AS FTF_APL_YN,
    (SELECT DECODE(JBPS_CD||'_'||SRECS_DEPT_CD,'0010300_100000','감찰관','0035400_100100','감찰담당관',F_USR_INFO(CNSL_CHRG_CNB,'2')) AS JBPS_CD /* 직위코드 */
FROM TBDCMACM001M WHERE TRGT_NOP_ENO = A.CNSL_CHRG_CNB) AS CNSL_CHRG_CNB , A.CNSL_TITLE , TO_CHAR(A.CNSL_APL_DH,'YYYY-MM-DD') AS CNSL_APL_DH , DECODE(A.ANO_YN,'Y','익명', 'N',F_DPT_INFO(F_USR_INFO(DGUARD.DECRYPT('TB_ENC','ECN',A.CNSL_APL_USR),'5'),'1')||' '||F_USR_INFO(DGUARD.DECRYPT('TB_ENC','ECN',A.CNSL_APL_USR), '2')) AS CNSL_APL_USR , A.SMT_YN AS SMT_YN , CASE WHEN DGUARD.DECRYPT('TB_ENC','ECN',A.CNSL_APL_USR) = #S_CNB# THEN 'Y' ELSE 'N' END AS WRT_DVSN FROM UBCREOWN.TBCSPCIS202M A WHERE 1=1 AND ((CNSL_CHRG_CNB IN(#S_CNB#) AND SMT_YN='Y') OR DGUARD.DECRYPT('TB_ENC','ECN',CNSL_APL_USR)= #S_CNB#) AND ((TO_CHAR(CNSL_APL_DH,'YYYYMMDD') BETWEEN #ACP_DH_START# AND #ACP_DH_END#) OR CNSL_APL_DH IS NULL) AND FTF_APL_YN = #FTF_APL_YN# AND CNSL_DVSN_CD = #CNSL_DVSN_CD# AND CNSL_CHRG_CNB = #CNSL_CHRG_CNB# AND CNSL_TITLE LIKE '%' || #CNSL_TITLE# ||'%' ORDER BY GRNDS_EXMN_AEX_SQNO ) WHERE 1=1 ORDER BY GRNDS_EXMN_AEX_SQNO