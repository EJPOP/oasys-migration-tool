UPDATE TB_BADDED001M SET PRGRS_STP_SECD = (SELECT /*실국배정은 NULL로 표기 2015.05.18 yyh*/ CASE WHEN D1.BZTRP_BGT_SECD != '1' THEN '' WHEN D3.ACADT_PRCS_STTS_SECD = '9' THEN '10' /* 국과별처리현황에 감사실시처리상태코드가 종료(9)면 감사실시처리상태코드를 종료(10)으로- 2015.05.20 yyh*/ /*실국배정 이외 */ ELSE CASE WHEN TRIM(D3.ENFC_ATRZ_YMD) IS NOT NULL THEN '10' /*종료*/ WHEN TRIM(D3.LDRV_MBCMT_ATRZ_YMD) IS NOT NULL THEN '09' /*주심위원*/ WHEN TRIM(D3.OW_DHD_ATRZ_YMD) IS NOT NULL THEN '08' /*총차장*/ WHEN TRIM(D3.JDAF_SRNG_OFER_ATRZ_YMD) IS NOT NULL THEN '07' /*심의실장*/ WHEN TRIM(D3.AJMT_DDG_ATRZ_YMD) IS NOT NULL THEN '06' /*조정담당관*/ WHEN TRIM(D3.AJMT_OFER_ATRZ_YMD) IS NOT NULL THEN '05' /*조정담당자*/ WHEN TRIM(D3.AB_ATRZ_YMD) IS NOT NULL THEN '04' /*감사국과*/ WHEN TRIM(D3.DAG_RPT_YMD) IS NOT NULL THEN '03' /*귀청보고*/ ELSE /* 실지감사중을 출장단계과 귀청보고 준비중으로 분리함 - 2015.05.15 yyh*/ (CASE WHEN (CASE WHEN (D3.ACADT_PRCS_STTS_SECD = '1' AND TO_DATE(D3.DAG_YMD) > TO_DATE(SYSDATE)) THEN '7' WHEN ((D3.ACADT_PRCS_STTS_SECD = '1' AND TRIM(D3.PRCS_TERM_YMD) IS NULL) OR D3.ACADT_PRCS_STTS_SECD = '3') OR (D3.ACADT_PRCS_STTS_SECD = '1'AND NVL(TO_DATE(D3.PRCS_TERM_YMD),'99991231') TO_DATE(SYSDATE)) THEN '7' WHEN ((D3.ACADT_PRCS_STTS_SECD = '1' AND TRIM(D3.PRCS_TERM_YMD) IS NULL) OR D3.ACADT_PRCS_STTS_SECD = '3') OR (D3.ACADT_PRCS_STTS_SECD = '1'AND NVL(TO_DATE(D3.PRCS_TERM_YMD),'99991231') TO_DATE(SYSDATE)) THEN '7' WHEN ((D3.ACADT_PRCS_STTS_SECD = '1' AND TRIM(D3.PRCS_TERM_YMD) IS NULL) OR D3.ACADT_PRCS_STTS_SECD = '3') OR (D3.ACADT_PRCS_STTS_SECD = '1'AND NVL(TO_DATE(D3.PRCS_TERM_YMD),'99991231') < TO_DATE(SYSDATE) )THEN '8' WHEN D3.ACADT_PRCS_STTS_SECD = '1'AND NVL(TO_DATE(D3.PRCS_TERM_YMD),'99991231') < TO_DATE(SYSDATE) THEN '6' WHEN D3.ACADT_PRCS_STTS_SECD = '3' THEN '3' WHEN D3.ACADT_PRCS_STTS_SECD = '9' THEN '9' ELSE '8' END) = '7' THEN '02' /*출장단계*/ END) END END AS PRGRS_STP_SECD /* 진행단계구분코드 */
FROM TB_BADDED001M D1 , TB_BADDED003M D3 WHERE 1=1 AND D1.ADT_YR = D3.ADT_YR(+) AND D1.ADT_NO = D3.ADT_NO(+) AND D1.ADT_YR = #CVLCPT_ADT_YR# AND D1.ADT_NO = #ADT_NO# ) WHERE CVLCPT_ADT_YR = #CVLCPT_ADT_YR# AND ADT_NO = #ADT_NO#