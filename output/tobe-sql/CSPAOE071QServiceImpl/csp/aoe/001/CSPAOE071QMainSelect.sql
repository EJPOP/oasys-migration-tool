/*감사업무 업무실적명세*/ SELECT D3.EVL_YR /* 평가년도 */,
    D3.HLYR_DVSN_CD /* 반기구분 */,
    D3.ADT_KDCD AS ADT_KDCD /* 감사종류코드 */,
    D3.TSK_NO AS TSK_NO /* 업무번호 */,
    D3.ADT_MTTR_NM /* 감사사항명 */,
    MIN(D4.ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */,
    MAX(D4.ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */,
    D1.PTCPT_CNB AS TRGT_NOP_ENO /* 전산번호 */,
    (SELECT SUM(CTB_RT) AS CTB_RT /* 기여비율 */
FROM TBCSPAOE023M WHERE 1=1 AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND PTCPT_CNB = #strCnb# GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_NO, PTCPT_CNB) AS CTB_RT /*기여율*/ , ( SELECT SUM(D1.DRIVE_RTE) AS DRIVE_RTE
FROM TBCSPAOE008D D1 , (SELECT DISTINCT D1.EVL_YR,
    D1.HLYR_DVSN_CD,
    D1.TSK_NO,
    D1.ADT_MTTR_NM /* 감사사항명 */,
    D3.PTCPT_CNB
FROM TBCSPAOE021M D1 , TBCSPAOE022M D2 LEFT JOIN TBCSPAOE023M D3 ON D2.EVL_YR = D3.EVL_YR AND D2.HLYR_DVSN_CD = D3.HLYR_DVSN_CD AND D2.TSK_NO = D3.TSK_NO AND D2.ADT_STP_SECD = D3.ADT_STP_SECD WHERE 1=1 AND D1.EVL_YR = D2.EVL_YR AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD AND D1.TSK_NO = D2.TSK_NO AND D3.EVL_YR = #strEvlYr# AND D3.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D3.PTCPT_CNB = #strCnb# ) D2 WHERE 1=1 AND D1.EVL_YR = D2.EVL_YR AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD AND D1.CVLCPT_TASK_SECD = '10000' AND D1.ADT_KDCD = ( SELECT DISTINCT D1.ADT_KDCD AS ADT_KDCD /* 감사종류코드 */
FROM TBCSPAOE021M D1 , TBCSPAOE023M D2 WHERE 1=1 AND D1.EVL_YR = D2.EVL_YR AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD AND D1.TSK_NO = D2.TSK_NO AND D2.EVL_YR = #strEvlYr# AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D2.PTCPT_CNB = #strCnb# ) AND D1.ADT_STP_SECD BETWEEN (SELECT MIN(ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */
FROM TBCSPAOE022M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_NO = (SELECT TSK_NO
FROM TBCSPAOE023M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND PTCPT_CNB = #strCnb#)) AND (SELECT MAX(ADT_STP_SECD) AS ADT_STP_SECD /* 감사단계구분코드 */
FROM TBCSPAOE022M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_NO = (SELECT TSK_NO
FROM TBCSPAOE023M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND PTCPT_CNB = #strCnb#)) ) AS DRIVE_RTE , NVL(D5.PSN_TSK_ASC,0) AS PSN_TSK_ASC /*개인평점*/ FROM TBCSPAOE023M D1 LEFT JOIN TBCSPAOE035M D5 ON D1.EVL_YR = D5.EVL_YR AND D1.HLYR_DVSN_CD = D5.HLYR_DVSN_CD AND D1.TSK_NO = D5.TSK_NO AND D1.PTCPT_CNB = D5.NEVLT_CNB , TBCSPAOE021M D3 , TBCSPAOE022M D4 WHERE 1=1 AND D1.EVL_YR = D3.EVL_YR AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD AND D1.TSK_NO = D3.TSK_NO AND D1.EVL_YR = D4.EVL_YR AND D1.HLYR_DVSN_CD = D4.HLYR_DVSN_CD AND D1.TSK_NO = D4.TSK_NO AND D1.EVL_YR = #strEvlYr# AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D1.PTCPT_CNB = #strCnb# GROUP BY D3.EVL_YR, D3.HLYR_DVSN_CD, D3.ADT_KDCD, D3.TSK_NO, D3.ADT_MTTR_NM, D1.PTCPT_CNB, D5.PSN_TSK_ASC UNION ALL /*감사외업무 업무실적명세*/ SELECT D3.EVL_YR /* 평가년도 */,
    D3.HLYR_DVSN_CD /* 반기구분 */,
    D3.TASK_KDCD AS TASK_KDCD /* 업무종류코드 */,
    D3.TSK_NO AS TSK_NO /* 업무번호 */,
    D3.TSK_NM AS TSK_NM /* 업무명 */,
    '' AS TSK_ST_STEP_CD /* 단계기초 */,
    '' AS TSK_END_STEP_CD /* 단계기말 */,
    D1.PTCPT_CNB AS TRGT_NOP_ENO /* 전산번호 */,
    SUM(D1.CTB_RT) AS CTB_RT /* 기여비율 */,
    0 /* 추진율 */,
    NVL(D4.PSN_TSK_ASC, 0) AS PSN_TSK_ASC /* 개인평점 */
FROM TBCSPAOE025M D1 LEFT JOIN TBCSPAOE035M D4 ON D1.EVL_YR = D4.EVL_YR AND D1.HLYR_DVSN_CD = D4.HLYR_DVSN_CD AND D1.TSK_NO = D4.TSK_NO AND D1.PTCPT_CNB = D4.NEVLT_CNB , TBCSPAOE024M D3 WHERE 1=1 AND D1.EVL_YR = D3.EVL_YR AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD AND D1.TSK_NO = D3.TSK_NO AND D1.EVL_YR = #strEvlYr# AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D1.PTCPT_CNB = #strCnb# GROUP BY D3.EVL_YR, D3.HLYR_DVSN_CD, D3.TASK_KDCD, D3.TSK_NO, D3.TSK_NO, D3.TSK_NM, D1.PTCPT_CNB, D4.PSN_TSK_ASC UNION ALL /*지원업무 업무실적명세*/ SELECT D1.EVL_YR /* 평가년도 */,
    D1.HLYR_DVSN_CD /* 반기구분 */,
    '' AS TASK_KDCD /* 업무종류코드 */,
    D1.TSK_NO /* 업무번호 */,
    D2.TSK_NM /* 업무명 */,
    '' AS TSK_ST_STEP_CD /* 단계기초 */,
    '' AS TSK_END_STEP_CD /* 단계기말 */,
    D1.PTCPT_CNB AS TRGT_NOP_ENO /* 전산번호 */,
    NVL(D1.CTB_RT, 0) AS CTB_RT /* 기여비율 */,
    0 /* 추진율 */,
    NVL(D3.PSN_TSK_ASC,0) AS PSN_TSK_ASC /* 개인평점 */
FROM TBCSPAOE027M D1 LEFT JOIN TBCSPAOE035M D3 ON D1.EVL_YR = D3.EVL_YR AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD AND D1.TSK_NO = D3.TSK_NO AND D1.PTCPT_CNB = D3.NEVLT_CNB , TBCSPAOE026M D2 WHERE 1=1 AND D1.EVL_YR = D2.EVL_YR AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD AND D1.TSK_NO = D2.TSK_NO AND D1.EVL_YR = #strEvlYr# AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd# AND D1.PTCPT_CNB = #strCnb#