SELECT C.KEY,
    C.KNB,
    C.KLD_CAT_NM,
    C.CAT_SPH_NM,
    C.KLD_NM,
    C.RGTR_NM /* 등록자명 */,
    C.REG_DMND_YMD /* 등록요청일자 */,
    C.KLD_STA_NM,
    C.KLD_STA_CD,
    C.PRSV_WAY_NM,
    C.ABRG_DH,
    C.ENAIS_PST_INQ_NMTM /* ENAIS게시물조회횟수 */,
    C.DOC_YN,
    C.CVLCPT_DOC_ID /* 민원문서아이디 */,
    C.ECL_KLD,
    NVL(D.COUNT, '0') AS COUNT,
    NVL(E.APRV_YN, 'N') AS APRV_YN /* 승인여부 */,
    NVL(F.CMMT_CNT, 0) AS CMMT_CNT,
    NVL(G.RCMD_CNT, 0) AS RCMD_CNT
FROM ( SELECT ROWNUM,
    A.KNB,
    F_CODE_NM(#cmmCdDvsnCd#, A.NEW_KLD_CAT_CD) AS F_CODE_NM,
    F_CODE_NM(#cmmCdDvsnCd2#, A.NEW_CAT_SPH_CD) AS F_CODE_NM,
    A.KLD_NM,
    F_USR_INFO(A.OTSD_EXPRT_RGTR_ENO, '2') AS RGTR_NM /* 등록자명 */,
    DECODE(REGN_OPEN_YN,'Y',F_USR_INFO(A.OTSD_EXPRT_RGTR_ENO, '2'),'N','비공개') AS RGTR_NM /* 등록자명 */,
    A.REG_DMND_YMD /* 등록요청일자 */,
    F_CODE_NM('1000351',A.KLD_STA_CD) AS F_CODE_NM,
    A.KLD_STA_CD,
    DECODE(A.PRSV_WAY_CD, '0', '영구보존', '1', '기간제한') AS PRSV_WAY_CD,
    TO_CHAR(A.ABRG_DH, 'YYYYMMDD') AS TO_CHAR,
    A.ENAIS_PST_INQ_NMTM /* ENAIS게시물조회횟수 */,
    DECODE(A.CVLCPT_DOC_ID, NULL, 'N', 'Y') AS CVLCPT_DOC_ID /* 민원문서아이디 */,
    A.CVLCPT_DOC_ID /* 민원문서아이디 */,
    NVL(A.ECL_KLD, 'N') AS ECL_KLD
FROM TBAEPGKM001M A, TBDCMACM013C B WHERE 1=1 AND A.OTSD_EXPRT_RGTR_ENO = #OTSD_EXPRT_RGTR_ENO# AND B.CMM_CD_DVSN_CD = #cmmCdDvsnCd# AND B.USR_DFN_TXT_1 = #strKldCatCdDvsn# AND A.NEW_KLD_CAT_CD = B.CD AND A.NEW_KLD_CAT_CD = #strNewKldCatCd# AND A.NEW_CAT_SPH_CD = #strNewCatSphCd# AND A.REG_DMND_YMD BETWEEN #strSdt# AND #strEdt# AND A.REG_DMND_YMD >= #strSdt# AND A.REG_DMND_YMD AND (A.KLD_NM LIKE '%'|| #strTitNm# ||'%' OR ( A.CRU_KYWD_NM LIKE '%'|| #strTitNm# ||'%' OR A.CRU_KYWD_NM LIKE '%'|| #strTitNm# ||'%' OR A.CRU_KYWD_NM LIKE '%'|| #strTitNm# ||'%') ) AND F_USR_INFO(A.OTSD_EXPRT_RGTR_ENO, '2') LIKE '%'|| #strRegnNm# ||'%' AND ECL_KLD = 'Y' ORDER BY TO_NUMBER(A.KNB) DESC ) C, (SELECT KNB,
    COUNT(KNB) AS KNB
FROM (SELECT KNB
FROM TBAEPGKM002L UNION ALL SELECT KNB
FROM TBAEPGKM004L ) GROUP BY KNB) D, (SELECT KNB,
    MAX(APRV_YN) AS APRV_YN /* 승인여부 */
FROM TBAEPGKM016L WHERE APRV_YN = 'Y' AND KNB IS NOT NULL GROUP BY KNB) E, (SELECT POST_SEQ,
    COUNT(*) AS CMMT_CNT
FROM CTT_POST_CMMT WHERE BOARD_ID = '1550' GROUP BY POST_SEQ) F, (SELECT KNB,
    SUM(CASE WHEN RCMD_YN = 'Y' THEN 1 ELSE 0 END ) AS RCMD_YN
FROM TBAEPGKM021M GROUP BY KNB) G WHERE 1=1 AND C.KNB = D.KNB(+) AND C.KNB = E.KNB(+) AND C.KNB = F.POST_SEQ(+) AND C.KNB = G.KNB(+)