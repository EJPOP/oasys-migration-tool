SELECT A.COPT_CAT_CD,
    /*소관분류코드*/ F_CODE_NM('1000322',A.COPT_CAT_CD) AS F_CODE_NM,
    /*소관분류코드*/ F_CODE_NM('1000149',A.BOO_KND_CD) AS F_CODE_NM,
    /*도서종류코드*/ A.BOO_NO,
    /*도서번호*/ A.BOO_NO||'-'||A.BOO_VLE_NO AS BOO_NO,
    /*도서번호*/ A.BOO_VLE_NO,
    /*도서권번호*/ A.CAT_SYM_NM,
    /*분류기호명*/ A.BOO_ACP_DT,
    /*도서접수일*/ A.BAR_CD,
    /*바코드*/ A.DRVT_SYM_NM,
    /*별치기호명*/ A.BOO_SYM_NM,
    /*도서기호명*/ A.BOO_TIT_NM,
    /*도서제목명*/ A.PBC_PLAC_NM,
    /*발행처명*/ A.PBC_RGN_NM,
    /*발행지역명*/ A.PBC_DT,
    /*발행일*/ A.PBC_YR,
    /*발행년도*/ A.RSCH_RPTP_AUT_NM AS RSCH_RPTP_AUT_NM /* 연구보고서저자명 */,
    /*저자명*/ A.PON,
    /*면수*/ A.SZ_VAL,
    /*크기값*/ A.KYWD_NM,
    /*키워드명*/ A.BOO_RMK,
    /*도서비고*/ A.ORI_NM,
    /*원서명*/ A.STN_PEN_NM,
    /*역자명*/ F_CODE_NM('1000150',A.BOO_PBC_BR_CD) AS F_CODE_NM,
    /*도서발행국코드*/ A.LIB_SBJ,
    /*총서사항*/ F_CODE_NM('1000323',A.CLC_WAY_CD) AS F_CODE_NM,
    /*수집방법코드*/ A.BOO_PUR_PR,
    /*도서구매가격*/ A.INTNA_STND_BOO_NO,
    /*국제표준도서번호*/ A.DEG_NM,
    /*학위명*/ A.MTRL_MNG_YR,
    /*자료관리년도*/ A.MTRL_MNG_DVSN_NO,
    /*자료관리구분번호*/ A.MTRL_MNG_NO,
    /*자료관리번호*/ A.CVLCPT_RCPT_YR AS CVLCPT_RCPT_YR /* 민원접수년도 */,
    /*접수년도*/ F_CODE_NM('1000162',A.PBLC_KND_CD) AS F_CODE_NM,
    /*간행물종류코드*/ A.INTNA_STND_PBLC_SRNO,
    /*국제표준간행물일련번호*/ A.SSCR_PRD_STR_DT,
    /*구독기간시작일*/ A.SSCR_PRD_END_DT,
    /*구독기간종료일*/ A.YRLY_SSCR_FEE,
    /*연간구독료*/ A.SSCR_COT,
    /*구독수량*/ F_CODE_NM('1000163',A.AVDOC_SHP_CD) AS F_CODE_NM,
    /*시청각자료형태코드*/ A.BOO_MAIN_TXT,
    /*도서주요내용*/ A.BOO_RPRT_NO,
    /*도서보고서번호*/ A.ASTR_TXT,
    /*초록내용*/ (CASE WHEN A.BOO_LEND_DVSN_CD = '0' AND Z.LAG_INV_CNB != #strCNB# AND ( CNT = 0 OR CNT IS NULL ) AND (SELECT COUNT(*)
FROM TBCSPQBO003H C WHERE A.COPT_CAT_CD = C.COPT_CAT_CD AND A.BOO_KND_CD = C.BOO_KND_CD AND A.BOO_NO = C.BOO_NO AND A.CAT_SYM_NM = C.CAT_SYM_NM AND A.BOO_VLE_NO = C.BOO_VLE_NO AND C.LEND_BOKG_STA_CD = 'Y' ) < 3 THEN '예' ELSE '아니오' END ) AS BOO_LEND_YN, (SELECT COUNT(*) AS CNT
FROM TBCSPQBO003H H WHERE H.COPT_CAT_CD = A.COPT_CAT_CD AND H.BOO_KND_CD = A.BOO_KND_CD AND H.BOO_NO = A.BOO_NO AND H.CAT_SYM_NM = A.CAT_SYM_NM AND H.BOO_VLE_NO = A.BOO_VLE_NO AND H.LEND_BOKG_STA_CD = 'Y') AS BOO_LEND_CNT, A.BOO_KND_CD, A.CVLCPT_DOC_ID, F_USR_INFO(Z.LAG_INV_CNB,'2') LAG_INV_NAM, F_DPT_INFO(F_USR_INFO(Z.LAG_INV_CNB,'5'), '1') AS LAG_INV_DPT_NM, Z.BOO_LEND_DT, A.COPY_CNT, A.ATR_SYM_NM, A.STC_BKS FROM TBCSPQBO001M A, (SELECT A.COPT_CAT_CD,
    A.BOO_KND_CD,
    A.BOO_NO,
    A.CAT_SYM_NM,
    A.BOO_VLE_NO,
    COUNT(*) AS CNT
FROM TBCSPQBO003H A WHERE A.LEND_BOKG_STA_CD = 'Y' AND A.LEND_BOKG_PEN_CNB = #strCNB# GROUP BY A.COPT_CAT_CD, A.BOO_KND_CD, A.BOO_NO, A.CAT_SYM_NM, A.BOO_VLE_NO ) B, TBCSPQBO002H Z WHERE 1=1 AND A.BOO_KND_CD = #strBOO_KND_CD# AND A.BOO_NO = #strBOO_NO# AND A.CAT_SYM_NM = #strCAT_SYM_NM# AND A.COPT_CAT_CD = #strCOPT_CAT_CD# AND A.BOO_VLE_NO = #strBOO_VLE_NO# AND A.COPT_CAT_CD = B.COPT_CAT_CD(+) AND A.BOO_KND_CD = B.BOO_KND_CD(+) AND A.BOO_NO = B.BOO_NO(+) AND A.CAT_SYM_NM = B.CAT_SYM_NM(+) AND A.BOO_VLE_NO = B.BOO_VLE_NO(+) AND Z.COPT_CAT_CD(+) = A.COPT_CAT_CD AND Z.BOO_KND_CD(+) = A.BOO_KND_CD AND Z.BOO_NO(+) = A.BOO_NO AND Z.CAT_SYM_NM(+) = A.CAT_SYM_NM AND Z.BOO_VLE_NO(+) = A.BOO_VLE_NO AND Z.BOO_REN_YN_CD(+) ='0'