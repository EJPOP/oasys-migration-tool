SELECT A.CLM_SECD /* 청구구분코드 */,
    A.CVLCPT_RCPT_YR /* 민원접수년도 */,
    A.CVLCPT_RCPT_RCPT /* 민원접수번호 */,
    A.CVLCPT_RCPT_YR||'-민원-'||C.TPOF_ACTL_RCPT_NO AS NTFCTN_RCPT_SQNO /* 통보접수순번 */,
    TO_CHAR(C.TPOF_RCPT_DT,'YYYY.MM.DD') AS NTFCTN_RCPT_YMD /* 통보접수일자 */,
    DECODE(C.TPOF_CLMT_KDCD,'1',C.TPOF_CVLPR_NM,'2',C.TPOF_CVLPR_RPRSV_NM,'3',C.TPOF_CVLPR_RPRSV_NM,'4',C.TPOF_CVLPR_NM) AS TPOF_CVLPR_NM /* 제보민원인명 */,
    DECODE(C.TPOF_CLMT_KDCD,'2','(기업)','') AS TPOF_CLMT_KDCD /* 제보청구인종류코드 */,
    DECODE(C.TPOF_CVLPR_ZIP,NULL,'','(우)'||C.TPOF_CVLPR_ZIP||' '||C.TPOF_CVLPR_ADDR||' '||C.TPOF_CVLPR_DADDR) AS OTSD_EXPRT_ADDR /* 외부전문가주소 */,
    DECODE(C.TPOF_CVLPR_TELNO,NULL,C.TPOF_CVLPR_MPNO,C.TPOF_CVLPR_TELNO) AS CRU_TELNO /* 부패전화번호 */,
    CASE WHEN H.SUC_CNT > 0 AND H.SUC_CNT 5 THEN C.TPOF_NM||( SELECT '(합건 : '||AGGR_CONCAT( S3.TPOF_ACTL_RCPT_NO, ', ')||' 외 '||(H.SUC_CNT-5)||'건)' AS RSCH_ASMT_TTL /* 연구과제제목 */
FROM TB_CSPDCP105L S2, TB_CSPDCP101M S3 WHERE C.CVLCPT_CLM_SECD = S2.CVLCPT_CLM_SECD AND C.TPOF_RCPT_YR = S2.TPOF_RCPT_YR AND C.TPOF_RCPT_NO = S2.TPOF_RCPT_NO AND S2.TPOF_MCA_CLM_SECD = S3.CVLCPT_CLM_SECD AND S2.TPOF_MCA_RCPT_YR = S3.TPOF_RCPT_YR AND S2.TPOF_MCA_CVLCPT_RCPT_NO = S3.TPOF_RCPT_NO AND ROWNUM '8' AND C.TPOF_RSLT_NTFCTN_MTHD_SECD = '003' THEN F_CODE_NM('1000089',C.TPOF_RSLT_NTFCTN_MTHD_SECD) ELSE '홈페이지+'||F_CODE_NM('1000089',C.TPOF_RSLT_NTFCTN_MTHD_SECD) END AS RSLT_NTF_WAY_NM ,F_DPT_INFO(G.TPOF_TRNF_DEPT_CD,'1') AS TRNF_DPT_NM ,( SELECT F_ORG_INFO(MIN(S1.TPOF_INST_CD),'1') AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */
FROM TB_CSPDCP206L S1 WHERE G.CVLCPT_CLM_SECD = S1.CLM_SECD AND G.TPOF_RCPT_YR = S1.CVLCPT_RCPT_YR AND G.TPOF_RCPT_NO = S1.CVLCPT_RCPT_RCPT AND G.TPOF_SQNO = S1.FRS_MDM_SQNO AND S1.CVLCPT_INST_DSCTN_SECD IN ('2','3') ) AS TRNF_ORG_NM ,( SELECT COUNT(*)
FROM TB_CSPDCP101M S1 WHERE S1.CLM_SECD = '1' AND S1.SLCT_CVLPR_MPNO IS NOT NULL AND S1.TPOF_CVLPR_NM = C.TPOF_CVLPR_NM AND S1.SLCT_CVLPR_MPNO = C.TPOF_CVLPR_MPNO ) AS JEBOCNT ,CASE WHEN H.SUC_CNT > 0 AND H.SUC_CNT 5 THEN F_CODE_NM('1000370','C')||' (제'||C.TPOF_RCPT_YR||'-민원-'||C.TPOF_ACTL_RCPT_NO||'호) 보고'||( SELECT ' (합건 : '||AGGR_CONCAT( S3.TPOF_ACTL_RCPT_NO, ', ')||' 외 '||(H.SUC_CNT-5)||'건)' AS TPOF_ACTL_RCPT_NO /* 제보실제접수번호 */
FROM TB_CSPDCP105L S2, TB_CSPDCP101M S3 WHERE C.CVLCPT_CLM_SECD = S2.CVLCPT_CLM_SECD AND C.TPOF_RCPT_YR = S2.TPOF_RCPT_YR AND C.TPOF_RCPT_NO = S2.TPOF_RCPT_NO AND S2.TPOF_MCA_CLM_SECD = S3.CVLCPT_CLM_SECD AND S2.TPOF_MCA_RCPT_YR = S3.TPOF_RCPT_YR AND S2.TPOF_MCA_CVLCPT_RCPT_NO = S3.TPOF_RCPT_NO AND ROWNUM <= 5 ) ELSE F_CODE_NM('1000370','C')||' (제'||C.TPOF_RCPT_YR||'-민원-'||C.TPOF_ACTL_RCPT_NO||'호) 보고' END AS TITLE ,C.TPOF_REPT_YN AS CRU_REPT_CVLCPT_YN ,CASE WHEN CRU_REPT_CVLCPT_YN = '101' THEN '귀하께서 제출하신 감사요청사항을 취하하여 감사요청사항의 처리에 관한 규정 제14조제3항에 따라 회신하지 않습니다.' WHEN CRU_REPT_CVLCPT_YN = '102' THEN '귀하께서 제출하신 감사요청사항은 가명․차명․ 무기명 또는 주소가 불분명한 경우로 감사요청사항의 처리에 관한 규정 제14조제3항에 따라 회신하지 않습니다.' WHEN CRU_REPT_CVLCPT_YN = '103' THEN '귀하께서 제출하신 감사요청사항은 3회 이상 반복 제출된 동일한 감사요청사항으로 종결처리되어 감사요청사항의 처리에 관한 규정 제14조제3항에 따라 회신하지 않습니다.' WHEN CRU_REPT_CVLCPT_YN = '104' THEN '귀하께서 제출하신 감사요청사항에 대해 회신을 원하지 않아 감사요청사항의 처리에 관한 규정 제14조제3항에 따라 회신하지 않습니다.' ELSE NULL END AS RPET_YN_CVPT_DOC_TXT ,TO_CHAR(A.TPOF_LAST_PRCS_DT,'YYYY-MM-DD') AS TPOF_LAST_PRCS_DT ,A.TPOF_BKMK_ANS_CN FROM TB_CSPDCP201M A , TB_CSPDCP101M C ,( SELECT Z.CVLCPT_CLM_SECD /* 민원청구구분코드 */,
    Z.TPOF_RCPT_YR /* 제보접수년도 */,
    Z.TPOF_RCPT_NO /* 제보접수번호 */,
    CASE WHEN Z.TPOF_OCRN_INST_CD = '10' THEN F_ORG_INFO(INST_CD,'1') ELSE Z.TPOF_INST_NM END AS PROF_RBPRSN_INST_NM /* 증명책임자기관명 */,
    CASE WHEN Z.TPOF_OCRN_INST_CD = '10' THEN F_ORG_HRK_NM(SLCT_JRSD_SG_SECD) ELSE NULL END AS TPOF_OCRN_INST_CD /* 제보발생기관코드 */
FROM TBCSPDCP206L Z WHERE Z.CLM_SECD = #CLM_SECD# AND Z.CVLCPT_RCPT_YR = #CVLCPT_RCPT_YR# AND Z.CVLCPT_RCPT_RCPT = #CVLCPT_RCPT_RCPT# AND Z.CVLCPT_INST_DSCTN_SECD ='1' AND Z.TPOF_PRCS_INST_SQNO = (SELECT MIN(S1.TPOF_PRCS_INST_SQNO) AS TPOF_PRCS_INST_SQNO /* 제보처리기관순번 */
FROM TBCSPDCP206L S1 WHERE S1.CLM_SECD = #CLM_SECD# AND S1.CVLCPT_RCPT_YR = #CVLCPT_RCPT_YR# AND S1.CVLCPT_RCPT_RCPT = #CVLCPT_RCPT_RCPT# AND S1.CVLCPT_INST_DSCTN_SECD ='1' ) ) Z , TB_CSPDCP301M D , TB_CSPDCP302M E , TBDCMACM103L F , TB_CSPDCP205L G , (SELECT #CLM_SECD# AS CLM_SECD /* 청구구분코드 */,
    #CVLCPT_RCPT_YR# AS CVLCPT_RCPT_YR /* 민원접수년도 */,
    #CVLCPT_RCPT_RCPT# AS CVLCPT_RCPT_RCPT /* 민원접수번호 */,
    COUNT(*) AS SUC_CNT
FROM TBCSPDCP105L S1 WHERE S1.CLM_SECD = #CLM_SECD# AND S1.CVLCPT_RCPT_YR = #CVLCPT_RCPT_YR# AND S1.CVLCPT_RCPT_RCPT = #CVLCPT_RCPT_RCPT# ) H WHERE 1=1 AND A.CLM_SECD = #CLM_SECD# AND A.CVLCPT_RCPT_YR = #CVLCPT_RCPT_YR# AND A.CVLCPT_RCPT_RCPT = #CVLCPT_RCPT_RCPT# AND A.CLM_SECD = C.CVLCPT_CLM_SECD AND A.CVLCPT_RCPT_YR = C.TPOF_RCPT_YR AND A.CVLCPT_RCPT_RCPT = C.TPOF_RCPT_NO AND A.CLM_SECD = Z.CLM_SECD(+) AND A.CVLCPT_RCPT_YR = Z.CVLCPT_RCPT_YR(+) AND A.CVLCPT_RCPT_RCPT = Z.CVLCPT_RCPT_RCPT(+) AND A.CLM_SECD = D.CLM_SECD(+) AND A.CVLCPT_RCPT_YR = D.CVLCPT_RCPT_YR(+) AND A.CVLCPT_RCPT_RCPT = D.CVLCPT_RCPT_RCPT(+) AND D.CLM_SECD = E.CVLCPT_CLM_SECD(+) AND D.CVLCPT_RCPT_YR = E.TPOF_RCPT_YR(+) AND D.CVLCPT_RCPT_RCPT = E.TPOF_RCPT_NO(+) AND D.CVLCPT_OPM_OPM = E.TPOF_OPM_SQNO(+) AND D.SLCT_AVTSMT_AVTSMT(+) = 'C' AND D.ONR_DOC_MNG_CARD_ID = F.ONR_DOC_MNG_CARD_ID(+) AND F.ONR_APV_FL_DVSN_CD(+) = 'A' AND A.CLM_SECD = G.CVLCPT_CLM_SECD AND A.CVLCPT_RCPT_YR = G.TPOF_RCPT_YR AND A.CVLCPT_RCPT_RCPT = G.TPOF_RCPT_NO AND (G.CVLCPT_CLM_SECD, G.TPOF_RCPT_YR, G.TPOF_RCPT_NO, G.TPOF_SQNO) IN ( SELECT Z.CVLCPT_CLM_SECD /* 민원청구구분코드 */,
    Z.TPOF_RCPT_YR /* 제보접수년도 */,
    Z.TPOF_RCPT_NO /* 제보접수번호 */,
    MIN(Z.TPOF_SQNO) AS FRS_MDM_SQNO /* 포렌식매체순번 */
FROM TB_CSPDCP205L Z WHERE A.CLM_SECD = Z.CLM_SECD AND A.CVLCPT_RCPT_YR = Z.CVLCPT_RCPT_YR AND A.CVLCPT_RCPT_RCPT = Z.CVLCPT_RCPT_RCPT GROUP BY Z.CLM_SECD, Z.CVLCPT_RCPT_YR, Z.CVLCPT_RCPT_RCPT ) AND A.CLM_SECD = H.CLM_SECD(+) AND A.CVLCPT_RCPT_YR = H.CVLCPT_RCPT_YR(+) AND A.CVLCPT_RCPT_RCPT = H.CVLCPT_RCPT_RCPT(+)